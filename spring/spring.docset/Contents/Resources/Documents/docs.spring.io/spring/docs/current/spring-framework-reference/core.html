<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Core Technologies</title>
<link rel="stylesheet" href="stylesheets/asciidoctor-spring.css" /><link rel="stylesheet" href="tocbot-3.0.2/tocbot.css" /><style>#tocbot a.toc-link.node-name--H1{font-style:italic}@media screen{#tocbot>ul.toc-list{margin-bottom:.5em;margin-left:.125em}#tocbot ul.sectlevel0,#tocbot a.toc-link.node-name--H1+ul{padding-left:0}#tocbot a.toc-link{height:100%}.is-collapsible{max-height:3000px;overflow:hidden}.is-collapsed{max-height:0}.is-active-link{font-weight:700}}@media print{#tocbot a.toc-link.node-name--H4{display:none}}</style>
<link rel="stylesheet" href="../../../../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 .5em 0 .25em}.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}table.CodeRay td{vertical-align:top;line-height:1.45}table.CodeRay td.line-numbers{text-align:right}table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}table.CodeRay td.code{padding:0 0 0 .5em}table.CodeRay td.code>pre{padding:0}.CodeRay .debug{color:#fff!important;background:navy!important}.CodeRay .annotation{color:#007}.CodeRay .attribute-name{color:navy}.CodeRay .attribute-value{color:#700}.CodeRay .binary{color:#509}.CodeRay .comment{color:#998;font-style:italic}.CodeRay .char{color:#04d}.CodeRay .char .content{color:#04d}.CodeRay .char .delimiter{color:#039}.CodeRay .class{color:#458;font-weight:bold}.CodeRay .complex{color:#a08}.CodeRay .constant,.CodeRay .predefined-constant{color:teal}.CodeRay .color{color:#099}.CodeRay .class-variable{color:#369}.CodeRay .decorator{color:#b0b}.CodeRay .definition{color:#099}.CodeRay .delimiter{color:#000}.CodeRay .doc{color:#970}.CodeRay .doctype{color:#34b}.CodeRay .doc-string{color:#d42}.CodeRay .escape{color:#666}.CodeRay .entity{color:#800}.CodeRay .error{color:#808}.CodeRay .exception{color:inherit}.CodeRay .filename{color:#099}.CodeRay .function{color:#900;font-weight:bold}.CodeRay .global-variable{color:teal}.CodeRay .hex{color:#058}.CodeRay .integer,.CodeRay .float{color:#099}.CodeRay .include{color:#555}.CodeRay .inline{color:#000}.CodeRay .inline .inline{background:#ccc}.CodeRay .inline .inline .inline{background:#bbb}.CodeRay .inline .inline-delimiter{color:#d14}.CodeRay .inline-delimiter{color:#d14}.CodeRay .important{color:#555;font-weight:bold}.CodeRay .interpreted{color:#b2b}.CodeRay .instance-variable{color:teal}.CodeRay .label{color:#970}.CodeRay .local-variable{color:#963}.CodeRay .octal{color:#40e}.CodeRay .predefined{color:#369}.CodeRay .preprocessor{color:#579}.CodeRay .pseudo-class{color:#555}.CodeRay .directive{font-weight:bold}.CodeRay .type{font-weight:bold}.CodeRay .predefined-type{color:inherit}.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}.CodeRay .key{color:#808}.CodeRay .key .delimiter{color:#606}.CodeRay .key .char{color:#80f}.CodeRay .value{color:#088}.CodeRay .regexp .delimiter{color:#808}.CodeRay .regexp .content{color:#808}.CodeRay .regexp .modifier{color:#808}.CodeRay .regexp .char{color:#d14}.CodeRay .regexp .function{color:#404;font-weight:bold}.CodeRay .string{color:#d20}.CodeRay .string .string .string{background:#ffd0d0}.CodeRay .string .content{color:#d14}.CodeRay .string .char{color:#d14}.CodeRay .string .delimiter{color:#d14}.CodeRay .shell{color:#d14}.CodeRay .shell .delimiter{color:#d14}.CodeRay .symbol{color:#990073}.CodeRay .symbol .content{color:#a60}.CodeRay .symbol .delimiter{color:#630}.CodeRay .tag{color:teal}.CodeRay .tag-special{color:#d70}.CodeRay .variable{color:#036}.CodeRay .insert{background:#afa}.CodeRay .delete{background:#faa}.CodeRay .change{color:#aaf;background:#007}.CodeRay .head{color:#f8f;background:#505}.CodeRay .insert .insert{color:#080}.CodeRay .delete .delete{color:#800}.CodeRay .change .change{color:#66f}.CodeRay .head .head{color:#f4f}</style>
</head>
<body id="spring-core" class="book toc2 toc-left">
<div id="header">
<h1>Core Technologies</h1>
<div class="details">
<span id="revnumber">version 5.0.4.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="core.html#beans">1. The IoC container</a>
<ul class="sectlevel2">
<li><a href="core.html#beans-introduction">1.1. Introduction to the Spring IoC container and beans</a></li>
<li><a href="core.html#beans-basics">1.2. Container overview</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-factory-metadata">1.2.1. Configuration metadata</a></li>
<li><a href="core.html#beans-factory-instantiation">1.2.2. Instantiating a container</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-xml-import">Composing XML-based configuration metadata</a></li>
<li><a href="core.html#groovy-bean-definition-dsl">The Groovy Bean Definition DSL</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-client">1.2.3. Using the container</a></li>
</ul>
</li>
<li><a href="core.html#beans-definition">1.3. Bean overview</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-beanname">1.3.1. Naming beans</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-beanname-alias">Aliasing a bean outside the bean definition</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-class">1.3.2. Instantiating beans</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-class-ctor">Instantiation with a constructor</a></li>
<li><a href="core.html#beans-factory-class-static-factory-method">Instantiation with a static factory method</a></li>
<li><a href="core.html#beans-factory-class-instance-factory-method">Instantiation using an instance factory method</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#beans-dependencies">1.4. Dependencies</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-factory-collaborators">1.4.1. Dependency Injection</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-constructor-injection">Constructor-based dependency injection</a></li>
<li><a href="core.html#beans-setter-injection">Setter-based dependency injection</a></li>
<li><a href="core.html#beans-dependency-resolution">Dependency resolution process</a></li>
<li><a href="core.html#beans-some-examples">Examples of dependency injection</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-properties-detailed">1.4.2. Dependencies and configuration in detail</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-value-element">Straight values (primitives, Strings, and so on)</a></li>
<li><a href="core.html#beans-ref-element">References to other beans (collaborators)</a></li>
<li><a href="core.html#beans-inner-beans">Inner beans</a></li>
<li><a href="core.html#beans-collection-elements">Collections</a></li>
<li><a href="core.html#beans-null-element">Null and empty string values</a></li>
<li><a href="core.html#beans-p-namespace">XML shortcut with the p-namespace</a></li>
<li><a href="core.html#beans-c-namespace">XML shortcut with the c-namespace</a></li>
<li><a href="core.html#beans-compound-property-names">Compound property names</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-dependson">1.4.3. Using depends-on</a></li>
<li><a href="core.html#beans-factory-lazy-init">1.4.4. Lazy-initialized beans</a></li>
<li><a href="core.html#beans-factory-autowire">1.4.5. Autowiring collaborators</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-autowired-exceptions">Limitations and disadvantages of autowiring</a></li>
<li><a href="core.html#beans-factory-autowire-candidate">Excluding a bean from autowiring</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-method-injection">1.4.6. Method injection</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-lookup-method-injection">Lookup method injection</a></li>
<li><a href="core.html#beans-factory-arbitrary-method-replacement">Arbitrary method replacement</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#beans-factory-scopes">1.5. Bean scopes</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-factory-scopes-singleton">1.5.1. The singleton scope</a></li>
<li><a href="core.html#beans-factory-scopes-prototype">1.5.2. The prototype scope</a></li>
<li><a href="core.html#beans-factory-scopes-sing-prot-interaction">1.5.3. Singleton beans with prototype-bean dependencies</a></li>
<li><a href="core.html#beans-factory-scopes-other">1.5.4. Request, session, application, and WebSocket scopes</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-scopes-other-web-configuration">Initial web configuration</a></li>
<li><a href="core.html#beans-factory-scopes-request">Request scope</a></li>
<li><a href="core.html#beans-factory-scopes-session">Session scope</a></li>
<li><a href="core.html#beans-factory-scopes-application">Application scope</a></li>
<li><a href="core.html#beans-factory-scopes-other-injection">Scoped beans as dependencies</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-scopes-custom">1.5.5. Custom scopes</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-scopes-custom-creating">Creating a custom scope</a></li>
<li><a href="core.html#beans-factory-scopes-custom-using">Using a custom scope</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#beans-factory-nature">1.6. Customizing the nature of a bean</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-factory-lifecycle">1.6.1. Lifecycle callbacks</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-lifecycle-initializingbean">Initialization callbacks</a></li>
<li><a href="core.html#beans-factory-lifecycle-disposablebean">Destruction callbacks</a></li>
<li><a href="core.html#beans-factory-lifecycle-default-init-destroy-methods">Default initialization and destroy methods</a></li>
<li><a href="core.html#beans-factory-lifecycle-combined-effects">Combining lifecycle mechanisms</a></li>
<li><a href="core.html#beans-factory-lifecycle-processor">Startup and shutdown callbacks</a></li>
<li><a href="core.html#beans-factory-shutdown">Shutting down the Spring IoC container gracefully in non-web applications</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-aware">1.6.2. ApplicationContextAware and BeanNameAware</a></li>
<li><a href="core.html#aware-list">1.6.3. Other Aware interfaces</a></li>
</ul>
</li>
<li><a href="core.html#beans-child-bean-definitions">1.7. Bean definition inheritance</a></li>
<li><a href="core.html#beans-factory-extension">1.8. Container Extension Points</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-factory-extension-bpp">1.8.1. Customizing beans using a BeanPostProcessor</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-extension-bpp-examples-hw">Example: Hello World, BeanPostProcessor-style</a></li>
<li><a href="core.html#beans-factory-extension-bpp-examples-rabpp">Example: The RequiredAnnotationBeanPostProcessor</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-extension-factory-postprocessors">1.8.2. Customizing configuration metadata with a BeanFactoryPostProcessor</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-factory-placeholderconfigurer">Example: the Class name substitution PropertyPlaceholderConfigurer</a></li>
<li><a href="core.html#beans-factory-overrideconfigurer">Example: the PropertyOverrideConfigurer</a></li>
</ul>
</li>
<li><a href="core.html#beans-factory-extension-factorybean">1.8.3. Customizing instantiation logic with a FactoryBean</a></li>
</ul>
</li>
<li><a href="core.html#beans-annotation-config">1.9. Annotation-based container configuration</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-required-annotation">1.9.1. @Required</a></li>
<li><a href="core.html#beans-autowired-annotation">1.9.2. @Autowired</a></li>
<li><a href="core.html#beans-autowired-annotation-primary">1.9.3. Fine-tuning annotation-based autowiring with @Primary</a></li>
<li><a href="core.html#beans-autowired-annotation-qualifiers">1.9.4. Fine-tuning annotation-based autowiring with qualifiers</a></li>
<li><a href="core.html#beans-generics-as-qualifiers">1.9.5. Using generics as autowiring qualifiers</a></li>
<li><a href="core.html#beans-custom-autowire-configurer">1.9.6. CustomAutowireConfigurer</a></li>
<li><a href="core.html#beans-resource-annotation">1.9.7. @Resource</a></li>
<li><a href="core.html#beans-postconstruct-and-predestroy-annotations">1.9.8. @PostConstruct and @PreDestroy</a></li>
</ul>
</li>
<li><a href="core.html#beans-classpath-scanning">1.10. Classpath scanning and managed components</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-stereotype-annotations">1.10.1. @Component and further stereotype annotations</a></li>
<li><a href="core.html#beans-meta-annotations">1.10.2. Meta-annotations</a></li>
<li><a href="core.html#beans-scanning-autodetection">1.10.3. Automatically detecting classes and registering bean definitions</a></li>
<li><a href="core.html#beans-scanning-filters">1.10.4. Using filters to customize scanning</a></li>
<li><a href="core.html#beans-factorybeans-annotations">1.10.5. Defining bean metadata within components</a></li>
<li><a href="core.html#beans-scanning-name-generator">1.10.6. Naming autodetected components</a></li>
<li><a href="core.html#beans-scanning-scope-resolver">1.10.7. Providing a scope for autodetected components</a></li>
<li><a href="core.html#beans-scanning-qualifiers">1.10.8. Providing qualifier metadata with annotations</a></li>
<li><a href="core.html#beans-scanning-index">1.10.9. Generating an index of candidate components</a></li>
</ul>
</li>
<li><a href="core.html#beans-standard-annotations">1.11. Using JSR 330 Standard Annotations</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-inject-named">1.11.1. Dependency Injection with @Inject and @Named</a></li>
<li><a href="core.html#beans-named">1.11.2. @Named and @ManagedBean: standard equivalents to the @Component annotation</a></li>
<li><a href="core.html#beans-standard-annotations-limitations">1.11.3. Limitations of JSR-330 standard annotations</a></li>
</ul>
</li>
<li><a href="core.html#beans-java">1.12. Java-based container configuration</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-java-basic-concepts">1.12.1. Basic concepts: @Bean and @Configuration</a></li>
<li><a href="core.html#beans-java-instantiating-container">1.12.2. Instantiating the Spring container using AnnotationConfigApplicationContext</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-java-instantiating-container-contstructor">Simple construction</a></li>
<li><a href="core.html#beans-java-instantiating-container-register">Building the container programmatically using register(Class&lt;?&gt;&#8230;&#8203;)</a></li>
<li><a href="core.html#beans-java-instantiating-container-scan">Enabling component scanning with scan(String&#8230;&#8203;)</a></li>
<li><a href="core.html#beans-java-instantiating-container-web">Support for web applications with AnnotationConfigWebApplicationContext</a></li>
</ul>
</li>
<li><a href="core.html#beans-java-bean-annotation">1.12.3. Using the @Bean annotation</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-java-declaring-a-bean">Declaring a bean</a></li>
<li><a href="core.html#beans-java-dependencies">Bean dependencies</a></li>
<li><a href="core.html#beans-java-lifecycle-callbacks">Receiving lifecycle callbacks</a></li>
<li><a href="core.html#beans-java-specifying-bean-scope">Specifying bean scope</a></li>
<li><a href="core.html#beans-java-customizing-bean-naming">Customizing bean naming</a></li>
<li><a href="core.html#beans-java-bean-aliasing">Bean aliasing</a></li>
<li><a href="core.html#beans-java-bean-description">Bean description</a></li>
</ul>
</li>
<li><a href="core.html#beans-java-configuration-annotation">1.12.4. Using the @Configuration annotation</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-java-injecting-dependencies">Injecting inter-bean dependencies</a></li>
<li><a href="core.html#beans-java-method-injection">Lookup method injection</a></li>
<li><a href="core.html#beans-java-further-information-java-config">Further information about how Java-based configuration works internally</a></li>
</ul>
</li>
<li><a href="core.html#beans-java-composing-configuration-classes">1.12.5. Composing Java-based configurations</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-java-using-import">Using the @Import annotation</a></li>
<li><a href="core.html#beans-java-conditional">Conditionally include @Configuration classes or @Bean methods</a></li>
<li><a href="core.html#beans-java-combining">Combining Java and XML configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#beans-environment">1.13. Environment abstraction</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-definition-profiles">1.13.1. Bean definition profiles</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-definition-profiles-java">@Profile</a></li>
<li><a href="core.html#beans-definition-profiles-xml">XML bean definition profiles</a></li>
<li><a href="core.html#beans-definition-profiles-enable">Activating a profile</a></li>
<li><a href="core.html#beans-definition-profiles-default">Default profile</a></li>
</ul>
</li>
<li><a href="core.html#beans-property-source-abstraction">1.13.2. PropertySource abstraction</a></li>
<li><a href="core.html#propertysource">1.13.3. @PropertySource</a></li>
<li><a href="core.html#placeholder-resolution-in-statements">1.13.4. Placeholder resolution in statements</a></li>
</ul>
</li>
<li><a href="core.html#context-load-time-weaver">1.14. Registering a LoadTimeWeaver</a></li>
<li><a href="core.html#context-introduction">1.15. Additional capabilities of the ApplicationContext</a>
<ul class="sectlevel3">
<li><a href="core.html#context-functionality-messagesource">1.15.1. Internationalization using MessageSource</a></li>
<li><a href="core.html#context-functionality-events">1.15.2. Standard and custom events</a>
<ul class="sectlevel4">
<li><a href="core.html#context-functionality-events-annotation">Annotation-based event listeners</a></li>
<li><a href="core.html#context-functionality-events-async">Asynchronous Listeners</a></li>
<li><a href="core.html#context-functionality-events-order">Ordering listeners</a></li>
<li><a href="core.html#context-functionality-events-generics">Generic events</a></li>
</ul>
</li>
<li><a href="core.html#context-functionality-resources">1.15.3. Convenient access to low-level resources</a></li>
<li><a href="core.html#context-create">1.15.4. Convenient ApplicationContext instantiation for web applications</a></li>
<li><a href="core.html#context-deploy-rar">1.15.5. Deploying a Spring ApplicationContext as a Java EE RAR file</a></li>
</ul>
</li>
<li><a href="core.html#beans-beanfactory">1.16. The BeanFactory</a>
<ul class="sectlevel3">
<li><a href="core.html#context-introduction-ctx-vs-beanfactory">1.16.1. BeanFactory or ApplicationContext?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#resources">2. Resources</a>
<ul class="sectlevel2">
<li><a href="core.html#resources-introduction">2.1. Introduction</a></li>
<li><a href="core.html#resources-resource">2.2. The Resource interface</a></li>
<li><a href="core.html#resources-implementations">2.3. Built-in Resource implementations</a>
<ul class="sectlevel3">
<li><a href="core.html#resources-implementations-urlresource">2.3.1. UrlResource</a></li>
<li><a href="core.html#resources-implementations-classpathresource">2.3.2. ClassPathResource</a></li>
<li><a href="core.html#resources-implementations-filesystemresource">2.3.3. FileSystemResource</a></li>
<li><a href="core.html#resources-implementations-servletcontextresource">2.3.4. ServletContextResource</a></li>
<li><a href="core.html#resources-implementations-inputstreamresource">2.3.5. InputStreamResource</a></li>
<li><a href="core.html#resources-implementations-bytearrayresource">2.3.6. ByteArrayResource</a></li>
</ul>
</li>
<li><a href="core.html#resources-resourceloader">2.4. The ResourceLoader</a></li>
<li><a href="core.html#resources-resourceloaderaware">2.5. The ResourceLoaderAware interface</a></li>
<li><a href="core.html#resources-as-dependencies">2.6. Resources as dependencies</a></li>
<li><a href="core.html#resources-app-ctx">2.7. Application contexts and Resource paths</a>
<ul class="sectlevel3">
<li><a href="core.html#resources-app-ctx-construction">2.7.1. Constructing application contexts</a>
<ul class="sectlevel4">
<li><a href="core.html#resources-app-ctx-classpathxml">Constructing ClassPathXmlApplicationContext instances - shortcuts</a></li>
</ul>
</li>
<li><a href="core.html#resources-app-ctx-wildcards-in-resource-paths">2.7.2. Wildcards in application context constructor resource paths</a>
<ul class="sectlevel4">
<li><a href="core.html#resources-app-ctx-ant-patterns-in-paths">Ant-style Patterns</a></li>
<li><a href="core.html#resources-classpath-wildcards">The classpath*: prefix</a></li>
<li><a href="core.html#resources-wildcards-in-path-other-stuff">Other notes relating to wildcards</a></li>
</ul>
</li>
<li><a href="core.html#resources-filesystemresource-caveats">2.7.3. FileSystemResource caveats</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#validation">3. Validation, Data Binding, and Type Conversion</a>
<ul class="sectlevel2">
<li><a href="core.html#validation-introduction">3.1. Introduction</a></li>
<li><a href="core.html#validator">3.2. Validation using Spring&#8217;s Validator interface</a></li>
<li><a href="core.html#validation-conversion">3.3. Resolving codes to error messages</a></li>
<li><a href="core.html#beans-beans">3.4. Bean manipulation and the BeanWrapper</a>
<ul class="sectlevel3">
<li><a href="core.html#beans-beans-conventions">3.4.1. Setting and getting basic and nested properties</a></li>
<li><a href="core.html#beans-beans-conversion">3.4.2. Built-in PropertyEditor implementations</a>
<ul class="sectlevel4">
<li><a href="core.html#beans-beans-conversion-customeditor-registration">Registering additional custom PropertyEditors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#core-convert">3.5. Spring Type Conversion</a>
<ul class="sectlevel3">
<li><a href="core.html#core-convert-Converter-API">3.5.1. Converter SPI</a></li>
<li><a href="core.html#core-convert-ConverterFactory-SPI">3.5.2. ConverterFactory</a></li>
<li><a href="core.html#core-convert-GenericConverter-SPI">3.5.3. GenericConverter</a>
<ul class="sectlevel4">
<li><a href="core.html#core-convert-ConditionalGenericConverter-SPI">ConditionalGenericConverter</a></li>
</ul>
</li>
<li><a href="core.html#core-convert-ConversionService-API">3.5.4. ConversionService API</a></li>
<li><a href="core.html#core-convert-Spring-config">3.5.5. Configuring a ConversionService</a></li>
<li><a href="core.html#core-convert-programmatic-usage">3.5.6. Using a ConversionService programmatically</a></li>
</ul>
</li>
<li><a href="core.html#format">3.6. Spring Field Formatting</a>
<ul class="sectlevel3">
<li><a href="core.html#format-Formatter-SPI">3.6.1. Formatter SPI</a></li>
<li><a href="core.html#format-CustomFormatAnnotations">3.6.2. Annotation-driven Formatting</a>
<ul class="sectlevel4">
<li><a href="core.html#format-annotations-api">Format Annotation API</a></li>
</ul>
</li>
<li><a href="core.html#format-FormatterRegistry-SPI">3.6.3. FormatterRegistry SPI</a></li>
<li><a href="core.html#format-FormatterRegistrar-SPI">3.6.4. FormatterRegistrar SPI</a></li>
<li><a href="core.html#format-configuring-formatting-mvc">3.6.5. Configuring Formatting in Spring MVC</a></li>
</ul>
</li>
<li><a href="core.html#format-configuring-formatting-globaldatetimeformat">3.7. Configuring a global date &amp; time format</a></li>
<li><a href="core.html#validation-beanvalidation">3.8. Spring Validation</a>
<ul class="sectlevel3">
<li><a href="core.html#validation-beanvalidation-overview">3.8.1. Overview of the JSR-303 Bean Validation API</a></li>
<li><a href="core.html#validation-beanvalidation-spring">3.8.2. Configuring a Bean Validation Provider</a>
<ul class="sectlevel4">
<li><a href="core.html#validation-beanvalidation-spring-inject">Injecting a Validator</a></li>
<li><a href="core.html#validation-beanvalidation-spring-constraints">Configuring Custom Constraints</a></li>
<li><a href="core.html#validation-beanvalidation-spring-method">Spring-driven Method Validation</a></li>
<li><a href="core.html#validation-beanvalidation-spring-other">Additional Configuration Options</a></li>
</ul>
</li>
<li><a href="core.html#validation-binder">3.8.3. Configuring a DataBinder</a></li>
<li><a href="core.html#validation-mvc">3.8.4. Spring MVC 3 Validation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#expressions">4. Spring Expression Language (SpEL)</a>
<ul class="sectlevel2">
<li><a href="core.html#expressions-intro">4.1. Introduction</a></li>
<li><a href="core.html#expressions-features">4.2. Feature overview</a></li>
<li><a href="core.html#expressions-evaluation">4.3. Expression evaluation using Spring&#8217;s Expression interface</a>
<ul class="sectlevel3">
<li><a href="core.html#expressions-evaluation-context">4.3.1. The EvaluationContext interface</a>
<ul class="sectlevel4">
<li><a href="core.html#expressions-type-conversion">Type conversion</a></li>
</ul>
</li>
<li><a href="core.html#expressions-parser-configuration">4.3.2. Parser configuration</a></li>
<li><a href="core.html#expressions-spel-compilation">4.3.3. SpEL compilation</a>
<ul class="sectlevel4">
<li><a href="core.html#expressions-compiler-configuration">Compiler configuration</a></li>
<li><a href="core.html#expressions-compiler-limitations">Compiler limitations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#expressions-beandef">4.4. Expression support for defining bean definitions</a>
<ul class="sectlevel3">
<li><a href="core.html#expressions-beandef-xml-based">4.4.1. XML based configuration</a></li>
<li><a href="core.html#expressions-beandef-annotation-based">4.4.2. Annotation-based configuration</a></li>
</ul>
</li>
<li><a href="core.html#expressions-language-ref">4.5. Language Reference</a>
<ul class="sectlevel3">
<li><a href="core.html#expressions-ref-literal">4.5.1. Literal expressions</a></li>
<li><a href="core.html#expressions-properties-arrays">4.5.2. Properties, Arrays, Lists, Maps, Indexers</a></li>
<li><a href="core.html#expressions-inline-lists">4.5.3. Inline lists</a></li>
<li><a href="core.html#expressions-inline-maps">4.5.4. Inline Maps</a></li>
<li><a href="core.html#expressions-array-construction">4.5.5. Array construction</a></li>
<li><a href="core.html#expressions-methods">4.5.6. Methods</a></li>
<li><a href="core.html#expressions-operators">4.5.7. Operators</a>
<ul class="sectlevel4">
<li><a href="core.html#expressions-operators-relational">Relational operators</a></li>
<li><a href="core.html#expressions-operators-logical">Logical operators</a></li>
<li><a href="core.html#expressions-operators-mathematical">Mathematical operators</a></li>
</ul>
</li>
<li><a href="core.html#expressions-assignment">4.5.8. Assignment</a></li>
<li><a href="core.html#expressions-types">4.5.9. Types</a></li>
<li><a href="core.html#expressions-constructors">4.5.10. Constructors</a></li>
<li><a href="core.html#expressions-ref-variables">4.5.11. Variables</a>
<ul class="sectlevel4">
<li><a href="core.html#expressions-this-root">The #this and #root variables</a></li>
</ul>
</li>
<li><a href="core.html#expressions-ref-functions">4.5.12. Functions</a></li>
<li><a href="core.html#expressions-bean-references">4.5.13. Bean references</a></li>
<li><a href="core.html#expressions-operator-ternary">4.5.14. Ternary Operator (If-Then-Else)</a></li>
<li><a href="core.html#expressions-operator-elvis">4.5.15. The Elvis Operator</a></li>
<li><a href="core.html#expressions-operator-safe-navigation">4.5.16. Safe Navigation operator</a></li>
<li><a href="core.html#expressions-collection-selection">4.5.17. Collection Selection</a></li>
<li><a href="core.html#expressions-collection-projection">4.5.18. Collection Projection</a></li>
<li><a href="core.html#expressions-templating">4.5.19. Expression templating</a></li>
</ul>
</li>
<li><a href="core.html#expressions-example-classes">4.6. Classes used in the examples</a></li>
</ul>
</li>
<li><a href="core.html#aop">5. Aspect Oriented Programming with Spring</a>
<ul class="sectlevel2">
<li><a href="core.html#aop-introduction">5.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-introduction-defn">5.1.1. AOP concepts</a></li>
<li><a href="core.html#aop-introduction-spring-defn">5.1.2. Spring AOP capabilities and goals</a></li>
<li><a href="core.html#aop-introduction-proxies">5.1.3. AOP Proxies</a></li>
</ul>
</li>
<li><a href="core.html#aop-ataspectj">5.2. @AspectJ support</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-aspectj-support">5.2.1. Enabling @AspectJ Support</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-enable-aspectj-java">Enabling @AspectJ Support with Java configuration</a></li>
<li><a href="core.html#aop-enable-aspectj-xml">Enabling @AspectJ Support with XML configuration</a></li>
</ul>
</li>
<li><a href="core.html#aop-at-aspectj">5.2.2. Declaring an aspect</a></li>
<li><a href="core.html#aop-pointcuts">5.2.3. Declaring a pointcut</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-pointcuts-designators">Supported Pointcut Designators</a></li>
<li><a href="core.html#aop-pointcuts-combining">Combining pointcut expressions</a></li>
<li><a href="core.html#aop-common-pointcuts">Sharing common pointcut definitions</a></li>
<li><a href="core.html#aop-pointcuts-examples">Examples</a></li>
<li><a href="core.html#writing-good-pointcuts">Writing good pointcuts</a></li>
</ul>
</li>
<li><a href="core.html#aop-advice">5.2.4. Declaring advice</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-advice-before">Before advice</a></li>
<li><a href="core.html#aop-advice-after-returning">After returning advice</a></li>
<li><a href="core.html#aop-advice-after-throwing">After throwing advice</a></li>
<li><a href="core.html#aop-advice-after-finally">After (finally) advice</a></li>
<li><a href="core.html#aop-ataspectj-around-advice">Around advice</a></li>
<li><a href="core.html#aop-ataspectj-advice-params">Advice parameters</a></li>
<li><a href="core.html#aop-ataspectj-advice-ordering">Advice ordering</a></li>
</ul>
</li>
<li><a href="core.html#aop-introductions">5.2.5. Introductions</a></li>
<li><a href="core.html#aop-instantiation-models">5.2.6. Aspect instantiation models</a></li>
<li><a href="core.html#aop-ataspectj-example">5.2.7. Example</a></li>
</ul>
</li>
<li><a href="core.html#aop-schema">5.3. Schema-based AOP support</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-schema-declaring-an-aspect">5.3.1. Declaring an aspect</a></li>
<li><a href="core.html#aop-schema-pointcuts">5.3.2. Declaring a pointcut</a></li>
<li><a href="core.html#aop-schema-advice">5.3.3. Declaring advice</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-schema-advice-before">Before advice</a></li>
<li><a href="core.html#aop-schema-advice-after-returning">After returning advice</a></li>
<li><a href="core.html#aop-schema-advice-after-throwing">After throwing advice</a></li>
<li><a href="core.html#aop-schema-advice-after-finally">After (finally) advice</a></li>
<li><a href="core.html#aop-schema-advice-around">Around advice</a></li>
<li><a href="core.html#aop-schema-params">Advice parameters</a></li>
<li><a href="core.html#aop-ordering">Advice ordering</a></li>
</ul>
</li>
<li><a href="core.html#aop-schema-introductions">5.3.4. Introductions</a></li>
<li><a href="core.html#aop-schema-instatiation-models">5.3.5. Aspect instantiation models</a></li>
<li><a href="core.html#aop-schema-advisors">5.3.6. Advisors</a></li>
<li><a href="core.html#aop-schema-example">5.3.7. Example</a></li>
</ul>
</li>
<li><a href="core.html#aop-choosing">5.4. Choosing which AOP declaration style to use</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-spring-or-aspectj">5.4.1. Spring AOP or full AspectJ?</a></li>
<li><a href="core.html#aop-ataspectj-or-xml">5.4.2. @AspectJ or XML for Spring AOP?</a></li>
</ul>
</li>
<li><a href="core.html#aop-mixing-styles">5.5. Mixing aspect types</a></li>
<li><a href="core.html#aop-proxying">5.6. Proxying mechanisms</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-understanding-aop-proxies">5.6.1. Understanding AOP proxies</a></li>
</ul>
</li>
<li><a href="core.html#aop-aspectj-programmatic">5.7. Programmatic creation of @AspectJ Proxies</a></li>
<li><a href="core.html#aop-using-aspectj">5.8. Using AspectJ with Spring applications</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-atconfigurable">5.8.1. Using AspectJ to dependency inject domain objects with Spring</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-configurable-testing">Unit testing @Configurable objects</a></li>
<li><a href="core.html#aop-configurable-container">Working with multiple application contexts</a></li>
</ul>
</li>
<li><a href="core.html#aop-ajlib-other">5.8.2. Other Spring aspects for AspectJ</a></li>
<li><a href="core.html#aop-aj-configure">5.8.3. Configuring AspectJ aspects using Spring IoC</a></li>
<li><a href="core.html#aop-aj-ltw">5.8.4. Load-time weaving with AspectJ in the Spring Framework</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-aj-ltw-first-example">A first example</a></li>
<li><a href="core.html#aop-aj-ltw-the-aspects">Aspects</a></li>
<li><a href="core.html#aop-aj-ltw-aop_dot_xml">'META-INF/aop.xml'</a></li>
<li><a href="core.html#aop-aj-ltw-libraries">Required libraries (JARS)</a></li>
<li><a href="core.html#aop-aj-ltw-spring">Spring configuration</a></li>
<li><a href="core.html#aop-aj-ltw-environments">Environment-specific configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#aop-resources">5.9. Further Resources</a></li>
</ul>
</li>
<li><a href="core.html#aop-api">6. Spring AOP APIs</a>
<ul class="sectlevel2">
<li><a href="core.html#aop-api-introduction">6.1. Introduction</a></li>
<li><a href="core.html#aop-api-pointcuts">6.2. Pointcut API in Spring</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-api-concepts">6.2.1. Concepts</a></li>
<li><a href="core.html#aop-api-pointcut-ops">6.2.2. Operations on pointcuts</a></li>
<li><a href="core.html#aop-api-pointcuts-aspectj">6.2.3. AspectJ expression pointcuts</a></li>
<li><a href="core.html#aop-api-pointcuts-impls">6.2.4. Convenience pointcut implementations</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-api-pointcuts-static">Static pointcuts</a></li>
<li><a href="core.html#aop-api-pointcuts-dynamic">Dynamic pointcuts</a></li>
</ul>
</li>
<li><a href="core.html#aop-api-pointcuts-superclasses">6.2.5. Pointcut superclasses</a></li>
<li><a href="core.html#aop-api-pointcuts-custom">6.2.6. Custom pointcuts</a></li>
</ul>
</li>
<li><a href="core.html#aop-api-advice">6.3. Advice API in Spring</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-api-advice-lifecycle">6.3.1. Advice lifecycles</a></li>
<li><a href="core.html#aop-api-advice-types">6.3.2. Advice types in Spring</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-api-advice-around">Interception around advice</a></li>
<li><a href="core.html#aop-api-advice-before">Before advice</a></li>
<li><a href="core.html#aop-api-advice-throws">Throws advice</a></li>
<li><a href="core.html#aop-api-advice-after-returning">After Returning advice</a></li>
<li><a href="core.html#aop-api-advice-introduction">Introduction advice</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#aop-api-advisor">6.4. Advisor API in Spring</a></li>
<li><a href="core.html#aop-pfb">6.5. Using the ProxyFactoryBean to create AOP proxies</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-pfb-1">6.5.1. Basics</a></li>
<li><a href="core.html#aop-pfb-2">6.5.2. JavaBean properties</a></li>
<li><a href="core.html#aop-pfb-proxy-types">6.5.3. JDK- and CGLIB-based proxies</a></li>
<li><a href="core.html#aop-api-proxying-intf">6.5.4. Proxying interfaces</a></li>
<li><a href="core.html#aop-api-proxying-class">6.5.5. Proxying classes</a></li>
<li><a href="core.html#aop-global-advisors">6.5.6. Using 'global' advisors</a></li>
</ul>
</li>
<li><a href="core.html#aop-concise-proxy">6.6. Concise proxy definitions</a></li>
<li><a href="core.html#aop-prog">6.7. Creating AOP proxies programmatically with the ProxyFactory</a></li>
<li><a href="core.html#aop-api-advised">6.8. Manipulating advised objects</a></li>
<li><a href="core.html#aop-autoproxy">6.9. Using the "auto-proxy" facility</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-autoproxy-choices">6.9.1. Autoproxy bean definitions</a>
<ul class="sectlevel4">
<li><a href="core.html#aop-api-autoproxy">BeanNameAutoProxyCreator</a></li>
<li><a href="core.html#aop-api-autoproxy-default">DefaultAdvisorAutoProxyCreator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="core.html#aop-targetsource">6.10. Using TargetSources</a>
<ul class="sectlevel3">
<li><a href="core.html#aop-ts-swap">6.10.1. Hot swappable target sources</a></li>
<li><a href="core.html#aop-ts-pool">6.10.2. Pooling target sources</a></li>
<li><a href="core.html#aop-ts-prototype">6.10.3. Prototype target sources</a></li>
<li><a href="core.html#aop-ts-threadlocal">6.10.4. ThreadLocal target sources</a></li>
</ul>
</li>
<li><a href="core.html#aop-extensibility">6.11. Defining new Advice types</a></li>
</ul>
</li>
<li><a href="core.html#null-safety">7. Null-safety</a>
<ul class="sectlevel2">
<li><a href="core.html#use-cases">7.1. Use cases</a></li>
<li><a href="core.html#jsr-305-meta-annotations">7.2. JSR 305 meta-annotations</a></li>
</ul>
</li>
<li><a href="core.html#databuffers">8. Data Buffers and Codecs</a>
<ul class="sectlevel2">
<li><a href="core.html#introduction">8.1. Introduction</a></li>
<li><a href="core.html#code-databufferfactory-code">8.2. <code>DataBufferFactory</code></a></li>
<li><a href="core.html#the-code-databuffer-code-interface">8.3. The <code>DataBuffer</code> interface</a>
<ul class="sectlevel3">
<li><a href="core.html#code-pooleddatabuffer-code">8.3.1. <code>PooledDataBuffer</code></a>
<ul class="sectlevel4">
<li><a href="core.html#databuffer-reference-counting">Reference Counting</a></li>
</ul>
</li>
<li><a href="core.html#databufferutils">8.3.2. DataBufferUtils</a></li>
</ul>
</li>
<li><a href="core.html#codecs">Codecs</a></li>
</ul>
</li>
<li><a href="core.html#appendix">9. Appendix</a>
<ul class="sectlevel2">
<li><a href="core.html#xsd-schemas">9.1. XML Schemas</a>
<ul class="sectlevel3">
<li><a href="core.html#xsd-schemas-util">9.1.1. The util schema</a>
<ul class="sectlevel4">
<li><a href="core.html#xsd-schemas-util-constant">&lt;util:constant/&gt;</a></li>
<li><a href="core.html#xsd-schemas-util-property-path">&lt;util:property-path/&gt;</a></li>
<li><a href="core.html#xsd-schemas-util-properties">&lt;util:properties/&gt;</a></li>
<li><a href="core.html#xsd-schemas-util-list">&lt;util:list/&gt;</a></li>
<li><a href="core.html#xsd-schemas-util-map">&lt;util:map/&gt;</a></li>
<li><a href="core.html#xsd-schemas-util-set">&lt;util:set/&gt;</a></li>
</ul>
</li>
<li><a href="core.html#xsd-schemas-aop">9.1.2. The aop schema</a></li>
<li><a href="core.html#xsd-schemas-context">9.1.3. The context schema</a>
<ul class="sectlevel4">
<li><a href="core.html#xsd-schemas-context-pphc">&lt;property-placeholder/&gt;</a></li>
<li><a href="core.html#xsd-schemas-context-ac">&lt;annotation-config/&gt;</a></li>
<li><a href="core.html#xsd-schemas-context-component-scan">&lt;component-scan/&gt;</a></li>
<li><a href="core.html#xsd-schemas-context-ltw">&lt;load-time-weaver/&gt;</a></li>
<li><a href="core.html#xsd-schemas-context-sc">&lt;spring-configured/&gt;</a></li>
<li><a href="core.html#xsd-schemas-context-mbe">&lt;mbean-export/&gt;</a></li>
</ul>
</li>
<li><a href="core.html#xsd-schemas-beans">9.1.4. The beans schema</a></li>
</ul>
</li>
<li><a href="core.html#xml-custom">9.2. XML Schema Authoring</a>
<ul class="sectlevel3">
<li><a href="core.html#xsd-custom-introduction">9.2.1. Introduction</a></li>
<li><a href="core.html#xsd-custom-schema">9.2.2. Authoring the schema</a></li>
<li><a href="core.html#xsd-custom-namespacehandler">9.2.3. Coding a NamespaceHandler</a></li>
<li><a href="core.html#xsd-custom-parser">9.2.4. BeanDefinitionParser</a></li>
<li><a href="core.html#xsd-custom-registration">9.2.5. Registering the handler and the schema</a>
<ul class="sectlevel4">
<li><a href="core.html#xsd-custom-registration-spring-handlers">'META-INF/spring.handlers'</a></li>
<li><a href="core.html#xsd-custom-registration-spring-schemas">'META-INF/spring.schemas'</a></li>
</ul>
</li>
<li><a href="core.html#xsd-custom-using">9.2.6. Using a custom extension in your Spring XML configuration</a></li>
<li><a href="core.html#xsd-custom-meat">9.2.7. Meatier examples</a>
<ul class="sectlevel4">
<li><a href="core.html#xsd-custom-custom-nested">Nesting custom tags within custom tags</a></li>
<li><a href="core.html#xsd-custom-custom-just-attributes">Custom attributes on 'normal' elements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This part of the reference documentation covers all of those technologies that are
absolutely integral to the Spring Framework.</p>
</div>
<div class="paragraph">
<p>Foremost amongst these is the Spring Framework&#8217;s Inversion of Control (IoC) container. A
thorough treatment of the Spring Framework&#8217;s IoC container is closely followed by
comprehensive coverage of Spring&#8217;s Aspect-Oriented Programming (AOP) technologies. The
Spring Framework has its own AOP framework, which is conceptually easy to understand,
and which successfully addresses the 80% sweet spot of AOP requirements in Java
enterprise programming.</p>
</div>
<div class="paragraph">
<p>Coverage of Spring&#8217;s integration with AspectJ (currently the richest - in terms of
features - and certainly most mature AOP implementation in the Java enterprise space) is
also provided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="beans"><a class="anchor" href="core.html#beans"></a>1. The IoC container</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="beans-introduction"><a class="anchor" href="core.html#beans-introduction"></a>1.1. Introduction to the Spring IoC container and beans</h3>
<div class="paragraph">
<p>This chapter covers the Spring Framework implementation of the Inversion of Control
(IoC) <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="core.html#_footnote_1" title="View footnote.">1</a>]</sup> principle. IoC
is also known as <em>dependency injection</em> (DI). It is a process whereby objects define
their dependencies, that is, the other objects they work with, only through constructor
arguments, arguments to a factory method, or properties that are set on the object
instance after it is constructed or returned from a factory method. The container then
<em>injects</em> those dependencies when it creates the bean. This process is fundamentally
the inverse, hence the name <em>Inversion of Control</em> (IoC), of the bean itself
controlling the instantiation or location of its dependencies by using direct
construction of classes, or a mechanism such as the <em>Service Locator</em> pattern.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.beans</code> and <code>org.springframework.context</code> packages are the basis
for Spring Framework&#8217;s IoC container. The
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/BeanFactory.html"><code>BeanFactory</code></a>
interface provides an advanced configuration mechanism capable of managing any type of
object.
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a>
is a sub-interface of <code>BeanFactory</code>. It adds easier integration with Spring&#8217;s AOP
features; message resource handling (for use in internationalization), event
publication; and application-layer specific contexts such as the <code>WebApplicationContext</code>
for use in web applications.</p>
</div>
<div class="paragraph">
<p>In short, the <code>BeanFactory</code> provides the configuration framework and basic
functionality, and the <code>ApplicationContext</code> adds more enterprise-specific functionality.
The <code>ApplicationContext</code> is a complete superset of the <code>BeanFactory</code>, and is used
exclusively in this chapter in descriptions of Spring&#8217;s IoC container. For more
information on using the <code>BeanFactory</code> instead of the <code>ApplicationContext,</code> refer to
<a href="core.html#beans-beanfactory">The BeanFactory</a>.</p>
</div>
<div class="paragraph">
<p>In Spring, the objects that form the backbone of your application and that are managed
by the Spring IoC <em>container</em> are called <em>beans</em>. A bean is an object that is
instantiated, assembled, and otherwise managed by a Spring IoC container. Otherwise, a
bean is simply one of many objects in your application. Beans, and the <em>dependencies</em>
among them, are reflected in the <em>configuration metadata</em> used by a container.</p>
</div>
</div>
<div class="sect2">
<h3 id="beans-basics"><a class="anchor" href="core.html#beans-basics"></a>1.2. Container overview</h3>
<div class="paragraph">
<p>The interface <code>org.springframework.context.ApplicationContext</code> represents the Spring IoC
container and is responsible for instantiating, configuring, and assembling the
aforementioned beans. The container gets its instructions on what objects to
instantiate, configure, and assemble by reading configuration metadata. The
configuration metadata is represented in XML, Java annotations, or Java code. It allows
you to express the objects that compose your application and the rich interdependencies
between such objects.</p>
</div>
<div class="paragraph">
<p>Several implementations of the <code>ApplicationContext</code> interface are supplied
out-of-the-box with Spring. In standalone applications it is common to create an
instance of
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html"><code>ClassPathXmlApplicationContext</code></a>
or <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html"><code>FileSystemXmlApplicationContext</code></a>.
While XML has been the traditional format for defining configuration metadata you can
instruct the container to use Java annotations or code as the metadata format by
providing a small amount of XML configuration to declaratively enable support for these
additional metadata formats.</p>
</div>
<div class="paragraph">
<p>In most application scenarios, explicit user code is not required to instantiate one or
more instances of a Spring IoC container. For example, in a web application scenario, a
simple eight (or so) lines of boilerplate web descriptor XML in the <code>web.xml</code> file
of the application will typically suffice (see <a href="core.html#context-create">Convenient ApplicationContext instantiation for web applications</a>). If you are using the
<a href="https://spring.io/tools/sts">Spring Tool Suite</a> Eclipse-powered development
environment this boilerplate configuration can be easily created with few mouse clicks or
keystrokes.</p>
</div>
<div class="paragraph">
<p>The following diagram is a high-level view of how Spring works. Your application classes
are combined with configuration metadata so that after the <code>ApplicationContext</code> is
created and initialized, you have a fully configured and executable system or
application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/container-magic.png" alt="container magic">
</div>
<div class="title">Figure 1. The Spring IoC container</div>
</div>
<div class="sect3">
<h4 id="beans-factory-metadata"><a class="anchor" href="core.html#beans-factory-metadata"></a>1.2.1. Configuration metadata</h4>
<div class="paragraph">
<p>As the preceding diagram shows, the Spring IoC container consumes a form of
<em>configuration metadata</em>; this configuration metadata represents how you as an
application developer tell the Spring container to instantiate, configure, and assemble
the objects in your application.</p>
</div>
<div class="paragraph">
<p>Configuration metadata is traditionally supplied in a simple and intuitive XML format,
which is what most of this chapter uses to convey key concepts and features of the
Spring IoC container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>XML-based metadata is <em>not</em> the only allowed form of configuration metadata. The
Spring IoC container itself is <em>totally</em> decoupled from the format in which this
configuration metadata is actually written. These days many developers choose
<a href="core.html#beans-java">Java-based configuration</a> for their Spring applications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about using other forms of metadata with the Spring container, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="core.html#beans-annotation-config">Annotation-based configuration</a>: Spring 2.5 introduced
support for annotation-based configuration metadata.</p>
</li>
<li>
<p><a href="core.html#beans-java">Java-based configuration</a>: Starting with Spring 3.0, many features
provided by the Spring JavaConfig project became part of the core Spring Framework.
Thus you can define beans external to your application classes by using Java rather
than XML files. To use these new features, see the <code>@Configuration</code>, <code>@Bean</code>, <code>@Import</code>
and <code>@DependsOn</code> annotations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring configuration consists of at least one and typically more than one bean
definition that the container must manage. XML-based configuration metadata shows these
beans configured as <code>&lt;bean/&gt;</code> elements inside a top-level <code>&lt;beans/&gt;</code> element. Java
configuration typically uses <code>@Bean</code> annotated methods within a <code>@Configuration</code> class.</p>
</div>
<div class="paragraph">
<p>These bean definitions correspond to the actual objects that make up your application.
Typically you define service layer objects, data access objects (DAOs), presentation
objects such as Struts <code>Action</code> instances, infrastructure objects such as Hibernate
<code>SessionFactories</code>, JMS <code>Queues</code>, and so forth. Typically one does not configure
fine-grained domain objects in the container, because it is usually the responsibility
of DAOs and business logic to create and load domain objects. However, you can use
Spring&#8217;s integration with AspectJ to configure objects that have been created outside
the control of an IoC container. See <a href="core.html#aop-atconfigurable">Using AspectJ to
dependency-inject domain objects with Spring</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows the basic structure of XML-based configuration metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- more bean definitions go here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>id</code> attribute is a string that you use to identify the individual bean definition.
The <code>class</code> attribute defines the type of the bean and uses the fully qualified
classname. The value of the id attribute refers to collaborating objects. The XML for
referring to collaborating objects is not shown in this example; see
<a href="core.html#beans-dependencies">Dependencies</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-instantiation"><a class="anchor" href="core.html#beans-factory-instantiation"></a>1.2.2. Instantiating a container</h4>
<div class="paragraph">
<p>Instantiating a Spring IoC container is straightforward. The location path or paths
supplied to an <code>ApplicationContext</code> constructor are actually resource strings that allow
the container to load configuration metadata from a variety of external resources such
as the local file system, from the Java <code>CLASSPATH</code>, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">services.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you learn about Spring&#8217;s IoC container, you may want to know more about Spring&#8217;s
<code>Resource</code> abstraction, as described in <a href="core.html#resources">Resources</a>, which provides a convenient
mechanism for reading an InputStream from locations defined in a URI syntax. In
particular, <code>Resource</code> paths are used to construct applications contexts as described in
<a href="core.html#resources-app-ctx">Application contexts and Resource paths</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the service layer objects <code>(services.xml)</code> configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- services --&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">petStore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.samples.jpetstore.services.PetStoreServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDao</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemDao</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- more bean definitions for services go here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows the data access objects <code>daos.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDao</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.samples.jpetstore.dao.jpa.JpaItemDao</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- more bean definitions for data access objects go here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the service layer consists of the class <code>PetStoreServiceImpl</code>,
and two data access objects of the type <code>JpaAccountDao</code> and <code>JpaItemDao</code> (based
on the JPA Object/Relational mapping standard). The <code>property name</code> element refers to the
name of the JavaBean property, and the <code>ref</code> element refers to the name of another bean
definition. This linkage between <code>id</code> and <code>ref</code> elements expresses the dependency between
collaborating objects. For details of configuring an object&#8217;s dependencies, see
<a href="core.html#beans-dependencies">Dependencies</a>.</p>
</div>
<div class="sect4">
<h5 id="beans-factory-xml-import"><a class="anchor" href="core.html#beans-factory-xml-import"></a>Composing XML-based configuration metadata</h5>
<div class="paragraph">
<p>It can be useful to have bean definitions span multiple XML files. Often each individual
XML configuration file represents a logical layer or module in your architecture.</p>
</div>
<div class="paragraph">
<p>You can use the application context constructor to load bean definitions from all these
XML fragments. This constructor takes multiple <code>Resource</code> locations, as was shown in the
previous section. Alternatively, use one or more occurrences of the <code>&lt;import/&gt;</code> element
to load bean definitions from another file or files. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">services.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resources/messageSource.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/themeSource.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, external bean definitions are loaded from three files:
<code>services.xml</code>, <code>messageSource.xml</code>, and <code>themeSource.xml</code>. All location paths are
relative to the definition file doing the importing, so <code>services.xml</code> must be in the
same directory or classpath location as the file doing the importing, while
<code>messageSource.xml</code> and <code>themeSource.xml</code> must be in a <code>resources</code> location below the
location of the importing file. As you can see, a leading slash is ignored, but given
that these paths are relative, it is better form not to use the slash at all. The
contents of the files being imported, including the top level <code>&lt;beans/&gt;</code> element, must
be valid XML bean definitions according to the Spring Schema.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible, but not recommended, to reference files in parent directories using a
relative "../" path. Doing so creates a dependency on a file that is outside the current
application. In particular, this reference is not recommended for "classpath:" URLs (for
example, "classpath:../services.xml"), where the runtime resolution process chooses the
"nearest" classpath root and then looks into its parent directory. Classpath
configuration changes may lead to the choice of a different, incorrect directory.</p>
</div>
<div class="paragraph">
<p>You can always use fully qualified resource locations instead of relative paths: for
example, "file:C:/config/services.xml" or "classpath:/config/services.xml". However, be
aware that you are coupling your application&#8217;s configuration to specific absolute
locations. It is generally preferable to keep an indirection for such absolute
locations, for example, through "${&#8230;&#8203;}" placeholders that are resolved against JVM
system properties at runtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The import directive is a feature provided by the beans namespace itself. Further
configuration features beyond plain bean definitions are available in a selection
of XML namespaces provided by Spring, e.g. the "context" and the "util" namespace.</p>
</div>
</div>
<div class="sect4">
<h5 id="groovy-bean-definition-dsl"><a class="anchor" href="core.html#groovy-bean-definition-dsl"></a>The Groovy Bean Definition DSL</h5>
<div class="paragraph">
<p>As a further example for externalized configuration metadata, bean definitions can also
be expressed in Spring&#8217;s Groovy Bean Definition DSL, as known from the Grails framework.
Typically, such configuration will live in a ".groovy" file with a structure as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">beans {
    dataSource(BasicDataSource) {
        driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbcDriver</span><span class="delimiter">&quot;</span></span>
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:mem:grailsDB</span><span class="delimiter">&quot;</span></span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
        settings = [mynew:<span class="string"><span class="delimiter">&quot;</span><span class="content">setting</span><span class="delimiter">&quot;</span></span>]
    }
    sessionFactory(SessionFactory) {
        dataSource = dataSource
    }
    myService(MyService) {
        nestedBean = { AnotherBean bean -&gt;
            dataSource = dataSource
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration style is largely equivalent to XML bean definitions and even
supports Spring&#8217;s XML configuration namespaces. It also allows for importing XML
bean definition files through an "importBeans" directive.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-client"><a class="anchor" href="core.html#beans-factory-client"></a>1.2.3. Using the container</h4>
<div class="paragraph">
<p>The <code>ApplicationContext</code> is the interface for an advanced factory capable of maintaining
a registry of different beans and their dependencies. Using the method <code>T getBean(String
name, Class&lt;T&gt; requiredType)</code> you can retrieve instances of your beans.</p>
</div>
<div class="paragraph">
<p>The <code>ApplicationContext</code> enables you to read bean definitions and access them as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create and configure beans</span>
ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">services.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.xml</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// retrieve configured instance</span>
PetStoreService service = context.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">petStore</span><span class="delimiter">&quot;</span></span>, PetStoreService.class);

<span class="comment">// use configured instance</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; userList = service.getUsernameList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>With Groovy configuration, bootstrapping looks very similar, just a different context
implementation class which is Groovy-aware (but also understands XML bean definitions):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext context = <span class="keyword">new</span> GenericGroovyApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">services.groovy</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.groovy</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most flexible variant is <code>GenericApplicationContext</code> in combination with reader
delegates, e.g. with <code>XmlBeanDefinitionReader</code> for XML files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GenericApplicationContext context = <span class="keyword">new</span> GenericApplicationContext();
<span class="keyword">new</span> XmlBeanDefinitionReader(context).loadBeanDefinitions(<span class="string"><span class="delimiter">&quot;</span><span class="content">services.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.xml</span><span class="delimiter">&quot;</span></span>);
context.refresh();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with <code>GroovyBeanDefinitionReader</code> for Groovy files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GenericApplicationContext context = <span class="keyword">new</span> GenericApplicationContext();
<span class="keyword">new</span> GroovyBeanDefinitionReader(context).loadBeanDefinitions(<span class="string"><span class="delimiter">&quot;</span><span class="content">services.groovy</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.groovy</span><span class="delimiter">&quot;</span></span>);
context.refresh();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such reader delegates can be mixed and matched on the same <code>ApplicationContext</code>,
reading bean definitions from diverse configuration sources, if desired.</p>
</div>
<div class="paragraph">
<p>You can then use <code>getBean</code> to retrieve instances of your beans. The <code>ApplicationContext</code>
interface has a few other methods for retrieving beans, but ideally your application
code should never use them. Indeed, your application code should have no calls to the
<code>getBean()</code> method at all, and thus no dependency on Spring APIs at all. For example,
Spring&#8217;s integration with web frameworks provides dependency injection for various web
framework components such as controllers and JSF-managed beans, allowing you to declare
a dependency on a specific bean through metadata (e.g. an autowiring annotation).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-definition"><a class="anchor" href="core.html#beans-definition"></a>1.3. Bean overview</h3>
<div class="paragraph">
<p>A Spring IoC container manages one or more <em>beans</em>. These beans are created with the
configuration metadata that you supply to the container, for example, in the form of XML
<code>&lt;bean/&gt;</code> definitions.</p>
</div>
<div class="paragraph">
<p>Within the container itself, these bean definitions are represented as <code>BeanDefinition</code>
objects, which contain (among other information) the following metadata:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>A package-qualified class name:</em> typically the actual implementation class of the
bean being defined.</p>
</li>
<li>
<p>Bean behavioral configuration elements, which state how the bean should behave in the
container (scope, lifecycle callbacks, and so forth).</p>
</li>
<li>
<p>References to other beans that are needed for the bean to do its work; these
references are also called <em>collaborators</em> or <em>dependencies</em>.</p>
</li>
<li>
<p>Other configuration settings to set in the newly created object, for example, the
number of connections to use in a bean that manages a connection pool, or the size
limit of the pool.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This metadata translates to a set of properties that make up each bean definition.</p>
</div>
<table id="beans-factory-bean-definition-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. The bean definition</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Explained in&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-class">Instantiating beans</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-beanname">Naming beans</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes">Bean scopes</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constructor arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-collaborators">Dependency Injection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-collaborators">Dependency Injection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autowiring mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-autowire">Autowiring collaborators</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lazy-initialization mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-lazy-init">Lazy-initialized beans</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialization method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-lifecycle-initializingbean">Initialization callbacks</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destruction method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-lifecycle-disposablebean">Destruction callbacks</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to bean definitions that contain information on how to create a specific
bean, the <code>ApplicationContext</code> implementations also permit the registration of existing
objects that are created outside the container, by users. This is done by accessing the
ApplicationContext&#8217;s BeanFactory via the method <code>getBeanFactory()</code> which returns the
BeanFactory implementation <code>DefaultListableBeanFactory</code>. <code>DefaultListableBeanFactory</code>
supports this registration through the methods <code>registerSingleton(..)</code> and
<code>registerBeanDefinition(..)</code>. However, typical applications work solely with beans
defined through metadata bean definitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Bean metadata and manually supplied singleton instances need to be registered as early
as possible, in order for the container to properly reason about them during autowiring
and other introspection steps. While overriding of existing metadata and existing
singleton instances is supported to some degree, the registration of new beans at
runtime (concurrently with live access to factory) is not officially supported and may
lead to concurrent access exceptions and/or inconsistent state in the bean container.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="beans-beanname"><a class="anchor" href="core.html#beans-beanname"></a>1.3.1. Naming beans</h4>
<div class="paragraph">
<p>Every bean has one or more identifiers. These identifiers must be unique within the
container that hosts the bean. A bean usually has only one identifier, but if it
requires more than one, the extra ones can be considered aliases.</p>
</div>
<div class="paragraph">
<p>In XML-based configuration metadata, you use the <code>id</code> and/or <code>name</code> attributes
to specify the bean identifier(s). The <code>id</code> attribute allows you to specify
exactly one id. Conventionally these names are alphanumeric ('myBean',
'fooService', etc.), but may contain special characters as well. If you want to
introduce other aliases to the bean, you can also specify them in the <code>name</code>
attribute, separated by a comma (<code>,</code>), semicolon (<code>;</code>), or white space. As a
historical note, in versions prior to Spring 3.1, the <code>id</code> attribute was
defined as an <code>xsd:ID</code> type, which constrained possible characters. As of 3.1,
it is defined as an <code>xsd:string</code> type. Note that bean <code>id</code> uniqueness is still
enforced by the container, though no longer by XML parsers.</p>
</div>
<div class="paragraph">
<p>You are not required to supply a name or id for a bean. If no name or id is supplied
explicitly, the container generates a unique name for that bean. However, if you want to
refer to that bean by name, through the use of the <code>ref</code> element or
<a href="core.html#beans-servicelocator">Service Locator</a> style lookup, you must provide a name.
Motivations for not supplying a name are related to using <a href="core.html#beans-inner-beans">inner
beans</a> and <a href="core.html#beans-factory-autowire">autowiring collaborators</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Bean Naming Conventions</div>
<div class="paragraph">
<p>The convention is to use the standard Java convention for instance field names when
naming beans. That is, bean names start with a lowercase letter, and are camel-cased
from then on. Examples of such names would be (without quotes) <code>'accountManager'</code>,
<code>'accountService'</code>, <code>'userDao'</code>, <code>'loginController'</code>, and so forth.</p>
</div>
<div class="paragraph">
<p>Naming beans consistently makes your configuration easier to read and understand, and if
you are using Spring AOP it helps a lot when applying advice to a set of beans related
by name.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With component scanning in the classpath, Spring generates bean names for unnamed
components, following the rules above: essentially, taking the simple class name
and turning its initial character to lower-case. However, in the (unusual) special
case when there is more than one character and both the first and second characters
are upper case, the original casing gets preserved. These are the same rules as
defined by <code>java.beans.Introspector.decapitalize</code> (which Spring is using here).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="beans-beanname-alias"><a class="anchor" href="core.html#beans-beanname-alias"></a>Aliasing a bean outside the bean definition</h5>
<div class="paragraph">
<p>In a bean definition itself, you can supply more than one name for the bean, by using a
combination of up to one name specified by the <code>id</code> attribute, and any number of other
names in the <code>name</code> attribute. These names can be equivalent aliases to the same bean,
and are useful for some situations, such as allowing each component in an application to
refer to a common dependency by using a bean name that is specific to that component
itself.</p>
</div>
<div class="paragraph">
<p>Specifying all aliases where the bean is actually defined is not always adequate,
however. It is sometimes desirable to introduce an alias for a bean that is defined
elsewhere. This is commonly the case in large systems where configuration is split
amongst each subsystem, each subsystem having its own set of object definitions. In
XML-based configuration metadata, you can use the <code>&lt;alias/&gt;</code> element to accomplish this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;alias</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fromName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">toName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a bean in the same container which is named <code>fromName</code>, may also,
after the use of this alias definition, be referred to as <code>toName</code>.</p>
</div>
<div class="paragraph">
<p>For example, the configuration metadata for subsystem A may refer to a DataSource via
the name <code>subsystemA-dataSource</code>. The configuration metadata for subsystem B may refer to
a DataSource via the name <code>subsystemB-dataSource</code>. When composing the main application
that uses both these subsystems the main application refers to the DataSource via the
name <code>myApp-dataSource</code>. To have all three names refer to the same object you add to the
MyApp configuration metadata the following aliases definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;alias</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">subsystemA-dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">subsystemB-dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;alias</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">subsystemA-dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myApp-dataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now each component and the main application can refer to the dataSource through a name
that is unique and guaranteed not to clash with any other definition (effectively
creating a namespace), yet they refer to the same bean.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Java-configuration</div>
<div class="paragraph">
<p>If you are using Java-configuration, the <code>@Bean</code> annotation can be used to provide aliases
see <a href="core.html#beans-java-bean-annotation">Using the @Bean annotation</a> for details.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-class"><a class="anchor" href="core.html#beans-factory-class"></a>1.3.2. Instantiating beans</h4>
<div class="paragraph">
<p>A bean definition essentially is a recipe for creating one or more objects. The
container looks at the recipe for a named bean when asked, and uses the configuration
metadata encapsulated by that bean definition to create (or acquire) an actual object.</p>
</div>
<div class="paragraph">
<p>If you use XML-based configuration metadata, you specify the type (or class) of object
that is to be instantiated in the <code>class</code> attribute of the <code>&lt;bean/&gt;</code> element. This
<code>class</code> attribute, which internally is a <code>Class</code> property on a <code>BeanDefinition</code>
instance, is usually mandatory. (For exceptions, see
<a href="core.html#beans-factory-class-instance-factory-method">Instantiation using an instance factory method</a> and <a href="core.html#beans-child-bean-definitions">Bean definition inheritance</a>.)
You use the <code>Class</code> property in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Typically, to specify the bean class to be constructed in the case where the container
itself directly creates the bean by calling its constructor reflectively, somewhat
equivalent to Java code using the <code>new</code> operator.</p>
</li>
<li>
<p>To specify the actual class containing the <code>static</code> factory method that will be
invoked to create the object, in the less common case where the container invokes a
<code>static</code> <em>factory</em> method on a class to create the bean. The object type returned
from the invocation of the <code>static</code> factory method may be the same class or another
class entirely.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<div class="title">Inner class names</div>
<p>If you want to configure a bean definition for a <code>static</code> nested class, you have to use
the <em>binary</em> name of the nested class.</p>
</div>
<div class="paragraph">
<p>For example, if you have a class called <code>Foo</code> in the <code>com.example</code> package, and this
<code>Foo</code> class has a <code>static</code> nested class called <code>Bar</code>, the value of the <code>'class'</code>
attribute on a bean definition would be&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><code>com.example.Foo$Bar</code></p>
</div>
<div class="paragraph">
<p>Notice the use of the <code>$</code> character in the name to separate the nested class name from
the outer class name.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-class-ctor"><a class="anchor" href="core.html#beans-factory-class-ctor"></a>Instantiation with a constructor</h5>
<div class="paragraph">
<p>When you create a bean by the constructor approach, all normal classes are usable by and
compatible with Spring. That is, the class being developed does not need to implement
any specific interfaces or to be coded in a specific fashion. Simply specifying the bean
class should suffice. However, depending on what type of IoC you use for that specific
bean, you may need a default (empty) constructor.</p>
</div>
<div class="paragraph">
<p>The Spring IoC container can manage virtually <em>any</em> class you want it to manage; it is
not limited to managing true JavaBeans. Most Spring users prefer actual JavaBeans with
only a default (no-argument) constructor and appropriate setters and getters modeled
after the properties in the container. You can also have more exotic non-bean-style
classes in your container. If, for example, you need to use a legacy connection pool
that absolutely does not adhere to the JavaBean specification, Spring can manage it as
well.</p>
</div>
<div class="paragraph">
<p>With XML-based configuration metadata you can specify your bean class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBeanTwo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For details about the mechanism for supplying arguments to the constructor (if required)
and setting object instance properties after the object is constructed, see
<a href="core.html#beans-factory-collaborators">Injecting Dependencies</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-class-static-factory-method"><a class="anchor" href="core.html#beans-factory-class-static-factory-method"></a>Instantiation with a static factory method</h5>
<div class="paragraph">
<p>When defining a bean that you create with a static factory method, you use the <code>class</code>
attribute to specify the class containing the <code>static</code> factory method and an attribute
named <code>factory-method</code> to specify the name of the factory method itself. You should be
able to call this method (with optional arguments as described later) and return a live
object, which subsequently is treated as if it had been created through a constructor.
One use for such a bean definition is to call <code>static</code> factories in legacy code.</p>
</div>
<div class="paragraph">
<p>The following bean definition specifies that the bean will be created by calling a
factory-method. The definition does not specify the type (class) of the returned object,
only the class containing the factory method. In this example, the <code>createInstance()</code>
method must be a <em>static</em> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ClientService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createInstance</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ClientService</span> {
    <span class="directive">private</span> <span class="directive">static</span> ClientService clientService = <span class="keyword">new</span> ClientService();
    <span class="directive">private</span> ClientService() {}

    <span class="directive">public</span> <span class="directive">static</span> ClientService createInstance() {
        <span class="keyword">return</span> clientService;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details about the mechanism for supplying (optional) arguments to the factory method
and setting object instance properties after the object is returned from the factory,
see <a href="core.html#beans-factory-properties-detailed">Dependencies and configuration in detail</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-class-instance-factory-method"><a class="anchor" href="core.html#beans-factory-class-instance-factory-method"></a>Instantiation using an instance factory method</h5>
<div class="paragraph">
<p>Similar to instantiation through a <a href="core.html#beans-factory-class-static-factory-method">static
factory method</a>, instantiation with an instance factory method invokes a non-static
method of an existing bean from the container to create a new bean. To use this
mechanism, leave the <code>class</code> attribute empty, and in the <code>factory-bean</code> attribute,
specify the name of a bean in the current (or parent/ancestor) container that contains
the instance method that is to be invoked to create the object. Set the name of the
factory method itself with the <code>factory-method</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceLocator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.DefaultServiceLocator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- the bean to be created via the factory bean --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceLocator</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createClientServiceInstance</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultServiceLocator</span> {

    <span class="directive">private</span> <span class="directive">static</span> ClientService clientService = <span class="keyword">new</span> ClientServiceImpl();

    <span class="directive">public</span> ClientService createClientServiceInstance() {
        <span class="keyword">return</span> clientService;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One factory class can also hold more than one factory method as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceLocator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.DefaultServiceLocator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceLocator</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createClientServiceInstance</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceLocator</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createAccountServiceInstance</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultServiceLocator</span> {

    <span class="directive">private</span> <span class="directive">static</span> ClientService clientService = <span class="keyword">new</span> ClientServiceImpl();

    <span class="directive">private</span> <span class="directive">static</span> AccountService accountService = <span class="keyword">new</span> AccountServiceImpl();

    <span class="directive">public</span> ClientService createClientServiceInstance() {
        <span class="keyword">return</span> clientService;
    }

    <span class="directive">public</span> AccountService createAccountServiceInstance() {
        <span class="keyword">return</span> accountService;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach shows that the factory bean itself can be managed and configured through
dependency injection (DI). See <a href="core.html#beans-factory-properties-detailed">Dependencies and
configuration in detail</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In Spring documentation,<em> factory bean</em> refers to a bean that is configured in the
Spring container that will create objects through an
<a href="core.html#beans-factory-class-instance-factory-method">instance</a> or
<a href="core.html#beans-factory-class-static-factory-method">static</a> factory method. By contrast,
<code>FactoryBean</code> (notice the capitalization) refers to a Spring-specific
<a href="core.html#beans-factory-extension-factorybean"><code>FactoryBean</code> </a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-dependencies"><a class="anchor" href="core.html#beans-dependencies"></a>1.4. Dependencies</h3>
<div class="paragraph">
<p>A typical enterprise application does not consist of a single object (or bean in the
Spring parlance). Even the simplest application has a few objects that work together to
present what the end-user sees as a coherent application. This next section explains how
you go from defining a number of bean definitions that stand alone to a fully realized
application where objects collaborate to achieve a goal.</p>
</div>
<div class="sect3">
<h4 id="beans-factory-collaborators"><a class="anchor" href="core.html#beans-factory-collaborators"></a>1.4.1. Dependency Injection</h4>
<div class="paragraph">
<p><em>Dependency injection</em> (DI) is a process whereby objects define their dependencies,
that is, the other objects they work with, only through constructor arguments, arguments
to a factory method, or properties that are set on the object instance after it is
constructed or returned from a factory method. The container then <em>injects</em> those
dependencies when it creates the bean. This process is fundamentally the inverse, hence
the name <em>Inversion of Control</em> (IoC), of the bean itself controlling the instantiation
or location of its dependencies on its own by using direct construction of classes, or
the <em>Service Locator</em> pattern.</p>
</div>
<div class="paragraph">
<p>Code is cleaner with the DI principle and decoupling is more effective when objects are
provided with their dependencies. The object does not look up its dependencies, and does
not know the location or class of the dependencies. As such, your classes become easier
to test, in particular when the dependencies are on interfaces or abstract base classes,
which allow for stub or mock implementations to be used in unit tests.</p>
</div>
<div class="paragraph">
<p>DI exists in two major variants, <a href="core.html#beans-constructor-injection">Constructor-based
dependency injection</a> and <a href="core.html#beans-setter-injection">Setter-based dependency injection</a>.</p>
</div>
<div class="sect4">
<h5 id="beans-constructor-injection"><a class="anchor" href="core.html#beans-constructor-injection"></a>Constructor-based dependency injection</h5>
<div class="paragraph">
<p><em>Constructor-based</em> DI is accomplished by the container invoking a constructor with a
number of arguments, each representing a dependency. Calling a <code>static</code> factory method
with specific arguments to construct the bean is nearly equivalent, and this discussion
treats arguments to a constructor and to a <code>static</code> factory method similarly. The
following example shows a class that can only be dependency-injected with constructor
injection. Notice that there is nothing <em>special</em> about this class, it is a POJO that
has no dependencies on container specific interfaces, base classes or annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="comment">// the SimpleMovieLister has a dependency on a MovieFinder</span>
    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="comment">// a constructor so that the Spring container can inject a MovieFinder</span>
    <span class="directive">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span>
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="beans-factory-ctor-arguments-resolution"><a class="anchor" href="core.html#beans-factory-ctor-arguments-resolution"></a>Constructor argument resolution</h6>
<div class="paragraph">
<p>Constructor argument resolution matching occurs using the argument&#8217;s type. If no
potential ambiguity exists in the constructor arguments of a bean definition, then the
order in which the constructor arguments are defined in a bean definition is the order
in which those arguments are supplied to the appropriate constructor when the bean is
being instantiated. Consider the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">x.y</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {

    <span class="directive">public</span> Foo(Bar bar, Baz baz) {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No potential ambiguity exists, assuming that <code>Bar</code> and <code>Baz</code> classes are not related by
inheritance. Thus the following configuration works fine, and you do not need to specify
the constructor argument indexes and/or types explicitly in the <code>&lt;constructor-arg/&gt;</code>
element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Baz</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When another bean is referenced, the type is known, and matching can occur (as was the
case with the preceding example). When a simple type is used, such as
<code>&lt;value&gt;true&lt;/value&gt;</code>, Spring cannot determine the type of the value, and so cannot match
by type without help. Consider the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">examples</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="comment">// Number of years to calculate the Ultimate Answer</span>
    <span class="directive">private</span> <span class="type">int</span> years;

    <span class="comment">// The Answer to Life, the Universe, and Everything</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> ultimateAnswer;

    <span class="directive">public</span> ExampleBean(<span class="type">int</span> years, <span class="predefined-type">String</span> ultimateAnswer) {
        <span class="local-variable">this</span>.years = years;
        <span class="local-variable">this</span>.ultimateAnswer = ultimateAnswer;
    }
}</code></pre>
</div>
</div>
<div class="openblock">
<div class="title"><a id="beans-factory-ctor-arguments-type"></a>Constructor argument type matching</div>
<div class="content">
<div class="paragraph">
<p>In the preceding scenario, the container <em>can</em> use type matching with simple types if
you explicitly specify the type of the constructor argument using the <code>type</code> attribute.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7500000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title"><a id="beans-factory-ctor-arguments-index"></a>Constructor argument index</div>
<div class="content">
<div class="paragraph">
<p>Use the <code>index</code> attribute to specify explicitly the index of constructor arguments. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7500000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to resolving the ambiguity of multiple simple values, specifying an index
resolves ambiguity where a constructor has two arguments of the same type. Note that the
<em>index is 0 based</em>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="title"><a id="beans-factory-ctor-arguments-name"></a>Constructor argument name</div>
<div class="content">
<div class="paragraph">
<p>You can also use the constructor parameter name for value disambiguation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">years</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7500000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ultimateAnswer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that to make this work out of the box your code must be compiled with the
debug flag enabled so that Spring can look up the parameter name from the constructor.
If you can&#8217;t compile your code with debug flag (or don&#8217;t want to) you can use
<a href="http://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html">@ConstructorProperties</a>
JDK annotation to explicitly name your constructor arguments. The sample class would
then have to look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">examples</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="comment">// Fields omitted</span>

    <span class="annotation">@ConstructorProperties</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">years</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ultimateAnswer</span><span class="delimiter">&quot;</span></span>})
    <span class="directive">public</span> ExampleBean(<span class="type">int</span> years, <span class="predefined-type">String</span> ultimateAnswer) {
        <span class="local-variable">this</span>.years = years;
        <span class="local-variable">this</span>.ultimateAnswer = ultimateAnswer;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-setter-injection"><a class="anchor" href="core.html#beans-setter-injection"></a>Setter-based dependency injection</h5>
<div class="paragraph">
<p><em>Setter-based</em> DI is accomplished by the container calling setter methods on your
beans after invoking a no-argument constructor or no-argument <code>static</code> factory method to
instantiate your bean.</p>
</div>
<div class="paragraph">
<p>The following example shows a class that can only be dependency-injected using pure
setter injection. This class is conventional Java. It is a POJO that has no dependencies
on container specific interfaces, base classes or annotations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="comment">// the SimpleMovieLister has a dependency on the MovieFinder</span>
    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="comment">// a setter method so that the Spring container can inject a MovieFinder</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ApplicationContext</code> supports constructor-based and setter-based DI for the beans it
manages. It also supports setter-based DI after some dependencies have already been
injected through the constructor approach. You configure the dependencies in the form of
a <code>BeanDefinition</code>, which you use in conjunction with <code>PropertyEditor</code> instances to
convert properties from one format to another. However, most Spring users do not work
with these classes directly (i.e., programmatically) but rather with XML <code>bean</code>
definitions, annotated components (i.e., classes annotated with <code>@Component</code>,
<code>@Controller</code>, etc.), or <code>@Bean</code> methods in Java-based <code>@Configuration</code> classes. These
sources are then converted internally into instances of <code>BeanDefinition</code> and used to
load an entire Spring IoC container instance.</p>
</div>
<div id="beans-constructor-vs-setter-injection" class="sidebarblock">
<div class="content">
<div class="title">Constructor-based or setter-based DI?</div>
<div class="paragraph">
<p>Since you can mix constructor-based and setter-based DI, it is a good rule of thumb to
use constructors for <em>mandatory dependencies</em> and setter methods or configuration methods
for <em>optional dependencies</em>. Note that use of the <a href="core.html#beans-required-annotation">@Required</a>
annotation on a setter method can be used to make the property a required dependency.</p>
</div>
<div class="paragraph">
<p>The Spring team generally advocates constructor injection as it enables one to implement
application components as <em>immutable objects</em> and to ensure that required dependencies
are not <code>null</code>. Furthermore constructor-injected components are always returned to client
(calling) code in a fully initialized state. As a side note, a large number of constructor
arguments is a <em>bad code smell</em>, implying that the class likely has too many
responsibilities and should be refactored to better address proper separation of concerns.</p>
</div>
<div class="paragraph">
<p>Setter injection should primarily only be used for optional dependencies that can be
assigned reasonable default values within the class. Otherwise, not-null checks must be
performed everywhere the code uses the dependency. One benefit of setter injection is that
setter methods make objects of that class amenable to reconfiguration or re-injection
later. Management through <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jmx">JMX MBeans</a> is therefore a compelling
use case for setter injection.</p>
</div>
<div class="paragraph">
<p>Use the DI style that makes the most sense for a particular class. Sometimes, when dealing
with third-party classes for which you do not have the source, the choice is made for you.
For example, if a third-party class does not expose any setter methods, then constructor
injection may be the only available form of DI.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-dependency-resolution"><a class="anchor" href="core.html#beans-dependency-resolution"></a>Dependency resolution process</h5>
<div class="paragraph">
<p>The container performs bean dependency resolution as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ApplicationContext</code> is created and initialized with configuration metadata that
describes all the beans. Configuration metadata can be specified via XML, Java code, or
annotations.</p>
</li>
<li>
<p>For each bean, its dependencies are expressed in the form of properties, constructor
arguments, or arguments to the static-factory method if you are using that instead of
a normal constructor. These dependencies are provided to the bean, <em>when the bean is
actually created</em>.</p>
</li>
<li>
<p>Each property or constructor argument is an actual definition of the value to set, or
a reference to another bean in the container.</p>
</li>
<li>
<p>Each property or constructor argument which is a value is converted from its specified
format to the actual type of that property or constructor argument. By default Spring
can convert a value supplied in string format to all built-in types, such as <code>int</code>,
<code>long</code>, <code>String</code>, <code>boolean</code>, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Spring container validates the configuration of each bean as the container is created.
However, the bean properties themselves are not set until the bean <em>is actually created</em>.
Beans that are singleton-scoped and set to be pre-instantiated (the default) are created
when the container is created. Scopes are defined in <a href="core.html#beans-factory-scopes">Bean scopes</a>. Otherwise,
the bean is created only when it is requested. Creation of a bean potentially causes a
graph of beans to be created, as the bean&#8217;s dependencies and its dependencies'
dependencies (and so on) are created and assigned. Note that resolution mismatches among
those dependencies may show up late, i.e. on first creation of the affected bean.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Circular dependencies</div>
<div class="paragraph">
<p>If you use predominantly constructor injection, it is possible to create an unresolvable
circular dependency scenario.</p>
</div>
<div class="paragraph">
<p>For example: Class A requires an instance of class B through constructor injection, and
class B requires an instance of class A through constructor injection. If you configure
beans for classes A and B to be injected into each other, the Spring IoC container
detects this circular reference at runtime, and throws a
<code>BeanCurrentlyInCreationException</code>.</p>
</div>
<div class="paragraph">
<p>One possible solution is to edit the source code of some classes to be configured by
setters rather than constructors. Alternatively, avoid constructor injection and use
setter injection only. In other words, although it is not recommended, you can configure
circular dependencies with setter injection.</p>
</div>
<div class="paragraph">
<p>Unlike the <em>typical</em> case (with no circular dependencies), a circular dependency
between bean A and bean B forces one of the beans to be injected into the other prior to
being fully initialized itself (a classic chicken/egg scenario).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>You can generally trust Spring to do the right thing. It detects configuration problems,
such as references to non-existent beans and circular dependencies, at container
load-time. Spring sets properties and resolves dependencies as late as possible, when
the bean is actually created. This means that a Spring container which has loaded
correctly can later generate an exception when you request an object if there is a
problem creating that object or one of its dependencies. For example, the bean throws an
exception as a result of a missing or invalid property. This potentially delayed
visibility of some configuration issues is why <code>ApplicationContext</code> implementations by
default pre-instantiate singleton beans. At the cost of some upfront time and memory to
create these beans before they are actually needed, you discover configuration issues
when the <code>ApplicationContext</code> is created, not later. You can still override this default
behavior so that singleton beans will lazy-initialize, rather than be pre-instantiated.</p>
</div>
<div class="paragraph">
<p>If no circular dependencies exist, when one or more collaborating beans are being
injected into a dependent bean, each collaborating bean is <em>totally</em> configured prior
to being injected into the dependent bean. This means that if bean A has a dependency on
bean B, the Spring IoC container completely configures bean B prior to invoking the
setter method on bean A. In other words, the bean is instantiated (if not a
pre-instantiated singleton), its dependencies are set, and the relevant lifecycle
methods (such as a <a href="core.html#beans-factory-lifecycle-initializingbean">configured init method</a>
or the <a href="core.html#beans-factory-lifecycle-initializingbean">InitializingBean callback method</a>)
are invoked.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-some-examples"><a class="anchor" href="core.html#beans-some-examples"></a>Examples of dependency injection</h5>
<div class="paragraph">
<p>The following example uses XML-based configuration metadata for setter-based DI. A small
part of a Spring XML configuration file specifies some bean definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- setter injection using the nested ref element --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanOne</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>

    <span class="comment">&lt;!-- setter injection using the neater ref attribute --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanTwo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">integerProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.AnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.YetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="directive">private</span> AnotherBean beanOne;

    <span class="directive">private</span> YetAnotherBean beanTwo;

    <span class="directive">private</span> <span class="type">int</span> i;

    <span class="directive">public</span> <span class="type">void</span> setBeanOne(AnotherBean beanOne) {
        <span class="local-variable">this</span>.beanOne = beanOne;
    }

    <span class="directive">public</span> <span class="type">void</span> setBeanTwo(YetAnotherBean beanTwo) {
        <span class="local-variable">this</span>.beanTwo = beanTwo;
    }

    <span class="directive">public</span> <span class="type">void</span> setIntegerProperty(<span class="type">int</span> i) {
        <span class="local-variable">this</span>.i = i;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, setters are declared to match against the properties specified
in the XML file. The following example uses constructor-based DI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- constructor injection using the nested ref element --&gt;</span>
    <span class="tag">&lt;constructor-arg&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/constructor-arg&gt;</span>

    <span class="comment">&lt;!-- constructor injection using the neater ref attribute --&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.AnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.YetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="directive">private</span> AnotherBean beanOne;

    <span class="directive">private</span> YetAnotherBean beanTwo;

    <span class="directive">private</span> <span class="type">int</span> i;

    <span class="directive">public</span> ExampleBean(
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="type">int</span> i) {
        <span class="local-variable">this</span>.beanOne = anotherBean;
        <span class="local-variable">this</span>.beanTwo = yetAnotherBean;
        <span class="local-variable">this</span>.i = i;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor arguments specified in the bean definition will be used as arguments to
the constructor of the <code>ExampleBean</code>.</p>
</div>
<div class="paragraph">
<p>Now consider a variant of this example, where instead of using a constructor, Spring is
told to call a <code>static</code> factory method to return an instance of the object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createInstance</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.AnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yetAnotherBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.YetAnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="comment">// a private constructor</span>
    <span class="directive">private</span> ExampleBean(...) {
        ...
    }

    <span class="comment">// a static factory method; the arguments to this method can be</span>
    <span class="comment">// considered the dependencies of the bean that is returned,</span>
    <span class="comment">// regardless of how those arguments are actually used.</span>
    <span class="directive">public</span> <span class="directive">static</span> ExampleBean createInstance (
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="type">int</span> i) {

        ExampleBean eb = <span class="keyword">new</span> ExampleBean (...);
        <span class="comment">// some other operations...</span>
        <span class="keyword">return</span> eb;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Arguments to the <code>static</code> factory method are supplied via <code>&lt;constructor-arg/&gt;</code> elements,
exactly the same as if a constructor had actually been used. The type of the class being
returned by the factory method does not have to be of the same type as the class that
contains the <code>static</code> factory method, although in this example it is. An instance
(non-static) factory method would be used in an essentially identical fashion (aside
from the use of the <code>factory-bean</code> attribute instead of the <code>class</code> attribute), so
details will not be discussed here.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-properties-detailed"><a class="anchor" href="core.html#beans-factory-properties-detailed"></a>1.4.2. Dependencies and configuration in detail</h4>
<div class="paragraph">
<p>As mentioned in the previous section, you can define bean properties and constructor
arguments as references to other managed beans (collaborators), or as values defined
inline. Spring&#8217;s XML-based configuration metadata supports sub-element types within its
<code>&lt;property/&gt;</code> and <code>&lt;constructor-arg/&gt;</code> elements for this purpose.</p>
</div>
<div class="sect4">
<h5 id="beans-value-element"><a class="anchor" href="core.html#beans-value-element"></a>Straight values (primitives, Strings, and so on)</h5>
<div class="paragraph">
<p>The <code>value</code> attribute of the <code>&lt;property/&gt;</code> element specifies a property or constructor
argument as a human-readable string representation. Spring&#8217;s
<a href="core.html#core-convert-ConversionService-API">conversion service</a> is used to convert these
values from a <code>String</code> to the actual type of the property or argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.dbcp.BasicDataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClassName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/mydb</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">masterkaoli</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example uses the <a href="core.html#beans-p-namespace">p-namespace</a> for even more succinct
XML configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.dbcp.BasicDataSource</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:driverClassName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/mydb</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">masterkaoli</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding XML is more succinct; however, typos are discovered at runtime rather than
design time, unless you use an IDE such as <a href="http://www.jetbrains.com/idea/">IntelliJ
IDEA</a> or the <a href="https://spring.io/tools/sts">Spring Tool Suite</a> (STS)
that support automatic property completion when you create bean definitions. Such IDE
assistance is highly recommended.</p>
</div>
<div class="paragraph">
<p>You can also configure a <code>java.util.Properties</code> instance as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- typed as a java.util.Properties --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>
            jdbc.driver.className=com.mysql.jdbc.Driver
            jdbc.url=jdbc:mysql://localhost:3306/mydb
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring container converts the text inside the <code>&lt;value/&gt;</code> element into a
<code>java.util.Properties</code> instance by using the JavaBeans <code>PropertyEditor</code> mechanism. This
is a nice shortcut, and is one of a few places where the Spring team do favor the use of
the nested <code>&lt;value/&gt;</code> element over the <code>value</code> attribute style.</p>
</div>
<div class="sect5">
<h6 id="beans-idref-element"><a class="anchor" href="core.html#beans-idref-element"></a>The idref element</h6>
<div class="paragraph">
<p>The <code>idref</code> element is simply an error-proof way to pass the <em>id</em> (string value - not
a reference) of another bean in the container to a <code>&lt;constructor-arg/&gt;</code> or <code>&lt;property/&gt;</code>
element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theTargetBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theClientBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;idref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theTargetBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above bean definition snippet is <em>exactly</em> equivalent (at runtime) to the
following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theTargetBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theTargetBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first form is preferable to the second, because using the <code>idref</code> tag allows the
container to validate <em>at deployment time</em> that the referenced, named bean actually
exists. In the second variation, no validation is performed on the value that is passed
to the <code>targetName</code> property of the <code>client</code> bean. Typos are only discovered (with most
likely fatal results) when the <code>client</code> bean is actually instantiated. If the <code>client</code>
bean is a <a href="core.html#beans-factory-scopes">prototype</a> bean, this typo and the resulting exception
may only be discovered long after the container is deployed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>local</code> attribute on the <code>idref</code> element is no longer supported in the 4.0 beans xsd
since it does not provide value over a regular <code>bean</code> reference anymore. Simply change
your existing <code>idref local</code> references to <code>idref bean</code> when upgrading to the 4.0 schema.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common place (at least in versions earlier than Spring 2.0) where the <code>&lt;idref/&gt;</code> element
brings value is in the configuration of <a href="core.html#aop-pfb-1">AOP interceptors</a> in a
<code>ProxyFactoryBean</code> bean definition. Using <code>&lt;idref/&gt;</code> elements when you specify the
interceptor names prevents you from misspelling an interceptor id.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-ref-element"><a class="anchor" href="core.html#beans-ref-element"></a>References to other beans (collaborators)</h5>
<div class="paragraph">
<p>The <code>ref</code> element is the final element inside a <code>&lt;constructor-arg/&gt;</code> or <code>&lt;property/&gt;</code>
definition element. Here you set the value of the specified property of a bean to be a
reference to another bean (a collaborator) managed by the container. The referenced bean
is a dependency of the bean whose property will be set, and it is initialized on demand
as needed before the property is set. (If the collaborator is a singleton bean, it may
be initialized already by the container.) All references are ultimately a reference to
another object. Scoping and validation depend on whether you specify the id/name of the
other object through the <code>bean</code>, <code>local,</code> or <code>parent</code> attributes.</p>
</div>
<div class="paragraph">
<p>Specifying the target bean through the <code>bean</code> attribute of the <code>&lt;ref/&gt;</code> tag is the most
general form, and allows creation of a reference to any bean in the same container or
parent container, regardless of whether it is in the same XML file. The value of the
<code>bean</code> attribute may be the same as the <code>id</code> attribute of the target bean, or as one of
the values in the <code>name</code> attribute of the target bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the target bean through the <code>parent</code> attribute creates a reference to a bean
that is in a parent container of the current container. The value of the <code>parent</code>
attribute may be the same as either the <code>id</code> attribute of the target bean, or one of the
values in the <code>name</code> attribute of the target bean, and the target bean must be in a
parent container of the current one. You use this bean reference variant mainly when you
have a hierarchy of containers and you want to wrap an existing bean in a parent
container with a proxy that will have the same name as the parent bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- in the parent context --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.SimpleAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- insert dependencies as required as here --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- in the child (descendant) context --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="error">&lt;</span><span class="error">!</span><span class="attribute-name">--</span> <span class="attribute-name">bean</span> <span class="attribute-name">name</span> <span class="attribute-name">is</span> <span class="attribute-name">the</span> <span class="attribute-name">same</span> <span class="attribute-name">as</span> <span class="attribute-name">the</span> <span class="attribute-name">parent</span> <span class="attribute-name">bean</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
    class=&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;<span class="error">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- notice how we refer to the parent bean --&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="comment">&lt;!-- insert other configuration and dependencies as required here --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>local</code> attribute on the <code>ref</code> element is no longer supported in the 4.0 beans xsd
since it does not provide value over a regular <code>bean</code> reference anymore. Simply change
your existing <code>ref local</code> references to <code>ref bean</code> when upgrading to the 4.0 schema.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-inner-beans"><a class="anchor" href="core.html#beans-inner-beans"></a>Inner beans</h5>
<div class="paragraph">
<p>A <code>&lt;bean/&gt;</code> element inside the <code>&lt;property/&gt;</code> or <code>&lt;constructor-arg/&gt;</code> elements defines a
so-called <em>inner bean</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.Person</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- this is the inner bean --&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fiona Apple</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An inner bean definition does not require a defined id or name; if specified, the container
does not use such a value as an identifier. The container also ignores the <code>scope</code> flag on
creation: Inner beans are <em>always</em> anonymous and they are <em>always</em> created with the outer
bean. It is <em>not</em> possible to inject inner beans into collaborating beans other than into
the enclosing bean or to access them independently.</p>
</div>
<div class="paragraph">
<p>As a corner case, it is possible to receive destruction callbacks from a custom scope, e.g.
for a request-scoped inner bean contained within a singleton bean: The creation of the inner
bean instance will be tied to its containing bean, but destruction callbacks allow it to
participate in the request scope&#8217;s lifecycle. This is not a common scenario; inner beans
typically simply share their containing bean&#8217;s scope.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-collection-elements"><a class="anchor" href="core.html#beans-collection-elements"></a>Collections</h5>
<div class="paragraph">
<p>In the <code>&lt;list/&gt;</code>, <code>&lt;set/&gt;</code>, <code>&lt;map/&gt;</code>, and <code>&lt;props/&gt;</code> elements, you set the properties
and arguments of the Java <code>Collection</code> types <code>List</code>, <code>Set</code>, <code>Map</code>, and <code>Properties</code>,
respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">moreComplexObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.ComplexObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- results in a setAdminEmails(java.util.Properties) call --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adminEmails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2647424b4f484f5552544752495466435e474b564a4308495441">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">support</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0d7e787d7d627f794d68756c607d616823627f6a">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="eb8f8e9d8e87849b868e859fab8e938a869b878ec584998c">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="comment">&lt;!-- results in a setSomeList(java.util.List) call --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>a list element followed by a reference<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="comment">&lt;!-- results in a setSomeMap(java.util.Map) call --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">an entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">just some string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">a ref</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="comment">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someSet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;value&gt;</span>just some string<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>The value of a map key or value, or a set value, can also again be any of the
following elements:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">bean | ref | idref | list | set | map | props | value | null</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="beans-collection-elements-merging"><a class="anchor" href="core.html#beans-collection-elements-merging"></a>Collection merging</h6>
<div class="paragraph">
<p>The Spring container also supports the <em>merging</em> of collections. An application
developer can define a parent-style <code>&lt;list/&gt;</code>, <code>&lt;map/&gt;</code>, <code>&lt;set/&gt;</code> or <code>&lt;props/&gt;</code> element,
and have child-style <code>&lt;list/&gt;</code>, <code>&lt;map/&gt;</code>, <code>&lt;set/&gt;</code> or <code>&lt;props/&gt;</code> elements inherit and
override values from the parent collection. That is, the child collection&#8217;s values are
the result of merging the elements of the parent and child collections, with the child&#8217;s
collection elements overriding values specified in the parent collection.</p>
</div>
<div class="paragraph">
<p><em>This section on merging discusses the parent-child bean mechanism. Readers unfamiliar
with parent and child bean definitions may wish to read the
<a href="core.html#beans-child-bean-definitions">relevant section</a> before continuing.</em></p>
</div>
<div class="paragraph">
<p>The following example demonstrates collection merging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.ComplexObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adminEmails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;props&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="81e0e5ece8efe8f2f5f3e0f5eef3c1e4f9e0ecf1ede4afe2eeec">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">support</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="364543464659444276534e575b465a531855595b">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">child</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adminEmails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- the merge is specified on the child collection definition --&gt;</span>
            <span class="tag">&lt;props</span> <span class="attribute-name">merge</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sales</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="89fae8e5ecfac9ecf1e8e4f9e5eca7eae6e4">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">support</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="087b7d7878677a7c486d70696578646d266b67267d63">[email&#160;protected]</a><span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the use of the <code>merge=true</code> attribute on the <code>&lt;props/&gt;</code> element of the
<code>adminEmails</code> property of the <code>child</code> bean definition. When the <code>child</code> bean is resolved
and instantiated by the container, the resulting instance has an <code>adminEmails</code>
<code>Properties</code> collection that contains the result of the merging of the child&#8217;s
<code>adminEmails</code> collection with the parent&#8217;s <code>adminEmails</code> collection.</p>
</div>
<div class="literalblock">
<div class="content">
<pre><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="99f8fdf4f0f7f0eaedebf8edf6eba4f8fdf4f0f7f0eaedebf8edf6ebd9fce1f8f4e9f5fcb7faf6f4">[email&#160;protected]</a>
<a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9deefcf1f8eea0eefcf1f8eeddf8e5fcf0edf1f8b3fef2f0">[email&#160;protected]</a>
<a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="02717772726d70763f717772726d707642677a636f726e672c616d2c7769">[email&#160;protected]</a></pre>
</div>
</div>
<div class="paragraph">
<p>The child <code>Properties</code> collection&#8217;s value set inherits all property elements from the
parent <code>&lt;props/&gt;</code>, and the child&#8217;s value for the <code>support</code> value overrides the value in
the parent collection.</p>
</div>
<div class="paragraph">
<p>This merging behavior applies similarly to the <code>&lt;list/&gt;</code>, <code>&lt;map/&gt;</code>, and <code>&lt;set/&gt;</code>
collection types. In the specific case of the <code>&lt;list/&gt;</code> element, the semantics
associated with the <code>List</code> collection type, that is, the notion of an <code>ordered</code>
collection of values, is maintained; the parent&#8217;s values precede all of the child list&#8217;s
values. In the case of the <code>Map</code>, <code>Set</code>, and <code>Properties</code> collection types, no ordering
exists. Hence no ordering semantics are in effect for the collection types that underlie
the associated <code>Map</code>, <code>Set</code>, and <code>Properties</code> implementation types that the container
uses internally.</p>
</div>
</div>
<div class="sect5">
<h6 id="beans-collection-merge-limitations"><a class="anchor" href="core.html#beans-collection-merge-limitations"></a>Limitations of collection merging</h6>
<div class="paragraph">
<p>You cannot merge different collection types (such as a <code>Map</code> and a <code>List</code>), and if you
do attempt to do so an appropriate <code>Exception</code> is thrown. The <code>merge</code> attribute must be
specified on the lower, inherited, child definition; specifying the <code>merge</code> attribute on
a parent collection definition is redundant and will not result in the desired merging.</p>
</div>
</div>
<div class="sect5">
<h6 id="beans-collection-elements-strongly-typed"><a class="anchor" href="core.html#beans-collection-elements-strongly-typed"></a>Strongly-typed collection</h6>
<div class="paragraph">
<p>With the introduction of generic types in Java 5, you can use strongly typed collections.
That is, it is possible to declare a <code>Collection</code> type such that it can only contain
<code>String</code> elements (for example). If you are using Spring to dependency-inject a
strongly-typed <code>Collection</code> into a bean, you can take advantage of Spring&#8217;s
type-conversion support such that the elements of your strongly-typed <code>Collection</code>
instances are converted to the appropriate type prior to being added to the <code>Collection</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {

    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Float</span>&gt; accounts;

    <span class="directive">public</span> <span class="type">void</span> setAccounts(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Float</span>&gt; accounts) {
        <span class="local-variable">this</span>.accounts = accounts;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accounts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9.99</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.75</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">six</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.99</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>accounts</code> property of the <code>foo</code> bean is prepared for injection, the generics
information about the element type of the strongly-typed <code>Map&lt;String, Float&gt;</code> is
available by reflection. Thus Spring&#8217;s type conversion infrastructure recognizes the
various value elements as being of type <code>Float</code>, and the string values <code>9.99, 2.75</code>, and
<code>3.99</code> are converted into an actual <code>Float</code> type.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-null-element"><a class="anchor" href="core.html#beans-null-element"></a>Null and empty string values</h5>
<div class="paragraph">
<p>Spring treats empty arguments for properties and the like as empty <code>Strings</code>. The
following XML-based configuration metadata snippet sets the email property to the empty
<code>String</code> value ("").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example is equivalent to the following Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">exampleBean.setEmail(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;null/&gt;</code> element handles <code>null</code> values. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;null</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration is equivalent to the following Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">exampleBean.setEmail(<span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-p-namespace"><a class="anchor" href="core.html#beans-p-namespace"></a>XML shortcut with the p-namespace</h5>
<div class="paragraph">
<p>The p-namespace enables you to use the <code>bean</code> element&#8217;s attributes, instead of nested
<code>&lt;property/&gt;</code> elements, to describe your property values and/or collaborating beans.</p>
</div>
<div class="paragraph">
<p>Spring supports extensible configuration formats
<a href="core.html#xsd-schemas">with namespaces</a>,
which are based on an XML Schema definition. The <code>beans</code> configuration format discussed in this
chapter is defined in an XML Schema document. However, the p-namespace is not defined in
an XSD file and exists only in the core of Spring.</p>
</div>
<div class="paragraph">
<p>The following example shows two XML snippets that resolve to the same result: The first
uses standard XML format and the second uses the p-namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8aece5e5cae8ebf8a4e9e5e7">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p-namespace</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ExampleBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:email</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cbada4a48ba9aab9e5a8a4a6">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example shows an attribute in the p-namespace called email in the bean definition.
This tells Spring to include a property declaration. As previously mentioned, the
p-namespace does not have a schema definition, so you can set the name of the attribute
to the property name.</p>
</div>
<div class="paragraph">
<p>This next example includes two more bean definitions that both have a reference to
another bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">john-classic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.Person</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spouse</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jane</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">john-modern</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.Person</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:spouse-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jane</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jane</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.Person</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Jane Doe</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this example includes not only a property value using the p-namespace,
but also uses a special format to declare property references. Whereas the first bean
definition uses <code>&lt;property name="spouse" ref="jane"/&gt;</code> to create a reference from bean
<code>john</code> to bean <code>jane</code>, the second bean definition uses <code>p:spouse-ref="jane"</code> as an
attribute to do the exact same thing. In this case <code>spouse</code> is the property name,
whereas the <code>-ref</code> part indicates that this is not a straight value but rather a
reference to another bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The p-namespace is not as flexible as the standard XML format. For example, the format
for declaring property references clashes with properties that end in <code>Ref</code>, whereas the
standard XML format does not. We recommend that you choose your approach carefully and
communicate this to your team members, to avoid producing XML documents that use all
three approaches at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-c-namespace"><a class="anchor" href="core.html#beans-c-namespace"></a>XML shortcut with the c-namespace</h5>
<div class="paragraph">
<p>Similar to the <a href="core.html#beans-p-namespace">XML shortcut with the p-namespace</a>, the <em>c-namespace</em>, newly introduced in Spring
3.1, allows usage of inlined attributes for configuring the constructor arguments rather
then nested <code>constructor-arg</code> elements.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s review the examples from <a href="core.html#beans-constructor-injection">Constructor-based dependency injection</a> with the <code>c:</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:c</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/c</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Baz</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- traditional declaration --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dcbab3b39cbebdaef2bfb3b1">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- c-namespace declaration --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">c:bar-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">c:baz-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">c:email</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cbada4a48ba9aab9e5a8a4a6">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>c:</code> namespace uses the same conventions as the <code>p:</code> one (trailing <code>-ref</code> for bean
references) for setting the constructor arguments by their names. And just as well, it
needs to be declared even though it is not defined in an XSD schema (but it exists
inside the Spring core).</p>
</div>
<div class="paragraph">
<p>For the rare cases where the constructor argument names are not available (usually if
the bytecode was compiled without debugging information), one can use fallback to the
argument indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- c-namespace index declaration --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">c:_0-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">c:_1-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the XML grammar, the index notation requires the presence of the leading <code>_</code> as
XML attribute names cannot start with a number (even though some IDE allow it).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In practice, the constructor resolution
<a href="core.html#beans-factory-ctor-arguments-resolution">mechanism</a> is quite efficient in matching
arguments so unless one really needs to, we recommend using the name notation
through-out your configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-compound-property-names"><a class="anchor" href="core.html#beans-compound-property-names"></a>Compound property names</h5>
<div class="paragraph">
<p>You can use compound or nested property names when you set bean properties, as long as
all components of the path except the final property name are not <code>null</code>. Consider the
following bean definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.Bar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fred.bob.sammy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>foo</code> bean has a <code>fred</code> property, which has a <code>bob</code> property, which has a <code>sammy</code>
property, and that final <code>sammy</code> property is being set to the value <code>123</code>. In order for
this to work, the <code>fred</code> property of <code>foo</code>, and the <code>bob</code> property of <code>fred</code> must not be
<code>null</code> after the bean is constructed, or a <code>NullPointerException</code> is thrown.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-dependson"><a class="anchor" href="core.html#beans-factory-dependson"></a>1.4.3. Using depends-on</h4>
<div class="paragraph">
<p>If a bean is a dependency of another that usually means that one bean is set as a
property of another. Typically you accomplish this with the <a href="core.html#beans-ref-element"><code>&lt;ref/&gt;</code>
element</a> in XML-based configuration metadata. However, sometimes dependencies between
beans are less direct; for example, a static initializer in a class needs to be
triggered, such as database driver registration. The <code>depends-on</code> attribute can
explicitly force one or more beans to be initialized before the bean using this element
is initialized. The following example uses the <code>depends-on</code> attribute to express a
dependency on a single bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanOne</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends-on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagerBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To express a dependency on multiple beans, supply a list of bean names as the value of
the <code>depends-on</code> attribute, with commas, whitespace and semicolons, used as valid
delimiters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanOne</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends-on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager,accountDao</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ManagerBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.jdbc.JdbcAccountDao</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>depends-on</code> attribute in the bean definition can specify both an initialization
time dependency and, in the case of <a href="core.html#beans-factory-scopes-singleton">singleton</a> beans
only, a corresponding destroy time dependency. Dependent beans that define a
<code>depends-on</code> relationship with a given bean are destroyed first, prior to the given bean
itself being destroyed. Thus <code>depends-on</code> can also control shutdown order.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-lazy-init"><a class="anchor" href="core.html#beans-factory-lazy-init"></a>1.4.4. Lazy-initialized beans</h4>
<div class="paragraph">
<p>By default, <code>ApplicationContext</code> implementations eagerly create and configure all
<a href="core.html#beans-factory-scopes-singleton">singleton</a> beans as part of the initialization
process. Generally, this pre-instantiation is desirable, because errors in the
configuration or surrounding environment are discovered immediately, as opposed to hours
or even days later. When this behavior is <em>not</em> desirable, you can prevent
pre-instantiation of a singleton bean by marking the bean definition as
lazy-initialized. A lazy-initialized bean tells the IoC container to create a bean
instance when it is first requested, rather than at startup.</p>
</div>
<div class="paragraph">
<p>In XML, this behavior is controlled by the <code>lazy-init</code> attribute on the <code>&lt;bean/&gt;</code>
element; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lazy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.ExpensiveToCreateBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lazy-init</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">not.lazy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.AnotherBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the preceding configuration is consumed by an <code>ApplicationContext</code>, the bean named
<code>lazy</code> is not eagerly pre-instantiated when the <code>ApplicationContext</code> is starting up,
whereas the <code>not.lazy</code> bean is eagerly pre-instantiated.</p>
</div>
<div class="paragraph">
<p>However, when a lazy-initialized bean is a dependency of a singleton bean that is
<em>not</em> lazy-initialized, the <code>ApplicationContext</code> creates the lazy-initialized bean at
startup, because it must satisfy the singleton&#8217;s dependencies. The lazy-initialized bean
is injected into a singleton bean elsewhere that is not lazy-initialized.</p>
</div>
<div class="paragraph">
<p>You can also control lazy-initialization at the container level by using the
<code>default-lazy-init</code> attribute on the <code>&lt;beans/&gt;</code> element; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">default-lazy-init</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- no beans will be pre-instantiated... --&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-autowire"><a class="anchor" href="core.html#beans-factory-autowire"></a>1.4.5. Autowiring collaborators</h4>
<div class="paragraph">
<p>The Spring container can <em>autowire</em> relationships between collaborating beans. You can
allow Spring to resolve collaborators (other beans) automatically for your bean by
inspecting the contents of the <code>ApplicationContext</code>. Autowiring has the following
advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Autowiring can significantly reduce the need to specify properties or constructor
arguments. (Other mechanisms such as a bean template
<a href="core.html#beans-child-bean-definitions">discussed elsewhere in this chapter</a> are also valuable
in this regard.)</p>
</li>
<li>
<p>Autowiring can update a configuration as your objects evolve. For example, if you need
to add a dependency to a class, that dependency can be satisfied automatically without
you needing to modify the configuration. Thus autowiring can be especially useful
during development, without negating the option of switching to explicit wiring when
the code base becomes more stable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using XML-based configuration metadata <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="core.html#_footnote_2" title="View footnote.">2</a>]</sup>, you specify autowire
mode for a bean definition with the <code>autowire</code> attribute of the <code>&lt;bean/&gt;</code> element. The
autowiring functionality has four modes. You specify autowiring <em>per</em> bean and thus
can choose which ones to autowire.</p>
</div>
<table id="beans-factory-autowiring-modes-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Autowiring modes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Default) No autowiring. Bean references must be defined via a <code>ref</code> element. Changing
the default setting is not recommended for larger deployments, because specifying
collaborators explicitly gives greater control and clarity. To some extent, it
documents the structure of a system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Autowiring by property name. Spring looks for a bean with the same name as the
property that needs to be autowired. For example, if a bean definition is set to
autowire by name, and it contains a <em>master</em> property (that is, it has a
<em>setMaster(..)</em> method), Spring looks for a bean definition named <code>master</code>, and uses
it to set the property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a property to be autowired if exactly one bean of the property type exists in
the container. If more than one exists, a fatal exception is thrown, which indicates
that you may not use <em>byType</em> autowiring for that bean. If there are no matching
beans, nothing happens; the property is not set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Analogous to <em>byType</em>, but applies to constructor arguments. If there is not exactly
one bean of the constructor argument type in the container, a fatal error is raised.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With <em>byType</em> or <em>constructor</em> autowiring mode, you can wire arrays and
typed-collections. In such cases <em>all</em> autowire candidates within the container that
match the expected type are provided to satisfy the dependency. You can autowire
strongly-typed Maps if the expected key type is <code>String</code>. An autowired Maps values will
consist of all bean instances that match the expected type, and the Maps keys will
contain the corresponding bean names.</p>
</div>
<div class="paragraph">
<p>You can combine autowire behavior with dependency checking, which is performed after
autowiring completes.</p>
</div>
<div class="sect4">
<h5 id="beans-autowired-exceptions"><a class="anchor" href="core.html#beans-autowired-exceptions"></a>Limitations and disadvantages of autowiring</h5>
<div class="paragraph">
<p>Autowiring works best when it is used consistently across a project. If autowiring is
not used in general, it might be confusing to developers to use it to wire only one or
two bean definitions.</p>
</div>
<div class="paragraph">
<p>Consider the limitations and disadvantages of autowiring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explicit dependencies in <code>property</code> and <code>constructor-arg</code> settings always override
autowiring. You cannot autowire so-called <em>simple</em> properties such as primitives,
<code>Strings</code>, and <code>Classes</code> (and arrays of such simple properties). This limitation is
by-design.</p>
</li>
<li>
<p>Autowiring is less exact than explicit wiring. Although, as noted in the above table,
Spring is careful to avoid guessing in case of ambiguity that might have unexpected
results, the relationships between your Spring-managed objects are no longer
documented explicitly.</p>
</li>
<li>
<p>Wiring information may not be available to tools that may generate documentation from
a Spring container.</p>
</li>
<li>
<p>Multiple bean definitions within the container may match the type specified by the
setter method or constructor argument to be autowired. For arrays, collections, or
Maps, this is not necessarily a problem. However for dependencies that expect a single
value, this ambiguity is not arbitrarily resolved. If no unique bean definition is
available, an exception is thrown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the latter scenario, you have several options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Abandon autowiring in favor of explicit wiring.</p>
</li>
<li>
<p>Avoid autowiring for a bean definition by setting its <code>autowire-candidate</code> attributes
to <code>false</code> as described in the next section.</p>
</li>
<li>
<p>Designate a single bean definition as the <em>primary</em> candidate by setting the
<code>primary</code> attribute of its <code>&lt;bean/&gt;</code> element to <code>true</code>.</p>
</li>
<li>
<p>Implement the more fine-grained control available
with annotation-based configuration, as described in <a href="core.html#beans-annotation-config">Annotation-based container configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-autowire-candidate"><a class="anchor" href="core.html#beans-factory-autowire-candidate"></a>Excluding a bean from autowiring</h5>
<div class="paragraph">
<p>On a per-bean basis, you can exclude a bean from autowiring. In Spring&#8217;s XML format, set
the <code>autowire-candidate</code> attribute of the <code>&lt;bean/&gt;</code> element to <code>false</code>; the container
makes that specific bean definition unavailable to the autowiring infrastructure
(including annotation style configurations such as <a href="core.html#beans-autowired-annotation"><code>@Autowired</code></a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>autowire-candidate</code> attribute is designed to only affect type-based autowiring.
It does not affect explicit references by name, which will get resolved even if the
specified bean is not marked as an autowire candidate. As a consequence, autowiring
by name will nevertheless inject a bean if the name matches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also limit autowire candidates based on pattern-matching against bean names. The
top-level <code>&lt;beans/&gt;</code> element accepts one or more patterns within its
<code>default-autowire-candidates</code> attribute. For example, to limit autowire candidate status
to any bean whose name ends with <em>Repository,</em> provide a value of *Repository. To
provide multiple patterns, define them in a comma-separated list. An explicit value of
<code>true</code> or <code>false</code> for a bean definitions <code>autowire-candidate</code> attribute always takes
precedence, and for such beans, the pattern matching rules do not apply.</p>
</div>
<div class="paragraph">
<p>These techniques are useful for beans that you never want to be injected into other
beans by autowiring. It does not mean that an excluded bean cannot itself be configured
using autowiring. Rather, the bean itself is not a candidate for autowiring other beans.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-method-injection"><a class="anchor" href="core.html#beans-factory-method-injection"></a>1.4.6. Method injection</h4>
<div class="paragraph">
<p>In most application scenarios, most beans in the container are
<a href="core.html#beans-factory-scopes-singleton">singletons</a>. When a singleton bean needs to
collaborate with another singleton bean, or a non-singleton bean needs to collaborate
with another non-singleton bean, you typically handle the dependency by defining one
bean as a property of the other. A problem arises when the bean lifecycles are
different. Suppose singleton bean A needs to use non-singleton (prototype) bean B,
perhaps on each method invocation on A. The container only creates the singleton bean A
once, and thus only gets one opportunity to set the properties. The container cannot
provide bean A with a new instance of bean B every time one is needed.</p>
</div>
<div class="paragraph">
<p>A solution is to forego some inversion of control. You can <a href="core.html#beans-factory-aware">make
bean A aware of the container</a> by implementing the <code>ApplicationContextAware</code> interface,
and by <a href="core.html#beans-factory-client">making a getBean("B") call to the container</a> ask for (a
typically new) bean B instance every time bean A needs it. The following is an example
of this approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// a class that uses a stateful Command-style class to perform some processing</span>
<span class="keyword">package</span> <span class="namespace">fiona.apple</span>;

<span class="comment">// Spring-API imports</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.BeansException</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationContextAware</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CommandManager</span> <span class="directive">implements</span> ApplicationContextAware {

    <span class="directive">private</span> ApplicationContext applicationContext;

    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Map</span> commandState) {
        <span class="comment">// grab a new instance of the appropriate Command</span>
        Command command = createCommand();
        <span class="comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="keyword">return</span> command.execute();
    }

    <span class="directive">protected</span> Command createCommand() {
        <span class="comment">// notice the Spring API dependency!</span>
        <span class="keyword">return</span> <span class="local-variable">this</span>.applicationContext.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">command</span><span class="delimiter">&quot;</span></span>, Command.class);
    }

    <span class="directive">public</span> <span class="type">void</span> setApplicationContext(
            ApplicationContext applicationContext) <span class="directive">throws</span> BeansException {
        <span class="local-variable">this</span>.applicationContext = applicationContext;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding is not desirable, because the business code is aware of and coupled to the
Spring Framework. Method Injection, a somewhat advanced feature of the Spring IoC
container, allows this use case to be handled in a clean fashion.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>You can read more about the motivation for Method Injection in
<a href="https://spring.io/blog/2004/08/06/method-injection/">this blog entry</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-lookup-method-injection"><a class="anchor" href="core.html#beans-factory-lookup-method-injection"></a>Lookup method injection</h5>
<div class="paragraph">
<p>Lookup method injection is the ability of the container to override methods on
<em>container managed beans</em>, to return the lookup result for another named bean in the
container. The lookup typically involves a prototype bean as in the scenario described
in the preceding section. The Spring Framework implements this method injection by using
bytecode generation from the CGLIB library to generate dynamically a subclass that
overrides the method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For this dynamic subclassing to work, the class that the Spring bean container will
subclass cannot be <code>final</code>, and the method to be overridden cannot be <code>final</code> either.</p>
</li>
<li>
<p>Unit-testing a class that has an <code>abstract</code> method requires you to subclass the class
yourself and to supply a stub implementation of the <code>abstract</code> method.</p>
</li>
<li>
<p>Concrete methods are also necessary for component scanning which requires concrete
classes to pick up.</p>
</li>
<li>
<p>A further key limitation is that lookup methods won&#8217;t work with factory methods and
in particular not with <code>@Bean</code> methods in configuration classes, since the container
is not in charge of creating the instance in that case and therefore cannot create
a runtime-generated subclass on the fly.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Looking at the <code>CommandManager</code> class in the previous code snippet, you see that the
Spring container will dynamically override the implementation of the <code>createCommand()</code>
method. Your <code>CommandManager</code> class will not have any Spring dependencies, as can be
seen in the reworked example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">fiona.apple</span>;

<span class="comment">// no more Spring imports!</span>

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CommandManager</span> {

    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Object</span> commandState) {
        <span class="comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();
        <span class="comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="keyword">return</span> command.execute();
    }

    <span class="comment">// okay... but where is the implementation of this method?</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> Command createCommand();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the client class containing the method to be injected (the <code>CommandManager</code> in this
case), the method to be injected requires a signature of the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;public</span><span class="error">|</span><span class="attribute-name">protected</span><span class="tag">&gt;</span> [abstract] <span class="tag">&lt;return-type&gt;</span> theMethodName(no-arguments);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the method is <code>abstract</code>, the dynamically-generated subclass implements the method.
Otherwise, the dynamically-generated subclass overrides the concrete method defined in
the original class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myCommand</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fiona.apple.AsyncCommand</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- inject dependencies here as required --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- commandProcessor uses statefulCommandHelper --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">commandManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fiona.apple.CommandManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;lookup-method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createCommand</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myCommand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean identified as <em>commandManager</em> calls its own method <code>createCommand()</code>
whenever it needs a new instance of the <em>myCommand</em> bean. You must be careful to deploy
the <code>myCommand</code> bean as a prototype, if that is actually what is needed. If it is
as a <a href="core.html#beans-factory-scopes-singleton">singleton</a>, the same instance of the <code>myCommand</code>
bean is returned each time.</p>
</div>
<div class="paragraph">
<p>Alternatively, within the annotation-based component model, you may declare a lookup
method through the <code>@Lookup</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CommandManager</span> {

    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Object</span> commandState) {
        Command command = createCommand();
        command.setState(commandState);
        <span class="keyword">return</span> command.execute();
    }

    <span class="annotation">@Lookup</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCommand</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="directive">abstract</span> Command createCommand();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, more idiomatically, you may rely on the target bean getting resolved against the
declared return type of the lookup method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CommandManager</span> {

    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Object</span> commandState) {
        MyCommand command = createCommand();
        command.setState(commandState);
        <span class="keyword">return</span> command.execute();
    }

    <span class="annotation">@Lookup</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> MyCommand createCommand();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you will typically declare such annotated lookup methods with a concrete
stub implementation, in order for them to be compatible with Spring&#8217;s component
scanning rules where abstract classes get ignored by default. This limitation does not
apply in case of explicitly registered or explicitly imported bean classes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Another way of accessing differently scoped target beans is an <code>ObjectFactory</code>/
<code>Provider</code> injection point. Check out <a href="core.html#beans-factory-scopes-other-injection">Scoped beans as dependencies</a>.</p>
</div>
<div class="paragraph">
<p>The interested reader may also find the <code>ServiceLocatorFactoryBean</code> (in the
<code>org.springframework.beans.factory.config</code> package) to be of use.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-arbitrary-method-replacement"><a class="anchor" href="core.html#beans-factory-arbitrary-method-replacement"></a>Arbitrary method replacement</h5>
<div class="paragraph">
<p>A less useful form of method injection than lookup method injection is the ability to
replace arbitrary methods in a managed bean with another method implementation. Users
may safely skip the rest of this section until the functionality is actually needed.</p>
</div>
<div class="paragraph">
<p>With XML-based configuration metadata, you can use the <code>replaced-method</code> element to
replace an existing method implementation with another, for a deployed bean. Consider
the following class, with a method computeValue, which we want to override:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyValueCalculator</span> {

    <span class="directive">public</span> <span class="predefined-type">String</span> computeValue(<span class="predefined-type">String</span> input) {
        <span class="comment">// some real code...</span>
    }

    <span class="comment">// some other methods...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A class implementing the <code>org.springframework.beans.factory.support.MethodReplacer</code>
interface provides the new method definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * meant to be used to override the existing computeValue(String)
 * implementation in MyValueCalculator
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReplacementComputeValue</span> <span class="directive">implements</span> MethodReplacer {

    <span class="directive">public</span> <span class="predefined-type">Object</span> reimplement(<span class="predefined-type">Object</span> o, <span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="comment">// get the input value, work with it, and return a computed result</span>
        <span class="predefined-type">String</span> input = (<span class="predefined-type">String</span>) args[<span class="integer">0</span>];
        ...
        return ...;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean definition to deploy the original class and specify the method override would
look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myValueCalculator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.z.MyValueCalculator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- arbitrary method replacement --&gt;</span>
    <span class="tag">&lt;replaced-method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">computeValue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">replacer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replacementComputeValue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;arg-type&gt;</span>String<span class="tag">&lt;/arg-type&gt;</span>
    <span class="tag">&lt;/replaced-method&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replacementComputeValue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a.b.c.ReplacementComputeValue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use one or more contained <code>&lt;arg-type/&gt;</code> elements within the <code>&lt;replaced-method/&gt;</code>
element to indicate the method signature of the method being overridden. The signature
for the arguments is necessary only if the method is overloaded and multiple variants
exist within the class. For convenience, the type string for an argument may be a
substring of the fully qualified type name. For example, the following all match
<code>java.lang.String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.lang.String
<span class="predefined-type">String</span>
Str</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the number of arguments is often enough to distinguish between each possible
choice, this shortcut can save a lot of typing, by allowing you to type only the
shortest string that will match an argument type.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-factory-scopes"><a class="anchor" href="core.html#beans-factory-scopes"></a>1.5. Bean scopes</h3>
<div class="paragraph">
<p>When you create a bean definition, you create a <em>recipe</em> for creating actual instances
of the class defined by that bean definition. The idea that a bean definition is a
recipe is important, because it means that, as with a class, you can create many object
instances from a single recipe.</p>
</div>
<div class="paragraph">
<p>You can control not only the various dependencies and configuration values that are to
be plugged into an object that is created from a particular bean definition, but also
the <em>scope</em> of the objects created from a particular bean definition. This approach is
powerful and flexible in that you can <em>choose</em> the scope of the objects you create
through configuration instead of having to bake in the scope of an object at the Java
class level. Beans can be defined to be deployed in one of a number of scopes: out of
the box, the Spring Framework supports six scopes, four of which are available only if
you use a web-aware <code>ApplicationContext</code>.</p>
</div>
<div class="paragraph">
<p>The following scopes are supported out of the box. You can also create
<a href="core.html#beans-factory-scopes-custom">a custom scope.</a></p>
</div>
<table id="beans-factory-scopes-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Bean scopes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes-singleton">singleton</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Default) Scopes a single bean definition to a single object instance per Spring IoC
container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes-prototype">prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scopes a single bean definition to any number of object instances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes-request">request</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scopes a single bean definition to the lifecycle of a single HTTP request; that is,
each HTTP request has its own instance of a bean created off the back of a single bean
definition. Only valid in the context of a web-aware Spring <code>ApplicationContext</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes-session">session</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scopes a single bean definition to the lifecycle of an HTTP <code>Session</code>. Only valid in
the context of a web-aware Spring <code>ApplicationContext</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-scopes-application">application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scopes a single bean definition to the lifecycle of a <code>ServletContext</code>. Only valid in
the context of a web-aware Spring <code>ApplicationContext</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#websocket-stomp-websocket-scope">websocket</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scopes a single bean definition to the lifecycle of a <code>WebSocket</code>. Only valid in
the context of a web-aware Spring <code>ApplicationContext</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring 3.0, a <em>thread scope</em> is available, but is not registered by default. For
more information, see the documentation for
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/support/SimpleThreadScope.html"><code>SimpleThreadScope</code></a>.
For instructions on how to register this or any other custom scope, see
<a href="core.html#beans-factory-scopes-custom-using">Using a custom scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="beans-factory-scopes-singleton"><a class="anchor" href="core.html#beans-factory-scopes-singleton"></a>1.5.1. The singleton scope</h4>
<div class="paragraph">
<p>Only one <em>shared</em> instance of a singleton bean is managed, and all requests for beans
with an id or ids matching that bean definition result in that one specific bean
instance being returned by the Spring container.</p>
</div>
<div class="paragraph">
<p>To put it another way, when you define a bean definition and it is scoped as a
singleton, the Spring IoC container creates <em>exactly one</em> instance of the object
defined by that bean definition. This single instance is stored in a cache of such
singleton beans, and <em>all subsequent requests and references</em> for that named bean
return the cached object.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/singleton.png" alt="singleton">
</div>
</div>
<div class="paragraph">
<p>Spring&#8217;s concept of a singleton bean differs from the Singleton pattern as defined in
the Gang of Four (GoF) patterns book. The GoF Singleton hard-codes the scope of an
object such that one <em>and only one</em> instance of a particular class is created <em>per
ClassLoader</em>. The scope of the Spring singleton is best described as <em>per container
and per bean</em>. This means that if you define one bean for a particular class in a
single Spring container, then the Spring container creates one <em>and only one</em> instance
of the class defined by that bean definition. <em>The singleton scope is the default scope
in Spring</em>. To define a bean as a singleton in XML, you would write, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultAccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-scopes-prototype"><a class="anchor" href="core.html#beans-factory-scopes-prototype"></a>1.5.2. The prototype scope</h4>
<div class="paragraph">
<p>The non-singleton, prototype scope of bean deployment results in the <em>creation of a new
bean instance</em> every time a request for that specific bean is made. That is, the bean
is injected into another bean or you request it through a <code>getBean()</code> method call on the
container. As a rule, use the prototype scope for all stateful beans and the singleton
scope for stateless beans.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the Spring prototype scope. <em>A data access object
(DAO) is not typically configured as a prototype, because a typical DAO does not hold
any conversational state; it was just easier for this author to reuse the core of the
singleton diagram.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/prototype.png" alt="prototype">
</div>
</div>
<div class="paragraph">
<p>The following example defines a bean as a prototype in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultAccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrast to the other scopes, Spring does not manage the complete lifecycle of a
prototype bean: the container instantiates, configures, and otherwise assembles a
prototype object, and hands it to the client, with no further record of that prototype
instance. Thus, although<em> initialization</em> lifecycle callback methods are called on all
objects regardless of scope, in the case of prototypes, configured <em>destruction</em>
lifecycle callbacks are <em>not</em> called. The client code must clean up prototype-scoped
objects and release expensive resources that the prototype bean(s) are holding. To get
the Spring container to release resources held by prototype-scoped beans, try using a
custom <a href="core.html#beans-factory-extension-bpp">bean post-processor</a>, which holds a reference to
beans that need to be cleaned up.</p>
</div>
<div class="paragraph">
<p>In some respects, the Spring container&#8217;s role in regard to a prototype-scoped bean is a
replacement for the Java <code>new</code> operator. All lifecycle management past that point must
be handled by the client. (For details on the lifecycle of a bean in the Spring
container, see <a href="core.html#beans-factory-lifecycle">Lifecycle callbacks</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-scopes-sing-prot-interaction"><a class="anchor" href="core.html#beans-factory-scopes-sing-prot-interaction"></a>1.5.3. Singleton beans with prototype-bean dependencies</h4>
<div class="paragraph">
<p>When you use singleton-scoped beans with dependencies on prototype beans, be aware that
<em>dependencies are resolved at instantiation time</em>. Thus if you dependency-inject a
prototype-scoped bean into a singleton-scoped bean, a new prototype bean is instantiated
and then dependency-injected into the singleton bean. The prototype instance is the sole
instance that is ever supplied to the singleton-scoped bean.</p>
</div>
<div class="paragraph">
<p>However, suppose you want the singleton-scoped bean to acquire a new instance of the
prototype-scoped bean repeatedly at runtime. You cannot dependency-inject a
prototype-scoped bean into your singleton bean, because that injection occurs only
<em>once</em>, when the Spring container is instantiating the singleton bean and resolving
and injecting its dependencies. If you need a new instance of a prototype bean at
runtime more than once, see <a href="core.html#beans-factory-method-injection">Method injection</a></p>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-scopes-other"><a class="anchor" href="core.html#beans-factory-scopes-other"></a>1.5.4. Request, session, application, and WebSocket scopes</h4>
<div class="paragraph">
<p>The <code>request</code>, <code>session</code>, <code>application</code>, and <code>websocket</code> scopes are <em>only</em> available
if you use a web-aware Spring <code>ApplicationContext</code> implementation (such as
<code>XmlWebApplicationContext</code>). If you use these scopes with regular Spring IoC containers
such as the <code>ClassPathXmlApplicationContext</code>, an <code>IllegalStateException</code> will be thrown
complaining about an unknown bean scope.</p>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-other-web-configuration"><a class="anchor" href="core.html#beans-factory-scopes-other-web-configuration"></a>Initial web configuration</h5>
<div class="paragraph">
<p>To support the scoping of beans at the <code>request</code>, <code>session</code>, <code>application</code>, and
<code>websocket</code> levels (web-scoped beans), some minor initial configuration is
required before you define your beans. (This initial setup is <em>not</em> required
for the standard scopes, <code>singleton</code> and <code>prototype</code>.)</p>
</div>
<div class="paragraph">
<p>How you accomplish this initial setup depends on your particular Servlet environment.</p>
</div>
<div class="paragraph">
<p>If you access scoped beans within Spring Web MVC, in effect, within a request that is
processed by the Spring <code>DispatcherServlet</code>, then no special setup is necessary:
<code>DispatcherServlet</code> already exposes all relevant state.</p>
</div>
<div class="paragraph">
<p>If you use a Servlet 2.5 web container, with requests processed outside of Spring&#8217;s
<code>DispatcherServlet</code> (for example, when using JSF or Struts), you need to register the
<code>org.springframework.web.context.request.RequestContextListener</code> <code>ServletRequestListener</code>.
For Servlet 3.0+, this can be done programmatically via the <code>WebApplicationInitializer</code>
interface. Alternatively, or for older containers, add the following declaration to
your web application&#8217;s <code>web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
    ...
    <span class="tag">&lt;listener&gt;</span>
        <span class="tag">&lt;listener-class&gt;</span>
            org.springframework.web.context.request.RequestContextListener
        <span class="tag">&lt;/listener-class&gt;</span>
    <span class="tag">&lt;/listener&gt;</span>
    ...
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if there are issues with your listener setup, consider using Spring&#8217;s
<code>RequestContextFilter</code>. The filter mapping depends on the surrounding web
application configuration, so you have to change it as appropriate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
    ...
    <span class="tag">&lt;filter&gt;</span>
        <span class="tag">&lt;filter-name&gt;</span>requestContextFilter<span class="tag">&lt;/filter-name&gt;</span>
        <span class="tag">&lt;filter-class&gt;</span>org.springframework.web.filter.RequestContextFilter<span class="tag">&lt;/filter-class&gt;</span>
    <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;filter-mapping&gt;</span>
        <span class="tag">&lt;filter-name&gt;</span>requestContextFilter<span class="tag">&lt;/filter-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/filter-mapping&gt;</span>
    ...
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DispatcherServlet</code>, <code>RequestContextListener</code>, and <code>RequestContextFilter</code> all do exactly
the same thing, namely bind the HTTP request object to the <code>Thread</code> that is servicing
that request. This makes beans that are request- and session-scoped available further
down the call chain.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-request"><a class="anchor" href="core.html#beans-factory-scopes-request"></a>Request scope</h5>
<div class="paragraph">
<p>Consider the following XML configuration for a bean definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loginAction</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.LoginAction</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring container creates a new instance of the <code>LoginAction</code> bean by using the
<code>loginAction</code> bean definition for each and every HTTP request. That is, the
<code>loginAction</code> bean is scoped at the HTTP request level. You can change the internal
state of the instance that is created as much as you want, because other instances
created from the same <code>loginAction</code> bean definition will not see these changes in state;
they are particular to an individual request. When the request completes processing, the
bean that is scoped to the request is discarded.</p>
</div>
<div class="paragraph">
<p>When using annotation-driven components or Java Config, the <code>@RequestScope</code> annotation
can be used to assign a component to the <code>request</code> scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><strong><span class="annotation">@RequestScope</span></strong>
<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginAction</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-session"><a class="anchor" href="core.html#beans-factory-scopes-session"></a>Session scope</h5>
<div class="paragraph">
<p>Consider the following XML configuration for a bean definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring container creates a new instance of the <code>UserPreferences</code> bean by using the
<code>userPreferences</code> bean definition for the lifetime of a single HTTP <code>Session</code>. In other
words, the <code>userPreferences</code> bean is effectively scoped at the HTTP <code>Session</code> level. As
with <code>request-scoped</code> beans, you can change the internal state of the instance that is
created as much as you want, knowing that other HTTP <code>Session</code> instances that are also
using instances created from the same <code>userPreferences</code> bean definition do not see these
changes in state, because they are particular to an individual HTTP <code>Session</code>. When the
HTTP <code>Session</code> is eventually discarded, the bean that is scoped to that particular HTTP
<code>Session</code> is also discarded.</p>
</div>
<div class="paragraph">
<p>When using annotation-driven components or Java Config, the <code>@SessionScope</code> annotation
can be used to assign a component to the <code>session</code> scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><strong><span class="annotation">@SessionScope</span></strong>
<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserPreferences</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-application"><a class="anchor" href="core.html#beans-factory-scopes-application"></a>Application scope</h5>
<div class="paragraph">
<p>Consider the following XML configuration for a bean definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">appPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.AppPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring container creates a new instance of the <code>AppPreferences</code> bean by using the
<code>appPreferences</code> bean definition once for the entire web application. That is, the
<code>appPreferences</code> bean is scoped at the <code>ServletContext</code> level, stored as a regular
<code>ServletContext</code> attribute. This is somewhat similar to a Spring singleton bean but
differs in two important ways: It is a singleton per <code>ServletContext</code>, not per Spring
'ApplicationContext' (for which there may be several in any given web application),
and it is actually exposed and therefore visible as a <code>ServletContext</code> attribute.</p>
</div>
<div class="paragraph">
<p>When using annotation-driven components or Java Config, the <code>@ApplicationScope</code>
annotation can be used to assign a component to the <code>application</code> scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><strong><span class="annotation">@ApplicationScope</span></strong>
<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppPreferences</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-other-injection"><a class="anchor" href="core.html#beans-factory-scopes-other-injection"></a>Scoped beans as dependencies</h5>
<div class="paragraph">
<p>The Spring IoC container manages not only the instantiation of your objects (beans),
but also the wiring up of collaborators (or dependencies). If you want to inject (for
example) an HTTP request scoped bean into another bean of a longer-lived scope, you may
choose to inject an AOP proxy in place of the scoped bean. That is, you need to inject
a proxy object that exposes the same public interface as the scoped object but that can
also retrieve the real target object from the relevant scope (such as an HTTP request)
and delegate method calls onto the real object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may also use <code>&lt;aop:scoped-proxy/&gt;</code> between beans that are scoped as <code>singleton</code>,
with the reference then going through an intermediate proxy that is serializable
and therefore able to re-obtain the target singleton bean on deserialization.</p>
</div>
<div class="paragraph">
<p>When declaring <code>&lt;aop:scoped-proxy/&gt;</code> against a bean of scope <code>prototype</code>, every method
call on the shared proxy will lead to the creation of a new target instance which the
call is then being forwarded to.</p>
</div>
<div class="paragraph">
<p>Also, scoped proxies are not the only way to access beans from shorter scopes in a
lifecycle-safe fashion. You may also simply declare your injection point (i.e. the
constructor/setter argument or autowired field) as <code>ObjectFactory&lt;MyTargetBean&gt;</code>,
allowing for a <code>getObject()</code> call to retrieve the current instance on demand every
time it is needed - without holding on to the instance or storing it separately.</p>
</div>
<div class="paragraph">
<p>As an extended variant, you may declare <code>ObjectProvider&lt;MyTargetBean&gt;</code> which delivers
several additional access variants, including <code>getIfAvailable</code> and <code>getIfUnique</code>.</p>
</div>
<div class="paragraph">
<p>The JSR-330 variant of this is called <code>Provider</code>, used with a <code>Provider&lt;MyTargetBean&gt;</code>
declaration and a corresponding <code>get()</code> call for every retrieval attempt.
See <a href="core.html#beans-standard-annotations">here</a> for more details on JSR-330 overall.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration in the following example is only one line, but it is important to
understand the "why" as well as the "how" behind it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:aop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/aop</span>
        <span class="content">http://www.springframework.org/schema/aop/spring-aop.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span>
        <span class="tag">&lt;aop:scoped-proxy</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.SimpleUserService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To create such a proxy, you insert a child <code>&lt;aop:scoped-proxy/&gt;</code> element into a scoped
bean definition (see <a href="core.html#beans-factory-scopes-other-injection-proxies">Choosing the type of proxy to create</a> and
<a href="core.html#xsd-schemas">XML Schema-based configuration</a>).
Why do definitions of beans scoped at the <code>request</code>, <code>session</code> and custom-scope
levels require the <code>&lt;aop:scoped-proxy/&gt;</code> element?
Let&#8217;s examine the following singleton bean definition and contrast it with
what you need to define for the aforementioned scopes (note that the following
<code>userPreferences</code> bean definition as it stands is <em>incomplete</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the singleton bean <code>userManager</code> is injected with a reference
to the HTTP <code>Session</code>-scoped bean <code>userPreferences</code>. The salient point here is that the
<code>userManager</code> bean is a singleton: it will be instantiated <em>exactly once</em> per
container, and its dependencies (in this case only one, the <code>userPreferences</code> bean) are
also injected only once. This means that the <code>userManager</code> bean will only operate on the
exact same <code>userPreferences</code> object, that is, the one that it was originally injected
with.</p>
</div>
<div class="paragraph">
<p>This is <em>not</em> the behavior you want when injecting a shorter-lived scoped bean into a
longer-lived scoped bean, for example injecting an HTTP <code>Session</code>-scoped collaborating
bean as a dependency into singleton bean. Rather, you need a single <code>userManager</code>
object, and for the lifetime of an HTTP <code>Session</code>, you need a <code>userPreferences</code> object
that is specific to said HTTP <code>Session</code>. Thus the container creates an object that
exposes the exact same public interface as the <code>UserPreferences</code> class (ideally an
object that <em>is a</em> <code>UserPreferences</code> instance) which can fetch the real
<code>UserPreferences</code> object from the scoping mechanism (HTTP request, <code>Session</code>, etc.). The
container injects this proxy object into the <code>userManager</code> bean, which is unaware that
this <code>UserPreferences</code> reference is a proxy. In this example, when a <code>UserManager</code>
instance invokes a method on the dependency-injected <code>UserPreferences</code> object, it
actually is invoking a method on the proxy. The proxy then fetches the real
<code>UserPreferences</code> object from (in this case) the HTTP <code>Session</code>, and delegates the
method invocation onto the retrieved real <code>UserPreferences</code> object.</p>
</div>
<div class="paragraph">
<p>Thus you need the following, correct and complete, configuration when injecting
<code>request-</code> and <code>session-scoped</code> beans into collaborating objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;aop:scoped-proxy</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="beans-factory-scopes-other-injection-proxies"><a class="anchor" href="core.html#beans-factory-scopes-other-injection-proxies"></a>Choosing the type of proxy to create</h6>
<div class="paragraph">
<p>By default, when the Spring container creates a proxy for a bean that is marked up with
the <code>&lt;aop:scoped-proxy/&gt;</code> element, <em>a CGLIB-based class proxy is created</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CGLIB proxies only intercept public method calls! Do not call non-public methods
on such a proxy; they will not be delegated to the actual scoped target object.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can configure the Spring container to create standard JDK
interface-based proxies for such scoped beans, by specifying <code>false</code> for the value of
the <code>proxy-target-class</code> attribute of the <code>&lt;aop:scoped-proxy/&gt;</code> element. Using JDK
interface-based proxies means that you do not need additional libraries in your
application classpath to effect such proxying. However, it also means that the class of
the scoped bean must implement at least one interface, and <em>that all</em> collaborators
into which the scoped bean is injected must reference the bean through one of its
interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- DefaultUserPreferences implements the UserPreferences interface --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultUserPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;aop:scoped-proxy</span> <span class="attribute-name">proxy-target-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.UserManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userPreferences</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more detailed information about choosing class-based or interface-based proxying,
see <a href="core.html#aop-proxying">Proxying mechanisms</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-scopes-custom"><a class="anchor" href="core.html#beans-factory-scopes-custom"></a>1.5.5. Custom scopes</h4>
<div class="paragraph">
<p>The bean scoping mechanism is extensible; You can define your own
scopes, or even redefine existing scopes, although the latter is considered bad practice
and you <em>cannot</em> override the built-in <code>singleton</code> and <code>prototype</code> scopes.</p>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-custom-creating"><a class="anchor" href="core.html#beans-factory-scopes-custom-creating"></a>Creating a custom scope</h5>
<div class="paragraph">
<p>To integrate your custom scope(s) into the Spring container, you need to implement the
<code>org.springframework.beans.factory.config.Scope</code> interface, which is described in this
section. For an idea of how to implement your own scopes, see the <code>Scope</code>
implementations that are supplied with the Spring Framework itself and the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/config/Scope.html"><code>Scope</code> javadocs</a>,
which explains the methods you need to implement in more detail.</p>
</div>
<div class="paragraph">
<p>The <code>Scope</code> interface has four methods to get objects from the scope, remove them from
the scope, and allow them to be destroyed.</p>
</div>
<div class="paragraph">
<p>The following method returns the object from the underlying scope. The session scope
implementation, for example, returns the session-scoped bean (and if it does not exist,
the method returns a new instance of the bean, after having bound it to the session for
future reference).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> get(<span class="predefined-type">String</span> name, <span class="predefined-type">ObjectFactory</span> objectFactory)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following method removes the object from the underlying scope. The session scope
implementation for example, removes the session-scoped bean from the underlying session.
The object should be returned, but you can return null if the object with the specified
name is not found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> remove(<span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following method registers the callbacks the scope should execute when it is
destroyed or when the specified object in the scope is destroyed. Refer to the javadocs
or a Spring scope implementation for more information on destruction callbacks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> registerDestructionCallback(<span class="predefined-type">String</span> name, <span class="predefined-type">Runnable</span> destructionCallback)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following method obtains the conversation identifier for the underlying scope. This
identifier is different for each scope. For a session scoped implementation, this
identifier can be the session identifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> getConversationId()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-scopes-custom-using"><a class="anchor" href="core.html#beans-factory-scopes-custom-using"></a>Using a custom scope</h5>
<div class="paragraph">
<p>After you write and test one or more custom <code>Scope</code> implementations, you need to make
the Spring container aware of your new scope(s). The following method is the central
method to register a new <code>Scope</code> with the Spring container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> registerScope(<span class="predefined-type">String</span> scopeName, Scope scope);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is declared on the <code>ConfigurableBeanFactory</code> interface, which is available
on most of the concrete <code>ApplicationContext</code> implementations that ship with Spring via
the BeanFactory property.</p>
</div>
<div class="paragraph">
<p>The first argument to the <code>registerScope(..)</code> method is the unique name associated with
a scope; examples of such names in the Spring container itself are <code>singleton</code> and
<code>prototype</code>. The second argument to the <code>registerScope(..)</code> method is an actual instance
of the custom <code>Scope</code> implementation that you wish to register and use.</p>
</div>
<div class="paragraph">
<p>Suppose that you write your custom <code>Scope</code> implementation, and then register it as below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The example below uses <code>SimpleThreadScope</code> which is included with Spring, but not
registered by default. The instructions would be the same for your own custom <code>Scope</code>
implementations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Scope threadScope = <span class="keyword">new</span> SimpleThreadScope();
beanFactory.registerScope(<span class="string"><span class="delimiter">&quot;</span><span class="content">thread</span><span class="delimiter">&quot;</span></span>, threadScope);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You then create bean definitions that adhere to the scoping rules of your custom <code>Scope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thread</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With a custom <code>Scope</code> implementation, you are not limited to programmatic registration
of the scope. You can also do the <code>Scope</code> registration declaratively, using the
<code>CustomScopeConfigurer</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:aop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/aop</span>
        <span class="content">http://www.springframework.org/schema/aop/spring-aop.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.CustomScopeConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scopes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thread</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.SimpleThreadScope</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/entry&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thread</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Rick</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;aop:scoped-proxy</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you place <code>&lt;aop:scoped-proxy/&gt;</code> in a <code>FactoryBean</code> implementation, it is the factory
bean itself that is scoped, not the object returned from <code>getObject()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-factory-nature"><a class="anchor" href="core.html#beans-factory-nature"></a>1.6. Customizing the nature of a bean</h3>
<div class="sect3">
<h4 id="beans-factory-lifecycle"><a class="anchor" href="core.html#beans-factory-lifecycle"></a>1.6.1. Lifecycle callbacks</h4>
<div class="paragraph">
<p>To interact with the container&#8217;s management of the bean lifecycle, you can implement the
Spring <code>InitializingBean</code> and <code>DisposableBean</code> interfaces. The container calls
<code>afterPropertiesSet()</code> for the former and <code>destroy()</code> for the latter to allow the bean
to perform certain actions upon initialization and destruction of your beans.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JSR-250 <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations are generally considered best
practice for receiving lifecycle callbacks in a modern Spring application. Using these
annotations means that your beans are not coupled to Spring specific interfaces. For
details see <a href="core.html#beans-postconstruct-and-predestroy-annotations">@PostConstruct and @PreDestroy</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to use the JSR-250 annotations but you are still looking to remove
coupling consider the use of init-method and destroy-method object definition metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, the Spring Framework uses <code>BeanPostProcessor</code> implementations to process any
callback interfaces it can find and call the appropriate methods. If you need custom
features or other lifecycle behavior Spring does not offer out-of-the-box, you can
implement a <code>BeanPostProcessor</code> yourself. For more information, see
<a href="core.html#beans-factory-extension">Container Extension Points</a>.</p>
</div>
<div class="paragraph">
<p>In addition to the initialization and destruction callbacks, Spring-managed objects may
also implement the <code>Lifecycle</code> interface so that those objects can participate in the
startup and shutdown process as driven by the container&#8217;s own lifecycle.</p>
</div>
<div class="paragraph">
<p>The lifecycle callback interfaces are described in this section.</p>
</div>
<div class="sect4">
<h5 id="beans-factory-lifecycle-initializingbean"><a class="anchor" href="core.html#beans-factory-lifecycle-initializingbean"></a>Initialization callbacks</h5>
<div class="paragraph">
<p>The <code>org.springframework.beans.factory.InitializingBean</code> interface allows a bean to
perform initialization work after all necessary properties on the bean have been set by
the container. The <code>InitializingBean</code> interface specifies a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended that you do not use the <code>InitializingBean</code> interface because it
unnecessarily couples the code to Spring. Alternatively, use
the <a href="core.html#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code></a> annotation or
specify a POJO initialization method. In the case of XML-based configuration metadata,
you use the <code>init-method</code> attribute to specify the name of the method that has a void
no-argument signature. With Java config, you use the <code>initMethod</code> attribute of <code>@Bean</code>,
see <a href="core.html#beans-java-lifecycle-callbacks">Receiving lifecycle callbacks</a>. For example, the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleInitBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">init-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">init</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="comment">// do some initialization work</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;is exactly the same as&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleInitBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.AnotherExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AnotherExampleBean</span> <span class="directive">implements</span> InitializingBean {

    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() {
        <span class="comment">// do some initialization work</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but does not couple the code to Spring.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-lifecycle-disposablebean"><a class="anchor" href="core.html#beans-factory-lifecycle-disposablebean"></a>Destruction callbacks</h5>
<div class="paragraph">
<p>Implementing the <code>org.springframework.beans.factory.DisposableBean</code> interface allows a
bean to get a callback when the container containing it is destroyed. The
<code>DisposableBean</code> interface specifies a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> destroy() <span class="directive">throws</span> <span class="exception">Exception</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended that you do not use the <code>DisposableBean</code> callback interface because it
unnecessarily couples the code to Spring. Alternatively, use
the <a href="core.html#beans-postconstruct-and-predestroy-annotations"><code>@PreDestroy</code></a> annotation or
specify a generic method that is supported by bean definitions. With XML-based
configuration metadata, you use the <code>destroy-method</code> attribute on the <code>&lt;bean/&gt;</code>.
With Java config, you use the <code>destroyMethod</code> attribute of <code>@Bean</code>, see
<a href="core.html#beans-java-lifecycle-callbacks">Receiving lifecycle callbacks</a>. For example, the following definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleInitBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBean</span> {

    <span class="directive">public</span> <span class="type">void</span> cleanup() {
        <span class="comment">// do some destruction work (like releasing pooled connections)</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is exactly the same as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleInitBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.AnotherExampleBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AnotherExampleBean</span> <span class="directive">implements</span> DisposableBean {

    <span class="directive">public</span> <span class="type">void</span> destroy() {
        <span class="comment">// do some destruction work (like releasing pooled connections)</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but does not couple the code to Spring.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>destroy-method</code> attribute of a <code>&lt;bean&gt;</code> element can be assigned a special
<code>(inferred)</code> value which instructs Spring to automatically detect a public <code>close</code> or
<code>shutdown</code> method on the specific bean class (any class that implements
<code>java.lang.AutoCloseable</code> or <code>java.io.Closeable</code> would therefore match). This special
<code>(inferred)</code> value can also be set on the <code>default-destroy-method</code> attribute of a
<code>&lt;beans&gt;</code> element to apply this behavior to an entire set of beans (see
<a href="core.html#beans-factory-lifecycle-default-init-destroy-methods">Default initialization and destroy methods</a>). Note that this is the
default behavior with Java config.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-lifecycle-default-init-destroy-methods"><a class="anchor" href="core.html#beans-factory-lifecycle-default-init-destroy-methods"></a>Default initialization and destroy methods</h5>
<div class="paragraph">
<p>When you write initialization and destroy method callbacks that do not use the
Spring-specific <code>InitializingBean</code> and <code>DisposableBean</code> callback interfaces, you
typically write methods with names such as <code>init()</code>, <code>initialize()</code>, <code>dispose()</code>, and so
on. Ideally, the names of such lifecycle callback methods are standardized across a
project so that all developers use the same method names and ensure consistency.</p>
</div>
<div class="paragraph">
<p>You can configure the Spring container to <code>look</code> for named initialization and destroy
callback method names on <em>every</em> bean. This means that you, as an application
developer, can write your application classes and use an initialization callback called
<code>init()</code>, without having to configure an <code>init-method="init"</code> attribute with each bean
definition. The Spring IoC container calls that method when the bean is created (and in
accordance with the standard lifecycle callback contract described previously). This
feature also enforces a consistent naming convention for initialization and destroy
method callbacks.</p>
</div>
<div class="paragraph">
<p>Suppose that your initialization callback methods are named <code>init()</code> and destroy
callback methods are named <code>destroy()</code>. Your class will resemble the class in the
following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultBlogService</span> <span class="directive">implements</span> BlogService {

    <span class="directive">private</span> BlogDao blogDao;

    <span class="directive">public</span> <span class="type">void</span> setBlogDao(BlogDao blogDao) {
        <span class="local-variable">this</span>.blogDao = blogDao;
    }

    <span class="comment">// this is (unsurprisingly) the initialization callback method</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="keyword">if</span> (<span class="local-variable">this</span>.blogDao == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The [blogDao] property must be set.</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">default-init-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">init</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blogService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultBlogService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blogDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blogDao</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The presence of the <code>default-init-method</code> attribute on the top-level <code>&lt;beans/&gt;</code> element
attribute causes the Spring IoC container to recognize a method called <code>init</code> on beans
as the initialization method callback. When a bean is created and assembled, if the bean
class has such a method, it is invoked at the appropriate time.</p>
</div>
<div class="paragraph">
<p>You configure destroy method callbacks similarly (in XML, that is) by using the
<code>default-destroy-method</code> attribute on the top-level <code>&lt;beans/&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>Where existing bean classes already have callback methods that are named at variance
with the convention, you can override the default by specifying (in XML, that is) the
method name using the <code>init-method</code> and <code>destroy-method</code> attributes of the <code>&lt;bean/&gt;</code>
itself.</p>
</div>
<div class="paragraph">
<p>The Spring container guarantees that a configured initialization callback is called
immediately after a bean is supplied with all dependencies. Thus the initialization
callback is called on the raw bean reference, which means that AOP interceptors and so
forth are not yet applied to the bean. A target bean is fully created <em>first</em>,
<em>then</em> an AOP proxy (for example) with its interceptor chain is applied. If the target
bean and the proxy are defined separately, your code can even interact with the raw
target bean, bypassing the proxy. Hence, it would be inconsistent to apply the
interceptors to the init method, because doing so would couple the lifecycle of the
target bean with its proxy/interceptors and leave strange semantics when your code
interacts directly to the raw target bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-lifecycle-combined-effects"><a class="anchor" href="core.html#beans-factory-lifecycle-combined-effects"></a>Combining lifecycle mechanisms</h5>
<div class="paragraph">
<p>As of Spring 2.5, you have three options for controlling bean lifecycle behavior: the
<a href="core.html#beans-factory-lifecycle-initializingbean"><code>InitializingBean</code></a> and
<a href="core.html#beans-factory-lifecycle-disposablebean"><code>DisposableBean</code></a> callback interfaces; custom
<code>init()</code> and <code>destroy()</code> methods; and the
<a href="core.html#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code> and <code>@PreDestroy</code>
annotations</a>. You can combine these mechanisms to control a given bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If multiple lifecycle mechanisms are configured for a bean, and each mechanism is
configured with a different method name, then each configured method is executed in the
order listed below. However, if the same method name is configured - for example,
<code>init()</code> for an initialization method - for more than one of these lifecycle mechanisms,
that method is executed once, as explained in the preceding section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Multiple lifecycle mechanisms configured for the same bean, with different
initialization methods, are called as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Methods annotated with <code>@PostConstruct</code></p>
</li>
<li>
<p><code>afterPropertiesSet()</code> as defined by the <code>InitializingBean</code> callback interface</p>
</li>
<li>
<p>A custom configured <code>init()</code> method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Destroy methods are called in the same order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Methods annotated with <code>@PreDestroy</code></p>
</li>
<li>
<p><code>destroy()</code> as defined by the <code>DisposableBean</code> callback interface</p>
</li>
<li>
<p>A custom configured <code>destroy()</code> method</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-lifecycle-processor"><a class="anchor" href="core.html#beans-factory-lifecycle-processor"></a>Startup and shutdown callbacks</h5>
<div class="paragraph">
<p>The <code>Lifecycle</code> interface defines the essential methods for any object that has its own
lifecycle requirements (e.g. starts and stops some background process):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Lifecycle</span> {

    <span class="type">void</span> start();

    <span class="type">void</span> stop();

    <span class="type">boolean</span> isRunning();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any Spring-managed object may implement that interface. Then, when the
<code>ApplicationContext</code> itself receives start and stop signals, e.g. for a stop/restart
scenario at runtime, it will cascade those calls to all <code>Lifecycle</code> implementations
defined within that context. It does this by delegating to a <code>LifecycleProcessor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LifecycleProcessor</span> <span class="directive">extends</span> Lifecycle {

    <span class="type">void</span> onRefresh();

    <span class="type">void</span> onClose();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>LifecycleProcessor</code> is itself an extension of the <code>Lifecycle</code>
interface. It also adds two other methods for reacting to the context being refreshed
and closed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the regular <code>org.springframework.context.Lifecycle</code> interface is just a plain
contract for explicit start/stop notifications and does NOT imply auto-startup at context
refresh time. Consider implementing <code>org.springframework.context.SmartLifecycle</code> instead
for fine-grained control over auto-startup of a specific bean (including startup phases).
Also, please note that stop notifications are not guaranteed to come before destruction:
On regular shutdown, all <code>Lifecycle</code> beans will first receive a stop notification before
the general destruction callbacks are being propagated; however, on hot refresh during a
context&#8217;s lifetime or on aborted refresh attempts, only destroy methods will be called.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The order of startup and shutdown invocations can be important. If a "depends-on"
relationship exists between any two objects, the dependent side will start <em>after</em> its
dependency, and it will stop <em>before</em> its dependency. However, at times the direct
dependencies are unknown. You may only know that objects of a certain type should start
prior to objects of another type. In those cases, the <code>SmartLifecycle</code> interface defines
another option, namely the <code>getPhase()</code> method as defined on its super-interface,
<code>Phased</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Phased</span> {

    <span class="type">int</span> getPhase();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SmartLifecycle</span> <span class="directive">extends</span> Lifecycle, Phased {

    <span class="type">boolean</span> isAutoStartup();

    <span class="type">void</span> stop(<span class="predefined-type">Runnable</span> callback);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When starting, the objects with the lowest phase start first, and when stopping, the
reverse order is followed. Therefore, an object that implements <code>SmartLifecycle</code> and
whose <code>getPhase()</code> method returns <code>Integer.MIN_VALUE</code> would be among the first to start
and the last to stop. At the other end of the spectrum, a phase value of
<code>Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped
first (likely because it depends on other processes to be running). When considering the
phase value, it&#8217;s also important to know that the default phase for any "normal"
<code>Lifecycle</code> object that does not implement <code>SmartLifecycle</code> would be 0. Therefore, any
negative phase value would indicate that an object should start before those standard
components (and stop after them), and vice versa for any positive phase value.</p>
</div>
<div class="paragraph">
<p>As you can see the stop method defined by <code>SmartLifecycle</code> accepts a callback. Any
implementation <em>must</em> invoke that callback&#8217;s <code>run()</code> method after that implementation&#8217;s
shutdown process is complete. That enables asynchronous shutdown where necessary since
the default implementation of the <code>LifecycleProcessor</code> interface,
<code>DefaultLifecycleProcessor</code>, will wait up to its timeout value for the group of objects
within each phase to invoke that callback. The default per-phase timeout is 30 seconds.
You can override the default lifecycle processor instance by defining a bean named
"lifecycleProcessor" within the context. If you only want to modify the timeout, then
defining the following would be sufficient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lifecycleProcessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.DefaultLifecycleProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- timeout value in milliseconds --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeoutPerShutdownPhase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned, the <code>LifecycleProcessor</code> interface defines callback methods for the
refreshing and closing of the context as well. The latter will simply drive the shutdown
process as if <code>stop()</code> had been called explicitly, but it will happen when the context is
closing. The 'refresh' callback on the other hand enables another feature of
<code>SmartLifecycle</code> beans. When the context is refreshed (after all objects have been
instantiated and initialized), that callback will be invoked, and at that point the
default lifecycle processor will check the boolean value returned by each
<code>SmartLifecycle</code> object&#8217;s <code>isAutoStartup()</code> method. If "true", then that object will be
started at that point rather than waiting for an explicit invocation of the context&#8217;s or
its own <code>start()</code> method (unlike the context refresh, the context start does not happen
automatically for a standard context implementation). The "phase" value as well as any
"depends-on" relationships will determine the startup order in the same way as described
above.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-shutdown"><a class="anchor" href="core.html#beans-factory-shutdown"></a>Shutting down the Spring IoC container gracefully in non-web applications</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section applies only to non-web applications. Spring&#8217;s web-based
<code>ApplicationContext</code> implementations already have code in place to shut down the Spring
IoC container gracefully when the relevant web application is shut down.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Spring&#8217;s IoC container in a non-web application environment; for
example, in a rich client desktop environment; you register a shutdown hook with the
JVM. Doing so ensures a graceful shutdown and calls the relevant destroy methods on your
singleton beans so that all resources are released. Of course, you must still configure
and implement these destroy callbacks correctly.</p>
</div>
<div class="paragraph">
<p>To register a shutdown hook, you call the <code>registerShutdownHook()</code> method that is
declared on the <code>ConfigurableApplicationContext</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.context.ConfigurableApplicationContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Boot</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        ConfigurableApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// add a shutdown hook for the above context...</span>
        ctx.registerShutdownHook();

        <span class="comment">// app runs here...</span>

        <span class="comment">// main method exits, hook is called prior to the app shutting down...</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-aware"><a class="anchor" href="core.html#beans-factory-aware"></a>1.6.2. ApplicationContextAware and BeanNameAware</h4>
<div class="paragraph">
<p>When an <code>ApplicationContext</code> creates an object instance that implements the
<code>org.springframework.context.ApplicationContextAware</code> interface, the instance is provided
with a reference to that <code>ApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ApplicationContextAware</span> {

    <span class="type">void</span> setApplicationContext(ApplicationContext applicationContext) <span class="directive">throws</span> BeansException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus beans can manipulate programmatically the <code>ApplicationContext</code> that created them,
through the <code>ApplicationContext</code> interface, or by casting the reference to a known
subclass of this interface, such as <code>ConfigurableApplicationContext</code>, which exposes
additional functionality. One use would be the programmatic retrieval of other beans.
Sometimes this capability is useful; however, in general you should avoid it, because it
couples the code to Spring and does not follow the Inversion of Control style, where
collaborators are provided to beans as properties. Other methods of the
<code>ApplicationContext</code> provide access to file resources, publishing application events, and
accessing a <code>MessageSource</code>. These additional features are described in
<a href="core.html#context-introduction">Additional capabilities of the ApplicationContext</a></p>
</div>
<div class="paragraph">
<p>As of Spring 2.5, autowiring is another alternative to obtain reference to the
<code>ApplicationContext</code>. The "traditional" <code>constructor</code> and <code>byType</code> autowiring modes (as
described in <a href="core.html#beans-factory-autowire">Autowiring collaborators</a>) can provide a dependency of type
<code>ApplicationContext</code> for a constructor argument or setter method parameter,
respectively. For more flexibility, including the ability to autowire fields and
multiple parameter methods, use the new annotation-based autowiring features. If you do,
the <code>ApplicationContext</code> is autowired into a field, constructor argument, or method
parameter that is expecting the <code>ApplicationContext</code> type if the field, constructor, or
method in question carries the <code>@Autowired</code> annotation. For more information, see
<a href="core.html#beans-autowired-annotation">@Autowired</a>.</p>
</div>
<div class="paragraph">
<p>When an <code>ApplicationContext</code> creates a class that implements the
<code>org.springframework.beans.factory.BeanNameAware</code> interface, the class is provided with
a reference to the name defined in its associated object definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">BeanNameAware</span> {

    <span class="type">void</span> setBeanName(<span class="predefined-type">String</span> name) <span class="directive">throws</span> BeansException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The callback is invoked after population of normal bean properties but before an
initialization callback such as <code>InitializingBean</code> <em>afterPropertiesSet</em> or a custom
init-method.</p>
</div>
</div>
<div class="sect3">
<h4 id="aware-list"><a class="anchor" href="core.html#aware-list"></a>1.6.3. Other Aware interfaces</h4>
<div class="paragraph">
<p>Besides <code>ApplicationContextAware</code> and <code>BeanNameAware</code> discussed above, Spring offers a
range of <code>Aware</code> interfaces that allow beans to indicate to the container that they
require a certain <em>infrastructure</em> dependency. The most important <code>Aware</code> interfaces
are summarized below - as a general rule, the name is a good indication of the
dependency type:</p>
</div>
<table id="beans-factory-nature-aware-list" class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Aware interfaces</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Injected Dependency</th>
<th class="tableblock halign-left valign-top">Explained in&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationContextAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring <code>ApplicationContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-aware">ApplicationContextAware and BeanNameAware</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationEventPublisherAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event publisher of the enclosing <code>ApplicationContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#context-introduction">Additional capabilities of the ApplicationContext</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanClassLoaderAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class loader used to load the bean classes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-class">Instantiating beans</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanFactoryAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring <code>BeanFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-aware">ApplicationContextAware and BeanNameAware</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanNameAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the declaring bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#beans-factory-aware">ApplicationContextAware and BeanNameAware</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BootstrapContextAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource adapter <code>BootstrapContext</code> the container runs in. Typically available only in
JCA aware <code>ApplicationContext</code>s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cci">JCA CCI</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LoadTimeWeaverAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defined <em>weaver</em> for processing class definition at load time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#aop-aj-ltw">Load-time weaving with AspectJ in the Spring Framework</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MessageSourceAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configured strategy for resolving messages (with support for parametrization and
internationalization)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#context-introduction">Additional capabilities of the ApplicationContext</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotificationPublisherAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring JMX notification publisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jmx-notifications">Notifications</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResourceLoaderAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configured loader for low-level access to resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="core.html#resources">Resources</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletConfigAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current <code>ServletConfig</code> the container runs in. Valid only in a web-aware Spring
<code>ApplicationContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">Spring MVC</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletContextAware</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current <code>ServletContext</code> the container runs in. Valid only in a web-aware Spring
<code>ApplicationContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">Spring MVC</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note again that usage of these interfaces ties your code to the Spring API and does not
follow the Inversion of Control style. As such, they are recommended for infrastructure
beans that require programmatic access to the container.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-child-bean-definitions"><a class="anchor" href="core.html#beans-child-bean-definitions"></a>1.7. Bean definition inheritance</h3>
<div class="paragraph">
<p>A bean definition can contain a lot of configuration information, including constructor
arguments, property values, and container-specific information such as initialization
method, static factory method name, and so on. A child bean definition inherits
configuration data from a parent definition. The child definition can override some
values, or add others, as needed. Using parent and child bean definitions can save a lot
of typing. Effectively, this is a form of templating.</p>
</div>
<div class="paragraph">
<p>If you work with an <code>ApplicationContext</code> interface programmatically, child bean
definitions are represented by the <code>ChildBeanDefinition</code> class. Most users do not work
with them on this level, instead configuring bean definitions declaratively in something
like the <code>ClassPathXmlApplicationContext</code>. When you use XML-based configuration
metadata, you indicate a child bean definition by using the <code>parent</code> attribute,
specifying the parent bean as the value of this attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritedTestBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritsWithDifferentClass</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.DerivedTestBean</span><span class="delimiter">&quot;</span></span>
        <span class="error"><strong></span><span class="error"></strong></span><span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritedTestBean</span><span class="delimiter">&quot;</span></span><span class="error"><strong></span><span class="error"></strong></span> <span class="attribute-name">init-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialize</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">override</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A child bean definition uses the bean class from the parent definition if none is
specified, but can also override it. In the latter case, the child bean class must be
compatible with the parent, that is, it must accept the parent&#8217;s property values.</p>
</div>
<div class="paragraph">
<p>A child bean definition inherits scope, constructor argument values, property values, and
method overrides from the parent, with the option to add new values. Any scope, initialization
method, destroy method, and/or <code>static</code> factory method settings that you specify will
override the corresponding parent settings.</p>
</div>
<div class="paragraph">
<p>The remaining settings are <em>always</em> taken from the child definition: <em>depends on</em>,
<em>autowire mode</em>, <em>dependency check</em>, <em>singleton</em>, <em>lazy init</em>.</p>
</div>
<div class="paragraph">
<p>The preceding example explicitly marks the parent bean definition as abstract by using
the <code>abstract</code> attribute. If the parent definition does not specify a class, explicitly
marking the parent bean definition as <code>abstract</code> is required, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritedTestBeanWithoutClass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritsWithClass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.DerivedTestBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inheritedTestBeanWithoutClass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">init-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialize</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">override</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- age will inherit the value of 1 from the parent bean definition--&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The parent bean cannot be instantiated on its own because it is incomplete, and it is
also explicitly marked as <code>abstract</code>. When a definition is <code>abstract</code> like this, it is
usable only as a pure template bean definition that serves as a parent definition for
child definitions. Trying to use such an <code>abstract</code> parent bean on its own, by referring
to it as a ref property of another bean or doing an explicit <code>getBean()</code> call with the
parent bean id, returns an error. Similarly, the container&#8217;s internal
<code>preInstantiateSingletons()</code> method ignores bean definitions that are defined as
abstract.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>ApplicationContext</code> pre-instantiates all singletons by default. Therefore, it is
important (at least for singleton beans) that if you have a (parent) bean definition
which you intend to use only as a template, and this definition specifies a class, you
must make sure to set the <em>abstract</em> attribute to <em>true</em>, otherwise the application
context will actually (attempt to) pre-instantiate the <code>abstract</code> bean.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="beans-factory-extension"><a class="anchor" href="core.html#beans-factory-extension"></a>1.8. Container Extension Points</h3>
<div class="paragraph">
<p>Typically, an application developer does not need to subclass <code>ApplicationContext</code>
implementation classes. Instead, the Spring IoC container can be extended by plugging in
implementations of special integration interfaces. The next few sections describe these
integration interfaces.</p>
</div>
<div class="sect3">
<h4 id="beans-factory-extension-bpp"><a class="anchor" href="core.html#beans-factory-extension-bpp"></a>1.8.1. Customizing beans using a BeanPostProcessor</h4>
<div class="paragraph">
<p>The <code>BeanPostProcessor</code> interface defines <em>callback methods</em> that you can implement to
provide your own (or override the container&#8217;s default) instantiation logic,
dependency-resolution logic, and so forth. If you want to implement some custom logic
after the Spring container finishes instantiating, configuring, and initializing a bean,
you can plug in one or more <code>BeanPostProcessor</code> implementations.</p>
</div>
<div class="paragraph">
<p>You can configure multiple <code>BeanPostProcessor</code> instances, and you can control the order
in which these <code>BeanPostProcessor</code>s execute by setting the <code>order</code> property. You can
set this property only if the <code>BeanPostProcessor</code> implements the <code>Ordered</code> interface; if
you write your own <code>BeanPostProcessor</code> you should consider implementing the <code>Ordered</code>
interface too. For further details, consult the javadocs of the <code>BeanPostProcessor</code> and
<code>Ordered</code> interfaces. See also the note below on
<a href="core.html#beans-factory-programmatically-registering-beanpostprocessors">programmatic
registration of <code>BeanPostProcessor</code>s</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>BeanPostProcessor</code>s operate on bean (or object) <em>instances</em>; that is to say, the
Spring IoC container instantiates a bean instance and <em>then</em> <code>BeanPostProcessor</code>s do
their work.</p>
</div>
<div class="paragraph">
<p><code>BeanPostProcessor</code>s are scoped <em>per-container</em>. This is only relevant if you are
using container hierarchies. If you define a <code>BeanPostProcessor</code> in one container, it
will <em>only</em> post-process the beans in that container. In other words, beans that are
defined in one container are not post-processed by a <code>BeanPostProcessor</code> defined in
another container, even if both containers are part of the same hierarchy.</p>
</div>
<div class="paragraph">
<p>To change the actual bean definition (i.e., the <em>blueprint</em> that defines the bean),
you instead need to use a <code>BeanFactoryPostProcessor</code> as described in
<a href="core.html#beans-factory-extension-factory-postprocessors">Customizing configuration metadata with a BeanFactoryPostProcessor</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>org.springframework.beans.factory.config.BeanPostProcessor</code> interface consists of
exactly two callback methods. When such a class is registered as a post-processor with
the container, for each bean instance that is created by the container, the
post-processor gets a callback from the container both <em>before</em> container
initialization methods (such as InitializingBean&#8217;s <em>afterPropertiesSet()</em> and any
declared init method) are called as well as <em>after</em> any bean initialization callbacks.
The post-processor can take any action with the bean instance, including ignoring the
callback completely. A bean post-processor typically checks for callback interfaces or
may wrap a bean with a proxy. Some Spring AOP infrastructure classes are implemented as
bean post-processors in order to provide proxy-wrapping logic.</p>
</div>
<div class="paragraph">
<p>An <code>ApplicationContext</code> <em>automatically detects</em> any beans that are defined in the
configuration metadata which implement the <code>BeanPostProcessor</code> interface. The
<code>ApplicationContext</code> registers these beans as post-processors so that they can be called
later upon bean creation. Bean post-processors can be deployed in the container just
like any other beans.</p>
</div>
<div class="paragraph">
<p>Note that when declaring a <code>BeanPostProcessor</code> using an <code>@Bean</code> factory method on a
configuration class, the return type of the factory method should be the implementation
class itself or at least the <code>org.springframework.beans.factory.config.BeanPostProcessor</code>
interface, clearly indicating the post-processor nature of that bean. Otherwise, the
<code>ApplicationContext</code> won&#8217;t be able to autodetect it by type before fully creating it.
Since a <code>BeanPostProcessor</code> needs to be instantiated early in order to apply to the
initialization of other beans in the context, this early type detection is critical.</p>
</div>
<div id="beans-factory-programmatically-registering-beanpostprocessors" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Programmatically registering BeanPostProcessors</div>
<div class="paragraph">
<p>While the recommended approach for <code>BeanPostProcessor</code> registration is through
<code>ApplicationContext</code> auto-detection (as described above), it is also possible to
register them <em>programmatically</em> against a <code>ConfigurableBeanFactory</code> using the
<code>addBeanPostProcessor</code> method. This can be useful when needing to evaluate conditional
logic before registration, or even for copying bean post processors across contexts in a
hierarchy. Note however that <code>BeanPostProcessor</code>s added programmatically <em>do not
respect the <code>Ordered</code> interface</em>. Here it is the <em>order of registration</em> that
dictates the order of execution. Note also that <code>BeanPostProcessor</code>s registered
programmatically are always processed before those registered through auto-detection,
regardless of any explicit ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">BeanPostProcessors and AOP auto-proxying</div>
<div class="paragraph">
<p>Classes that implement the <code>BeanPostProcessor</code> interface are <em>special</em> and are treated
differently by the container. All <code>BeanPostProcessor</code>s <em>and beans that they reference
directly</em> are instantiated on startup, as part of the special startup phase of the
<code>ApplicationContext</code>. Next, all <code>BeanPostProcessor</code>s are registered in a sorted fashion
and applied to all further beans in the container. Because AOP auto-proxying is
implemented as a <code>BeanPostProcessor</code> itself, neither <code>BeanPostProcessor</code>s nor the beans
they reference directly are eligible for auto-proxying, and thus do not have aspects
woven into them.</p>
</div>
<div class="paragraph">
<p>For any such bean, you should see an informational log message: "<em>Bean foo is not
eligible for getting processed by all BeanPostProcessor interfaces (for example: not
eligible for auto-proxying)</em>".</p>
</div>
<div class="paragraph">
<p>Note that if you have beans wired into your <code>BeanPostProcessor</code> using autowiring or
<code>@Resource</code> (which may fall back to autowiring), Spring might access unexpected beans
when searching for type-matching dependency candidates, and therefore make them
ineligible for auto-proxying or other kinds of bean post-processing. For example, if you
have a dependency annotated with <code>@Resource</code> where the field/setter name does not
directly correspond to the declared name of a bean and no name attribute is used, then
Spring will access other beans for matching them by type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following examples show how to write, register, and use <code>BeanPostProcessor</code>s in an
<code>ApplicationContext</code>.</p>
</div>
<div class="sect4">
<h5 id="beans-factory-extension-bpp-examples-hw"><a class="anchor" href="core.html#beans-factory-extension-bpp-examples-hw"></a>Example: Hello World, BeanPostProcessor-style</h5>
<div class="paragraph">
<p>This first example illustrates basic usage. The example shows a custom
<code>BeanPostProcessor</code> implementation that invokes the <code>toString()</code> method of each bean as
it is created by the container and prints the resulting string to the system console.</p>
</div>
<div class="paragraph">
<p>Find below the custom <code>BeanPostProcessor</code> implementation class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">scripting</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.config.BeanPostProcessor</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">InstantiationTracingBeanPostProcessor</span> <span class="directive">implements</span> BeanPostProcessor {

    <span class="comment">// simply return the instantiated bean as-is</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> postProcessBeforeInitialization(<span class="predefined-type">Object</span> bean, <span class="predefined-type">String</span> beanName) {
        <span class="keyword">return</span> bean; <span class="comment">// we could potentially return any object reference here...</span>
    }

    <span class="directive">public</span> <span class="predefined-type">Object</span> postProcessAfterInitialization(<span class="predefined-type">Object</span> bean, <span class="predefined-type">String</span> beanName) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bean '</span><span class="delimiter">&quot;</span></span> + beanName + <span class="string"><span class="delimiter">&quot;</span><span class="content">' created : </span><span class="delimiter">&quot;</span></span> + bean.toString());
        <span class="keyword">return</span> bean;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/lang</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/lang</span>
        <span class="content">http://www.springframework.org/schema/lang/spring-lang.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;lang:groovy</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messenger</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">script-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:org/springframework/scripting/groovy/Messenger.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;lang:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fiona Apple Is Just So Dreamy.</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/lang:groovy&gt;</span>

    <span class="comment">&lt;!--
    when the above bean (messenger) is instantiated, this custom
    BeanPostProcessor implementation will output the fact to the system console
    --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scripting.InstantiationTracingBeanPostProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the <code>InstantiationTracingBeanPostProcessor</code> is simply defined. It does not
even have a name, and because it is a bean it can be dependency-injected just like any
other bean. (The preceding configuration also defines a bean that is backed by a Groovy
script. The Spring dynamic language support is detailed in the chapter entitled
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#dynamic-language">Dynamic language support</a>.)</p>
</div>
<div class="paragraph">
<p>The following simple Java application executes the preceding code and configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.scripting.Messenger</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Boot</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">scripting/beans.xml</span><span class="delimiter">&quot;</span></span>);
        Messenger messenger = (Messenger) ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">messenger</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(messenger);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the preceding application resembles the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Bean 'messenger' created : <a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b0dfc2d79ec3c0c2d9ded7d6c2d1ddd5c7dfc2db9ec3d3c2d9c0c4d9ded79ed7c2dfdfc6c99ef7c2dfdfc6c9fdd5c3c3d5ded7d5c2f0828782898681">[email&#160;protected]</a>
<a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="701f02175e030002191e171602111d15071f021b5e031302190004191e175e17021f1f06095e37021f1f06093d150303151e17150230424742494641">[email&#160;protected]</a></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-extension-bpp-examples-rabpp"><a class="anchor" href="core.html#beans-factory-extension-bpp-examples-rabpp"></a>Example: The RequiredAnnotationBeanPostProcessor</h5>
<div class="paragraph">
<p>Using callback interfaces or annotations in conjunction with a custom
<code>BeanPostProcessor</code> implementation is a common means of extending the Spring IoC
container. An example is Spring&#8217;s <code>RequiredAnnotationBeanPostProcessor</code> - a
<code>BeanPostProcessor</code> implementation that ships with the Spring distribution which ensures
that JavaBean properties on beans that are marked with an (arbitrary) annotation are
actually (configured to be) dependency-injected with a value.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-extension-factory-postprocessors"><a class="anchor" href="core.html#beans-factory-extension-factory-postprocessors"></a>1.8.2. Customizing configuration metadata with a BeanFactoryPostProcessor</h4>
<div class="paragraph">
<p>The next extension point that we will look at is the
<code>org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>. The semantics of
this interface are similar to those of the <code>BeanPostProcessor</code>, with one major
difference: <code>BeanFactoryPostProcessor</code> operates on the <em>bean configuration metadata</em>;
that is, the Spring IoC container allows a <code>BeanFactoryPostProcessor</code> to read the
configuration metadata and potentially change it <em>before</em> the container instantiates
any beans other than <code>BeanFactoryPostProcessor</code>s.</p>
</div>
<div class="paragraph">
<p>You can configure multiple <code>BeanFactoryPostProcessor</code>s, and you can control the order in
which these <code>BeanFactoryPostProcessor</code>s execute by setting the <code>order</code> property.
However, you can only set this property if the <code>BeanFactoryPostProcessor</code> implements the
<code>Ordered</code> interface. If you write your own <code>BeanFactoryPostProcessor</code>, you should
consider implementing the <code>Ordered</code> interface too. Consult the javadocs of the
<code>BeanFactoryPostProcessor</code> and <code>Ordered</code> interfaces for more details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to change the actual bean <em>instances</em> (i.e., the objects that are created
from the configuration metadata), then you instead need to use a <code>BeanPostProcessor</code>
(described above in <a href="core.html#beans-factory-extension-bpp">Customizing beans using a BeanPostProcessor</a>). While it is technically possible
to work with bean instances within a <code>BeanFactoryPostProcessor</code> (e.g., using
<code>BeanFactory.getBean()</code>), doing so causes premature bean instantiation, violating the
standard container lifecycle. This may cause negative side effects such as bypassing
bean post processing.</p>
</div>
<div class="paragraph">
<p>Also, <code>BeanFactoryPostProcessor</code>s are scoped <em>per-container</em>. This is only relevant if
you are using container hierarchies. If you define a <code>BeanFactoryPostProcessor</code> in one
container, it will <em>only</em> be applied to the bean definitions in that container. Bean
definitions in one container will not be post-processed by <code>BeanFactoryPostProcessor</code>s
in another container, even if both containers are part of the same hierarchy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A bean factory post-processor is executed automatically when it is declared inside an
<code>ApplicationContext</code>, in order to apply changes to the configuration metadata that
define the container. Spring includes a number of predefined bean factory
post-processors, such as <code>PropertyOverrideConfigurer</code> and
<code>PropertyPlaceholderConfigurer</code>. A custom <code>BeanFactoryPostProcessor</code> can also be used,
for example, to register custom property editors.</p>
</div>
<div id="null" class="paragraph">
<p>An <code>ApplicationContext</code> automatically detects any beans that are deployed into it that
implement the <code>BeanFactoryPostProcessor</code> interface. It uses these beans as bean factory
post-processors, at the appropriate time. You can deploy these post-processor beans as
you would any other bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As with <code>BeanPostProcessor</code>s , you typically do not want to configure
<code>BeanFactoryPostProcessor</code>s for lazy initialization. If no other bean references a
<code>Bean(Factory)PostProcessor</code>, that post-processor will not get instantiated at all.
Thus, marking it for lazy initialization will be ignored, and the
<code>Bean(Factory)PostProcessor</code> will be instantiated eagerly even if you set the
<code>default-lazy-init</code> attribute to <code>true</code> on the declaration of your <code>&lt;beans /&gt;</code> element.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="beans-factory-placeholderconfigurer"><a class="anchor" href="core.html#beans-factory-placeholderconfigurer"></a>Example: the Class name substitution PropertyPlaceholderConfigurer</h5>
<div class="paragraph">
<p>You use the <code>PropertyPlaceholderConfigurer</code> to externalize property values from a bean
definition in a separate file using the standard Java <code>Properties</code> format. Doing so
enables the person deploying an application to customize environment-specific properties
such as database URLs and passwords, without the complexity or risk of modifying the
main XML definition file or files for the container.</p>
</div>
<div class="paragraph">
<p>Consider the following XML-based configuration metadata fragment, where a <code>DataSource</code>
with placeholder values is defined. The example shows properties configured from an
external <code>Properties</code> file. At runtime, a <code>PropertyPlaceholderConfigurer</code> is applied to
the metadata that will replace some properties of the DataSource. The values to replace
are specified as <em>placeholders</em> of the form <code>${property-name}</code> which follows the Ant /
log4j / JSP EL style.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/foo/jdbc.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.commons.dbcp.BasicDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClassName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.driverClassName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.url}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.username}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.password}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual values come from another file in the standard Java <code>Properties</code> format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>jdbc.driverClassName=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:hsql://production:9002
jdbc.username=sa
jdbc.password=root</pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, the string <code>${jdbc.username}</code> is replaced at runtime with the value 'sa', and
the same applies for other placeholder values that match keys in the properties file.
The <code>PropertyPlaceholderConfigurer</code> checks for placeholders in most properties and
attributes of a bean definition. Furthermore, the placeholder prefix and suffix can be
customized.</p>
</div>
<div class="paragraph">
<p>With the <code>context</code> namespace introduced in Spring 2.5, it is possible to configure
property placeholders with a dedicated configuration element. One or more locations can
be provided as a comma-separated list in the <code>location</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/foo/jdbc.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PropertyPlaceholderConfigurer</code> not only looks for properties in the <code>Properties</code>
file you specify. By default it also checks against the Java <code>System</code> properties if it
cannot find a property in the specified properties files. You can customize this
behavior by setting the <code>systemPropertiesMode</code> property of the configurer with one of
the following three supported integer values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>never</em> (0): Never check system properties</p>
</li>
<li>
<p><em>fallback</em> (1): Check system properties if not resolvable in the specified
properties files. This is the default.</p>
</li>
<li>
<p><em>override</em> (2): Check system properties first, before trying the specified
properties files. This allows system properties to override any other property source.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consult the <code>PropertyPlaceholderConfigurer</code> javadocs for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <code>PropertyPlaceholderConfigurer</code> to substitute class names, which is
sometimes useful when you have to pick a particular implementation class at runtime. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>classpath:com/foo/strategy.properties<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>custom.strategy.class=com.foo.DefaultStrategy<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom.strategy.class}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the class cannot be resolved at runtime to a valid class, resolution of the bean
fails when it is about to be created, which is during the <code>preInstantiateSingletons()</code>
phase of an <code>ApplicationContext</code> for a non-lazy-init bean.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-factory-overrideconfigurer"><a class="anchor" href="core.html#beans-factory-overrideconfigurer"></a>Example: the PropertyOverrideConfigurer</h5>
<div class="paragraph">
<p>The <code>PropertyOverrideConfigurer</code>, another bean factory post-processor, resembles the
<code>PropertyPlaceholderConfigurer</code>, but unlike the latter, the original definitions can
have default values or no values at all for bean properties. If an overriding
<code>Properties</code> file does not have an entry for a certain bean property, the default
context definition is used.</p>
</div>
<div class="paragraph">
<p>Note that the bean definition is <em>not</em> aware of being overridden, so it is not
immediately obvious from the XML definition file that the override configurer is being
used. In case of multiple <code>PropertyOverrideConfigurer</code> instances that define different
values for the same bean property, the last one wins, due to the overriding mechanism.</p>
</div>
<div class="paragraph">
<p>Properties file configuration lines take this format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>beanName.property=value</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dataSource.driverClassName=com.mysql.jdbc.Driver
dataSource.url=jdbc:mysql:mydb</pre>
</div>
</div>
<div class="paragraph">
<p>This example file can be used with a container definition that contains a bean called
<em>dataSource</em>, which has <em>driver</em> and <em>url</em> properties.</p>
</div>
<div class="paragraph">
<p>Compound property names are also supported, as long as every component of the path
except the final property being overridden is already non-null (presumably initialized
by the constructors). In this example&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>foo.fred.bob.sammy=123</pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>the <code>sammy</code> property of the <code>bob</code> property of the <code>fred</code> property of the <code>foo</code> bean
is set to the scalar value <code>123</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Specified override values are always <em>literal</em> values; they are not translated into
bean references. This convention also applies when the original value in the XML bean
definition specifies a bean reference.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the <code>context</code> namespace introduced in Spring 2.5, it is possible to configure
property overriding with a dedicated configuration element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:property-override</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:override.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-factory-extension-factorybean"><a class="anchor" href="core.html#beans-factory-extension-factorybean"></a>1.8.3. Customizing instantiation logic with a FactoryBean</h4>
<div class="paragraph">
<p>Implement the <code>org.springframework.beans.factory.FactoryBean</code> interface for objects that
<em>are themselves factories</em>.</p>
</div>
<div class="paragraph">
<p>The <code>FactoryBean</code> interface is a point of pluggability into the Spring IoC container&#8217;s
instantiation logic. If you have complex initialization code that is better expressed in
Java as opposed to a (potentially) verbose amount of XML, you can create your own
<code>FactoryBean</code>, write the complex initialization inside that class, and then plug your
custom <code>FactoryBean</code> into the container.</p>
</div>
<div class="paragraph">
<p>The <code>FactoryBean</code> interface provides three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Object getObject()</code>: returns an instance of the object this factory creates. The
instance can possibly be shared, depending on whether this factory returns singletons
or prototypes.</p>
</li>
<li>
<p><code>boolean isSingleton()</code>: returns <code>true</code> if this <code>FactoryBean</code> returns singletons,
<code>false</code> otherwise.</p>
</li>
<li>
<p><code>Class getObjectType()</code>: returns the object type returned by the <code>getObject()</code> method
or <code>null</code> if the type is not known in advance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>FactoryBean</code> concept and interface is used in a number of places within the Spring
Framework; more than 50 implementations of the <code>FactoryBean</code> interface ship with Spring
itself.</p>
</div>
<div class="paragraph">
<p>When you need to ask a container for an actual <code>FactoryBean</code> instance itself instead of
the bean it produces, preface the bean&#8217;s id with the ampersand symbol ( <code>&amp;</code>) when
calling the <code>getBean()</code> method of the <code>ApplicationContext</code>. So for a given <code>FactoryBean</code>
with an id of <code>myBean</code>, invoking <code>getBean("myBean")</code> on the container returns the
product of the <code>FactoryBean</code>; whereas, invoking <code>getBean("&amp;myBean")</code> returns the
<code>FactoryBean</code> instance itself.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-annotation-config"><a class="anchor" href="core.html#beans-annotation-config"></a>1.9. Annotation-based container configuration</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Are annotations better than XML for configuring Spring?</div>
<div class="paragraph">
<p>The introduction of annotation-based configurations raised the question of whether this
approach is 'better' than XML. The short answer is <em>it depends</em>. The long answer is
that each approach has its pros and cons, and usually it is up to the developer to
decide which strategy suits them better. Due to the way they are defined, annotations
provide a lot of context in their declaration, leading to shorter and more concise
configuration. However, XML excels at wiring up components without touching their source
code or recompiling them. Some developers prefer having the wiring close to the source
while others argue that annotated classes are no longer POJOs and, furthermore, that the
configuration becomes decentralized and harder to control.</p>
</div>
<div class="paragraph">
<p>No matter the choice, Spring can accommodate both styles and even mix them together.
It&#8217;s worth pointing out that through its <a href="core.html#beans-java">JavaConfig</a> option, Spring allows
annotations to be used in a non-invasive way, without touching the target components
source code and that in terms of tooling, all configuration styles are supported by the
<a href="https://spring.io/tools/sts">Spring Tool Suite</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>An alternative to XML setups is provided by annotation-based configuration which rely on
the bytecode metadata for wiring up components instead of angle-bracket declarations.
Instead of using XML to describe a bean wiring, the developer moves the configuration
into the component class itself by using annotations on the relevant class, method, or
field declaration. As mentioned in <a href="core.html#beans-factory-extension-bpp-examples-rabpp">Example: The RequiredAnnotationBeanPostProcessor</a>, using
a <code>BeanPostProcessor</code> in conjunction with annotations is a common means of extending the
Spring IoC container. For example, Spring 2.0 introduced the possibility of enforcing
required properties with the <a href="core.html#beans-required-annotation">@Required</a> annotation. Spring
2.5 made it possible to follow that same general approach to drive Spring&#8217;s dependency
injection. Essentially, the <code>@Autowired</code> annotation provides the same capabilities as
described in <a href="core.html#beans-factory-autowire">Autowiring collaborators</a> but with more fine-grained control and wider
applicability. Spring 2.5 also added support for JSR-250 annotations such as
<code>@PostConstruct</code>, and <code>@PreDestroy</code>. Spring 3.0 added support for JSR-330 (Dependency
Injection for Java) annotations contained in the javax.inject package such as <code>@Inject</code>
and <code>@Named</code>. Details about those annotations can be found in the
<a href="core.html#beans-standard-annotations">relevant section</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Annotation injection is performed <em>before</em> XML injection, thus the latter
configuration will override the former for properties wired through both approaches.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As always, you can register them as individual bean definitions, but they can also be
implicitly registered by including the following tag in an XML-based Spring
configuration (notice the inclusion of the <code>context</code> namespace):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(The implicitly registered post-processors include
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html"><code>AutowiredAnnotationBeanPostProcessor</code></a>,
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html"><code>CommonAnnotationBeanPostProcessor</code></a>,
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html"><code>PersistenceAnnotationBeanPostProcessor</code></a>,
as well as the aforementioned
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html"><code>RequiredAnnotationBeanPostProcessor</code></a>.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>&lt;context:annotation-config/&gt;</code> only looks for annotations on beans in the same
application context in which it is defined. This means that, if you put
<code>&lt;context:annotation-config/&gt;</code> in a <code>WebApplicationContext</code> for a <code>DispatcherServlet</code>,
it only checks for <code>@Autowired</code> beans in your controllers, and not your services. See
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-servlet">The DispatcherServlet</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="beans-required-annotation"><a class="anchor" href="core.html#beans-required-annotation"></a>1.9.1. @Required</h4>
<div class="paragraph">
<p>The <code>@Required</code> annotation applies to bean property setter methods, as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Required</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This annotation simply indicates that the affected bean property must be populated at
configuration time, through an explicit property value in a bean definition or through
autowiring. The container throws an exception if the affected bean property has not been
populated; this allows for eager and explicit failure, avoiding <code>NullPointerException</code>s
or the like later on. It is still recommended that you put assertions into the bean
class itself, for example, into an init method. Doing so enforces those required
references and values even when you use the class outside of a container.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-autowired-annotation"><a class="anchor" href="core.html#beans-autowired-annotation"></a>1.9.2. @Autowired</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JSR 330&#8217;s <code>@Inject</code> annotation can be used in place of Spring&#8217;s <code>@Autowired</code> annotation
in the examples below. See <a href="core.html#beans-standard-annotations">here</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can apply the <code>@Autowired</code> annotation to constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> <span class="directive">final</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
        <span class="local-variable">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring Framework 4.3, an <code>@Autowired</code> annotation on such a constructor is
no longer necessary if the target bean only defines one constructor to begin with.
However, if several constructors are available, at least one must be annotated to
teach the container which one to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As expected, you can also apply the <code>@Autowired</code> annotation to "traditional" setter
methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also apply the annotation to methods with arbitrary names and/or multiple
arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> MovieCatalog movieCatalog;

    <span class="directive">private</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> prepare(MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="local-variable">this</span>.movieCatalog = movieCatalog;
        <span class="local-variable">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can apply <code>@Autowired</code> to fields as well and even mix it with constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> <span class="directive">final</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MovieCatalog movieCatalog;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
        <span class="local-variable">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that your target components (e.g. <code>MovieCatalog</code>, <code>CustomerPreferenceDao</code>)
are consistently declared by the type that you are using for your <code>@Autowired</code>-annotated
injection points. Otherwise injection may fail due to no type match found at runtime.</p>
</div>
<div class="paragraph">
<p>For XML-defined beans or component classes found through a classpath scan, the container
usually knows the concrete type upfront. However, for <code>@Bean</code> factory methods, you need
to make sure that the declared return type is sufficiently expressive. For components
implementing several interfaces or for components potentially referred to by their
implementation type, consider declaring the most specific return type on your factory
method (at least as specific as required by the injection points referring to your bean).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to provide <em>all</em> beans of a particular type from the
<code>ApplicationContext</code> by adding the annotation to a field or method that expects an array
of that type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MovieCatalog<span class="type">[]</span> movieCatalogs;

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same applies for typed collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;MovieCatalog&gt; movieCatalogs;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieCatalogs(<span class="predefined-type">Set</span>&lt;MovieCatalog&gt; movieCatalogs) {
        <span class="local-variable">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Your target beans can implement the <code>org.springframework.core.Ordered</code> interface or use
the <code>@Order</code> or standard <code>@Priority</code> annotation if you want items in the array or list
to be sorted in a specific order. Otherwise their order will follow the registration
order of the corresponding target bean definitions in the container.</p>
</div>
<div class="paragraph">
<p>The <code>@Order</code> annotation may be declared at target class level but also on <code>@Bean</code> methods,
potentially being very individual per bean definition (in case of multiple definitions
with the same bean class). <code>@Order</code> values may influence priorities at injection points,
but please be aware that they do not influence singleton startup order which is an
orthogonal concern determined by dependency relationships and <code>@DependsOn</code> declarations.</p>
</div>
<div class="paragraph">
<p>Note that the standard <code>javax.annotation.Priority</code> annotation is not available at the
<code>@Bean</code> level since it cannot be declared on methods. Its semantics can be modeled
through <code>@Order</code> values in combination with <code>@Primary</code> on a single bean per type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Even typed Maps can be autowired as long as the expected key type is <code>String</code>. The Map
values will contain all beans of the expected type, and the keys will contain the
corresponding bean names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, MovieCatalog&gt; movieCatalogs;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieCatalogs(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, MovieCatalog&gt; movieCatalogs) {
        <span class="local-variable">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the autowiring fails whenever <em>zero</em> candidate beans are available; the
default behavior is to treat annotated methods, constructors, and fields as
indicating <em>required</em> dependencies. This behavior can be changed as demonstrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Autowired</span>(required = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only <em>one annotated constructor per-class</em> can be marked as <em>required</em>, but multiple
non-required constructors can be annotated. In that case, each is considered among the
candidates and Spring uses the <em>greediest</em> constructor whose dependencies can be
satisfied, that is the constructor that has the largest number of arguments.</p>
</div>
<div class="paragraph">
<p>The <em>required</em> attribute of <code>@Autowired</code> is recommended over the <code>@Required</code> annotation.
The <em>required</em> attribute indicates that the property is not required for autowiring
purposes, the property is ignored if it cannot be autowired. <code>@Required</code>, on the other
hand, is stronger in that it enforces the property that was set by any means supported
by the container. If no value is injected, a corresponding exception is raised.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you may express the non-required nature of a particular dependency
through Java 8&#8217;s <code>java.util.Optional</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(Optional&lt;MovieFinder&gt; movieFinder) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As of Spring Framework 5.0, you may also use an <code>@Nullable</code> annotation (of any kind
in any package, e.g. <code>javax.annotation.Nullable</code> from JSR-305):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(<span class="annotation">@Nullable</span> MovieFinder movieFinder) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>@Autowired</code> for interfaces that are well-known resolvable
dependencies: <code>BeanFactory</code>, <code>ApplicationContext</code>, <code>Environment</code>, <code>ResourceLoader</code>,
<code>ApplicationEventPublisher</code>, and <code>MessageSource</code>. These interfaces and their extended
interfaces, such as <code>ConfigurableApplicationContext</code> or <code>ResourcePatternResolver</code>, are
automatically resolved, with no special setup necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> ApplicationContext context;

    <span class="directive">public</span> MovieRecommender() {
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@Autowired</code>, <code>@Inject</code>, <code>@Resource</code>, and <code>@Value</code> annotations are handled by Spring
<code>BeanPostProcessor</code> implementations which in turn means that you <em>cannot</em> apply these
annotations within your own <code>BeanPostProcessor</code> or <code>BeanFactoryPostProcessor</code> types (if
any). These types must be 'wired up' explicitly via XML or using a Spring <code>@Bean</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-autowired-annotation-primary"><a class="anchor" href="core.html#beans-autowired-annotation-primary"></a>1.9.3. Fine-tuning annotation-based autowiring with @Primary</h4>
<div class="paragraph">
<p>Because autowiring by type may lead to multiple candidates, it is often necessary to have
more control over the selection process. One way to accomplish this is with Spring&#8217;s
<code>@Primary</code> annotation. <code>@Primary</code> indicates that a particular bean should be given
preference when multiple beans are candidates to be autowired to a single-valued
dependency. If exactly one 'primary' bean exists among the candidates, it will be the
autowired value.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we have the following configuration that defines <code>firstMovieCatalog</code> as the
<em>primary</em> <code>MovieCatalog</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MovieConfiguration</span> {

    <span class="annotation">@Bean</span>
    <strong><span class="annotation">@Primary</span></strong>
    <span class="directive">public</span> MovieCatalog firstMovieCatalog() { ... }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> MovieCatalog secondMovieCatalog() { ... }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With such configuration, the following <code>MovieRecommender</code> will be autowired with the
<code>firstMovieCatalog</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MovieCatalog movieCatalog;

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding bean definitions appear as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span> <span class="error"><strong></span><span class="error"></strong></span><span class="attribute-name">primary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="error"><strong></span><span class="error"></strong></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">movieRecommender</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.MovieRecommender</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-autowired-annotation-qualifiers"><a class="anchor" href="core.html#beans-autowired-annotation-qualifiers"></a>1.9.4. Fine-tuning annotation-based autowiring with qualifiers</h4>
<div class="paragraph">
<p><code>@Primary</code> is an effective way to use autowiring by type with several instances when one
primary candidate can be determined. When more control over the selection process is
required, Spring&#8217;s <code>@Qualifier</code> annotation can be used. You can associate qualifier values
with specific arguments, narrowing the set of type matches so that a specific bean is
chosen for each argument. In the simplest case, this can be a plain descriptive value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <strong><span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">private</span> MovieCatalog movieCatalog;

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Qualifier</code> annotation can also be specified on individual constructor arguments or
method parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> MovieCatalog movieCatalog;

    <span class="directive">private</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> prepare(<strong><span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>)</strong>MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="local-variable">this</span>.movieCatalog = movieCatalog;
        <span class="local-variable">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding bean definitions appear as follows. The bean with qualifier value
"main" is wired with the constructor argument that is qualified with the same value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <strong><span class="tag">&lt;qualifier</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>

        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <strong><span class="tag">&lt;qualifier</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>

        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">movieRecommender</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.MovieRecommender</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a fallback match, the bean name is considered a default qualifier value. Thus you
can define the bean with an id "main" instead of the nested qualifier element, leading
to the same matching result. However, although you can use this convention to refer to
specific beans by name, <code>@Autowired</code> is fundamentally about type-driven injection with
optional semantic qualifiers. This means that qualifier values, even with the bean name
fallback, always have narrowing semantics within the set of type matches; they do not
semantically express a reference to a unique bean id. Good qualifier values are "main"
or "EMEA" or "persistent", expressing characteristics of a specific component that are
independent from the bean <code>id</code>, which may be auto-generated in case of an anonymous bean
definition like the one in the preceding example.</p>
</div>
<div class="paragraph">
<p>Qualifiers also apply to typed collections, as discussed above, for example, to
<code>Set&lt;MovieCatalog&gt;</code>. In this case, all matching beans according to the declared
qualifiers are injected as a collection. This implies that qualifiers do not have to be
unique; they rather simply constitute filtering criteria. For example, you can define
multiple <code>MovieCatalog</code> beans with the same qualifier value "action", all of which would
be injected into a <code>Set&lt;MovieCatalog&gt;</code> annotated with <code>@Qualifier("action")</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Letting qualifier values select against target bean names, within the type-matching
candidates, doesn&#8217;t even require a <code>@Qualifier</code> annotation at the injection point.
If there is no other resolution indicator (e.g. a qualifier or a primary marker),
for a non-unique dependency situation, Spring will match the injection point name
(i.e. field name or parameter name) against the target bean names and choose the
same-named candidate, if any.</p>
</div>
<div class="paragraph">
<p>That said, if you intend to express annotation-driven injection by name, do not
primarily use <code>@Autowired</code>, even if is capable of selecting by bean name among
type-matching candidates. Instead, use the JSR-250 <code>@Resource</code> annotation, which is
semantically defined to identify a specific target component by its unique name, with
the declared type being irrelevant for the matching process. <code>@Autowired</code> has rather
different semantics: After selecting candidate beans by type, the specified String
qualifier value will be considered within those type-selected candidates only, e.g.
matching an "account" qualifier against beans marked with the same qualifier label.</p>
</div>
<div class="paragraph">
<p>For beans that are themselves defined as a collection/map or array type, <code>@Resource</code>
is a fine solution, referring to the specific collection or array bean by unique name.
That said, as of 4.3, collection/map and array types can be matched through Spring&#8217;s
<code>@Autowired</code> type matching algorithm as well, as long as the element type information
is preserved in <code>@Bean</code> return type signatures or collection inheritance hierarchies.
In this case, qualifier values can be used to select among same-typed collections,
as outlined in the previous paragraph.</p>
</div>
<div class="paragraph">
<p>As of 4.3, <code>@Autowired</code> also considers self references for injection, i.e. references
back to the bean that is currently injected. Note that self injection is a fallback;
regular dependencies on other components always have precedence. In that sense, self
references do not participate in regular candidate selection and are therefore in
particular never primary; on the contrary, they always end up as lowest precedence.
In practice, use self references as a last resort only, e.g. for calling other methods
on the same instance through the bean&#8217;s transactional proxy: Consider factoring out
the affected methods to a separate delegate bean in such a scenario. Alternatively,
use <code>@Resource</code> which may obtain a proxy back to the current bean by its unique name.</p>
</div>
<div class="paragraph">
<p><code>@Autowired</code> applies to fields, constructors, and multi-argument methods, allowing for
narrowing through qualifier annotations at the parameter level. By contrast, <code>@Resource</code>
is supported only for fields and bean property setter methods with a single argument.
As a consequence, stick with qualifiers if your injection target is a constructor or a
multi-argument method.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can create your own custom qualifier annotations. Simply define an annotation and
provide the <code>@Qualifier</code> annotation within your definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.FIELD, <span class="predefined-type">ElementType</span>.PARAMETER})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<strong><span class="annotation">@Qualifier</span></strong>
<span class="directive">public</span> <span class="annotation">@interface</span> Genre {

    <span class="predefined-type">String</span> value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can provide the custom qualifier on autowired fields and parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <strong><span class="annotation">@Genre</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">private</span> MovieCatalog actionCatalog;

    <span class="directive">private</span> MovieCatalog comedyCatalog;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setComedyCatalog(<strong><span class="annotation">@Genre</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span>)</strong> MovieCatalog comedyCatalog) {
        <span class="local-variable">this</span>.comedyCatalog = comedyCatalog;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, provide the information for the candidate bean definitions. You can add
<code>&lt;qualifier/&gt;</code> tags as sub-elements of the <code>&lt;bean/&gt;</code> tag and then specify the <code>type</code> and
<code>value</code> to match your custom qualifier annotations. The type is matched against the
fully-qualified class name of the annotation. Or, as a convenience if no risk of
conflicting names exists, you can use the short class name. Both approaches are
demonstrated in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <strong><span class="tag">&lt;qualifier</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <strong><span class="tag">&lt;qualifier</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.Genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">movieRecommender</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.MovieRecommender</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="core.html#beans-classpath-scanning">Classpath scanning and managed components</a>, you will see an annotation-based alternative to
providing the qualifier metadata in XML. Specifically, see <a href="core.html#beans-scanning-qualifiers">Providing qualifier metadata with annotations</a>.</p>
</div>
<div class="paragraph">
<p>In some cases, it may be sufficient to use an annotation without a value. This may be
useful when the annotation serves a more generic purpose and can be applied across
several different types of dependencies. For example, you may provide an <em>offline</em>
catalog that would be searched when no Internet connection is available. First define
the simple annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.FIELD, <span class="predefined-type">ElementType</span>.PARAMETER})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Qualifier</span>
<span class="directive">public</span> <span class="annotation">@interface</span> Offline {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add the annotation to the field or property to be autowired:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <strong><span class="annotation">@Offline</span></strong>
    <span class="directive">private</span> MovieCatalog offlineCatalog;

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the bean definition only needs a qualifier <code>type</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <strong><span class="tag">&lt;qualifier</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Offline</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>
    <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define custom qualifier annotations that accept named attributes in
addition to or instead of the simple <code>value</code> attribute. If multiple attribute values are
then specified on a field or parameter to be autowired, a bean definition must match
<em>all</em> such attribute values to be considered an autowire candidate. As an example,
consider the following annotation definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.FIELD, <span class="predefined-type">ElementType</span>.PARAMETER})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Qualifier</span>
<span class="directive">public</span> <span class="annotation">@interface</span> MovieQualifier {

    <span class="predefined-type">String</span> genre();

    <span class="predefined-type">Format</span> format();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>Format</code> is an enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> <span class="predefined-type">Format</span> {
    VHS, DVD, BLURAY
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fields to be autowired are annotated with the custom qualifier and include values
for both attributes: <code>genre</code> and <code>format</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Autowired</span>
    <span class="annotation">@MovieQualifier</span>(format=<span class="predefined-type">Format</span>.VHS, genre=<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> MovieCatalog actionVhsCatalog;

    <span class="annotation">@Autowired</span>
    <span class="annotation">@MovieQualifier</span>(format=<span class="predefined-type">Format</span>.VHS, genre=<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> MovieCatalog comedyVhsCatalog;

    <span class="annotation">@Autowired</span>
    <span class="annotation">@MovieQualifier</span>(format=<span class="predefined-type">Format</span>.DVD, genre=<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> MovieCatalog actionDvdCatalog;

    <span class="annotation">@Autowired</span>
    <span class="annotation">@MovieQualifier</span>(format=<span class="predefined-type">Format</span>.BLURAY, genre=<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> MovieCatalog comedyBluRayCatalog;

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the bean definitions should contain matching qualifier values. This example
also demonstrates that bean <em>meta</em> attributes may be used instead of the
<code>&lt;qualifier/&gt;</code> sub-elements. If available, the <code>&lt;qualifier/&gt;</code> and its attributes take
precedence, but the autowiring mechanism falls back on the values provided within the
<code>&lt;meta/&gt;</code> tags if no such qualifier is present, as in the last two bean definitions in
the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;qualifier</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MovieQualifier</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VHS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/qualifier&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;qualifier</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MovieQualifier</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VHS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;attribute</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/qualifier&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DVD</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleMovieCatalog</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BLURAY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Comedy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-generics-as-qualifiers"><a class="anchor" href="core.html#beans-generics-as-qualifiers"></a>1.9.5. Using generics as autowiring qualifiers</h4>
<div class="paragraph">
<p>In addition to the <code>@Qualifier</code> annotation, it is also possible to use Java generic types
as an implicit form of qualification. For example, suppose you have the following
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyConfiguration</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> StringStore stringStore() {
        <span class="keyword">return</span> <span class="keyword">new</span> StringStore();
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> IntegerStore integerStore() {
        <span class="keyword">return</span> <span class="keyword">new</span> IntegerStore();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that beans above implement a generic interface, i.e. <code>Store&lt;String&gt;</code> and
<code>Store&lt;Integer&gt;</code>, you can <code>@Autowire</code> the <code>Store</code> interface and the <em>generic</em> will
be used as a qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Store&lt;<span class="predefined-type">String</span>&gt; s1; <span class="comment">// &lt;String&gt; qualifier, injects the stringStore bean</span>

<span class="annotation">@Autowired</span>
<span class="directive">private</span> Store&lt;<span class="predefined-type">Integer</span>&gt; s2; <span class="comment">// &lt;Integer&gt; qualifier, injects the integerStore bean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Generic qualifiers also apply when autowiring Lists, Maps and Arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span>
<span class="comment">// Store&lt;String&gt; beans will not appear in this list</span>
<span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;Store&lt;<span class="predefined-type">Integer</span>&gt;&gt; s;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-custom-autowire-configurer"><a class="anchor" href="core.html#beans-custom-autowire-configurer"></a>1.9.6. CustomAutowireConfigurer</h4>
<div class="paragraph">
<p>The
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html"><code>CustomAutowireConfigurer</code></a>
is a <code>BeanFactoryPostProcessor</code> that enables you to register your own custom qualifier
annotation types even if they are not annotated with Spring&#8217;s <code>@Qualifier</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customAutowireConfigurer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.annotation.CustomAutowireConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customQualifierTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;value&gt;</span>example.CustomQualifier<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AutowireCandidateResolver</code> determines autowire candidates by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>autowire-candidate</code> value of each bean definition</p>
</li>
<li>
<p>any <code>default-autowire-candidates</code> pattern(s) available on the <code>&lt;beans/&gt;</code> element</p>
</li>
<li>
<p>the presence of <code>@Qualifier</code> annotations and any custom annotations registered
with the <code>CustomAutowireConfigurer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When multiple beans qualify as autowire candidates, the determination of a "primary" is
the following: if exactly one bean definition among the candidates has a <code>primary</code>
attribute set to <code>true</code>, it will be selected.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-resource-annotation"><a class="anchor" href="core.html#beans-resource-annotation"></a>1.9.7. @Resource</h4>
<div class="paragraph">
<p>Spring also supports injection using the JSR-250 <code>@Resource</code> annotation on fields or
bean property setter methods. This is a common pattern in Java EE 5 and 6, for example
in JSF 1.2 managed beans or JAX-WS 2.0 endpoints. Spring supports this pattern for
Spring-managed objects as well.</p>
</div>
<div class="paragraph">
<p><code>@Resource</code> takes a name attribute, and by default Spring interprets that value as the
bean name to be injected. In other words, it follows <em>by-name</em> semantics, as
demonstrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <strong><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMovieFinder</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no name is specified explicitly, the default name is derived from the field name or
setter method. In case of a field, it takes the field name; in case of a setter method,
it takes the bean property name. So the following example is going to have the bean with
name "movieFinder" injected into its setter method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <strong><span class="annotation">@Resource</span></strong>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The name provided with the annotation is resolved as a bean name by the
<code>ApplicationContext</code> of which the <code>CommonAnnotationBeanPostProcessor</code> is aware. The
names can be resolved through JNDI if you configure Spring&#8217;s
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html"><code>SimpleJndiBeanFactory</code></a>
explicitly. However, it is recommended that you rely on the default behavior and simply
use Spring&#8217;s JNDI lookup capabilities to preserve the level of indirection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the exclusive case of <code>@Resource</code> usage with no explicit name specified, and similar
to <code>@Autowired</code>, <code>@Resource</code> finds a primary type match instead of a specific named bean
and resolves well-known resolvable dependencies: the <code>BeanFactory</code>,
<code>ApplicationContext</code>, <code>ResourceLoader</code>, <code>ApplicationEventPublisher</code>, and <code>MessageSource</code>
interfaces.</p>
</div>
<div class="paragraph">
<p>Thus in the following example, the <code>customerPreferenceDao</code> field first looks for a bean
named customerPreferenceDao, then falls back to a primary type match for the type
<code>CustomerPreferenceDao</code>. The "context" field is injected based on the known resolvable
dependency type <code>ApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="annotation">@Resource</span>
    <span class="directive">private</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Resource</span>
    <span class="directive">private</span> ApplicationContext context;

    <span class="directive">public</span> MovieRecommender() {
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-postconstruct-and-predestroy-annotations"><a class="anchor" href="core.html#beans-postconstruct-and-predestroy-annotations"></a>1.9.8. @PostConstruct and @PreDestroy</h4>
<div class="paragraph">
<p>The <code>CommonAnnotationBeanPostProcessor</code> not only recognizes the <code>@Resource</code> annotation
but also the JSR-250 <em>lifecycle</em> annotations. Introduced in Spring 2.5, the support
for these annotations offers yet another alternative to those described in
<a href="core.html#beans-factory-lifecycle-initializingbean">initialization callbacks</a> and
<a href="core.html#beans-factory-lifecycle-disposablebean">destruction callbacks</a>. Provided that the
<code>CommonAnnotationBeanPostProcessor</code> is registered within the Spring
<code>ApplicationContext</code>, a method carrying one of these annotations is invoked at the same
point in the lifecycle as the corresponding Spring lifecycle interface method or
explicitly declared callback method. In the example below, the cache will be
pre-populated upon initialization and cleared upon destruction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CachingMovieLister</span> {

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> populateMovieCache() {
        <span class="comment">// populates the movie cache upon initialization...</span>
    }

    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> clearMovieCache() {
        <span class="comment">// clears the movie cache upon destruction...</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For details about the effects of combining various lifecycle mechanisms, see
<a href="core.html#beans-factory-lifecycle-combined-effects">Combining lifecycle mechanisms</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-classpath-scanning"><a class="anchor" href="core.html#beans-classpath-scanning"></a>1.10. Classpath scanning and managed components</h3>
<div class="paragraph">
<p>Most examples in this chapter use XML to specify the configuration metadata that produces
each <code>BeanDefinition</code> within the Spring container. The previous section
(<a href="core.html#beans-annotation-config">Annotation-based container configuration</a>) demonstrates how to provide a lot of the configuration
metadata through source-level annotations. Even in those examples, however, the "base"
bean definitions are explicitly defined in the XML file, while the annotations only drive
the dependency injection. This section describes an option for implicitly detecting the
<em>candidate components</em> by scanning the classpath. Candidate components are classes that
match against a filter criteria and have a corresponding bean definition registered with
the container. This removes the need to use XML to perform bean registration; instead you
can use annotations (for example <code>@Component</code>), AspectJ type expressions, or your own
custom filter criteria to select which classes will have bean definitions registered with
the container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Spring 3.0, many features provided by the Spring JavaConfig project are
part of the core Spring Framework. This allows you to define beans using Java rather
than using the traditional XML files. Take a look at the <code>@Configuration</code>, <code>@Bean</code>,
<code>@Import</code>, and <code>@DependsOn</code> annotations for examples of how to use these new features.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="beans-stereotype-annotations"><a class="anchor" href="core.html#beans-stereotype-annotations"></a>1.10.1. @Component and further stereotype annotations</h4>
<div class="paragraph">
<p>The <code>@Repository</code> annotation is a marker for any class that fulfills the role or
<em>stereotype</em> of a repository (also known as Data Access Object or DAO). Among the uses
of this marker is the automatic translation of exceptions as described in
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#orm-exception-translation">Exception translation</a>.</p>
</div>
<div class="paragraph">
<p>Spring provides further stereotype annotations: <code>@Component</code>, <code>@Service</code>, and
<code>@Controller</code>. <code>@Component</code> is a generic stereotype for any Spring-managed component.
<code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code> are specializations of <code>@Component</code> for
more specific use cases, for example, in the persistence, service, and presentation
layers, respectively. Therefore, you can annotate your component classes with
<code>@Component</code>, but by annotating them with <code>@Repository</code>, <code>@Service</code>, or <code>@Controller</code>
instead, your classes are more properly suited for processing by tools or associating
with aspects. For example, these stereotype annotations make ideal targets for
pointcuts. It is also possible that <code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code> may
carry additional semantics in future releases of the Spring Framework. Thus, if you are
choosing between using <code>@Component</code> or <code>@Service</code> for your service layer, <code>@Service</code> is
clearly the better choice. Similarly, as stated above, <code>@Repository</code> is already
supported as a marker for automatic exception translation in your persistence layer.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-meta-annotations"><a class="anchor" href="core.html#beans-meta-annotations"></a>1.10.2. Meta-annotations</h4>
<div class="paragraph">
<p>Many of the annotations provided by Spring can be used as <em>meta-annotations</em> in your
own code. A meta-annotation is simply an annotation that can be applied to another
annotation. For example, the <code>@Service</code> annotation mentioned above is meta-annotated with
<code>@Component</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<strong><span class="annotation">@Component</span></strong> <span class="comment">// Spring will see this and treat @Service in the same way as @Component</span>
<span class="directive">public</span> <span class="annotation">@interface</span> Service {

    <span class="comment">// ....</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Meta-annotations can also be combined to create <em>composed annotations</em>. For example,
the <code>@RestController</code> annotation from Spring MVC is <em>composed</em> of <code>@Controller</code> and
<code>@ResponseBody</code>.</p>
</div>
<div class="paragraph">
<p>In addition, composed annotations may optionally redeclare attributes from
meta-annotations to allow user customization. This can be particularly useful when you
want to only expose a subset of the meta-annotation&#8217;s attributes. For example, Spring&#8217;s
<code>@SessionScope</code> annotation hardcodes the scope name to <code>session</code> but still allows
customization of the <code>proxyMode</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Scope</span>(WebApplicationContext.SCOPE_SESSION)
<span class="directive">public</span> <span class="annotation">@interface</span> SessionScope {

    <span class="comment">/**
     * Alias for {@link Scope#proxyMode}.
     * &lt;p&gt;Defaults to {@link ScopedProxyMode#TARGET_CLASS}.
     */</span>
    <span class="annotation">@AliasFor</span>(annotation = Scope.class)
    ScopedProxyMode proxyMode() <span class="keyword">default</span> ScopedProxyMode.TARGET_CLASS;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@SessionScope</code> can then be used without declaring the <code>proxyMode</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>
<strong><span class="annotation">@SessionScope</span></strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SessionScopedService</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with an overridden value for the <code>proxyMode</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>
<strong><span class="annotation">@SessionScope</span>(proxyMode = ScopedProxyMode.INTERFACES)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SessionScopedUserService</span> <span class="directive">implements</span> UserService {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details, consult the
<a href="https://github.com/spring-projects/spring-framework/wiki/Spring-Annotation-Programming-Model">Spring Annotation Programming Model</a>
wiki page.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-autodetection"><a class="anchor" href="core.html#beans-scanning-autodetection"></a>1.10.3. Automatically detecting classes and registering bean definitions</h4>
<div class="paragraph">
<p>Spring can automatically detect stereotyped classes and register corresponding
<code>BeanDefinition</code>s with the <code>ApplicationContext</code>. For example, the following two classes
are eligible for such autodetection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">JpaMovieFinder</span> <span class="directive">implements</span> MovieFinder {
    <span class="comment">// implementation elided for clarity</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To autodetect these classes and register the corresponding beans, you need to add
<code>@ComponentScan</code> to your <code>@Configuration</code> class, where the <code>basePackages</code> attribute
is a common parent package for the two classes. (Alternatively, you can specify a
comma/semicolon/space-separated list that includes the parent package of each class.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span>  {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For concision, the above may have used the <code>value</code> attribute of the
annotation, i.e. <code>@ComponentScan("org.example")</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an alternative using XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of <code>&lt;context:component-scan&gt;</code> implicitly enables the functionality of
<code>&lt;context:annotation-config&gt;</code>. There is usually no need to include the
<code>&lt;context:annotation-config&gt;</code> element when using <code>&lt;context:component-scan&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The scanning of classpath packages requires the presence of corresponding directory
entries in the classpath. When you build JARs with Ant, make sure that you do <em>not</em>
activate the files-only switch of the JAR task. Also, classpath directories may not
get exposed based on security policies in some environments, e.g. standalone apps on
JDK 1.7.0_45 and higher (which requires 'Trusted-Library' setup in your manifests; see
<a href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources" class="bare">http://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources</a>).</p>
</div>
<div class="paragraph">
<p>On JDK 9&#8217;s module path (Jigsaw), Spring&#8217;s classpath scanning generally works as expected.
However, please make sure that your component classes are exported in your <code>module-info</code>
descriptors; if you expect Spring to invoke non-public members of your classes, make
sure that they are 'opened' (i.e. using an <code>opens</code> declaration instead of an <code>exports</code>
declaration in your <code>module-info</code> descriptor).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, the <code>AutowiredAnnotationBeanPostProcessor</code> and
<code>CommonAnnotationBeanPostProcessor</code> are both included implicitly when you use the
component-scan element. That means that the two components are autodetected <em>and</em>
wired together - all without any bean configuration metadata provided in XML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can disable the registration of <code>AutowiredAnnotationBeanPostProcessor</code> and
<code>CommonAnnotationBeanPostProcessor</code> by including the <em>annotation-config</em> attribute
with a value of <code>false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-filters"><a class="anchor" href="core.html#beans-scanning-filters"></a>1.10.4. Using filters to customize scanning</h4>
<div class="paragraph">
<p>By default, classes annotated with <code>@Component</code>, <code>@Repository</code>, <code>@Service</code>,
<code>@Controller</code>, or a custom annotation that itself is annotated with <code>@Component</code> are the
only detected candidate components. However, you can modify and extend this behavior
simply by applying custom filters. Add them as <em>includeFilters</em> or <em>excludeFilters</em>
parameters of the <code>@ComponentScan</code> annotation (or as <em>include-filter</em> or <em>exclude-filter</em>
sub-elements of the <code>component-scan</code> element). Each filter element requires the <code>type</code>
and <code>expression</code> attributes. The following table describes the filtering options.</p>
</div>
<table id="beans-scanning-filters-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Filter Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filter Type</th>
<th class="tableblock halign-left valign-top">Example Expression</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotation (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.example.SomeAnnotation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An annotation to be present at the type level in target components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assignable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.example.SomeClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A class (or interface) that the target components are assignable to (extend/implement).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aspectj</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.example..*Service+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An AspectJ type expression to be matched by the target components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org\.example\.Default.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regex expression to be matched by the target components class names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.example.MyTypeFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom implementation of the <code>org.springframework.core.type .TypeFilter</code> interface.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows the configuration ignoring all <code>@Repository</code> annotations
and using "stub" repositories instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>,
        includeFilters = <span class="annotation">@Filter</span>(type = FilterType.REGEX, pattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">.*Stub.*Repository</span><span class="delimiter">&quot;</span></span>),
        excludeFilters = <span class="annotation">@Filter</span>(Repository.class))
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the equivalent using XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;context:include-filter</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">regex</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*Stub.*Repository</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;context:exclude-filter</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">annotation</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.stereotype.Repository</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/context:component-scan&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also disable the default filters by setting <code>useDefaultFilters=false</code> on the annotation or
providing <code>use-default-filters="false"</code> as an attribute of the <code>&lt;component-scan/&gt;</code> element. This
will in effect disable automatic detection of classes annotated with <code>@Component</code>, <code>@Repository</code>,
<code>@Service</code>, <code>@Controller</code>, or <code>@Configuration</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-factorybeans-annotations"><a class="anchor" href="core.html#beans-factorybeans-annotations"></a>1.10.5. Defining bean metadata within components</h4>
<div class="paragraph">
<p>Spring components can also contribute bean definition metadata to the container. You do
this with the same <code>@Bean</code> annotation used to define bean metadata within <code>@Configuration</code>
annotated classes. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FactoryMethodComponent</span> {

    <span class="annotation">@Bean</span>
    <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> TestBean publicInstance() {
        <span class="keyword">return</span> <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicInstance</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="type">void</span> doWork() {
        <span class="comment">// Component method implementation omitted</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is a Spring component that has application-specific code contained in its
<code>doWork()</code> method. However, it also contributes a bean definition that has a factory
method referring to the method <code>publicInstance()</code>. The <code>@Bean</code> annotation identifies the
factory method and other bean definition properties, such as a qualifier value through
the <code>@Qualifier</code> annotation. Other method level annotations that can be specified are
<code>@Scope</code>, <code>@Lazy</code>, and custom qualifier annotations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to its role for component initialization, the <code>@Lazy</code> annotation may also be
placed on injection points marked with <code>@Autowired</code> or <code>@Inject</code>. In this context, it
leads to the injection of a lazy-resolution proxy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Autowired fields and methods are supported as previously discussed, with additional
support for autowiring of <code>@Bean</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FactoryMethodComponent</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">int</span> i;

    <span class="annotation">@Bean</span>
    <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> TestBean publicInstance() {
        <span class="keyword">return</span> <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicInstance</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="comment">// use of a custom qualifier and autowiring of method parameters</span>
    <span class="annotation">@Bean</span>
    <span class="directive">protected</span> TestBean protectedInstance(
            <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>) TestBean spouse,
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{privateInstance.age}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> country) {
        TestBean tb = <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">protectedInstance</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>);
        tb.setSpouse(spouse);
        tb.setCountry(country);
        <span class="keyword">return</span> tb;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">private</span> TestBean privateInstance() {
        <span class="keyword">return</span> <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">privateInstance</span><span class="delimiter">&quot;</span></span>, i++);
    }

    <span class="annotation">@Bean</span>
    <span class="annotation">@RequestScope</span>
    <span class="directive">public</span> TestBean requestScopedInstance() {
        <span class="keyword">return</span> <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">requestScopedInstance</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example autowires the <code>String</code> method parameter <code>country</code> to the value of the <code>Age</code>
property on another bean named <code>privateInstance</code>. A Spring Expression Language element
defines the value of the property through the notation <code>#{ &lt;expression&gt; }</code>. For <code>@Value</code>
annotations, an expression resolver is preconfigured to look for bean names when
resolving expression text.</p>
</div>
<div class="paragraph">
<p>As of Spring Framework 4.3, you may also declare a factory method parameter of type
<code>InjectionPoint</code> (or its more specific subclass <code>DependencyDescriptor</code>) in order to
access the requesting injection point that triggers the creation of the current bean.
Note that this will only apply to the actual creation of bean instances, not to the
injection of existing instances. As a consequence, this feature makes most sense for
beans of prototype scope. For other scopes, the factory method will only ever see the
injection point which triggered the creation of a new bean instance in the given scope:
for example, the dependency that triggered the creation of a lazy singleton bean.
Use the provided injection point metadata with semantic care in such scenarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FactoryMethodComponent</span> {

    <span class="annotation">@Bean</span> <span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> TestBean prototypeInstance(InjectionPoint injectionPoint) {
        <span class="keyword">return</span> <span class="keyword">new</span> TestBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototypeInstance for </span><span class="delimiter">&quot;</span></span> + injectionPoint.getMember());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Bean</code> methods in a regular Spring component are processed differently than their
counterparts inside a Spring <code>@Configuration</code> class. The difference is that <code>@Component</code>
classes are not enhanced with CGLIB to intercept the invocation of methods and fields.
CGLIB proxying is the means by which invoking methods or fields within <code>@Bean</code> methods
in <code>@Configuration</code> classes creates bean metadata references to collaborating objects;
such methods are <em>not</em> invoked with normal Java semantics but rather go through the
container in order to provide the usual lifecycle management and proxying of Spring
beans even when referring to other beans via programmatic calls to <code>@Bean</code> methods.
In contrast, invoking a method or field in an <code>@Bean</code> method within a plain <code>@Component</code>
class <em>has</em> standard Java semantics, with no special CGLIB processing or other
constraints applying.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may declare <code>@Bean</code> methods as <code>static</code>, allowing for them to be called without
creating their containing configuration class as an instance. This makes particular
sense when defining post-processor beans, e.g. of type <code>BeanFactoryPostProcessor</code> or
<code>BeanPostProcessor</code>, since such beans will get initialized early in the container
lifecycle and should avoid triggering other parts of the configuration at that point.</p>
</div>
<div class="paragraph">
<p>Note that calls to static <code>@Bean</code> methods will never get intercepted by the container,
not even within <code>@Configuration</code> classes (see above). This is due to technical
limitations: CGLIB subclassing can only override non-static methods. As a consequence,
a direct call to another <code>@Bean</code> method will have standard Java semantics, resulting
in an independent instance being returned straight from the factory method itself.</p>
</div>
<div class="paragraph">
<p>The Java language visibility of <code>@Bean</code> methods does not have an immediate impact on
the resulting bean definition in Spring&#8217;s container. You may freely declare your
factory methods as you see fit in non-<code>@Configuration</code> classes and also for static
methods anywhere. However, regular <code>@Bean</code> methods in <code>@Configuration</code> classes need
to be overridable, i.e. they must not be declared as <code>private</code> or <code>final</code>.</p>
</div>
<div class="paragraph">
<p><code>@Bean</code> methods will also be discovered on base classes of a given component or
configuration class, as well as on Java 8 default methods declared in interfaces
implemented by the component or configuration class. This allows for a lot of
flexibility in composing complex configuration arrangements, with even multiple
inheritance being possible through Java 8 default methods as of Spring 4.2.</p>
</div>
<div class="paragraph">
<p>Finally, note that a single class may hold multiple <code>@Bean</code> methods for the same
bean, as an arrangement of multiple factory methods to use depending on available
dependencies at runtime. This is the same algorithm as for choosing the "greediest"
constructor or factory method in other configuration scenarios: The variant with
the largest number of satisfiable dependencies will be picked at construction time,
analogous to how the container selects between multiple <code>@Autowired</code> constructors.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-name-generator"><a class="anchor" href="core.html#beans-scanning-name-generator"></a>1.10.6. Naming autodetected components</h4>
<div class="paragraph">
<p>When a component is autodetected as part of the scanning process, its bean name is
generated by the <code>BeanNameGenerator</code> strategy known to that scanner. By default, any
Spring stereotype annotation (<code>@Component</code>, <code>@Repository</code>, <code>@Service</code>, and
<code>@Controller</code>) that contains a <em>name</em> <code>value</code> will thereby provide that name to the
corresponding bean definition.</p>
</div>
<div class="paragraph">
<p>If such an annotation contains no <em>name</em> <code>value</code> or for any other detected component (such
as those discovered by custom filters), the default bean name generator returns the
uncapitalized non-qualified class name. For example, if the following two components
were detected, the names would be <code>myMovieLister</code> and <code>movieFinderImpl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myMovieLister</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MovieFinderImpl</span> <span class="directive">implements</span> MovieFinder {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not want to rely on the default bean-naming strategy, you can provide a custom
bean-naming strategy. First, implement the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html"><code>BeanNameGenerator</code></a>
interface, and be sure to include a default no-arg constructor. Then, provide the
fully-qualified class name when configuring the scanner:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>, nameGenerator = MyNameGenerator.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">name-generator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.MyNameGenerator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a general rule, consider specifying the name with the annotation whenever other
components may be making explicit references to it. On the other hand, the
auto-generated names are adequate whenever the container is responsible for wiring.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-scope-resolver"><a class="anchor" href="core.html#beans-scanning-scope-resolver"></a>1.10.7. Providing a scope for autodetected components</h4>
<div class="paragraph">
<p>As with Spring-managed components in general, the default and most common scope for
autodetected components is <code>singleton</code>. However, sometimes you need a different scope
which can be specified via the <code>@Scope</code> annotation. Simply provide the name of the scope
within the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MovieFinderImpl</span> <span class="directive">implements</span> MovieFinder {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details on web-specific scopes, see <a href="core.html#beans-factory-scopes-other">Request, session, application, and WebSocket scopes</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To provide a custom strategy for scope resolution rather than relying on the
annotation-based approach, implement the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html"><code>ScopeMetadataResolver</code></a>
interface, and be sure to include a default no-arg constructor. Then, provide the
fully-qualified class name when configuring the scanner:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>, scopeResolver = MyScopeResolver.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">scope-resolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.MyScopeResolver</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using certain non-singleton scopes, it may be necessary to generate proxies for the
scoped objects. The reasoning is described in <a href="core.html#beans-factory-scopes-other-injection">Scoped beans as dependencies</a>.
For this purpose, a <em>scoped-proxy</em> attribute is available on the component-scan
element. The three possible values are: no, interfaces, and targetClass. For example,
the following configuration will result in standard JDK dynamic proxies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>, scopedProxy = ScopedProxyMode.INTERFACES)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">scoped-proxy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interfaces</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-qualifiers"><a class="anchor" href="core.html#beans-scanning-qualifiers"></a>1.10.8. Providing qualifier metadata with annotations</h4>
<div class="paragraph">
<p>The <code>@Qualifier</code> annotation is discussed in <a href="core.html#beans-autowired-annotation-qualifiers">Fine-tuning annotation-based autowiring with qualifiers</a>.
The examples in that section demonstrate the use of the <code>@Qualifier</code> annotation and
custom qualifier annotations to provide fine-grained control when you resolve autowire
candidates. Because those examples were based on XML bean definitions, the qualifier
metadata was provided on the candidate bean definitions using the <code>qualifier</code> or <code>meta</code>
sub-elements of the <code>bean</code> element in the XML. When relying upon classpath scanning for
autodetection of components, you provide the qualifier metadata with type-level
annotations on the candidate class. The following three examples demonstrate this
technique:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<strong><span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ActionMovieCatalog</span> <span class="directive">implements</span> MovieCatalog {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<strong><span class="annotation">@Genre</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ActionMovieCatalog</span> <span class="directive">implements</span> MovieCatalog {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<strong><span class="annotation">@Offline</span></strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CachingMovieCatalog</span> <span class="directive">implements</span> MovieCatalog {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As with most annotation-based alternatives, keep in mind that the annotation metadata is
bound to the class definition itself, while the use of XML allows for multiple beans
<em>of the same type</em> to provide variations in their qualifier metadata, because that
metadata is provided per-instance rather than per-class.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-scanning-index"><a class="anchor" href="core.html#beans-scanning-index"></a>1.10.9. Generating an index of candidate components</h4>
<div class="paragraph">
<p>While classpath scanning is very fast, it is possible to improve the startup performance
of large applications by creating a static list of candidates at compilation time. In this
mode, <em>all modules</em> of the application must use this mechanism as, when the
<code>ApplicationContext</code> detects such index, it will automatically use it rather than scanning
the classpath.</p>
</div>
<div class="paragraph">
<p>To generate the index, simply add an additional dependency to each module that contains
components that are target for component scan directives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-context-indexer<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>5.0.4.RELEASE<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;optional&gt;</span>true<span class="tag">&lt;/optional&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, using Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compileOnly(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework:spring-context-indexer:5.0.4.RELEASE</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That process will generate a <code>META-INF/spring.components</code> file that is going to be
included in the jar.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When working with this mode in your IDE, the <code>spring-context-indexer</code> must be registered
as an annotation processor to make sure the index is up to date when candidate components
are updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The index is enabled automatically when a <code>META-INF/spring.components</code> is found on the
classpath. If an index is partially available for some libraries (or use cases) but
couldn&#8217;t be built for the whole application, you can fallback to a regular classpath
arrangement (i.e. as no index was present at all) by setting <code>spring.index.ignore</code> to
<code>true</code>, either as a system property or in a <code>spring.properties</code> file at the root of the
classpath.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-standard-annotations"><a class="anchor" href="core.html#beans-standard-annotations"></a>1.11. Using JSR 330 Standard Annotations</h3>
<div class="paragraph">
<p>Starting with Spring 3.0, Spring offers support for JSR-330 standard annotations
(Dependency Injection). Those annotations are scanned in the same way as the Spring
annotations. You just need to have the relevant jars in your classpath.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Maven, the <code>javax.inject</code> artifact is available in the standard Maven
repository (
<a href="https://repo1.maven.org/maven2/javax/inject/javax.inject/1/">http://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>).
You can add the following dependency to your file pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>javax.inject<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>javax.inject<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="beans-inject-named"><a class="anchor" href="core.html#beans-inject-named"></a>1.11.1. Dependency Injection with @Inject and @Named</h4>
<div class="paragraph">
<p>Instead of <code>@Autowired</code>, <code>@javax.inject.Inject</code> may be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="directive">public</span> <span class="type">void</span> listMovies() {
        <span class="local-variable">this</span>.movieFinder.findMovies(...);
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>@Autowired</code>, it is possible to use <code>@Inject</code> at the field level, method level
and constructor-argument level. Furthermore, you may declare your injection point as a
<code>Provider</code>, allowing for on-demand access to beans of shorter scopes or lazy access to
other beans through a <code>Provider.get()</code> call. As a variant of the example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Provider</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> <span class="predefined-type">Provider</span>&lt;MovieFinder&gt; movieFinder;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(<span class="predefined-type">Provider</span>&lt;MovieFinder&gt; movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="directive">public</span> <span class="type">void</span> listMovies() {
        <span class="local-variable">this</span>.movieFinder.get().findMovies(...);
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to use a qualified name for the dependency that should be injected,
you should use the <code>@Named</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>) MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like <code>@Autowired</code>, <code>@Inject</code> can also be used with <code>java.util.Optional</code> or
<code>@Nullable</code>. This is even more applicable here since <code>@Inject</code> does not have
a <code>required</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(Optional&lt;MovieFinder&gt; movieFinder) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(<span class="annotation">@Nullable</span> MovieFinder movieFinder) {
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-named"><a class="anchor" href="core.html#beans-named"></a>1.11.2. @Named and @ManagedBean: standard equivalents to the @Component annotation</h4>
<div class="paragraph">
<p>Instead of <code>@Component</code>, <code>@javax.inject.Named</code> or <code>javax.annotation.ManagedBean</code> may be
used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">movieListener</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// @ManagedBean(&quot;movieListener&quot;) could be used as well</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is very common to use <code>@Component</code> without specifying a name for the component.
<code>@Named</code> can be used in a similar fashion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> <span class="type">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>@Named</code> or <code>@ManagedBean</code>, it is possible to use component scanning in the
exact same way as when using Spring annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span>  {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In contrast to <code>@Component</code>, the JSR-330 <code>@Named</code> and the JSR-250 <code>ManagedBean</code>
annotations are not composable. Please use Spring&#8217;s stereotype model for building custom
component annotations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beans-standard-annotations-limitations"><a class="anchor" href="core.html#beans-standard-annotations-limitations"></a>1.11.3. Limitations of JSR-330 standard annotations</h4>
<div class="paragraph">
<p>When working with standard annotations, it is important to know that some significant
features are not available as shown in the table below:</p>
</div>
<table id="annotations-comparison" class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Spring component model elements vs. JSR-330 variants</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring</th>
<th class="tableblock halign-left valign-top">javax.inject.*</th>
<th class="tableblock halign-left valign-top">javax.inject restrictions / comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Autowired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Inject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject</code> has no 'required' attribute; can be used with Java 8&#8217;s <code>Optional</code> instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Named / @ManagedBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSR-330 does not provide a composable model, just a way to identify named components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Scope("singleton")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Singleton</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JSR-330 default scope is like Spring&#8217;s <code>prototype</code>. However, in order to keep it
consistent with Spring&#8217;s general defaults, a JSR-330 bean declared in the Spring
container is a <code>singleton</code> by default. In order to use a scope other than <code>singleton</code>,
you should use Spring&#8217;s <code>@Scope</code> annotation. <code>javax.inject</code> also provides a
<a href="http://download.oracle.com/javaee/6/api/javax/inject/Scope.html">@Scope</a> annotation.
Nevertheless, this one is only intended to be used for creating your own annotations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Qualifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Qualifier / @Named</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.inject.Qualifier</code> is just a meta-annotation for building custom qualifiers.
Concrete String qualifiers (like Spring&#8217;s <code>@Qualifier</code> with a value) can be associated
through <code>javax.inject.Named</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Lazy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no equivalent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjectFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.inject.Provider</code> is a direct alternative to Spring&#8217;s <code>ObjectFactory</code>,
just with a shorter <code>get()</code> method name. It can also be used in combination with
Spring&#8217;s <code>@Autowired</code> or with non-annotated constructors and setter methods.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="beans-java"><a class="anchor" href="core.html#beans-java"></a>1.12. Java-based container configuration</h3>
<div class="sect3">
<h4 id="beans-java-basic-concepts"><a class="anchor" href="core.html#beans-java-basic-concepts"></a>1.12.1. Basic concepts: @Bean and @Configuration</h4>
<div class="paragraph">
<p>The central artifacts in Spring&#8217;s new Java-configuration support are
<code>@Configuration</code>-annotated classes and <code>@Bean</code>-annotated methods.</p>
</div>
<div class="paragraph">
<p>The <code>@Bean</code> annotation is used to indicate that a method instantiates, configures and
initializes a new object to be managed by the Spring IoC container. For those familiar
with Spring&#8217;s <code>&lt;beans/&gt;</code> XML configuration the <code>@Bean</code> annotation plays the same role as
the <code>&lt;bean/&gt;</code> element. You can use <code>@Bean</code> annotated methods with any Spring
<code>@Component</code>, however, they are most often used with <code>@Configuration</code> beans.</p>
</div>
<div class="paragraph">
<p>Annotating a class with <code>@Configuration</code> indicates that its primary purpose is as a
source of bean definitions. Furthermore, <code>@Configuration</code> classes allow inter-bean
dependencies to be defined by simply calling other <code>@Bean</code> methods in the same class.
The simplest possible <code>@Configuration</code> class would read as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> MyService myService() {
        <span class="keyword">return</span> <span class="keyword">new</span> MyServiceImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AppConfig</code> class above would be equivalent to the following Spring <code>&lt;beans/&gt;</code> XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.services.MyServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Full @Configuration vs 'lite' @Bean mode?</div>
<div class="paragraph">
<p>When <code>@Bean</code> methods are declared within classes that are <em>not</em> annotated with
<code>@Configuration</code> they are referred to as being processed in a 'lite' mode. Bean methods
declared in a <code>@Component</code> or even in a <em>plain old class</em> will be considered 'lite',
with a different primary purpose of the containing class and an <code>@Bean</code> method just
being a sort of bonus there. For example, service components may expose management views
to the container through an additional <code>@Bean</code> method on each applicable component class.
In such scenarios, <code>@Bean</code> methods are a simple general-purpose factory method mechanism.</p>
</div>
<div class="paragraph">
<p>Unlike full <code>@Configuration</code>, lite <code>@Bean</code> methods cannot declare inter-bean dependencies.
Instead, they operate on their containing component&#8217;s internal state and optionally on
arguments that they may declare. Such an <code>@Bean</code> method should therefore not invoke other
<code>@Bean</code> methods; each such method is literally just a factory method for a particular
bean reference, without any special runtime semantics. The positive side-effect here is
that no CGLIB subclassing has to be applied at runtime, so there are no limitations in
terms of class design (i.e. the containing class may nevertheless be <code>final</code> etc).</p>
</div>
<div class="paragraph">
<p>In common scenarios, <code>@Bean</code> methods are to be declared within <code>@Configuration</code> classes,
ensuring that 'full' mode is always used and that cross-method references will therefore
get redirected to the container&#8217;s lifecycle management. This will prevent the same
<code>@Bean</code> method from accidentally being invoked through a regular Java call which helps
to reduce subtle bugs that can be hard to track down when operating in 'lite' mode.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@Bean</code> and <code>@Configuration</code> annotations will be discussed in depth in the sections
below. First, however, we&#8217;ll cover the various ways of creating a spring container using
Java-based configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="beans-java-instantiating-container"><a class="anchor" href="core.html#beans-java-instantiating-container"></a>1.12.2. Instantiating the Spring container using AnnotationConfigApplicationContext</h4>
<div class="paragraph">
<p>The sections below document Spring&#8217;s <code>AnnotationConfigApplicationContext</code>, new in Spring
3.0. This versatile <code>ApplicationContext</code> implementation is capable of accepting not only
<code>@Configuration</code> classes as input, but also plain <code>@Component</code> classes and classes
annotated with JSR-330 metadata.</p>
</div>
<div class="paragraph">
<p>When <code>@Configuration</code> classes are provided as input, the <code>@Configuration</code> class itself
is registered as a bean definition, and all declared <code>@Bean</code> methods within the class
are also registered as bean definitions.</p>
</div>
<div class="paragraph">
<p>When <code>@Component</code> and JSR-330 classes are provided, they are registered as bean
definitions, and it is assumed that DI metadata such as <code>@Autowired</code> or <code>@Inject</code> are
used within those classes where necessary.</p>
</div>
<div class="sect4">
<h5 id="beans-java-instantiating-container-contstructor"><a class="anchor" href="core.html#beans-java-instantiating-container-contstructor"></a>Simple construction</h5>
<div class="paragraph">
<p>In much the same way that Spring XML files are used as input when instantiating a
<code>ClassPathXmlApplicationContext</code>, <code>@Configuration</code> classes may be used as input when
instantiating an <code>AnnotationConfigApplicationContext</code>. This allows for completely
XML-free usage of the Spring container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, <code>AnnotationConfigApplicationContext</code> is not limited to working only
with <code>@Configuration</code> classes. Any <code>@Component</code> or JSR-330 annotated class may be supplied
as input to the constructor. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyServiceImpl.class, Dependency1.class, Dependency2.class);
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above assumes that <code>MyServiceImpl</code>, <code>Dependency1</code> and <code>Dependency2</code> use Spring
dependency injection annotations such as <code>@Autowired</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-instantiating-container-register"><a class="anchor" href="core.html#beans-java-instantiating-container-register"></a>Building the container programmatically using register(Class&lt;?&gt;&#8230;&#8203;)</h5>
<div class="paragraph">
<p>An <code>AnnotationConfigApplicationContext</code> may be instantiated using a no-arg constructor
and then configured using the <code>register()</code> method. This approach is particularly useful
when programmatically building an <code>AnnotationConfigApplicationContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();
    ctx.register(AppConfig.class, OtherConfig.class);
    ctx.register(AdditionalConfig.class);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-instantiating-container-scan"><a class="anchor" href="core.html#beans-java-instantiating-container-scan"></a>Enabling component scanning with scan(String&#8230;&#8203;)</h5>
<div class="paragraph">
<p>To enable component scanning, just annotate your <code>@Configuration</code> class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span>  {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Experienced Spring users will be familiar with the XML declaration equivalent from
Spring&#8217;s <code>context:</code> namespace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above, the <code>com.acme</code> package will be scanned, looking for any
<code>@Component</code>-annotated classes, and those classes will be registered as Spring bean
definitions within the container. <code>AnnotationConfigApplicationContext</code> exposes the
<code>scan(String&#8230;&#8203;)</code> method to allow for the same component-scanning functionality:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();
    ctx.scan(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme</span><span class="delimiter">&quot;</span></span>);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.class);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember that <code>@Configuration</code> classes are <a href="core.html#beans-meta-annotations">meta-annotated</a>
with <code>@Component</code>, so they are candidates for component-scanning! In the example above,
assuming that <code>AppConfig</code> is declared within the <code>com.acme</code> package (or any package
underneath), it will be picked up during the call to <code>scan()</code>, and upon <code>refresh()</code> all
its <code>@Bean</code> methods will be processed and registered as bean definitions within the
container.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-instantiating-container-web"><a class="anchor" href="core.html#beans-java-instantiating-container-web"></a>Support for web applications with AnnotationConfigWebApplicationContext</h5>
<div class="paragraph">
<p>A <code>WebApplicationContext</code> variant of <code>AnnotationConfigApplicationContext</code> is available
with <code>AnnotationConfigWebApplicationContext</code>. This implementation may be used when
configuring the Spring <code>ContextLoaderListener</code> servlet listener, Spring MVC
<code>DispatcherServlet</code>, etc. What follows is a <code>web.xml</code> snippet that configures a typical
Spring MVC web application. Note the use of the <code>contextClass</code> context-param and
init-param:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
    <span class="comment">&lt;!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext
        instead of the default XmlWebApplicationContext --&gt;</span>
    <span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>contextClass<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>
            org.springframework.web.context.support.AnnotationConfigWebApplicationContext
        <span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/context-param&gt;</span>

    <span class="comment">&lt;!-- Configuration locations must consist of one or more comma- or space-delimited
        fully-qualified @Configuration classes. Fully-qualified packages may also be
        specified for component-scanning --&gt;</span>
    <span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>com.acme.AppConfig<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/context-param&gt;</span>

    <span class="comment">&lt;!-- Bootstrap the root application context as usual using ContextLoaderListener --&gt;</span>
    <span class="tag">&lt;listener&gt;</span>
        <span class="tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
    <span class="tag">&lt;/listener&gt;</span>

    <span class="comment">&lt;!-- Declare a Spring MVC DispatcherServlet as usual --&gt;</span>
    <span class="tag">&lt;servlet&gt;</span>
        <span class="tag">&lt;servlet-name&gt;</span>dispatcher<span class="tag">&lt;/servlet-name&gt;</span>
        <span class="tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/servlet-class&gt;</span>
        <span class="comment">&lt;!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext
            instead of the default XmlWebApplicationContext --&gt;</span>
        <span class="tag">&lt;init-param&gt;</span>
            <span class="tag">&lt;param-name&gt;</span>contextClass<span class="tag">&lt;/param-name&gt;</span>
            <span class="tag">&lt;param-value&gt;</span>
                org.springframework.web.context.support.AnnotationConfigWebApplicationContext
            <span class="tag">&lt;/param-value&gt;</span>
        <span class="tag">&lt;/init-param&gt;</span>
        <span class="comment">&lt;!-- Again, config locations must consist of one or more comma- or space-delimited
            and fully-qualified @Configuration classes --&gt;</span>
        <span class="tag">&lt;init-param&gt;</span>
            <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
            <span class="tag">&lt;param-value&gt;</span>com.acme.web.MvcConfig<span class="tag">&lt;/param-value&gt;</span>
        <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;/servlet&gt;</span>

    <span class="comment">&lt;!-- map all requests for /app/* to the dispatcher servlet --&gt;</span>
    <span class="tag">&lt;servlet-mapping&gt;</span>
        <span class="tag">&lt;servlet-name&gt;</span>dispatcher<span class="tag">&lt;/servlet-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/app/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-java-bean-annotation"><a class="anchor" href="core.html#beans-java-bean-annotation"></a>1.12.3. Using the @Bean annotation</h4>
<div class="paragraph">
<p><code>@Bean</code> is a method-level annotation and a direct analog of the XML <code>&lt;bean/&gt;</code> element.
The annotation supports some of the attributes offered by <code>&lt;bean/&gt;</code>, such as:
<a href="core.html#beans-factory-lifecycle-initializingbean">init-method</a>,
<a href="core.html#beans-factory-lifecycle-disposablebean">destroy-method</a>,
<a href="core.html#beans-factory-autowire">autowiring</a> and <code>name</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>@Bean</code> annotation in a <code>@Configuration</code>-annotated or in a
<code>@Component</code>-annotated class.</p>
</div>
<div class="sect4">
<h5 id="beans-java-declaring-a-bean"><a class="anchor" href="core.html#beans-java-declaring-a-bean"></a>Declaring a bean</h5>
<div class="paragraph">
<p>To declare a bean, simply annotate a method with the <code>@Bean</code> annotation. You use this
method to register a bean definition within an <code>ApplicationContext</code> of the type
specified as the method&#8217;s return value. By default, the bean name will be the same as
the method name. The following is a simple example of a <code>@Bean</code> method declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferServiceImpl transferService() {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding configuration is exactly equivalent to the following Spring XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transferService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.TransferServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both declarations make a bean named <code>transferService</code> available in the
<code>ApplicationContext</code>, bound to an object instance of type <code>TransferServiceImpl</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>transferService -&gt; com.acme.TransferServiceImpl</pre>
</div>
</div>
<div class="paragraph">
<p>You may also declare your <code>@Bean</code> method with an interface (or base class)
return type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService() {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this limits the visibility for advance type prediction to the specified
interface type (<code>TransferService</code>) then, with the full type (<code>TransferServiceImpl</code>)
only known to the container once the affected singleton bean has been instantiated.
Non-lazy singleton beans get instantiated according to their declaration order,
so you may see different type matching results depending on when another component
tries to match by a non-declared type (such as <code>@Autowired TransferServiceImpl</code>
which will only resolve once the "transferService" bean has been instantiated).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you consistently refer to your types by a declared service interface, your
<code>@Bean</code> return types may safely join that design decision. However, for components
implementing several interfaces or for components potentially referred to by their
implementation type, it is safer to declare the most specific return type possible
(at least as specific as required by the injection points referring to your bean).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-dependencies"><a class="anchor" href="core.html#beans-java-dependencies"></a>Bean dependencies</h5>
<div class="paragraph">
<p>A <code>@Bean</code> annotated method can have an arbitrary number of parameters describing the
dependencies required to build that bean. For instance if our <code>TransferService</code>
requires an <code>AccountRepository</code> we can materialize that dependency via a method
parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService(AccountRepository accountRepository) {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(accountRepository);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resolution mechanism is pretty much identical to constructor-based dependency
injection, see <a href="core.html#beans-constructor-injection">the relevant section</a> for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-lifecycle-callbacks"><a class="anchor" href="core.html#beans-java-lifecycle-callbacks"></a>Receiving lifecycle callbacks</h5>
<div class="paragraph">
<p>Any classes defined with the <code>@Bean</code> annotation support the regular lifecycle callbacks
and can use the <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations from JSR-250, see
<a href="core.html#beans-postconstruct-and-predestroy-annotations">JSR-250 annotations</a> for further
details.</p>
</div>
<div class="paragraph">
<p>The regular Spring <a href="core.html#beans-factory-nature">lifecycle</a> callbacks are fully supported as
well. If a bean implements <code>InitializingBean</code>, <code>DisposableBean</code>, or <code>Lifecycle</code>, their
respective methods are called by the container.</p>
</div>
<div class="paragraph">
<p>The standard set of <code>*Aware</code> interfaces such as <a href="core.html#beans-beanfactory">BeanFactoryAware</a>,
<a href="core.html#beans-factory-aware">BeanNameAware</a>,
<a href="core.html#context-functionality-messagesource">MessageSourceAware</a>,
<a href="core.html#beans-factory-aware">ApplicationContextAware</a>, and so on are also fully supported.</p>
</div>
<div class="paragraph">
<p>The <code>@Bean</code> annotation supports specifying arbitrary initialization and destruction
callback methods, much like Spring XML&#8217;s <code>init-method</code> and <code>destroy-method</code> attributes
on the <code>bean</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {

    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="comment">// initialization logic</span>
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Bar</span> {

    <span class="directive">public</span> <span class="type">void</span> cleanup() {
        <span class="comment">// destruction logic</span>
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>(initMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">init</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Foo foo() {
        <span class="keyword">return</span> <span class="keyword">new</span> Foo();
    }

    <span class="annotation">@Bean</span>(destroyMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Bar bar() {
        <span class="keyword">return</span> <span class="keyword">new</span> Bar();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, beans defined using Java config that have a public <code>close</code> or <code>shutdown</code>
method are automatically enlisted with a destruction callback. If you have a public
<code>close</code> or <code>shutdown</code> method and you do not wish for it to be called when the container
shuts down, simply add <code>@Bean(destroyMethod="")</code> to your bean definition to disable the
default <code>(inferred)</code> mode.</p>
</div>
<div class="paragraph">
<p>You may want to do that by default for a resource that you acquire via JNDI as its
lifecycle is managed outside the application. In particular, make sure to always do it
for a <code>DataSource</code> as it is known to be problematic on Java EE application servers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>(destroyMethod=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() <span class="directive">throws</span> <span class="exception">NamingException</span> {
    <span class="keyword">return</span> (<span class="predefined-type">DataSource</span>) jndiTemplate.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDS</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, with <code>@Bean</code> methods, you will typically choose to use programmatic JNDI lookups:
either using Spring&#8217;s <code>JndiTemplate</code>/<code>JndiLocatorDelegate</code> helpers or straight JNDI
<code>InitialContext</code> usage, but not the <code>JndiObjectFactoryBean</code> variant which would force
you to declare the return type as the <code>FactoryBean</code> type instead of the actual target
type, making it harder to use for cross-reference calls in other <code>@Bean</code> methods that
intend to refer to the provided resource here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, in the case of <code>Foo</code> above, it would be equally as valid to call the <code>init()</code>
method directly during construction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> Foo foo() {
        Foo foo = <span class="keyword">new</span> Foo();
        foo.init();
        <span class="keyword">return</span> foo;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you work directly in Java, you can do anything you like with your objects and do
not always need to rely on the container lifecycle!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-specifying-bean-scope"><a class="anchor" href="core.html#beans-java-specifying-bean-scope"></a>Specifying bean scope</h5>
<div class="sect5">
<h6 id="beans-java-available-scopes"><a class="anchor" href="core.html#beans-java-available-scopes"></a>Using the @Scope annotation</h6>
<div class="paragraph">
<p>You can specify that your beans defined with the <code>@Bean</code> annotation should have a
specific scope. You can use any of the standard scopes specified in the
<a href="core.html#beans-factory-scopes">Bean Scopes</a> section.</p>
</div>
<div class="paragraph">
<p>The default scope is <code>singleton</code>, but you can override this with the <code>@Scope</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyConfiguration</span> {

    <span class="annotation">@Bean</span>
    <strong><span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> Encryptor encryptor() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="beans-java-scoped-proxy"><a class="anchor" href="core.html#beans-java-scoped-proxy"></a>@Scope and scoped-proxy</h6>
<div class="paragraph">
<p>Spring offers a convenient way of working with scoped dependencies through
<a href="core.html#beans-factory-scopes-other-injection">scoped proxies</a>. The easiest way to create such
a proxy when using the XML configuration is the <code>&lt;aop:scoped-proxy/&gt;</code> element.
Configuring your beans in Java with a @Scope annotation offers equivalent support with
the proxyMode attribute. The default is no proxy ( <code>ScopedProxyMode.NO</code>), but you can
specify <code>ScopedProxyMode.TARGET_CLASS</code> or <code>ScopedProxyMode.INTERFACES</code>.</p>
</div>
<div class="paragraph">
<p>If you port the scoped proxy example from the XML reference documentation (see preceding
link) to our <code>@Bean</code> using Java, it would look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// an HTTP Session-scoped bean exposed as a proxy</span>
<span class="annotation">@Bean</span>
<strong><span class="annotation">@SessionScope</span></strong>
<span class="directive">public</span> UserPreferences userPreferences() {
    <span class="keyword">return</span> <span class="keyword">new</span> UserPreferences();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Service userService() {
    UserService service = <span class="keyword">new</span> SimpleUserService();
    <span class="comment">// a reference to the proxied userPreferences bean</span>
    service.setUserPreferences(userPreferences());
    <span class="keyword">return</span> service;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-customizing-bean-naming"><a class="anchor" href="core.html#beans-java-customizing-bean-naming"></a>Customizing bean naming</h5>
<div class="paragraph">
<p>By default, configuration classes use a <code>@Bean</code> method&#8217;s name as the name of the
resulting bean. This functionality can be overridden, however, with the <code>name</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">myFoo</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Foo foo() {
        <span class="keyword">return</span> <span class="keyword">new</span> Foo();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-bean-aliasing"><a class="anchor" href="core.html#beans-java-bean-aliasing"></a>Bean aliasing</h5>
<div class="paragraph">
<p>As discussed in <a href="core.html#beans-beanname">Naming beans</a>, it is sometimes desirable to give a single bean
multiple names, otherwise known as <em>bean aliasing</em>. The <code>name</code> attribute of the <code>@Bean</code>
annotation accepts a String array for this purpose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>(name = { <span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">subsystemA-dataSource</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">subsystemB-dataSource</span><span class="delimiter">&quot;</span></span> })
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="comment">// instantiate, configure and return DataSource bean...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-bean-description"><a class="anchor" href="core.html#beans-java-bean-description"></a>Bean description</h5>
<div class="paragraph">
<p>Sometimes it is helpful to provide a more detailed textual description of a bean. This can
be particularly useful when beans are exposed (perhaps via JMX) for monitoring purposes.</p>
</div>
<div class="paragraph">
<p>To add a description to a <code>@Bean</code> the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/Description.html"><code>@Description</code></a>
annotation can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <strong><span class="annotation">@Description</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Provides a basic example of a bean</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> Foo foo() {
        <span class="keyword">return</span> <span class="keyword">new</span> Foo();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-java-configuration-annotation"><a class="anchor" href="core.html#beans-java-configuration-annotation"></a>1.12.4. Using the @Configuration annotation</h4>
<div class="paragraph">
<p><code>@Configuration</code> is a class-level annotation indicating that an object is a source of
bean definitions. <code>@Configuration</code> classes declare beans via public <code>@Bean</code> annotated
methods. Calls to <code>@Bean</code> methods on <code>@Configuration</code> classes can also be used to define
inter-bean dependencies. See <a href="core.html#beans-java-basic-concepts">Basic concepts: @Bean and @Configuration</a> for a general introduction.</p>
</div>
<div class="sect4">
<h5 id="beans-java-injecting-dependencies"><a class="anchor" href="core.html#beans-java-injecting-dependencies"></a>Injecting inter-bean dependencies</h5>
<div class="paragraph">
<p>When <code>@Bean</code>s have dependencies on one another, expressing that dependency is as simple
as having one bean method call another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> Foo foo() {
        <span class="keyword">return</span> <span class="keyword">new</span> Foo(bar());
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> Bar bar() {
        <span class="keyword">return</span> <span class="keyword">new</span> Bar();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>foo</code> bean receives a reference to <code>bar</code> via constructor
injection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This method of declaring inter-bean dependencies only works when the <code>@Bean</code> method is
declared within a <code>@Configuration</code> class. You cannot declare inter-bean dependencies
using plain <code>@Component</code> classes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-method-injection"><a class="anchor" href="core.html#beans-java-method-injection"></a>Lookup method injection</h5>
<div class="paragraph">
<p>As noted earlier, <a href="core.html#beans-factory-method-injection">lookup method injection</a> is an
advanced feature that you should use rarely. It is useful in cases where a
singleton-scoped bean has a dependency on a prototype-scoped bean. Using Java for this
type of configuration provides a natural means for implementing this pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CommandManager</span> {
    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Object</span> commandState) {
        <span class="comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();
        <span class="comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="keyword">return</span> command.execute();
    }

    <span class="comment">// okay... but where is the implementation of this method?</span>
    <span class="directive">protected</span> <span class="directive">abstract</span> Command createCommand();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Java-configuration support , you can create a subclass of <code>CommandManager</code> where
the abstract <code>createCommand()</code> method is overridden in such a way that it looks up a new
(prototype) command object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> AsyncCommand asyncCommand() {
    AsyncCommand command = <span class="keyword">new</span> AsyncCommand();
    <span class="comment">// inject dependencies here as required</span>
    <span class="keyword">return</span> command;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> CommandManager commandManager() {
    <span class="comment">// return new anonymous implementation of CommandManager with command() overridden</span>
    <span class="comment">// to return a new prototype Command object</span>
    <span class="keyword">return</span> <span class="keyword">new</span> CommandManager() {
        <span class="directive">protected</span> Command createCommand() {
            <span class="keyword">return</span> asyncCommand();
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-further-information-java-config"><a class="anchor" href="core.html#beans-java-further-information-java-config"></a>Further information about how Java-based configuration works internally</h5>
<div class="paragraph">
<p>The following example shows a <code>@Bean</code> annotated method being called twice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> ClientService clientService1() {
        ClientServiceImpl clientService = <span class="keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="keyword">return</span> clientService;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> ClientService clientService2() {
        ClientServiceImpl clientService = <span class="keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="keyword">return</span> clientService;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> ClientDao clientDao() {
        <span class="keyword">return</span> <span class="keyword">new</span> ClientDaoImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>clientDao()</code> has been called once in <code>clientService1()</code> and once in <code>clientService2()</code>.
Since this method creates a new instance of <code>ClientDaoImpl</code> and returns it, you would
normally expect having 2 instances (one for each service). That definitely would be
problematic: in Spring, instantiated beans have a <code>singleton</code> scope by default. This is
where the magic comes in: All <code>@Configuration</code> classes are subclassed at startup-time
with <code>CGLIB</code>. In the subclass, the child method checks the container first for any
cached (scoped) beans before it calls the parent method and creates a new instance. Note
that as of Spring 3.2, it is no longer necessary to add CGLIB to your classpath because
CGLIB classes have been repackaged under <code>org.springframework.cglib</code> and included directly
within the spring-core JAR.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The behavior could be different according to the scope of your bean. We are talking
about singletons here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are a few restrictions due to the fact that CGLIB dynamically adds features at
startup-time, in particular that configuration classes must not be final. However, as
of 4.3, any constructors are allowed on configuration classes, including the use of
<code>@Autowired</code> or a single non-default constructor declaration for default injection.</p>
</div>
<div class="paragraph">
<p>If you prefer to avoid any CGLIB-imposed limitations, consider declaring your <code>@Bean</code>
methods on non-<code>@Configuration</code> classes, e.g. on plain <code>@Component</code> classes instead.
Cross-method calls between <code>@Bean</code> methods won&#8217;t get intercepted then, so you&#8217;ll have
to exclusively rely on dependency injection at the constructor or method level there.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-java-composing-configuration-classes"><a class="anchor" href="core.html#beans-java-composing-configuration-classes"></a>1.12.5. Composing Java-based configurations</h4>
<div class="sect4">
<h5 id="beans-java-using-import"><a class="anchor" href="core.html#beans-java-using-import"></a>Using the @Import annotation</h5>
<div class="paragraph">
<p>Much as the <code>&lt;import/&gt;</code> element is used within Spring XML files to aid in modularizing
configurations, the <code>@Import</code> annotation allows for loading <code>@Bean</code> definitions from
another configuration class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfigA</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> A a() {
        <span class="keyword">return</span> <span class="keyword">new</span> A();
    }
}

<span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>(ConfigA.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfigB</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> B b() {
        <span class="keyword">return</span> <span class="keyword">new</span> B();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, rather than needing to specify both <code>ConfigA.class</code> and <code>ConfigB.class</code> when
instantiating the context, only <code>ConfigB</code> needs to be supplied explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(ConfigB.class);

    <span class="comment">// now both beans A and B will be available...</span>
    A a = ctx.getBean(A.class);
    B b = ctx.getBean(B.class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach simplifies container instantiation, as only one class needs to be dealt
with, rather than requiring the developer to remember a potentially large number of
<code>@Configuration</code> classes during construction.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring Framework 4.2, <code>@Import</code> also supports references to regular component
classes, analogous to the <code>AnnotationConfigApplicationContext.register</code> method.
This is particularly useful if you&#8217;d like to avoid component scanning, using a few
configuration classes as entry points for explicitly defining all your components.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="beans-java-injecting-imported-beans"><a class="anchor" href="core.html#beans-java-injecting-imported-beans"></a>Injecting dependencies on imported @Bean definitions</h6>
<div class="paragraph">
<p>The example above works, but is simplistic. In most practical scenarios, beans will have
dependencies on one another across configuration classes. When using XML, this is not an
issue, per se, because there is no compiler involved, and one can simply declare
<code>ref="someBean"</code> and trust that Spring will work it out during container initialization.
Of course, when using <code>@Configuration</code> classes, the Java compiler places constraints on
the configuration model, in that references to other beans must be valid Java syntax.</p>
</div>
<div class="paragraph">
<p>Fortunately, solving this problem is simple. As <a href="core.html#beans-java-dependencies">we already discussed</a>,
<code>@Bean</code> method can have an arbitrary number of parameters describing the bean
dependencies. Let&#8217;s consider a more real-world scenario with several <code>@Configuration</code>
classes, each depending on beans declared in the others:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServiceConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService(AccountRepository accountRepository) {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(accountRepository);
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RepositoryConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AccountRepository accountRepository(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcAccountRepository(dataSource);
    }
}

<span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>({ServiceConfig.class, RepositoryConfig.class})
<span class="directive">public</span> <span class="type">class</span> <span class="class">SystemTestConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="comment">// return new DataSource</span>
    }
}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.class);
    <span class="comment">// everything wires up across configuration classes...</span>
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(<span class="float">100.00</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A123</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C456</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is another way to achieve the same result. Remember that <code>@Configuration</code> classes are
ultimately just another bean in the container: This means that they can take advantage of
<code>@Autowired</code> and <code>@Value</code> injection etc just like any other bean!</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the dependencies you inject that way are of the simplest kind only. <code>@Configuration</code>
classes are processed quite early during the initialization of the context and forcing a dependency
to be injected this way may lead to unexpected early initialization. Whenever possible, resort to
parameter-based injection as in the example above.</p>
</div>
<div class="paragraph">
<p>Also, be particularly careful with <code>BeanPostProcessor</code> and <code>BeanFactoryPostProcessor</code> definitions
via <code>@Bean</code>. Those should usually be declared as <code>static @Bean</code> methods, not triggering the
instantiation of their containing configuration class. Otherwise, <code>@Autowired</code> and <code>@Value</code> won&#8217;t
work on the configuration class itself since it is being created as a bean instance too early.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServiceConfig</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> AccountRepository accountRepository;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService() {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(accountRepository);
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RepositoryConfig</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> RepositoryConfig(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="local-variable">this</span>.dataSource = dataSource;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AccountRepository accountRepository() {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcAccountRepository(dataSource);
    }
}

<span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>({ServiceConfig.class, RepositoryConfig.class})
<span class="directive">public</span> <span class="type">class</span> <span class="class">SystemTestConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="comment">// return new DataSource</span>
    }
}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.class);
    <span class="comment">// everything wires up across configuration classes...</span>
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(<span class="float">100.00</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A123</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C456</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Constructor injection in <code>@Configuration</code> classes is only supported as of Spring
Framework 4.3. Note also that there is no need to specify <code>@Autowired</code> if the target
bean defines only one constructor; in the example above, <code>@Autowired</code> is not necessary
on the <code>RepositoryConfig</code> constructor.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="title"><a id="beans-java-injecting-imported-beans-fq"></a>Fully-qualifying imported beans for ease of navigation</div>
<div class="content">
<div class="paragraph">
<p>In the scenario above, using <code>@Autowired</code> works well and provides the desired
modularity, but determining exactly where the autowired bean definitions are declared is
still somewhat ambiguous. For example, as a developer looking at <code>ServiceConfig</code>, how do
you know exactly where the <code>@Autowired AccountRepository</code> bean is declared? It&#8217;s not
explicit in the code, and this may be just fine. Remember that the
<a href="https://spring.io/tools/sts">Spring Tool Suite</a> provides tooling that
can render graphs showing how everything is wired up - that may be all you need. Also,
your Java IDE can easily find all declarations and uses of the <code>AccountRepository</code> type,
and will quickly show you the location of <code>@Bean</code> methods that return that type.</p>
</div>
<div class="paragraph">
<p>In cases where this ambiguity is not acceptable and you wish to have direct navigation
from within your IDE from one <code>@Configuration</code> class to another, consider autowiring the
configuration classes themselves:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServiceConfig</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> RepositoryConfig repositoryConfig;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService() {
        <span class="comment">// navigate 'through' the config class to the @Bean method!</span>
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the situation above, it is completely explicit where <code>AccountRepository</code> is defined.
However, <code>ServiceConfig</code> is now tightly coupled to <code>RepositoryConfig</code>; that&#8217;s the
tradeoff. This tight coupling can be somewhat mitigated by using interface-based or
abstract class-based <code>@Configuration</code> classes. Consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServiceConfig</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> RepositoryConfig repositoryConfig;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService() {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">RepositoryConfig</span> {

    <span class="annotation">@Bean</span>
    AccountRepository accountRepository();
}

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultRepositoryConfig</span> <span class="directive">implements</span> RepositoryConfig {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AccountRepository accountRepository() {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcAccountRepository(...);
    }
}

<span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>({ServiceConfig.class, DefaultRepositoryConfig.class})  <span class="comment">// import the concrete config!</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SystemTestConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="comment">// return DataSource</span>
    }

}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.class);
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(<span class="float">100.00</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A123</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C456</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>ServiceConfig</code> is loosely coupled with respect to the concrete
<code>DefaultRepositoryConfig</code>, and built-in IDE tooling is still useful: it will be easy for
the developer to get a type hierarchy of <code>RepositoryConfig</code> implementations. In this
way, navigating <code>@Configuration</code> classes and their dependencies becomes no different
than the usual process of navigating interface-based code.</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you would like to influence the startup creation order of certain beans, consider
declaring some of them as <code>@Lazy</code> (for creation on first access instead of on startup)
or as <code>@DependsOn</code> on certain other beans (making sure that specific other beans will
be created before the current bean, beyond what the latter&#8217;s direct dependencies imply).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-conditional"><a class="anchor" href="core.html#beans-java-conditional"></a>Conditionally include @Configuration classes or @Bean methods</h5>
<div class="paragraph">
<p>It is often useful to conditionally enable or disable a complete <code>@Configuration</code> class,
or even individual <code>@Bean</code> methods, based on some arbitrary system state. One common
example of this is to use the <code>@Profile</code> annotation to activate beans only when a specific
profile has been enabled in the Spring <code>Environment</code> (see <a href="core.html#beans-definition-profiles">Bean definition profiles</a>
for details).</p>
</div>
<div class="paragraph">
<p>The <code>@Profile</code> annotation is actually implemented using a much more flexible annotation
called <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/Conditional.html"><code>@Conditional</code></a>.
The <code>@Conditional</code> annotation indicates specific
<code>org.springframework.context.annotation.Condition</code> implementations that should be
consulted before a <code>@Bean</code> is registered.</p>
</div>
<div class="paragraph">
<p>Implementations of the <code>Condition</code> interface simply provide a <code>matches(&#8230;&#8203;)</code>
method that returns <code>true</code> or <code>false</code>. For example, here is the actual
<code>Condition</code> implementation used for <code>@Profile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">boolean</span> matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
    <span class="keyword">if</span> (context.getEnvironment() != <span class="predefined-constant">null</span>) {
        <span class="comment">// Read the @Profile annotation attributes</span>
        MultiValueMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());
        <span class="keyword">if</span> (attrs != <span class="predefined-constant">null</span>) {
            <span class="keyword">for</span> (<span class="predefined-type">Object</span> value : attrs.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)) {
                <span class="keyword">if</span> (context.getEnvironment().acceptsProfiles(((<span class="predefined-type">String</span><span class="type">[]</span>) value))) {
                    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
                }
            }
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
    }
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/Conditional.html">
<code>@Conditional</code> javadocs</a> for more detail.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-java-combining"><a class="anchor" href="core.html#beans-java-combining"></a>Combining Java and XML configuration</h5>
<div class="paragraph">
<p>Spring&#8217;s <code>@Configuration</code> class support does not aim to be a 100% complete replacement
for Spring XML. Some facilities such as Spring XML namespaces remain an ideal way to
configure the container. In cases where XML is convenient or necessary, you have a
choice: either instantiate the container in an "XML-centric" way using, for example,
<code>ClassPathXmlApplicationContext</code>, or in a "Java-centric" fashion using
<code>AnnotationConfigApplicationContext</code> and the <code>@ImportResource</code> annotation to import XML
as needed.</p>
</div>
<div class="sect5">
<h6 id="beans-java-combining-xml-centric"><a class="anchor" href="core.html#beans-java-combining-xml-centric"></a>XML-centric use of @Configuration classes</h6>
<div class="paragraph">
<p>It may be preferable to bootstrap the Spring container from XML and include
<code>@Configuration</code> classes in an ad-hoc fashion. For example, in a large existing codebase
that uses Spring XML, it will be easier to create <code>@Configuration</code> classes on an
as-needed basis and include them from the existing XML files. Below you&#8217;ll find the
options for using <code>@Configuration</code> classes in this kind of "XML-centric" situation.</p>
</div>
<div class="openblock">
<div class="title"><a id="beans-java-combining-xml-centric-declare-as-bean"></a>Declaring @Configuration classes as plain Spring <code>&lt;bean/&gt;</code> elements</div>
<div class="content">
<div class="paragraph">
<p>Remember that <code>@Configuration</code> classes are ultimately just bean definitions in the
container. In this example, we create a <code>@Configuration</code> class named <code>AppConfig</code> and
include it within <code>system-test-config.xml</code> as a <code>&lt;bean/&gt;</code> definition. Because
<code>&lt;context:annotation-config/&gt;</code> is switched on, the container will recognize the
<code>@Configuration</code> annotation and process the <code>@Bean</code> methods declared in <code>AppConfig</code>
properly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> AccountRepository accountRepository() {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcAccountRepository(dataSource);
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransferService transferService() {
        <span class="keyword">return</span> <span class="keyword">new</span> TransferService(accountRepository());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>system-test-config.xml</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="comment">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;</span>
    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/acme/jdbc.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.AppConfig</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.url}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.username}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.password}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>jdbc.properties</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/acme/system-test-config.xml</span><span class="delimiter">&quot;</span></span>);
    TransferService transferService = ctx.getBean(TransferService.class);
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In <code>system-test-config.xml</code> above, the <code>AppConfig</code> <code>&lt;bean/&gt;</code> does not declare an <code>id</code>
element. While it would be acceptable to do so, it is unnecessary given that no other
bean will ever refer to it, and it is unlikely that it will be explicitly fetched from
the container by name. Likewise with the <code>DataSource</code> bean - it is only ever autowired
by type, so an explicit bean <code>id</code> is not strictly required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock">
<div class="title"><a id="beans-java-combining-xml-centric-component-scan"></a> Using &lt;context:component-scan/&gt; to pick up <code>@Configuration</code> classes</div>
<div class="content">
<div class="paragraph">
<p>Because <code>@Configuration</code> is meta-annotated with <code>@Component</code>, <code>@Configuration</code>-annotated
classes are automatically candidates for component scanning. Using the same scenario as
above, we can redefine <code>system-test-config.xml</code> to take advantage of component-scanning.
Note that in this case, we don&#8217;t need to explicitly declare
<code>&lt;context:annotation-config/&gt;</code>, because <code>&lt;context:component-scan/&gt;</code> enables the same
functionality.</p>
</div>
<div class="paragraph">
<p><strong>system-test-config.xml</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="comment">&lt;!-- picks up and registers AppConfig as a bean definition --&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/acme/jdbc.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.url}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.username}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.password}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="beans-java-combining-java-centric"><a class="anchor" href="core.html#beans-java-combining-java-centric"></a>@Configuration class-centric use of XML with @ImportResource</h6>
<div class="paragraph">
<p>In applications where <code>@Configuration</code> classes are the primary mechanism for configuring
the container, it will still likely be necessary to use at least some XML. In these
scenarios, simply use <code>@ImportResource</code> and define only as much XML as is needed. Doing
so achieves a "Java-centric" approach to configuring the container and keeps XML to a
bare minimum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ImportResource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/acme/properties-config.xml</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.url}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> url;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.username}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> username;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.password}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> password;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> DriverManagerDataSource(url, username, password);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">properties-config.xml
<span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/acme/jdbc.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>jdbc.properties
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);
    TransferService transferService = ctx.getBean(TransferService.class);
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-environment"><a class="anchor" href="core.html#beans-environment"></a>1.13. Environment abstraction</h3>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/core/env/Environment.html"><code>Environment</code></a>
is an abstraction integrated in the container that models two key
aspects of the application environment: <a href="core.html#beans-definition-profiles"><em>profiles</em></a>
and <a href="core.html#beans-property-source-abstraction"><em>properties</em></a>.</p>
</div>
<div class="paragraph">
<p>A <em>profile</em> is a named, logical group of bean definitions to be registered with the
container only if the given profile is active. Beans may be assigned to a profile
whether defined in XML or via annotations. The role of the <code>Environment</code> object with
relation to profiles is in determining which profiles (if any) are currently active,
and which profiles (if any) should be active by default.</p>
</div>
<div class="paragraph">
<p>Properties play an important role in almost all applications, and may originate from
a variety of sources: properties files, JVM system properties, system environment
variables, JNDI, servlet context parameters, ad-hoc Properties objects, Maps, and so
on. The role of the <code>Environment</code> object with relation to properties is to provide the
user with a convenient service interface for configuring property sources and resolving
properties from them.</p>
</div>
<div class="sect3">
<h4 id="beans-definition-profiles"><a class="anchor" href="core.html#beans-definition-profiles"></a>1.13.1. Bean definition profiles</h4>
<div class="paragraph">
<p>Bean definition profiles is a mechanism in the core container that allows for
registration of different beans in different environments. The word <em>environment</em>
can mean different things to different users and this feature can help with many
use cases, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>working against an in-memory datasource in development vs looking up that same
datasource from JNDI when in QA or production</p>
</li>
<li>
<p>registering monitoring infrastructure only when deploying an application into a
performance environment</p>
</li>
<li>
<p>registering customized implementations of beans for customer A vs. customer
B deployments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the first use case in a practical application that requires a
<code>DataSource</code>. In a test environment, the configuration may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
    <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
        .setType(EmbeddedDatabaseType.HSQL)
        .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-schema.sql</span><span class="delimiter">&quot;</span></span>)
        .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-test-data.sql</span><span class="delimiter">&quot;</span></span>)
        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now consider how this application will be deployed into a QA or production
environment, assuming that the datasource for the application will be registered
with the production application server&#8217;s JNDI directory. Our <code>dataSource</code> bean
now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>(destroyMethod=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
    <span class="keyword">return</span> (<span class="predefined-type">DataSource</span>) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem is how to switch between using these two variations based on the
current environment. Over time, Spring users have devised a number of ways to
get this done, usually relying on a combination of system environment variables
and XML <code>&lt;import/&gt;</code> statements containing <code>${placeholder}</code> tokens that resolve
to the correct configuration file path depending on the value of an environment
variable. Bean definition profiles is a core container feature that provides a
solution to this problem.</p>
</div>
<div class="paragraph">
<p>If we generalize the example use case above of environment-specific bean
definitions, we end up with the need to register certain bean definitions in
certain contexts, while not in others. You could say that you want to register a
certain profile of bean definitions in situation A, and a different profile in
situation B. Let&#8217;s first see how we can update our configuration to reflect
this need.</p>
</div>
<div class="sect4">
<h5 id="beans-definition-profiles-java"><a class="anchor" href="core.html#beans-definition-profiles-java"></a>@Profile</h5>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/Profile.html"><code>@Profile</code></a>
annotation allows you to indicate that a component is eligible for registration
when one or more specified profiles are active. Using our example above, we
can rewrite the <code>dataSource</code> configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StandaloneDataConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span>)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/test-data.sql</span><span class="delimiter">&quot;</span></span>)
            .build();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">JndiDataConfig</span> {

    <span class="annotation">@Bean</span>(destroyMethod=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
        <span class="keyword">return</span> (<span class="predefined-type">DataSource</span>) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As mentioned before, with <code>@Bean</code> methods, you will typically choose to use programmatic
JNDI lookups: either using Spring&#8217;s <code>JndiTemplate</code>/<code>JndiLocatorDelegate</code> helpers or the
straight JNDI <code>InitialContext</code> usage shown above, but not the <code>JndiObjectFactoryBean</code>
variant which would force you to declare the return type as the <code>FactoryBean</code> type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@Profile</code> can be used as a <a href="core.html#beans-meta-annotations">meta-annotation</a> for the purpose
of creating a custom <em>composed annotation</em>. The following example defines a custom
<code>@Production</code> annotation that can be used as a drop-in replacement for
<code>@Profile("production")</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="annotation">@interface</span> Production {
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a <code>@Configuration</code> class is marked with <code>@Profile</code>, all of the <code>@Bean</code> methods and
<code>@Import</code> annotations associated with that class will be bypassed unless one or more of
the specified profiles are active. If a <code>@Component</code> or <code>@Configuration</code> class is marked
with <code>@Profile({"p1", "p2"})</code>, that class will not be registered/processed unless
profiles 'p1' and/or 'p2' have been activated. If a given profile is prefixed with the
NOT operator (<code>!</code>), the annotated element will be registered if the profile is <strong>not</strong>
active. For example, given <code>@Profile({"p1", "!p2"})</code>, registration will occur if profile
'p1' is active or if profile 'p2' is not active.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@Profile</code> can also be declared at the method level to include only one particular bean
of a configuration class, e.g. for alternative variants of a particular bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>)
    <strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> standaloneDataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span>)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/test-data.sql</span><span class="delimiter">&quot;</span></span>)
            .build();
    }

    <span class="annotation">@Bean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>)
    <strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> jndiDataSource() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Context</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
        <span class="keyword">return</span> (<span class="predefined-type">DataSource</span>) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With <code>@Profile</code> on <code>@Bean</code> methods, a special scenario may apply: In the case of
overloaded <code>@Bean</code> methods of the same Java method name (analogous to constructor
overloading), an <code>@Profile</code> condition needs to be consistently declared on all
overloaded methods. If the conditions are inconsistent, only the condition on the
first declaration among the overloaded methods will matter. <code>@Profile</code> can therefore
not be used to select an overloaded method with a particular argument signature over
another; resolution between all factory methods for the same bean follows Spring&#8217;s
constructor resolution algorithm at creation time.</p>
</div>
<div class="paragraph">
<p>If you would like to define alternative beans with different profile conditions,
use distinct Java method names pointing to the same bean name via the <code>@Bean</code> name
attribute, as indicated in the example above. If the argument signatures are all
the same (e.g. all of the variants have no-arg factory methods), this is the only
way to represent such an arrangement in a valid Java class in the first place
(since there can only be one method of a particular name and argument signature).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="beans-definition-profiles-xml"><a class="anchor" href="core.html#beans-definition-profiles-xml"></a>XML bean definition profiles</h5>
<div class="paragraph">
<p>The XML counterpart is the <code>profile</code> attribute of the <code>&lt;beans&gt;</code> element. Our sample
configuration above can be rewritten in two XML files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:jdbc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jdbc</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;jdbc:embedded-database</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;jdbc:script</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;jdbc:script</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/test-data.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/jdbc:embedded-database&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:jee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jee</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to avoid that split and nest <code>&lt;beans/&gt;</code> elements within the same file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:jdbc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jdbc</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:jee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jee</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- other bean definitions --&gt;</span>

    <span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;jdbc:embedded-database</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;jdbc:script</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jdbc:script</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/test-data.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/jdbc:embedded-database&gt;</span>
    <span class="tag">&lt;/beans&gt;</span>

    <span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/datasource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/beans&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>spring-bean.xsd</code> has been constrained to allow such elements only as the
last ones in the file. This should help provide flexibility without incurring
clutter in the XML files.</p>
</div>
</div>
<div class="sect4">
<h5 id="beans-definition-profiles-enable"><a class="anchor" href="core.html#beans-definition-profiles-enable"></a>Activating a profile</h5>
<div class="paragraph">
<p>Now that we have updated our configuration, we still need to instruct Spring which
profile is active. If we started our sample application right now, we would see
a <code>NoSuchBeanDefinitionException</code> thrown, because the container could not find
the Spring bean named <code>dataSource</code>.</p>
</div>
<div class="paragraph">
<p>Activating a profile can be done in several ways, but the most straightforward is to do
it programmatically against the <code>Environment</code> API which is available via an
<code>ApplicationContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();
ctx.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>);
ctx.register(SomeConfig.class, StandaloneDataConfig.class, JndiDataConfig.class);
ctx.refresh();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, profiles may also be activated declaratively through the
<code>spring.profiles.active</code> property which may be specified through system environment
variables, JVM system properties, servlet context parameters in <code>web.xml</code>, or even as an
entry in JNDI (see <a href="core.html#beans-property-source-abstraction">PropertySource abstraction</a>). In integration tests, active
profiles can be declared via the <code>@ActiveProfiles</code> annotation in the <code>spring-test</code> module
(see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#testcontext-ctx-management-env-profiles">Context configuration with environment profiles</a>).</p>
</div>
<div class="paragraph">
<p>Note that profiles are not an "either-or" proposition; it is possible to activate multiple
profiles at once. Programmatically, simply provide multiple profile names to the
<code>setActiveProfiles()</code> method, which accepts <code>String&#8230;&#8203;</code> varargs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ctx.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">profile1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">profile2</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Declaratively, <code>spring.profiles.active</code> may accept a comma-separated list of profile names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dspring.profiles.active=<span class="string"><span class="delimiter">&quot;</span><span class="content">profile1,profile2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beans-definition-profiles-default"><a class="anchor" href="core.html#beans-definition-profiles-default"></a>Default profile</h5>
<div class="paragraph">
<p>The <em>default</em> profile represents the profile that is enabled by default. Consider the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<strong><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultDataConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/bank/config/sql/schema.sql</span><span class="delimiter">&quot;</span></span>)
            .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no profile is active, the <code>dataSource</code> above will be created; this can be
seen as a way to provide a <em>default</em> definition for one or more beans. If any
profile is enabled, the <em>default</em> profile will not apply.</p>
</div>
<div class="paragraph">
<p>The name of the default profile can be changed using <code>setDefaultProfiles()</code> on
the <code>Environment</code> or declaratively using the <code>spring.profiles.default</code> property.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-property-source-abstraction"><a class="anchor" href="core.html#beans-property-source-abstraction"></a>1.13.2. PropertySource abstraction</h4>
<div class="paragraph">
<p>Spring&#8217;s <code>Environment</code> abstraction provides search operations over a configurable
hierarchy of property sources. To explain fully, consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx = <span class="keyword">new</span> GenericApplicationContext();
Environment env = ctx.getEnvironment();
<span class="type">boolean</span> containsFoo = env.containsProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Does my environment contain the 'foo' property? </span><span class="delimiter">&quot;</span></span> + containsFoo);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, we see a high-level way of asking Spring whether the <code>foo</code> property is
defined for the current environment. To answer this question, the <code>Environment</code> object performs
a search over a set of <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/core/env/PropertySource.html"><code>PropertySource</code></a>
objects. A <code>PropertySource</code> is a simple abstraction over any source of key-value pairs, and
Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/core/env/StandardEnvironment.html"><code>StandardEnvironment</code></a>
is configured with two PropertySource objects&#8201;&#8212;&#8201;one representing the set of JVM system properties
(<em>a la</em> <code>System.getProperties()</code>) and one representing the set of system environment variables
(<em>a la</em> <code>System.getenv()</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These default property sources are present for <code>StandardEnvironment</code>, for use in standalone
applications. <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/context/support/StandardServletEnvironment.html"><code>StandardServletEnvironment</code></a>
is populated with additional default property sources including servlet config and servlet
context parameters. It can optionally enable a <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/jndi/JndiPropertySource.html"><code>JndiPropertySource</code></a>.
See the javadocs for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Concretely, when using the <code>StandardEnvironment</code>, the call to <code>env.containsProperty("foo")</code>
will return true if a <code>foo</code> system property or <code>foo</code> environment variable is present at
runtime.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The search performed is hierarchical. By default, system properties have precedence over
environment variables, so if the <code>foo</code> property happens to be set in both places during
a call to <code>env.getProperty("foo")</code>, the system property value will 'win' and be returned
preferentially over the environment variable. Note that property values will not get merged
but rather completely overridden by a preceding entry.</p>
</div>
<div class="paragraph">
<p>For a common <code>StandardServletEnvironment</code>, the full hierarchy looks as follows, with the
highest-precedence entries at the top:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ServletConfig parameters (if applicable, e.g. in case of a <code>DispatcherServlet</code> context)</p>
</li>
<li>
<p>ServletContext parameters (web.xml context-param entries)</p>
</li>
<li>
<p>JNDI environment variables ("java:comp/env/" entries)</p>
</li>
<li>
<p>JVM system properties ("-D" command-line arguments)</p>
</li>
<li>
<p>JVM system environment (operating system environment variables)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most importantly, the entire mechanism is configurable. Perhaps you have a custom source
of properties that you&#8217;d like to integrate into this search. No problem&#8201;&#8212;&#8201;simply implement
and instantiate your own <code>PropertySource</code> and add it to the set of <code>PropertySources</code> for the
current <code>Environment</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConfigurableApplicationContext ctx = <span class="keyword">new</span> GenericApplicationContext();
MutablePropertySources sources = ctx.getEnvironment().getPropertySources();
sources.addFirst(<span class="keyword">new</span> MyPropertySource());</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, <code>MyPropertySource</code> has been added with highest precedence in the
search. If it contains a <code>foo</code> property, it will be detected and returned ahead of
any <code>foo</code> property in any other <code>PropertySource</code>. The
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/core/env/MutablePropertySources.html"><code>MutablePropertySources</code></a>
API exposes a number of methods that allow for precise manipulation of the set of
property sources.</p>
</div>
</div>
<div class="sect3">
<h4 id="propertysource"><a class="anchor" href="core.html#propertysource"></a>1.13.3. @PropertySource</h4>
<div class="paragraph">
<p>The <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a>
annotation provides a convenient and declarative mechanism for adding a <code>PropertySource</code>
to Spring&#8217;s <code>Environment</code>.</p>
</div>
<div class="paragraph">
<p>Given a file "app.properties" containing the key/value pair <code>testbean.name=myTestBean</code>,
the following <code>@Configuration</code> class uses <code>@PropertySource</code> in such a way that
a call to <code>testBean.getName()</code> will return "myTestBean".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<strong><span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/myco/app.properties</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Autowired</span>
    Environment env;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TestBean testBean() {
        TestBean testBean = <span class="keyword">new</span> TestBean();
        testBean.setName(env.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">testbean.name</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> testBean;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any <code>${&#8230;&#8203;}</code> placeholders present in a <code>@PropertySource</code> resource location will
be resolved against the set of property sources already registered against the
environment. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/com/${my.placeholder:default/path}/app.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Autowired</span>
    Environment env;

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TestBean testBean() {
        TestBean testBean = <span class="keyword">new</span> TestBean();
        testBean.setName(env.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">testbean.name</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> testBean;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that "my.placeholder" is present in one of the property sources already
registered, e.g. system properties or environment variables, the placeholder will
be resolved to the corresponding value. If not, then "default/path" will be used
as a default. If no default is specified and a property cannot be resolved, an
<code>IllegalArgumentException</code> will be thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="placeholder-resolution-in-statements"><a class="anchor" href="core.html#placeholder-resolution-in-statements"></a>1.13.4. Placeholder resolution in statements</h4>
<div class="paragraph">
<p>Historically, the value of placeholders in elements could be resolved only against
JVM system properties or environment variables. No longer is this the case. Because
the Environment abstraction is integrated throughout the container, it&#8217;s easy to
route resolution of placeholders through it. This means that you may configure the
resolution process in any way you like: change the precedence of searching through
system properties and environment variables, or remove them entirely; add your
own property sources to the mix as appropriate.</p>
</div>
<div class="paragraph">
<p>Concretely, the following statement works regardless of where the <code>customer</code>
property is defined, as long as it is available in the <code>Environment</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com/bank/service/${customer}-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-load-time-weaver"><a class="anchor" href="core.html#context-load-time-weaver"></a>1.14. Registering a LoadTimeWeaver</h3>
<div class="paragraph">
<p>The <code>LoadTimeWeaver</code> is used by Spring to dynamically transform classes as they are
loaded into the Java virtual machine (JVM).</p>
</div>
<div class="paragraph">
<p>To enable load-time weaving add the <code>@EnableLoadTimeWeaving</code> to one of your
<code>@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableLoadTimeWeaving</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively for XML configuration use the <code>context:load-time-weaver</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;context:load-time-weaver</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once configured for the <code>ApplicationContext</code>. Any bean within that <code>ApplicationContext</code>
may implement <code>LoadTimeWeaverAware</code>, thereby receiving a reference to the load-time
weaver instance. This is particularly useful in combination with
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#orm-jpa">Spring&#8217;s JPA support</a> where load-time weaving may be necessary
for JPA class transformation.
Consult the <code>LocalContainerEntityManagerFactoryBean</code> javadocs for more detail. For more on
AspectJ load-time weaving, see <a href="core.html#aop-aj-ltw">Load-time weaving with AspectJ in the Spring Framework</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="context-introduction"><a class="anchor" href="core.html#context-introduction"></a>1.15. Additional capabilities of the ApplicationContext</h3>
<div class="paragraph">
<p>As was discussed in the chapter introduction, the <code>org.springframework.beans.factory</code>
package provides basic functionality for managing and manipulating beans, including in a
programmatic way. The <code>org.springframework.context</code> package adds the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a>
interface, which extends the <code>BeanFactory</code> interface, in addition to extending other
interfaces to provide additional functionality in a more <em>application
framework-oriented style</em>. Many people use the <code>ApplicationContext</code> in a completely
declarative fashion, not even creating it programmatically, but instead relying on
support classes such as <code>ContextLoader</code> to automatically instantiate an
<code>ApplicationContext</code> as part of the normal startup process of a Java EE web application.</p>
</div>
<div class="paragraph">
<p>To enhance <code>BeanFactory</code> functionality in a more framework-oriented style the context
package also provides the following functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Access to messages in i18n-style</em>, through the <code>MessageSource</code> interface.</p>
</li>
<li>
<p><em>Access to resources</em>, such as URLs and files, through the <code>ResourceLoader</code> interface.</p>
</li>
<li>
<p><em>Event publication</em> to namely beans implementing the <code>ApplicationListener</code> interface,
through the use of the <code>ApplicationEventPublisher</code> interface.</p>
</li>
<li>
<p><em>Loading of multiple (hierarchical) contexts</em>, allowing each to be focused on one
particular layer, such as the web layer of an application, through the
<code>HierarchicalBeanFactory</code> interface.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="context-functionality-messagesource"><a class="anchor" href="core.html#context-functionality-messagesource"></a>1.15.1. Internationalization using MessageSource</h4>
<div class="paragraph">
<p>The <code>ApplicationContext</code> interface extends an interface called <code>MessageSource</code>, and
therefore provides internationalization (i18n) functionality. Spring also provides the
interface <code>HierarchicalMessageSource</code>, which can resolve messages hierarchically.
Together these interfaces provide the foundation upon which Spring effects message
resolution. The methods defined on these interfaces include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String getMessage(String code, Object[] args, String default, Locale loc)</code>: The basic
method used to retrieve a message from the <code>MessageSource</code>. When no message is found
for the specified locale, the default message is used. Any arguments passed in become
replacement values, using the <code>MessageFormat</code> functionality provided by the standard
library.</p>
</li>
<li>
<p><code>String getMessage(String code, Object[] args, Locale loc)</code>: Essentially the same as
the previous method, but with one difference: no default message can be specified; if
the message cannot be found, a <code>NoSuchMessageException</code> is thrown.</p>
</li>
<li>
<p><code>String getMessage(MessageSourceResolvable resolvable, Locale locale)</code>: All properties
used in the preceding methods are also wrapped in a class named
<code>MessageSourceResolvable</code>, which you can use with this method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an <code>ApplicationContext</code> is loaded, it automatically searches for a <code>MessageSource</code>
bean defined in the context. The bean must have the name <code>messageSource</code>. If such a bean
is found, all calls to the preceding methods are delegated to the message source. If no
message source is found, the <code>ApplicationContext</code> attempts to find a parent containing a
bean with the same name. If it does, it uses that bean as the <code>MessageSource</code>. If the
<code>ApplicationContext</code> cannot find any source for messages, an empty
<code>DelegatingMessageSource</code> is instantiated in order to be able to accept calls to the
methods defined above.</p>
</div>
<div class="paragraph">
<p>Spring provides two <code>MessageSource</code> implementations, <code>ResourceBundleMessageSource</code> and
<code>StaticMessageSource</code>. Both implement <code>HierarchicalMessageSource</code> in order to do nested
messaging. The <code>StaticMessageSource</code> is rarely used but provides programmatic ways to
add messages to the source. The <code>ResourceBundleMessageSource</code> is shown in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basenames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;value&gt;</span>format<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;value&gt;</span>exceptions<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;value&gt;</span>windows<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example it is assumed you have three resource bundles defined in your classpath
called <code>format</code>, <code>exceptions</code> and <code>windows</code>. Any request to resolve a message will be
handled in the JDK standard way of resolving messages through ResourceBundles. For the
purposes of the example, assume the contents of two of the above resource bundle files
are&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">#</span> in format.properties
message=Alligators rock!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">#</span> in exceptions.properties
argument.required=The {<span class="integer">0</span>} argument is required.</code></pre>
</div>
</div>
<div class="paragraph">
<p>A program to execute the <code>MessageSource</code> functionality is shown in the next example.
Remember that all <code>ApplicationContext</code> implementations are also <code>MessageSource</code>
implementations and so can be cast to the <code>MessageSource</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    MessageSource resources = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">String</span> message = resources.getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Default</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    <span class="predefined-type">System</span>.out.println(message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output from the above program will be&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Alligators rock!</pre>
</div>
</div>
<div class="paragraph">
<p>So to summarize, the <code>MessageSource</code> is defined in a file called <code>beans.xml</code>, which
exists at the root of your classpath. The <code>messageSource</code> bean definition refers to a
number of resource bundles through its <code>basenames</code> property. The three files that are
passed in the list to the <code>basenames</code> property exist as files at the root of your
classpath and are called <code>format.properties</code>, <code>exceptions.properties</code>, and
<code>windows.properties</code> respectively.</p>
</div>
<div class="paragraph">
<p>The next example shows arguments passed to the message lookup; these arguments will be
converted into Strings and inserted into placeholders in the lookup message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="comment">&lt;!-- this MessageSource is being used in a web application --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exceptions</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- lets inject the above MessageSource into this POJO --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.Example</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Example</span> {

    <span class="directive">private</span> MessageSource messages;

    <span class="directive">public</span> <span class="type">void</span> setMessages(MessageSource messages) {
        <span class="local-variable">this</span>.messages = messages;
    }

    <span class="directive">public</span> <span class="type">void</span> execute() {
        <span class="predefined-type">String</span> message = <span class="local-variable">this</span>.messages.getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">argument.required</span><span class="delimiter">&quot;</span></span>,
            <span class="keyword">new</span> <span class="predefined-type">Object</span> <span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">userDao</span><span class="delimiter">&quot;</span></span>}, <span class="string"><span class="delimiter">&quot;</span><span class="content">Required</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
        <span class="predefined-type">System</span>.out.println(message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output from the invocation of the <code>execute()</code> method will be&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The userDao argument is required.</pre>
</div>
</div>
<div class="paragraph">
<p>With regard to internationalization (i18n), Spring&#8217;s various <code>MessageSource</code>
implementations follow the same locale resolution and fallback rules as the standard JDK
<code>ResourceBundle</code>. In short, and continuing with the example <code>messageSource</code> defined
previously, if you want to resolve messages against the British (<code>en-GB</code>) locale, you
would create files called <code>format_en_GB.properties</code>, <code>exceptions_en_GB.properties</code>, and
<code>windows_en_GB.properties</code> respectively.</p>
</div>
<div class="paragraph">
<p>Typically, locale resolution is managed by the surrounding environment of the
application. In this example, the locale against which (British) messages will be
resolved is specified manually.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># in exceptions_en_GB.properties
argument.required=Ebagum lad, the {0} argument is required, I say, required.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) {
    MessageSource resources = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">String</span> message = resources.getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">argument.required</span><span class="delimiter">&quot;</span></span>,
        <span class="keyword">new</span> <span class="predefined-type">Object</span> <span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">userDao</span><span class="delimiter">&quot;</span></span>}, <span class="string"><span class="delimiter">&quot;</span><span class="content">Required</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Locale</span>.UK);
    <span class="predefined-type">System</span>.out.println(message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output from the running of the above program will be&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Ebagum lad, the 'userDao' argument is required, I say, required.</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>MessageSourceAware</code> interface to acquire a reference to any
<code>MessageSource</code> that has been defined. Any bean that is defined in an
<code>ApplicationContext</code> that implements the <code>MessageSourceAware</code> interface is injected with
the application context&#8217;s <code>MessageSource</code> when the bean is created and configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>As an alternative to <code>ResourceBundleMessageSource</code>, Spring provides a
<code>ReloadableResourceBundleMessageSource</code> class. This variant supports the same bundle
file format but is more flexible than the standard JDK based
<code>ResourceBundleMessageSource</code> implementation.</em> In particular, it allows for reading
files from any Spring resource location (not just from the classpath) and supports hot
reloading of bundle property files (while efficiently caching them in between). Check
out the <code>ReloadableResourceBundleMessageSource</code> javadocs for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="context-functionality-events"><a class="anchor" href="core.html#context-functionality-events"></a>1.15.2. Standard and custom events</h4>
<div class="paragraph">
<p>Event handling in the <code>ApplicationContext</code> is provided through the <code>ApplicationEvent</code>
class and <code>ApplicationListener</code> interface. If a bean that implements the
<code>ApplicationListener</code> interface is deployed into the context, every time an
<code>ApplicationEvent</code> gets published to the <code>ApplicationContext</code>, that bean is notified.
Essentially, this is the standard <em>Observer</em> design pattern.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring 4.2, the event infrastructure has been significantly improved and offer
an <a href="core.html#context-functionality-events-annotation">annotation-based model</a> as well as the
ability to publish any arbitrary event, that is an object that does not necessarily
extend from <code>ApplicationEvent</code>. When such an object is published we wrap it in an
event for you.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring provides the following standard events:</p>
</div>
<table id="beans-ctx-events-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Built-in Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContextRefreshedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published when the <code>ApplicationContext</code> is initialized or refreshed, for example,
using the <code>refresh()</code> method on the <code>ConfigurableApplicationContext</code> interface.
"Initialized" here means that all beans are loaded, post-processor beans are detected
and activated, singletons are pre-instantiated, and the <code>ApplicationContext</code> object is
ready for use. As long as the context has not been closed, a refresh can be triggered
multiple times, provided that the chosen <code>ApplicationContext</code> actually supports such
"hot" refreshes. For example, <code>XmlWebApplicationContext</code> supports hot refreshes, but
<code>GenericApplicationContext</code> does not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContextStartedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published when the <code>ApplicationContext</code> is started, using the <code>start()</code> method on the
<code>ConfigurableApplicationContext</code> interface. "Started" here means that all <code>Lifecycle</code>
beans receive an explicit start signal. Typically this signal is used to restart beans
after an explicit stop, but it may also be used to start components that have not been
configured for autostart , for example, components that have not already started on
initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContextStoppedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published when the <code>ApplicationContext</code> is stopped, using the <code>stop()</code> method on the
<code>ConfigurableApplicationContext</code> interface. "Stopped" here means that all <code>Lifecycle</code>
beans receive an explicit stop signal. A stopped context may be restarted through a
<code>start()</code> call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContextClosedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Published when the <code>ApplicationContext</code> is closed, using the <code>close()</code> method on the
<code>ConfigurableApplicationContext</code> interface. "Closed" here means that all singleton
beans are destroyed. A closed context reaches its end of life; it cannot be refreshed
or restarted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequestHandledEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A web-specific event telling all beans that an HTTP request has been serviced. This
event is published <em>after</em> the request is complete. This event is only applicable to
web applications using Spring&#8217;s <code>DispatcherServlet</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also create and publish your own custom events. This example demonstrates a
simple class that extends Spring&#8217;s <code>ApplicationEvent</code> base class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BlackListEvent</span> <span class="directive">extends</span> ApplicationEvent {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> address;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> test;

    <span class="directive">public</span> BlackListEvent(<span class="predefined-type">Object</span> source, <span class="predefined-type">String</span> address, <span class="predefined-type">String</span> test) {
        <span class="local-variable">super</span>(source);
        <span class="local-variable">this</span>.address = address;
        <span class="local-variable">this</span>.test = test;
    }

    <span class="comment">// accessor and other methods...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To publish a custom <code>ApplicationEvent</code>, call the <code>publishEvent()</code> method on an
<code>ApplicationEventPublisher</code>. Typically this is done by creating a class that implements
<code>ApplicationEventPublisherAware</code> and registering it as a Spring bean. The following
example demonstrates such a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EmailService</span> <span class="directive">implements</span> ApplicationEventPublisherAware {

    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; blackList;
    <span class="directive">private</span> ApplicationEventPublisher publisher;

    <span class="directive">public</span> <span class="type">void</span> setBlackList(<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; blackList) {
        <span class="local-variable">this</span>.blackList = blackList;
    }

    <span class="directive">public</span> <span class="type">void</span> setApplicationEventPublisher(ApplicationEventPublisher publisher) {
        <span class="local-variable">this</span>.publisher = publisher;
    }

    <span class="directive">public</span> <span class="type">void</span> sendEmail(<span class="predefined-type">String</span> address, <span class="predefined-type">String</span> text) {
        <span class="keyword">if</span> (blackList.contains(address)) {
            BlackListEvent event = <span class="keyword">new</span> BlackListEvent(<span class="local-variable">this</span>, address, text);
            publisher.publishEvent(event);
            <span class="keyword">return</span>;
        }
        <span class="comment">// send email...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At configuration time, the Spring container will detect that <code>EmailService</code> implements
<code>ApplicationEventPublisherAware</code> and will automatically call
<code>setApplicationEventPublisher()</code>. In reality, the parameter passed in will be the Spring
container itself; you&#8217;re simply interacting with the application context via its
<code>ApplicationEventPublisher</code> interface.</p>
</div>
<div class="paragraph">
<p>To receive the custom <code>ApplicationEvent</code>, create a class that implements
<code>ApplicationListener</code> and register it as a Spring bean. The following example
demonstrates such a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BlackListNotifier</span> <span class="directive">implements</span> ApplicationListener&lt;BlackListEvent&gt; {

    <span class="directive">private</span> <span class="predefined-type">String</span> notificationAddress;

    <span class="directive">public</span> <span class="type">void</span> setNotificationAddress(<span class="predefined-type">String</span> notificationAddress) {
        <span class="local-variable">this</span>.notificationAddress = notificationAddress;
    }

    <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(BlackListEvent event) {
        <span class="comment">// notify appropriate parties via notificationAddress...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>ApplicationListener</code> is generically parameterized with the type of your
custom event, <code>BlackListEvent</code>. This means that the <code>onApplicationEvent()</code> method can
remain type-safe, avoiding any need for downcasting. You may register as many event
listeners as you wish, but note that by default event listeners receive events
synchronously. This means the <code>publishEvent()</code> method blocks until all listeners have
finished processing the event. One advantage of this synchronous and single-threaded
approach is that when a listener receives an event, it operates inside the transaction
context of the publisher if a transaction context is available. If another strategy for
event publication becomes necessary, refer to the javadoc for Spring&#8217;s
<code>ApplicationEventMulticaster</code> interface.</p>
</div>
<div class="paragraph">
<p>The following example shows the bean definitions used to register and configure each of
the classes above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emailService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.EmailService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blackList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9af1f4f5edf4b4e9eafbf7f7ffe8daffe2fbf7eaf6ffb4f5e8fd">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="412a2f2e362f6f2920222a2433012439202c312d246f2e3326">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7c16131412521813193c19041d110c101952130e1b">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blackListNotifier</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.BlackListNotifier</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationAddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4e2c222f2d2522273d3a0e2b362f233e222b60213c29">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Putting it all together, when the <code>sendEmail()</code> method of the <code>emailService</code> bean is
called, if there are any emails that should be blacklisted, a custom event of type
<code>BlackListEvent</code> is published. The <code>blackListNotifier</code> bean is registered as an
<code>ApplicationListener</code> and thus receives the <code>BlackListEvent</code>, at which point it can
notify appropriate parties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring&#8217;s eventing mechanism is designed for simple communication between Spring beans
within the same application context. However, for more sophisticated enterprise
integration needs, the separately-maintained
<a href="https://projects.spring.io/spring-integration/">Spring Integration</a> project provides
complete support for building lightweight,
<a href="http://www.enterpriseintegrationpatterns.com">pattern-oriented</a>, event-driven
architectures that build upon the well-known Spring programming model.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="context-functionality-events-annotation"><a class="anchor" href="core.html#context-functionality-events-annotation"></a>Annotation-based event listeners</h5>
<div class="paragraph">
<p>As of Spring 4.2, an event listener can be registered on any public method of a managed
bean via the <code>EventListener</code> annotation. The <code>BlackListNotifier</code> can be rewritten as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BlackListNotifier</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> notificationAddress;

    <span class="directive">public</span> <span class="type">void</span> setNotificationAddress(<span class="predefined-type">String</span> notificationAddress) {
        <span class="local-variable">this</span>.notificationAddress = notificationAddress;
    }

    <span class="annotation">@EventListener</span>
    <span class="directive">public</span> <span class="type">void</span> processBlackListEvent(BlackListEvent event) {
        <span class="comment">// notify appropriate parties via notificationAddress...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see above, the method signature once again declares the event type it listens to,
but this time with a flexible name and without implementing a specific listener interface.
The event type can also be narrowed through generics as long as the actual event type
resolves your generic parameter in its implementation hierarchy.</p>
</div>
<div class="paragraph">
<p>If your method should listen to several events or if you want to define it with no
parameter at all, the event type(s) can also be specified on the annotation itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>({ContextStartedEvent.class, ContextRefreshedEvent.class})
<span class="directive">public</span> <span class="type">void</span> handleContextStart() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to add additional runtime filtering via the <code>condition</code> attribute of the
annotation that defines a <a href="core.html#expressions"><code>SpEL</code> expression</a> that should match to actually invoke
the method for a particular event.</p>
</div>
<div class="paragraph">
<p>For instance, our notifier can be rewritten to be only invoked if the <code>test</code> attribute of the
event is equal to <code>foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>(condition = <span class="string"><span class="delimiter">&quot;</span><span class="content">#blEvent.test == 'foo'</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> processBlackListEvent(BlackListEvent blEvent) {
    <span class="comment">// notify appropriate parties via notificationAddress...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>SpEL</code> expression evaluates again a dedicated context. The next table lists the items made
available to the context so one can use them for conditional event processing:</p>
</div>
<table id="context-functionality-events-annotation-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Event SpEL available metadata</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual <code>ApplicationEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.event</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The arguments (as array) used for invoking the target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.args[0]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Argument name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluation context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of any of the method arguments. If for some reason the names are not available
(e.g. no debug information), the argument names are also available under the <code>#a&lt;#arg&gt;</code>
where <em>#arg</em> stands for the argument index (starting from 0).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#blEvent</code> or <code>#a0</code> (one can also use <code>#p0</code> or <code>#p&lt;#arg&gt;</code> notation as an alias).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that <code>#root.event</code> allows you to access to the underlying event, even if your method
signature actually refers to an arbitrary object that was published.</p>
</div>
<div class="paragraph">
<p>If you need to publish an event as the result of processing another, just change the
method signature to return the event that should be published, something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>
<span class="directive">public</span> ListUpdateEvent handleBlackListEvent(BlackListEvent event) {
    <span class="comment">// notify appropriate parties via notificationAddress and</span>
    <span class="comment">// then publish a ListUpdateEvent...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is not supported for <a href="core.html#context-functionality-events-async">asynchronous
listeners</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This new method will publish a new <code>ListUpdateEvent</code> for every <code>BlackListEvent</code> handled
by the method above. If you need to publish several events, just return a <code>Collection</code> of
events instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="context-functionality-events-async"><a class="anchor" href="core.html#context-functionality-events-async"></a>Asynchronous Listeners</h5>
<div class="paragraph">
<p>If you want a particular listener to process events asynchronously, simply reuse the
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling-annotation-support-async">regular <code>@Async</code> support</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>
<span class="annotation">@Async</span>
<span class="directive">public</span> <span class="type">void</span> processBlackListEvent(BlackListEvent event) {
    <span class="comment">// BlackListEvent is processed in a separate thread</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be aware of the following limitations when using asynchronous events:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the event listener throws an <code>Exception</code> it will not be propagated to the caller,
check <code>AsyncUncaughtExceptionHandler</code> for more details.</p>
</li>
<li>
<p>Such event listener cannot send replies. If you need to send another event as the
result of the processing, inject <code>ApplicationEventPublisher</code> to send the event
manually.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="context-functionality-events-order"><a class="anchor" href="core.html#context-functionality-events-order"></a>Ordering listeners</h5>
<div class="paragraph">
<p>If you need the listener to be invoked before another one, just add the <code>@Order</code>
annotation to the method declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>
<span class="annotation">@Order</span>(<span class="integer">42</span>)
<span class="directive">public</span> <span class="type">void</span> processBlackListEvent(BlackListEvent event) {
    <span class="comment">// notify appropriate parties via notificationAddress...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="context-functionality-events-generics"><a class="anchor" href="core.html#context-functionality-events-generics"></a>Generic events</h5>
<div class="paragraph">
<p>You may also use generics to further define the structure of your event. Consider an
<code>EntityCreatedEvent&lt;T&gt;</code> where <code>T</code> is the type of the actual entity that got created. You
can create the following listener definition to only receive <code>EntityCreatedEvent</code> for a
<code>Person</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EventListener</span>
<span class="directive">public</span> <span class="type">void</span> onPersonCreated(EntityCreatedEvent&lt;Person&gt; event) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to type erasure, this will only work if the event that is fired resolves the generic
parameter(s) on which the event listener filters on (that is something like
<code>class PersonCreatedEvent extends EntityCreatedEvent&lt;Person&gt; { &#8230;&#8203; }</code>).</p>
</div>
<div class="paragraph">
<p>In certain circumstances, this may become quite tedious if all events follow the same
structure (as it should be the case for the event above). In such a case, you can
implement <code>ResolvableTypeProvider</code> to <em>guide</em> the framework beyond what the runtime
environment provides:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EntityCreatedEvent</span>&lt;T&gt;
        <span class="directive">extends</span> ApplicationEvent <span class="directive">implements</span> ResolvableTypeProvider {

    <span class="directive">public</span> EntityCreatedEvent(T entity) {
        <span class="local-variable">super</span>(entity);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ResolvableType getResolvableType() {
        <span class="keyword">return</span> ResolvableType.forClassWithGenerics(getClass(),
                ResolvableType.forInstance(getSource()));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This works not only for <code>ApplicationEvent</code> but any arbitrary object that you&#8217;d send as
an event.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="context-functionality-resources"><a class="anchor" href="core.html#context-functionality-resources"></a>1.15.3. Convenient access to low-level resources</h4>
<div class="paragraph">
<p>For optimal usage and understanding of application contexts, users should generally
familiarize themselves with Spring&#8217;s <code>Resource</code> abstraction, as described in the chapter
<a href="core.html#resources">Resources</a>.</p>
</div>
<div class="paragraph">
<p>An application context is a <code>ResourceLoader</code>, which can be used to load <code>Resource</code>s. A
<code>Resource</code> is essentially a more feature rich version of the JDK class <code>java.net.URL</code>,
in fact, the implementations of the <code>Resource</code> wrap an instance of <code>java.net.URL</code> where
appropriate. A <code>Resource</code> can obtain low-level resources from almost any location in a
transparent fashion, including from the classpath, a filesystem location, anywhere
describable with a standard URL, and some other variations. If the resource location
string is a simple path without any special prefixes, where those resources come from is
specific and appropriate to the actual application context type.</p>
</div>
<div class="paragraph">
<p>You can configure a bean deployed into the application context to implement the special
callback interface, <code>ResourceLoaderAware</code>, to be automatically called back at
initialization time with the application context itself passed in as the
<code>ResourceLoader</code>. You can also expose properties of type <code>Resource</code>, to be used to
access static resources; they will be injected into it like any other properties. You
can specify those <code>Resource</code> properties as simple String paths, and rely on a special
JavaBean <code>PropertyEditor</code> that is automatically registered by the context, to convert
those text strings to actual <code>Resource</code> objects when the bean is deployed.</p>
</div>
<div class="paragraph">
<p>The location path or paths supplied to an <code>ApplicationContext</code> constructor are actually
resource strings, and in simple form are treated appropriately to the specific context
implementation. <code>ClassPathXmlApplicationContext</code> treats a simple location path as a
classpath location. You can also use location paths (resource strings) with special
prefixes to force loading of definitions from the classpath or a URL, regardless of the
actual context type.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-create"><a class="anchor" href="core.html#context-create"></a>1.15.4. Convenient ApplicationContext instantiation for web applications</h4>
<div class="paragraph">
<p>You can create <code>ApplicationContext</code> instances declaratively by using, for example, a
<code>ContextLoader</code>. Of course you can also create <code>ApplicationContext</code> instances
programmatically by using one of the <code>ApplicationContext</code> implementations.</p>
</div>
<div class="paragraph">
<p>You can register an <code>ApplicationContext</code> using the <code>ContextLoaderListener</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>

<span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listener inspects the <code>contextConfigLocation</code> parameter. If the parameter does not
exist, the listener uses <code>/WEB-INF/applicationContext.xml</code> as a default. When the
parameter <em>does</em> exist, the listener separates the String by using predefined
delimiters (comma, semicolon and whitespace) and uses the values as locations where
application contexts will be searched. Ant-style path patterns are supported as well.
Examples are <code>/WEB-INF/*Context.xml</code> for all files with names ending with "Context.xml",
residing in the "WEB-INF" directory, and <code>/WEB-INF/**/*Context.xml</code>, for all such files
in any subdirectory of "WEB-INF".</p>
</div>
</div>
<div class="sect3">
<h4 id="context-deploy-rar"><a class="anchor" href="core.html#context-deploy-rar"></a>1.15.5. Deploying a Spring ApplicationContext as a Java EE RAR file</h4>
<div class="paragraph">
<p>It is possible to deploy a Spring ApplicationContext as a RAR file, encapsulating the
context and all of its required bean classes and library JARs in a Java EE RAR deployment
unit. This is the equivalent of bootstrapping a standalone ApplicationContext, just hosted
in Java EE environment, being able to access the Java EE servers facilities. RAR deployment
is more natural alternative to scenario of deploying a headless WAR file, in effect, a WAR
file without any HTTP entry points that is used only for bootstrapping a Spring
ApplicationContext in a Java EE environment.</p>
</div>
<div class="paragraph">
<p>RAR deployment is ideal for application contexts that do not need HTTP entry points but
rather consist only of message endpoints and scheduled jobs. Beans in such a context can
use application server resources such as the JTA transaction manager and JNDI-bound JDBC
DataSources and JMS ConnectionFactory instances, and may also register with the
platform&#8217;s JMX server - all through Spring&#8217;s standard transaction management and JNDI
and JMX support facilities. Application components can also interact with the
application server&#8217;s JCA WorkManager through Spring&#8217;s <code>TaskExecutor</code> abstraction.</p>
</div>
<div class="paragraph">
<p>Check out the javadoc of the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html"><code>SpringContextResourceAdapter</code></a>
class for the configuration details involved in RAR deployment.</p>
</div>
<div class="paragraph">
<p><em>For a simple deployment of a Spring ApplicationContext as a Java EE RAR file:</em> package
all application classes into a RAR file, which is a standard JAR file with a different
file extension. Add all required library JARs into the root of the RAR archive. Add a
"META-INF/ra.xml" deployment descriptor (as shown in <code>SpringContextResourceAdapter</code>s
javadoc) and the corresponding Spring XML bean definition file(s) (typically
"META-INF/applicationContext.xml"), and drop the resulting RAR file into your
application server&#8217;s deployment directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Such RAR deployment units are usually self-contained; they do not expose components to
the outside world, not even to other modules of the same application. Interaction with a
RAR-based ApplicationContext usually occurs through JMS destinations that it shares with
other modules. A RAR-based ApplicationContext may also, for example, schedule some jobs,
reacting to new files in the file system (or the like). If it needs to allow synchronous
access from the outside, it could for example export RMI endpoints, which of course may
be used by other application modules on the same machine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="beans-beanfactory"><a class="anchor" href="core.html#beans-beanfactory"></a>1.16. The BeanFactory</h3>
<div class="paragraph">
<p>The <code>BeanFactory</code> provides the underlying basis for Spring&#8217;s IoC functionality but it is
only used directly in integration with other third-party frameworks and is now largely
historical in nature for most users of Spring. The <code>BeanFactory</code> and related interfaces,
such as <code>BeanFactoryAware</code>, <code>InitializingBean</code>, <code>DisposableBean</code>, are still present in
Spring for the purposes of backward compatibility with the large number of third-party
frameworks that integrate with Spring. Often third-party components that can not use
more modern equivalents such as <code>@PostConstruct</code> or <code>@PreDestroy</code> in order to avoid a
dependency on JSR-250.</p>
</div>
<div class="paragraph">
<p>This section provides additional background into the differences between the
<code>BeanFactory</code> and <code>ApplicationContext</code> and how one might access the IoC container
directly through a classic singleton lookup.</p>
</div>
<div class="sect3">
<h4 id="context-introduction-ctx-vs-beanfactory"><a class="anchor" href="core.html#context-introduction-ctx-vs-beanfactory"></a>1.16.1. BeanFactory or ApplicationContext?</h4>
<div class="paragraph">
<p>Use an <code>ApplicationContext</code> unless you have a good reason for not doing so.</p>
</div>
<div class="paragraph">
<p>Because the <code>ApplicationContext</code> includes all functionality of the <code>BeanFactory</code>, it is
generally recommended over the <code>BeanFactory</code>, except for a few situations such as in
embedded applications running on resource-constrained devices where memory consumption
might be critical and a few extra kilobytes might make a difference. However, for
most typical enterprise applications and systems, the <code>ApplicationContext</code> is what you
will want to use. Spring makes <em>heavy</em> use of the <a href="core.html#beans-factory-extension-bpp"><code>BeanPostProcessor</code> extension point</a> (to effect proxying and so on). If you use only a
plain <code>BeanFactory</code>, a fair amount of support such as transactions and AOP will not take
effect, at least not without some extra steps on your part. This situation could be
confusing because nothing is actually wrong with the configuration.</p>
</div>
<div class="paragraph">
<p>The following table lists features provided by the <code>BeanFactory</code> and
<code>ApplicationContext</code> interfaces and implementations.</p>
</div>
<table id="context-introduction-ctx-vs-beanfactory-feature-matrix" class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Feature Matrix</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top"><code>BeanFactory</code></th>
<th class="tableblock halign-left valign-top"><code>ApplicationContext</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean instantiation/wiring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatic <code>BeanPostProcessor</code> registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatic <code>BeanFactoryPostProcessor</code> registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convenient <code>MessageSource</code> access (for i18n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ApplicationEvent</code> publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To explicitly register a bean post-processor with a <code>BeanFactory</code> implementation,
you need to write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DefaultListableBeanFactory factory = <span class="keyword">new</span> DefaultListableBeanFactory();
<span class="comment">// populate the factory with bean definitions</span>

<span class="comment">// now register any needed BeanPostProcessor instances</span>
MyBeanPostProcessor postProcessor = <span class="keyword">new</span> MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);

<span class="comment">// now start using the factory</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly register a <code>BeanFactoryPostProcessor</code> when using a <code>BeanFactory</code>
implementation, you must write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DefaultListableBeanFactory factory = <span class="keyword">new</span> DefaultListableBeanFactory();
XmlBeanDefinitionReader reader = <span class="keyword">new</span> XmlBeanDefinitionReader(factory);
reader.loadBeanDefinitions(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// bring in some property values from a Properties file</span>
PropertyPlaceholderConfigurer cfg = <span class="keyword">new</span> PropertyPlaceholderConfigurer();
cfg.setLocation(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc.properties</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// now actually do the replacement</span>
cfg.postProcessBeanFactory(factory);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, the explicit registration step is inconvenient, which is one reason why
the various <code>ApplicationContext</code> implementations are preferred above plain <code>BeanFactory</code>
implementations in the vast majority of Spring-backed applications, especially when
using <code>BeanFactoryPostProcessor</code>s and <code>BeanPostProcessor</code>s. These mechanisms implement
important functionality such as property placeholder replacement and AOP.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="anchor" href="core.html#resources"></a>2. Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="resources-introduction"><a class="anchor" href="core.html#resources-introduction"></a>2.1. Introduction</h3>
<div class="paragraph">
<p>Java&#8217;s standard <code>java.net.URL</code> class and standard handlers for various URL prefixes
unfortunately are not quite adequate enough for all access to low-level resources. For
example, there is no standardized <code>URL</code> implementation that may be used to access a
resource that needs to be obtained from the classpath, or relative to a
<code>ServletContext</code>. While it is possible to register new handlers for specialized <code>URL</code>
prefixes (similar to existing handlers for prefixes such as <code>http:</code>), this is generally
quite complicated, and the <code>URL</code> interface still lacks some desirable functionality,
such as a method to check for the existence of the resource being pointed to.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources-resource"><a class="anchor" href="core.html#resources-resource"></a>2.2. The Resource interface</h3>
<div class="paragraph">
<p>Spring&#8217;s <code>Resource</code> interface is meant to be a more capable interface for abstracting
access to low-level resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Resource</span> <span class="directive">extends</span> InputStreamSource {

    <span class="type">boolean</span> exists();

    <span class="type">boolean</span> isOpen();

    <span class="predefined-type">URL</span> getURL() <span class="directive">throws</span> <span class="exception">IOException</span>;

    <span class="predefined-type">File</span> getFile() <span class="directive">throws</span> <span class="exception">IOException</span>;

    Resource createRelative(<span class="predefined-type">String</span> relativePath) <span class="directive">throws</span> <span class="exception">IOException</span>;

    <span class="predefined-type">String</span> getFilename();

    <span class="predefined-type">String</span> getDescription();

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">InputStreamSource</span> {

    <span class="predefined-type">InputStream</span> getInputStream() <span class="directive">throws</span> <span class="exception">IOException</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some of the most important methods from the <code>Resource</code> interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getInputStream()</code>: locates and opens the resource, returning an <code>InputStream</code> for
reading from the resource. It is expected that each invocation returns a fresh
<code>InputStream</code>. It is the responsibility of the caller to close the stream.</p>
</li>
<li>
<p><code>exists()</code>: returns a <code>boolean</code> indicating whether this resource actually exists in
physical form.</p>
</li>
<li>
<p><code>isOpen()</code>: returns a <code>boolean</code> indicating whether this resource represents a handle
with an open stream. If <code>true</code>, the <code>InputStream</code> cannot be read multiple times, and
must be read once only and then closed to avoid resource leaks. Will be <code>false</code> for
all usual resource implementations, with the exception of <code>InputStreamResource</code>.</p>
</li>
<li>
<p><code>getDescription()</code>: returns a description for this resource, to be used for error
output when working with the resource. This is often the fully qualified file name or
the actual URL of the resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other methods allow you to obtain an actual <code>URL</code> or <code>File</code> object representing the
resource (if the underlying implementation is compatible, and supports that
functionality).</p>
</div>
<div class="paragraph">
<p>The <code>Resource</code> abstraction is used extensively in Spring itself, as an argument type in
many method signatures when a resource is needed. Other methods in some Spring APIs
(such as the constructors to various <code>ApplicationContext</code> implementations), take a
<code>String</code> which in unadorned or simple form is used to create a <code>Resource</code> appropriate to
that context implementation, or via special prefixes on the <code>String</code> path, allow the
caller to specify that a specific <code>Resource</code> implementation must be created and used.</p>
</div>
<div class="paragraph">
<p>While the <code>Resource</code> interface is used a lot with Spring and by Spring, it&#8217;s actually
very useful to use as a general utility class by itself in your own code, for access to
resources, even when your code doesn&#8217;t know or care about any other parts of Spring.
While this couples your code to Spring, it really only couples it to this small set of
utility classes, which are serving as a more capable replacement for <code>URL</code>, and can be
considered equivalent to any other library you would use for this purpose.</p>
</div>
<div class="paragraph">
<p>It is important to note that the <code>Resource</code> abstraction does not replace functionality:
it wraps it where possible. For example, a <code>UrlResource</code> wraps a URL, and uses the
wrapped <code>URL</code> to do its work.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources-implementations"><a class="anchor" href="core.html#resources-implementations"></a>2.3. Built-in Resource implementations</h3>
<div class="paragraph">
<p>There are a number of <code>Resource</code> implementations that come supplied straight out of the
box in Spring:</p>
</div>
<div class="sect3">
<h4 id="resources-implementations-urlresource"><a class="anchor" href="core.html#resources-implementations-urlresource"></a>2.3.1. UrlResource</h4>
<div class="paragraph">
<p>The <code>UrlResource</code> wraps a <code>java.net.URL</code>, and may be used to access any object that is
normally accessible via a URL, such as files, an HTTP target, an FTP target, etc. All
URLs have a standardized <code>String</code> representation, such that appropriate standardized
prefixes are used to indicate one URL type from another. This includes <code>file:</code> for
accessing filesystem paths, <code>http:</code> for accessing resources via the HTTP protocol,
<code>ftp:</code> for accessing resources via FTP, etc.</p>
</div>
<div class="paragraph">
<p>A <code>UrlResource</code> is created by Java code explicitly using the <code>UrlResource</code> constructor,
but will often be created implicitly when you call an API method which takes a <code>String</code>
argument which is meant to represent a path. For the latter case, a JavaBeans
<code>PropertyEditor</code> will ultimately decide which type of <code>Resource</code> to create. If the path
string contains a few well-known (to it, that is) prefixes such as <code>classpath:</code>, it will
create an appropriate specialized <code>Resource</code> for that prefix. However, if it doesn&#8217;t
recognize the prefix, it will assume the this is just a standard URL string, and will
create a <code>UrlResource</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-implementations-classpathresource"><a class="anchor" href="core.html#resources-implementations-classpathresource"></a>2.3.2. ClassPathResource</h4>
<div class="paragraph">
<p>This class represents a resource which should be obtained from the classpath. This uses
either the thread context class loader, a given class loader, or a given class for
loading resources.</p>
</div>
<div class="paragraph">
<p>This <code>Resource</code> implementation supports resolution as <code>java.io.File</code> if the class path
resource resides in the file system, but not for classpath resources which reside in a
jar and have not been expanded (by the servlet engine, or whatever the environment is)
to the filesystem. To address this the various <code>Resource</code> implementations always support
resolution as a <code>java.net.URL</code>.</p>
</div>
<div class="paragraph">
<p>A <code>ClassPathResource</code> is created by Java code explicitly using the <code>ClassPathResource</code>
constructor, but will often be created implicitly when you call an API method which
takes a <code>String</code> argument which is meant to represent a path. For the latter case, a
JavaBeans <code>PropertyEditor</code> will recognize the special prefix <code>classpath:</code> on the string
path, and create a <code>ClassPathResource</code> in that case.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-implementations-filesystemresource"><a class="anchor" href="core.html#resources-implementations-filesystemresource"></a>2.3.3. FileSystemResource</h4>
<div class="paragraph">
<p>This is a <code>Resource</code> implementation for <code>java.io.File</code> handles. It obviously supports
resolution as a <code>File</code>, and as a <code>URL</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-implementations-servletcontextresource"><a class="anchor" href="core.html#resources-implementations-servletcontextresource"></a>2.3.4. ServletContextResource</h4>
<div class="paragraph">
<p>This is a <code>Resource</code> implementation for <code>ServletContext</code> resources, interpreting
relative paths within the relevant web application&#8217;s root directory.</p>
</div>
<div class="paragraph">
<p>This always supports stream access and URL access, but only allows <code>java.io.File</code> access
when the web application archive is expanded and the resource is physically on the
filesystem. Whether or not it&#8217;s expanded and on the filesystem like this, or accessed
directly from the JAR or somewhere else like a DB (it&#8217;s conceivable) is actually
dependent on the Servlet container.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-implementations-inputstreamresource"><a class="anchor" href="core.html#resources-implementations-inputstreamresource"></a>2.3.5. InputStreamResource</h4>
<div class="paragraph">
<p>A <code>Resource</code> implementation for a given <code>InputStream</code>. This should only be used if no
specific <code>Resource</code> implementation is applicable. In particular, prefer
<code>ByteArrayResource</code> or any of the file-based <code>Resource</code> implementations where possible.</p>
</div>
<div class="paragraph">
<p>In contrast to other <code>Resource</code> implementations, this is a descriptor for an <em>already</em>
opened resource - therefore returning <code>true</code> from <code>isOpen()</code>. Do not use it if you need
to keep the resource descriptor somewhere, or if you need to read a stream multiple
times.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-implementations-bytearrayresource"><a class="anchor" href="core.html#resources-implementations-bytearrayresource"></a>2.3.6. ByteArrayResource</h4>
<div class="paragraph">
<p>This is a <code>Resource</code> implementation for a given byte array. It creates a
<code>ByteArrayInputStream</code> for the given byte array.</p>
</div>
<div class="paragraph">
<p>It&#8217;s useful for loading content from any given byte array, without having to resort to a
single-use <code>InputStreamResource</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resources-resourceloader"><a class="anchor" href="core.html#resources-resourceloader"></a>2.4. The ResourceLoader</h3>
<div class="paragraph">
<p>The <code>ResourceLoader</code> interface is meant to be implemented by objects that can return
(i.e. load) <code>Resource</code> instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ResourceLoader</span> {

    Resource getResource(<span class="predefined-type">String</span> location);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All application contexts implement the <code>ResourceLoader</code> interface, and therefore all
application contexts may be used to obtain <code>Resource</code> instances.</p>
</div>
<div class="paragraph">
<p>When you call <code>getResource()</code> on a specific application context, and the location path
specified doesn&#8217;t have a specific prefix, you will get back a <code>Resource</code> type that is
appropriate to that particular application context. For example, assume the following
snippet of code was executed against a <code>ClassPathXmlApplicationContext</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Resource template = ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>What would be returned would be a <code>ClassPathResource</code>; if the same method was executed
against a <code>FileSystemXmlApplicationContext</code> instance, you&#8217;d get back a
<code>FileSystemResource</code>. For a <code>WebApplicationContext</code>, you&#8217;d get back a
<code>ServletContextResource</code>, and so on.</p>
</div>
<div class="paragraph">
<p>As such, you can load resources in a fashion appropriate to the particular application
context.</p>
</div>
<div class="paragraph">
<p>On the other hand, you may also force <code>ClassPathResource</code> to be used, regardless of the
application context type, by specifying the special <code>classpath:</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Resource template = ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, one can force a <code>UrlResource</code> to be used by specifying any of the standard
<code>java.net.URL</code> prefixes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Resource template = ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Resource template = ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://myhost.com/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes the strategy for converting <code>String</code>s to <code>Resource</code>s:</p>
</div>
<table id="resources-resource-strings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Resource strings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classpath:com/myapp/config.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loaded from the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="file:///data/config.xml" class="bare">file:///data/config.xml</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loaded as a <code>URL</code>, from the filesystem. <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="core.html#_footnote_3" title="View footnote.">3</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://myserver/logo.png" class="bare">http://myserver/logo.png</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loaded as a <code>URL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data/config.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on the underlying <code>ApplicationContext</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="resources-resourceloaderaware"><a class="anchor" href="core.html#resources-resourceloaderaware"></a>2.5. The ResourceLoaderAware interface</h3>
<div class="paragraph">
<p>The <code>ResourceLoaderAware</code> interface is a special marker interface, identifying objects
that expect to be provided with a <code>ResourceLoader</code> reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ResourceLoaderAware</span> {

    <span class="type">void</span> setResourceLoader(ResourceLoader resourceLoader);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a class implements <code>ResourceLoaderAware</code> and is deployed into an application
context (as a Spring-managed bean), it is recognized as <code>ResourceLoaderAware</code> by the
application context. The application context will then invoke the
<code>setResourceLoader(ResourceLoader)</code>, supplying itself as the argument (remember, all
application contexts in Spring implement the <code>ResourceLoader</code> interface).</p>
</div>
<div class="paragraph">
<p>Of course, since an <code>ApplicationContext</code> is a <code>ResourceLoader</code>, the bean could also
implement the <code>ApplicationContextAware</code> interface and use the supplied application
context directly to load resources, but in general, it&#8217;s better to use the specialized
<code>ResourceLoader</code> interface if that&#8217;s all that&#8217;s needed. The code would just be coupled
to the resource loading interface, which can be considered a utility interface, and not
the whole Spring <code>ApplicationContext</code> interface.</p>
</div>
<div class="paragraph">
<p>As of Spring 2.5, you can rely upon autowiring of the <code>ResourceLoader</code> as an alternative
to implementing the <code>ResourceLoaderAware</code> interface. The "traditional" <code>constructor</code> and
<code>byType</code> autowiring modes (as described in <a href="core.html#beans-factory-autowire">Autowiring collaborators</a>) are now capable
of providing a dependency of type <code>ResourceLoader</code> for either a constructor argument or
setter method parameter respectively. For more flexibility (including the ability to
autowire fields and multiple parameter methods), consider using the new annotation-based
autowiring features. In that case, the <code>ResourceLoader</code> will be autowired into a field,
constructor argument, or method parameter that is expecting the <code>ResourceLoader</code> type as
long as the field, constructor, or method in question carries the <code>@Autowired</code>
annotation. For more information, see <a href="core.html#beans-autowired-annotation">@Autowired</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources-as-dependencies"><a class="anchor" href="core.html#resources-as-dependencies"></a>2.6. Resources as dependencies</h3>
<div class="paragraph">
<p>If the bean itself is going to determine and supply the resource path through some sort
of dynamic process, it probably makes sense for the bean to use the <code>ResourceLoader</code>
interface to load resources. Consider as an example the loading of a template of some
sort, where the specific resource that is needed depends on the role of the user. If the
resources are static, it makes sense to eliminate the use of the <code>ResourceLoader</code>
interface completely, and just have the bean expose the <code>Resource</code> properties it needs,
and expect that they will be injected into it.</p>
</div>
<div class="paragraph">
<p>What makes it trivial to then inject these properties, is that all application contexts
register and use a special JavaBeans <code>PropertyEditor</code> which can convert <code>String</code> paths
to <code>Resource</code> objects. So if <code>myBean</code> has a template property of type <code>Resource</code>, it can
be configured with a simple string for that resource, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the resource path has no prefix, so because the application context itself is
going to be used as the <code>ResourceLoader</code>, the resource itself will be loaded via a
<code>ClassPathResource</code>, <code>FileSystemResource</code>, or <code>ServletContextResource</code> (as appropriate)
depending on the exact type of the context.</p>
</div>
<div class="paragraph">
<p>If there is a need to force a specific <code>Resource</code> type to be used, then a prefix may be
used. The following two examples show how to force a <code>ClassPathResource</code> and a
<code>UrlResource</code> (the latter being used to access a filesystem file).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resources-app-ctx"><a class="anchor" href="core.html#resources-app-ctx"></a>2.7. Application contexts and Resource paths</h3>
<div class="sect3">
<h4 id="resources-app-ctx-construction"><a class="anchor" href="core.html#resources-app-ctx-construction"></a>2.7.1. Constructing application contexts</h4>
<div class="paragraph">
<p>An application context constructor (for a specific application context type) generally
takes a string or array of strings as the location path(s) of the resource(s) such as
XML files that make up the definition of the context.</p>
</div>
<div class="paragraph">
<p>When such a location path doesn&#8217;t have a prefix, the specific <code>Resource</code> type built from
that path and used to load the bean definitions, depends on and is appropriate to the
specific application context. For example, if you create a
<code>ClassPathXmlApplicationContext</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean definitions will be loaded from the classpath, as a <code>ClassPathResource</code> will be
used. But if you create a <code>FileSystemXmlApplicationContext</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx =
    <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean definition will be loaded from a filesystem location, in this case relative to
the current working directory.</p>
</div>
<div class="paragraph">
<p>Note that the use of the special classpath prefix or a standard URL prefix on the
location path will override the default type of <code>Resource</code> created to load the
definition. So this <code>FileSystemXmlApplicationContext</code>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx =
    <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:conf/appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>will actually load its bean definitions from the classpath. However, it is still a
<code>FileSystemXmlApplicationContext</code>. If it is subsequently used as a <code>ResourceLoader</code>, any
unprefixed paths will still be treated as filesystem paths.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="resources-app-ctx-classpathxml"><a class="anchor" href="core.html#resources-app-ctx-classpathxml"></a>Constructing ClassPathXmlApplicationContext instances - shortcuts</h5>
<div class="paragraph">
<p>The <code>ClassPathXmlApplicationContext</code> exposes a number of constructors to enable
convenient instantiation. The basic idea is that one supplies merely a string array
containing just the filenames of the XML files themselves (without the leading path
information), and one <em>also</em> supplies a <code>Class</code>; the <code>ClassPathXmlApplicationContext</code>
will derive the path information from the supplied class.</p>
</div>
<div class="paragraph">
<p>An example will hopefully make this clear. Consider a directory layout that looks like
this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com/
  foo/
    services.xml
    daos.xml
    MessengerService.class</pre>
</div>
</div>
<div class="paragraph">
<p>A <code>ClassPathXmlApplicationContext</code> instance composed of the beans defined in the
<code>'services.xml'</code> and <code>'daos.xml'</code> could be instantiated like so&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(
    <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">services.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">daos.xml</span><span class="delimiter">&quot;</span></span>}, MessengerService.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please do consult the <code>ClassPathXmlApplicationContext</code> javadocs for details
on the various constructors.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-app-ctx-wildcards-in-resource-paths"><a class="anchor" href="core.html#resources-app-ctx-wildcards-in-resource-paths"></a>2.7.2. Wildcards in application context constructor resource paths</h4>
<div class="paragraph">
<p>The resource paths in application context constructor values may be a simple path (as
shown above) which has a one-to-one mapping to a target Resource, or alternately may
contain the special "classpath*:" prefix and/or internal Ant-style regular expressions
(matched using Spring&#8217;s <code>PathMatcher</code> utility). Both of the latter are effectively
wildcards</p>
</div>
<div class="paragraph">
<p>One use for this mechanism is when doing component-style application assembly. All
components can 'publish' context definition fragments to a well-known location path, and
when the final application context is created using the same path prefixed via
<code>classpath*:</code>, all component fragments will be picked up automatically.</p>
</div>
<div class="paragraph">
<p>Note that this wildcarding is specific to use of resource paths in application context
constructors (or when using the <code>PathMatcher</code> utility class hierarchy directly), and is
resolved at construction time. It has nothing to do with the <code>Resource</code> type itself.
It&#8217;s not possible to use the <code>classpath*:</code> prefix to construct an actual <code>Resource</code>, as
a resource points to just one resource at a time.</p>
</div>
<div class="sect4">
<h5 id="resources-app-ctx-ant-patterns-in-paths"><a class="anchor" href="core.html#resources-app-ctx-ant-patterns-in-paths"></a>Ant-style Patterns</h5>
<div class="paragraph">
<p>When the path location contains an Ant-style pattern, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/WEB-INF/*-context.xml
  com/mycompany/**/applicationContext.xml
  file:C:/some/path/*-context.xml
  classpath:com/mycompany/**/applicationContext.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The resolver follows a more complex but defined procedure to try to resolve the
wildcard. It produces a Resource for the path up to the last non-wildcard segment and
obtains a URL from it. If this URL is not a <code>jar:</code> URL or container-specific variant
(e.g. <code>zip:</code> in WebLogic, <code>wsjar</code> in WebSphere, etc.), then a <code>java.io.File</code> is
obtained from it and used to resolve the wildcard by traversing the filesystem. In the
case of a jar URL, the resolver either gets a <code>java.net.JarURLConnection</code> from it or
manually parses the jar URL and then traverses the contents of the jar file to resolve
the wildcards.</p>
</div>
<div class="sect5">
<h6 id="resources-app-ctx-portability"><a class="anchor" href="core.html#resources-app-ctx-portability"></a>Implications on portability</h6>
<div class="paragraph">
<p>If the specified path is already a file URL (either explicitly, or implicitly because
the base <code>ResourceLoader</code> is a filesystem one, then wildcarding is guaranteed to work in
a completely portable fashion.</p>
</div>
<div class="paragraph">
<p>If the specified path is a classpath location, then the resolver must obtain the last
non-wildcard path segment URL via a <code>Classloader.getResource()</code> call. Since this is just
a node of the path (not the file at the end) it is actually undefined (in the
<code>ClassLoader</code> javadocs) exactly what sort of a URL is returned in this case. In
practice, it is always a <code>java.io.File</code> representing the directory, where the classpath
resource resolves to a filesystem location, or a jar URL of some sort, where the
classpath resource resolves to a jar location. Still, there is a portability concern on
this operation.</p>
</div>
<div class="paragraph">
<p>If a jar URL is obtained for the last non-wildcard segment, the resolver must be able to
get a <code>java.net.JarURLConnection</code> from it, or manually parse the jar URL, to be able to
walk the contents of the jar, and resolve the wildcard. This will work in most
environments, but will fail in others, and it is strongly recommended that the wildcard
resolution of resources coming from jars be thoroughly tested in your specific
environment before you rely on it.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resources-classpath-wildcards"><a class="anchor" href="core.html#resources-classpath-wildcards"></a>The classpath*: prefix</h5>
<div class="paragraph">
<p>When constructing an XML-based application context, a location string may use the
special <code>classpath*:</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx =
    <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath*:conf/appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This special prefix specifies that all classpath resources that match the given name
must be obtained (internally, this essentially happens via a
<code>ClassLoader.getResources(&#8230;&#8203;)</code> call), and then merged to form the final application
context definition.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The wildcard classpath relies on the <code>getResources()</code> method of the underlying
classloader. As most application servers nowadays supply their own classloader
implementation, the behavior might differ especially when dealing with jar files. A
simple test to check if <code>classpath*</code> works is to use the classloader to load a file from
within a jar on the classpath:
<code>getClass().getClassLoader().getResources("&lt;someFileInsideTheJar&gt;")</code>. Try this test with
files that have the same name but are placed inside two different locations. In case an
inappropriate result is returned, check the application server documentation for
settings that might affect the classloader behavior.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>classpath*:</code> prefix can also be combined with a <code>PathMatcher</code> pattern in the
rest of the location path, for example <code>classpath*:META-INF/*-beans.xml</code>. In this
case, the resolution strategy is fairly simple: a <code>ClassLoader.getResources()</code> call is
used on the last non-wildcard path segment to get all the matching resources in the
class loader hierarchy, and then off each resource the same PathMatcher resolution
strategy described above is used for the wildcard subpath.</p>
</div>
</div>
<div class="sect4">
<h5 id="resources-wildcards-in-path-other-stuff"><a class="anchor" href="core.html#resources-wildcards-in-path-other-stuff"></a>Other notes relating to wildcards</h5>
<div class="paragraph">
<p>Please note that <code>classpath*:</code> when combined with Ant-style patterns will only work
reliably with at least one root directory before the pattern starts, unless the actual
target files reside in the file system. This means that a pattern like
<code>classpath*:*.xml</code> might not retrieve files from the root of jar files but rather only
from the root of expanded directories.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s ability to retrieve classpath entries originates from the JDK&#8217;s
<code>ClassLoader.getResources()</code> method which only returns file system locations for a
passed-in empty string (indicating potential roots to search). Spring evaluates
<code>URLClassLoader</code> runtime configuration and the "java.class.path" manifest in jar files
as well but this is not guaranteed to lead to portable behavior.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The scanning of classpath packages requires the presence of corresponding directory
entries in the classpath. When you build JARs with Ant, make sure that you do <em>not</em>
activate the files-only switch of the JAR task. Also, classpath directories may not
get exposed based on security policies in some environments, e.g. standalone apps on
JDK 1.7.0_45 and higher (which requires 'Trusted-Library' setup in your manifests; see
<a href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources" class="bare">http://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources</a>).</p>
</div>
<div class="paragraph">
<p>On JDK 9&#8217;s module path (Jigsaw), Spring&#8217;s classpath scanning generally works as expected.
Putting resources into a dedicated directory is highly recommendable here as well,
avoiding the aforementioned portability problems with searching the jar file root level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ant-style patterns with <code>classpath:</code> resources are not guaranteed to find matching
resources if the root package to search is available in multiple class path locations.
This is because a resource such as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com/mycompany/package1/service-context.xml</pre>
</div>
</div>
<div class="paragraph">
<p>may be in only one location, but when a path such as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>classpath:com/mycompany/**/service-context.xml</pre>
</div>
</div>
<div class="paragraph">
<p>is used to try to resolve it, the resolver will work off the (first) URL returned by
<code>getResource("com/mycompany")</code>;. If this base package node exists in multiple
classloader locations, the actual end resource may not be underneath. Therefore,
preferably, use " `classpath*:`" with the same Ant-style pattern in such a case, which
will search all class path locations that contain the root package.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-filesystemresource-caveats"><a class="anchor" href="core.html#resources-filesystemresource-caveats"></a>2.7.3. FileSystemResource caveats</h4>
<div class="paragraph">
<p>A <code>FileSystemResource</code> that is not attached to a <code>FileSystemApplicationContext</code> (that
is, a <code>FileSystemApplicationContext</code> is not the actual <code>ResourceLoader</code>) will treat
absolute vs. relative paths as you would expect. Relative paths are relative to the
current working directory, while absolute paths are relative to the root of the
filesystem.</p>
</div>
<div class="paragraph">
<p>For backwards compatibility (historical) reasons however, this changes when the
<code>FileSystemApplicationContext</code> is the <code>ResourceLoader</code>. The
<code>FileSystemApplicationContext</code> simply forces all attached <code>FileSystemResource</code> instances
to treat all location paths as relative, whether they start with a leading slash or not.
In practice, this means the following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx =
    <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/context.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx =
    <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">/conf/context.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As are the following: (Even though it would make sense for them to be different, as one
case is relative and the other absolute.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, if true absolute filesystem paths are needed, it is better to forgo the use
of absolute paths with <code>FileSystemResource</code> / <code>FileSystemXmlApplicationContext</code>, and
just force the use of a <code>UrlResource</code>, by using the <code>file:</code> URL prefix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// actual context type doesn't matter, the Resource will always be UrlResource</span>
ctx.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///some/resource/path/myTemplate.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// force this FileSystemXmlApplicationContext to load its definition via a UrlResource</span>
ApplicationContext ctx =
    <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///conf/context.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validation"><a class="anchor" href="core.html#validation"></a>3. Validation, Data Binding, and Type Conversion</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="validation-introduction"><a class="anchor" href="core.html#validation-introduction"></a>3.1. Introduction</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">JSR-303/JSR-349 Bean Validation</div>
<div class="paragraph">
<p>Spring Framework 4.0 supports Bean Validation 1.0 (JSR-303) and Bean Validation 1.1
(JSR-349) in terms of setup support, also adapting it to Spring&#8217;s <code>Validator</code> interface.</p>
</div>
<div class="paragraph">
<p>An application can choose to enable Bean Validation once globally, as described in
<a href="core.html#validation-beanvalidation">Spring Validation</a>, and use it exclusively for all validation needs.</p>
</div>
<div class="paragraph">
<p>An application can also register additional Spring <code>Validator</code> instances per
<code>DataBinder</code> instance, as described in <a href="core.html#validation-binder">Configuring a DataBinder</a>. This may be useful for
plugging in validation logic without the use of annotations.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are pros and cons for considering validation as business logic, and Spring offers
a design for validation (and data binding) that does not exclude either one of them.
Specifically validation should not be tied to the web tier, should be easy to localize
and it should be possible to plug in any validator available. Considering the above,
Spring has come up with a <code>Validator</code> interface that is both basic and eminently usable
in every layer of an application.</p>
</div>
<div class="paragraph">
<p>Data binding is useful for allowing user input to be dynamically bound to the domain
model of an application (or whatever objects you use to process user input). Spring
provides the so-called <code>DataBinder</code> to do exactly that. The <code>Validator</code> and the
<code>DataBinder</code> make up the <code>validation</code> package, which is primarily used in but not
limited to the MVC framework.</p>
</div>
<div class="paragraph">
<p>The <code>BeanWrapper</code> is a fundamental concept in the Spring Framework and is used in a lot
of places. However, you probably will not have the need to use the <code>BeanWrapper</code>
directly. Because this is reference documentation however, we felt that some explanation
might be in order. We will explain the <code>BeanWrapper</code> in this chapter since, if you were
going to use it at all, you would most likely do so when trying to bind data to objects.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s DataBinder and the lower-level BeanWrapper both use PropertyEditors to parse
and format property values. The <code>PropertyEditor</code> concept is part of the JavaBeans
specification, and is also explained in this chapter. Spring 3 introduces a
"core.convert" package that provides a general type conversion facility, as well as a
higher-level "format" package for formatting UI field values. These new packages may be
used as simpler alternatives to PropertyEditors, and will also be discussed in this
chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="validator"><a class="anchor" href="core.html#validator"></a>3.2. Validation using Spring&#8217;s Validator interface</h3>
<div class="paragraph">
<p>Spring features a <code>Validator</code> interface that you can use to validate objects. The
<code>Validator</code> interface works using an <code>Errors</code> object so that while validating,
validators can report validation failures to the <code>Errors</code> object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider a small data object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;

    <span class="comment">// the usual getters and setters...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re going to provide validation behavior for the <code>Person</code> class by implementing the
following two methods of the <code>org.springframework.validation.Validator</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>supports(Class)</code> - Can this <code>Validator</code> validate instances of the supplied <code>Class</code>?</p>
</li>
<li>
<p><code>validate(Object, org.springframework.validation.Errors)</code> - validates the given object
and in case of validation errors, registers those with the given <code>Errors</code> object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementing a <code>Validator</code> is fairly straightforward, especially when you know of the
<code>ValidationUtils</code> helper class that the Spring Framework also provides.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {

    <span class="comment">/**
     * This Validator validates *just* Person instances
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span> clazz) {
        <span class="keyword">return</span> Person.class.equals(clazz);
    }

    <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.empty</span><span class="delimiter">&quot;</span></span>);
        Person p = (Person) obj;
        <span class="keyword">if</span> (p.getAge() &lt; <span class="integer">0</span>) {
            e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">negativevalue</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> (p.getAge() &gt; <span class="integer">110</span>) {
            e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">too.darn.old</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>static</code> <code>rejectIfEmpty(..)</code> method on the <code>ValidationUtils</code> class
is used to reject the <code>'name'</code> property if it is <code>null</code> or the empty string. Have a look
at the <code>ValidationUtils</code> javadocs to see what functionality it provides besides the
example shown previously.</p>
</div>
<div class="paragraph">
<p>While it is certainly possible to implement a single <code>Validator</code> class to validate each
of the nested objects in a rich object, it may be better to encapsulate the validation
logic for each nested class of object in its own <code>Validator</code> implementation. A simple
example of a <em>'rich'</em> object would be a <code>Customer</code> that is composed of two <code>String</code>
properties (a first and second name) and a complex <code>Address</code> object. <code>Address</code> objects
may be used independently of <code>Customer</code> objects, and so a distinct <code>AddressValidator</code>
has been implemented. If you want your <code>CustomerValidator</code> to reuse the logic contained
within the <code>AddressValidator</code> class without resorting to copy-and-paste, you can
dependency-inject or instantiate an <code>AddressValidator</code> within your <code>CustomerValidator</code>,
and use it like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Validator</span> addressValidator;

    <span class="directive">public</span> CustomerValidator(<span class="predefined-type">Validator</span> addressValidator) {
        <span class="keyword">if</span> (addressValidator == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The supplied [Validator] is </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">required and must not be null.</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="keyword">if</span> (!addressValidator.supports(Address.class)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The supplied [Validator] must </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">support the validation of [Address] instances.</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="local-variable">this</span>.addressValidator = addressValidator;
    }

    <span class="comment">/**
     * This Validator validates Customer instances, and any subclasses of Customer too
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span> clazz) {
        <span class="keyword">return</span> Customer.class.isAssignableFrom(clazz);
    }

    <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> target, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">field.required</span><span class="delimiter">&quot;</span></span>);
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">field.required</span><span class="delimiter">&quot;</span></span>);
        Customer customer = (Customer) target;
        <span class="keyword">try</span> {
            errors.pushNestedPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>);
            ValidationUtils.invokeValidator(<span class="local-variable">this</span>.addressValidator, customer.getAddress(), errors);
        } <span class="keyword">finally</span> {
            errors.popNestedPath();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Validation errors are reported to the <code>Errors</code> object passed to the validator. In case
of Spring Web MVC you can use <code>&lt;spring:bind/&gt;</code> tag to inspect the error messages, but of
course you can also inspect the errors object yourself. More information about the
methods it offers can be found in the javadocs.</p>
</div>
</div>
<div class="sect2">
<h3 id="validation-conversion"><a class="anchor" href="core.html#validation-conversion"></a>3.3. Resolving codes to error messages</h3>
<div class="paragraph">
<p>We&#8217;ve talked about databinding and validation. Outputting messages corresponding to
validation errors is the last thing we need to discuss. In the example we&#8217;ve shown
above, we rejected the <code>name</code> and the <code>age</code> field. If we&#8217;re going to output the error
messages by using a <code>MessageSource</code>, we will do so using the error code we&#8217;ve given when
rejecting the field ('name' and 'age' in this case). When you call (either directly, or
indirectly, using for example the <code>ValidationUtils</code> class) <code>rejectValue</code> or one of the
other <code>reject</code> methods from the <code>Errors</code> interface, the underlying implementation will
not only register the code you&#8217;ve passed in, but also a number of additional error
codes. What error codes it registers is determined by the <code>MessageCodesResolver</code> that is
used. By default, the <code>DefaultMessageCodesResolver</code> is used, which for example not only
registers a message with the code you gave, but also messages that include the field
name you passed to the reject method. So in case you reject a field using
<code>rejectValue("age", "too.darn.old")</code>, apart from the <code>too.darn.old</code> code, Spring will
also register <code>too.darn.old.age</code> and <code>too.darn.old.age.int</code> (so the first will include
the field name and the second will include the type of the field); this is done as a
convenience to aid developers in targeting error messages and suchlike.</p>
</div>
<div class="paragraph">
<p>More information on the <code>MessageCodesResolver</code> and the default strategy can be found
online in the javadocs of
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/validation/MessageCodesResolver.html"><code>MessageCodesResolver</code></a>
and
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html"><code>DefaultMessageCodesResolver</code></a>,
respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="beans-beans"><a class="anchor" href="core.html#beans-beans"></a>3.4. Bean manipulation and the BeanWrapper</h3>
<div class="paragraph">
<p>The <code>org.springframework.beans</code> package adheres to the JavaBeans standard provided by
Oracle. A JavaBean is simply a class with a default no-argument constructor, which follows
a naming convention where (by way of an example) a property named <code>bingoMadness</code> would
have a setter method <code>setBingoMadness(..)</code> and a getter method <code>getBingoMadness()</code>. For
more information about JavaBeans and the specification, please refer to Oracle&#8217;s website (
<a href="http://docs.oracle.com/javase/6/docs/api/java/beans/package-summary.html">javabeans</a>).</p>
</div>
<div class="paragraph">
<p>One quite important class in the beans package is the <code>BeanWrapper</code> interface and its
corresponding implementation ( <code>BeanWrapperImpl</code>). As quoted from the javadocs, the
<code>BeanWrapper</code> offers functionality to set and get property values (individually or in
bulk), get property descriptors, and to query properties to determine if they are
readable or writable. Also, the <code>BeanWrapper</code> offers support for nested properties,
enabling the setting of properties on sub-properties to an unlimited depth. Then, the
<code>BeanWrapper</code> supports the ability to add standard JavaBeans <code>PropertyChangeListeners</code>
and <code>VetoableChangeListeners</code>, without the need for supporting code in the target class.
Last but not least, the <code>BeanWrapper</code> provides support for the setting of indexed
properties. The <code>BeanWrapper</code> usually isn&#8217;t used by application code directly, but by
the <code>DataBinder</code> and the <code>BeanFactory</code>.</p>
</div>
<div class="paragraph">
<p>The way the <code>BeanWrapper</code> works is partly indicated by its name: <em>it wraps a bean</em> to
perform actions on that bean, like setting and retrieving properties.</p>
</div>
<div class="sect3">
<h4 id="beans-beans-conventions"><a class="anchor" href="core.html#beans-beans-conventions"></a>3.4.1. Setting and getting basic and nested properties</h4>
<div class="paragraph">
<p>Setting and getting properties is done using the <code>setPropertyValue(s)</code> and
<code>getPropertyValue(s)</code> methods that both come with a couple of overloaded variants.
They&#8217;re all described in more detail in the javadocs Spring comes with. What&#8217;s important
to know is that there are a couple of conventions for indicating properties of an
object. A couple of examples:</p>
</div>
<table id="beans-beans-conventions-properties-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. Examples of properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the property <code>name</code> corresponding to the methods <code>getName()</code> or <code>isName()</code>
and <code>setName(..)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the nested property <code>name</code> of the property <code>account</code> corresponding e.g. to
the methods <code>getAccount().setName()</code> or <code>getAccount().getName()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account[2]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the <em>third</em> element of the indexed property <code>account</code>. Indexed properties
can be of type <code>array</code>, <code>list</code> or other <em>naturally ordered</em> collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account[COMPANYNAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the value of the map entry indexed by the key <em>COMPANYNAME</em> of the Map
property <code>account</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below you&#8217;ll find some examples of working with the <code>BeanWrapper</code> to get and set
properties.</p>
</div>
<div class="paragraph">
<p><em>(This next section is not vitally important to you if you&#8217;re not planning to work with
the <code>BeanWrapper</code> directly. If you&#8217;re just using the <code>DataBinder</code> and the <code>BeanFactory</code>
and their out-of-the-box implementation, you should skip ahead to the section about
<code>PropertyEditors</code>.)</em></p>
</div>
<div class="paragraph">
<p>Consider the following two classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Company</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> Employee managingDirector;

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> Employee getManagingDirector() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.managingDirector;
    }

    <span class="directive">public</span> <span class="type">void</span> setManagingDirector(Employee managingDirector) {
        <span class="local-variable">this</span>.managingDirector = managingDirector;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">private</span> <span class="type">float</span> salary;

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="type">float</span> getSalary() {
        <span class="keyword">return</span> salary;
    }

    <span class="directive">public</span> <span class="type">void</span> setSalary(<span class="type">float</span> salary) {
        <span class="local-variable">this</span>.salary = salary;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippets show some examples of how to retrieve and manipulate some of
the properties of instantiated <code>Companies</code> and <code>Employees</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BeanWrapper company = <span class="keyword">new</span> BeanWrapperImpl(<span class="keyword">new</span> Company());
<span class="comment">// setting the company name..</span>
company.setPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Some Company Inc.</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// ... can also be done like this:</span>
PropertyValue value = <span class="keyword">new</span> PropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Some Company Inc.</span><span class="delimiter">&quot;</span></span>);
company.setPropertyValue(value);

<span class="comment">// ok, let's create the director and tie it to the company:</span>
BeanWrapper jim = <span class="keyword">new</span> BeanWrapperImpl(<span class="keyword">new</span> Employee());
jim.setPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Jim Stravinsky</span><span class="delimiter">&quot;</span></span>);
company.setPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">managingDirector</span><span class="delimiter">&quot;</span></span>, jim.getWrappedInstance());

<span class="comment">// retrieving the salary of the managingDirector through the company</span>
<span class="predefined-type">Float</span> salary = (<span class="predefined-type">Float</span>) company.getPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">managingDirector.salary</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="beans-beans-conversion"><a class="anchor" href="core.html#beans-beans-conversion"></a>3.4.2. Built-in PropertyEditor implementations</h4>
<div class="paragraph">
<p>Spring uses the concept of <code>PropertyEditors</code> to effect the conversion between an
<code>Object</code> and a <code>String</code>. If you think about it, it sometimes might be handy to be able
to represent properties in a different way than the object itself. For example, a <code>Date</code>
can be represented in a human readable way (as the <code>String</code> <code>'2007-14-09'</code>), while
we&#8217;re still able to convert the human readable form back to the original date (or even
better: convert any date entered in a human readable form, back to <code>Date</code> objects). This
behavior can be achieved by <em>registering custom editors</em>, of type
<code>java.beans.PropertyEditor</code>. Registering custom editors on a <code>BeanWrapper</code> or
alternately in a specific IoC container as mentioned in the previous chapter, gives it
the knowledge of how to convert properties to the desired type. Read more about
<code>PropertyEditors</code> in the javadocs of the <code>java.beans</code> package provided by Oracle.</p>
</div>
<div class="paragraph">
<p>A couple of examples where property editing is used in Spring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>setting properties on beans</em> is done using <code>PropertyEditors</code>. When mentioning
<code>java.lang.String</code> as the value of a property of some bean you&#8217;re declaring in XML
file, Spring will (if the setter of the corresponding property has a
<code>Class</code>-parameter) use the <code>ClassEditor</code> to try to resolve the parameter to a <code>Class</code>
object.</p>
</li>
<li>
<p><em>parsing HTTP request parameters</em> in Spring&#8217;s MVC framework is done using all kinds
of <code>PropertyEditors</code> that you can manually bind in all subclasses of the
<code>CommandController</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring has a number of built-in <code>PropertyEditors</code> to make life easy. Each of those is
listed below and they are all located in the <code>org.springframework.beans.propertyeditors</code>
package. Most, but not all (as indicated below), are registered by default by
<code>BeanWrapperImpl</code>. Where the property editor is configurable in some fashion, you can of
course still register your own variant to override the default one:</p>
</div>
<table id="beans-beans-property-editors-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Built-in PropertyEditors</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ByteArrayPropertyEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Editor for byte arrays. Strings will simply be converted to their corresponding byte
representations. Registered by default by <code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses Strings representing classes to actual classes and the other way around. When a
class is not found, an <code>IllegalArgumentException</code> is thrown. Registered by default by
<code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CustomBooleanEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customizable property editor for <code>Boolean</code> properties. Registered by default by
<code>BeanWrapperImpl</code>, but, can be overridden by registering custom instance of it as
custom editor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CustomCollectionEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property editor for Collections, converting any source <code>Collection</code> to a given target
<code>Collection</code> type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CustomDateEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customizable property editor for java.util.Date, supporting a custom DateFormat. NOT
registered by default. Must be user registered as needed with appropriate format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CustomNumberEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customizable property editor for any Number subclass like <code>Integer</code>, <code>Long</code>, <code>Float</code>,
<code>Double</code>. Registered by default by <code>BeanWrapperImpl</code>, but can be overridden by
registering custom instance of it as a custom editor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FileEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capable of resolving Strings to <code>java.io.File</code> objects. Registered by default by
<code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InputStreamEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One-way property editor, capable of taking a text string and producing (via an
intermediate <code>ResourceEditor</code> and <code>Resource</code>) an <code>InputStream</code>, so <code>InputStream</code>
properties may be directly set as Strings. Note that the default usage will not close
the <code>InputStream</code> for you! Registered by default by <code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LocaleEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capable of resolving Strings to <code>Locale</code> objects and vice versa (the String format is
<em class="language">[country]</em>[variant], which is the same thing the toString() method of
Locale provides). Registered by default by <code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PatternEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capable of resolving Strings to <code>java.util.regex.Pattern</code> objects and vice versa.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PropertiesEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capable of converting Strings (formatted using the format as defined in the javadocs
of the <code>java.util.Properties</code> class) to <code>Properties</code> objects. Registered by default
by <code>BeanWrapperImpl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StringTrimmerEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property editor that trims Strings. Optionally allows transforming an empty string
into a <code>null</code> value. NOT registered by default; must be user registered as needed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>URLEditor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capable of resolving a String representation of a URL to an actual <code>URL</code> object.
Registered by default by <code>BeanWrapperImpl</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Spring uses the <code>java.beans.PropertyEditorManager</code> to set the search path for property
editors that might be needed. The search path also includes <code>sun.bean.editors</code>, which
includes <code>PropertyEditor</code> implementations for types such as <code>Font</code>, <code>Color</code>, and most of
the primitive types. Note also that the standard JavaBeans infrastructure will
automatically discover <code>PropertyEditor</code> classes (without you having to register them
explicitly) if they are in the same package as the class they handle, and have the same
name as that class, with <code>'Editor'</code> appended; for example, one could have the following
class and package structure, which would be sufficient for the <code>FooEditor</code> class to be
recognized and used as the <code>PropertyEditor</code> for <code>Foo</code>-typed properties.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com
  chank
    pop
      Foo
      FooEditor // the PropertyEditor for the Foo class</pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also use the standard <code>BeanInfo</code> JavaBeans mechanism here as well
(described
<a href="http://docs.oracle.com/javase/tutorial/javabeans/advanced/customization.html">in
not-amazing-detail here</a>). Find below an example of using the <code>BeanInfo</code> mechanism for
explicitly registering one or more <code>PropertyEditor</code> instances with the properties of an
associated class.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com
  chank
    pop
      Foo
      FooBeanInfo // the BeanInfo for the Foo class</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the Java source code for the referenced <code>FooBeanInfo</code> class. This would
associate a <code>CustomNumberEditor</code> with the <code>age</code> property of the <code>Foo</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FooBeanInfo</span> <span class="directive">extends</span> <span class="predefined-type">SimpleBeanInfo</span> {

    <span class="directive">public</span> <span class="predefined-type">PropertyDescriptor</span><span class="type">[]</span> getPropertyDescriptors() {
        <span class="keyword">try</span> {
            <span class="directive">final</span> <span class="predefined-type">PropertyEditor</span> numberPE = <span class="keyword">new</span> CustomNumberEditor(<span class="predefined-type">Integer</span>.class, <span class="predefined-constant">true</span>);
            <span class="predefined-type">PropertyDescriptor</span> ageDescriptor = <span class="keyword">new</span> <span class="predefined-type">PropertyDescriptor</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, Foo.class) {
                <span class="directive">public</span> <span class="predefined-type">PropertyEditor</span> createPropertyEditor(<span class="predefined-type">Object</span> bean) {
                    <span class="keyword">return</span> numberPE;
                };
            };
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">PropertyDescriptor</span><span class="type">[]</span> { ageDescriptor };
        }
        <span class="keyword">catch</span> (<span class="exception">IntrospectionException</span> ex) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">Error</span>(ex.toString());
        }
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="beans-beans-conversion-customeditor-registration"><a class="anchor" href="core.html#beans-beans-conversion-customeditor-registration"></a>Registering additional custom PropertyEditors</h5>
<div class="paragraph">
<p>When setting bean properties as a string value, a Spring IoC container ultimately uses
standard JavaBeans <code>PropertyEditors</code> to convert these Strings to the complex type of the
property. Spring pre-registers a number of custom <code>PropertyEditors</code> (for example, to
convert a classname expressed as a string into a real <code>Class</code> object). Additionally,
Java&#8217;s standard JavaBeans <code>PropertyEditor</code> lookup mechanism allows a <code>PropertyEditor</code>
for a class simply to be named appropriately and placed in the same package as the class
it provides support for, to be found automatically.</p>
</div>
<div class="paragraph">
<p>If there is a need to register other custom <code>PropertyEditors</code>, there are several
mechanisms available. The most manual approach, which is not normally convenient or
recommended, is to simply use the <code>registerCustomEditor()</code> method of the
<code>ConfigurableBeanFactory</code> interface, assuming you have a <code>BeanFactory</code> reference.
Another, slightly more convenient, mechanism is to use a special bean factory
post-processor called <code>CustomEditorConfigurer</code>. Although bean factory post-processors
can be used with <code>BeanFactory</code> implementations, the <code>CustomEditorConfigurer</code> has a
nested property setup, so it is strongly recommended that it is used with the
<code>ApplicationContext</code>, where it may be deployed in similar fashion to any other bean, and
automatically detected and applied.</p>
</div>
<div class="paragraph">
<p>Note that all bean factories and application contexts automatically use a number of
built-in property editors, through their use of something called a <code>BeanWrapper</code> to
handle property conversions. The standard property editors that the <code>BeanWrapper</code>
registers are listed in <a href="core.html#beans-beans-conversion">the previous section</a>. Additionally,
<code>ApplicationContexts</code> also override or add an additional number of editors to handle
resource lookups in a manner appropriate to the specific application context type.</p>
</div>
<div class="paragraph">
<p>Standard JavaBeans <code>PropertyEditor</code> instances are used to convert property values
expressed as strings to the actual complex type of the property.
<code>CustomEditorConfigurer</code>, a bean factory post-processor, may be used to conveniently add
support for additional <code>PropertyEditor</code> instances to an <code>ApplicationContext</code>.</p>
</div>
<div class="paragraph">
<p>Consider a user class <code>ExoticType</code>, and another class <code>DependsOnExoticType</code> which needs
<code>ExoticType</code> set as a property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExoticType</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> ExoticType(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">DependsOnExoticType</span> {

    <span class="directive">private</span> ExoticType type;

    <span class="directive">public</span> <span class="type">void</span> setType(ExoticType type) {
        <span class="local-variable">this</span>.type = type;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When things are properly set up, we want to be able to assign the type property as a
string, which a <code>PropertyEditor</code> will behind the scenes convert into an actual
<code>ExoticType</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.DependsOnExoticType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aNameForExoticType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PropertyEditor</code> implementation could look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// converts string representation to ExoticType object</span>
<span class="keyword">package</span> <span class="namespace">example</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExoticTypeEditor</span> <span class="directive">extends</span> <span class="predefined-type">PropertyEditorSupport</span> {

    <span class="directive">public</span> <span class="type">void</span> setAsText(<span class="predefined-type">String</span> text) {
        setValue(<span class="keyword">new</span> ExoticType(text.toUpperCase()));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we use <code>CustomEditorConfigurer</code> to register the new <code>PropertyEditor</code> with the
<code>ApplicationContext</code>, which will then be able to use it as needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.CustomEditorConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customEditors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.ExoticType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.ExoticTypeEditor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="beans-beans-conversion-customeditor-registration-per"><a class="anchor" href="core.html#beans-beans-conversion-customeditor-registration-per"></a>Using PropertyEditorRegistrars</h6>
<div class="paragraph">
<p>Another mechanism for registering property editors with the Spring container is to
create and use a <code>PropertyEditorRegistrar</code>. This interface is particularly useful when
you need to use the same set of property editors in several different situations: write
a corresponding registrar and reuse that in each case. <code>PropertyEditorRegistrars</code> work
in conjunction with an interface called <code>PropertyEditorRegistry</code>, an interface that is
implemented by the Spring <code>BeanWrapper</code> (and <code>DataBinder</code>). <code>PropertyEditorRegistrars</code>
are particularly convenient when used in conjunction with the <code>CustomEditorConfigurer</code>
(introduced <a href="core.html#beans-beans-conversion-customeditor-registration">here</a>), which exposes a
property called <code>setPropertyEditorRegistrars(..)</code>: <code>PropertyEditorRegistrars</code> added to a
<code>CustomEditorConfigurer</code> in this fashion can easily be shared with <code>DataBinder</code> and
Spring MVC <code>Controllers</code>. Furthermore, it avoids the need for synchronization on custom
editors: a <code>PropertyEditorRegistrar</code> is expected to create fresh <code>PropertyEditor</code>
instances for each bean creation attempt.</p>
</div>
<div class="paragraph">
<p>Using a <code>PropertyEditorRegistrar</code> is perhaps best illustrated with an example. First
off, you need to create your own <code>PropertyEditorRegistrar</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo.editors.spring</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">CustomPropertyEditorRegistrar</span> <span class="directive">implements</span> PropertyEditorRegistrar {

    <span class="directive">public</span> <span class="type">void</span> registerCustomEditors(PropertyEditorRegistry registry) {

        <span class="comment">// it is expected that new PropertyEditor instances are created</span>
        registry.registerCustomEditor(ExoticType.class, <span class="keyword">new</span> ExoticTypeEditor());

        <span class="comment">// you could register as many custom property editors as are required here...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the <code>org.springframework.beans.support.ResourceEditorRegistrar</code> for an example
<code>PropertyEditorRegistrar</code> implementation. Notice how in its implementation of the
<code>registerCustomEditors(..)</code> method it creates new instances of each property editor.</p>
</div>
<div class="paragraph">
<p>Next we configure a <code>CustomEditorConfigurer</code> and inject an instance of our
<code>CustomPropertyEditorRegistrar</code> into it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.CustomEditorConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyEditorRegistrars</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customPropertyEditorRegistrar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customPropertyEditorRegistrar</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.editors.spring.CustomPropertyEditorRegistrar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, and in a bit of a departure from the focus of this chapter, for those of you
using <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">Spring&#8217;s MVC web framework</a>, using <code>PropertyEditorRegistrars</code> in
conjunction with data-binding <code>Controllers</code> (such as <code>SimpleFormController</code>) can be very
convenient. Find below an example of using a <code>PropertyEditorRegistrar</code> in the
implementation of an <code>initBinder(..)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">RegisterUserController</span> <span class="directive">extends</span> SimpleFormController {

    <span class="directive">private</span> <span class="directive">final</span> PropertyEditorRegistrar customPropertyEditorRegistrar;

    <span class="directive">public</span> RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
        <span class="local-variable">this</span>.customPropertyEditorRegistrar = propertyEditorRegistrar;
    }

    <span class="directive">protected</span> <span class="type">void</span> initBinder(HttpServletRequest request,
            ServletRequestDataBinder binder) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <strong><span class="local-variable">this</span>.customPropertyEditorRegistrar.registerCustomEditors(binder);</strong>
    }

    <span class="comment">// other methods to do with registering a User</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This style of <code>PropertyEditor</code> registration can lead to concise code (the implementation
of <code>initBinder(..)</code> is just one line long!), and allows common <code>PropertyEditor</code>
registration code to be encapsulated in a class and then shared amongst as many
<code>Controllers</code> as needed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core-convert"><a class="anchor" href="core.html#core-convert"></a>3.5. Spring Type Conversion</h3>
<div class="paragraph">
<p>Spring 3 introduces a <code>core.convert</code> package that provides a general type conversion
system. The system defines an SPI to implement type conversion logic, as well as an API
to execute type conversions at runtime. Within a Spring container, this system can be
used as an alternative to PropertyEditors to convert externalized bean property value
strings to required property types. The public API may also be used anywhere in your
application where type conversion is needed.</p>
</div>
<div class="sect3">
<h4 id="core-convert-Converter-API"><a class="anchor" href="core.html#core-convert-Converter-API"></a>3.5.1. Converter SPI</h4>
<div class="paragraph">
<p>The SPI to implement type conversion logic is simple and strongly typed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert.converter</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Converter</span>&lt;S, T&gt; {

    T convert(S source);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create your own converter, simply implement the interface above. Parameterize <code>S</code>
as the type you are converting from, and <code>T</code> as the type you are converting to. Such a
converter can also be applied transparently if a collection or array of <code>S</code> needs to be
converted to an array or collection of <code>T</code>, provided that a delegating array/collection
converter has been registered as well (which <code>DefaultConversionService</code> does by default).</p>
</div>
<div class="paragraph">
<p>For each call to <code>convert(S)</code>, the source argument is guaranteed to be NOT null. Your
Converter may throw any unchecked exception if conversion fails; specifically, an
<code>IllegalArgumentException</code> should be thrown to report an invalid source value.
Take care to ensure that your <code>Converter</code> implementation is thread-safe.</p>
</div>
<div class="paragraph">
<p>Several converter implementations are provided in the <code>core.convert.support</code> package as
a convenience. These include converters from Strings to Numbers and other common types.
Consider <code>StringToInteger</code> as an example for a typical <code>Converter</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert.support</span>;

<span class="directive">final</span> <span class="type">class</span> <span class="class">StringToInteger</span> <span class="directive">implements</span> Converter&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; {

    <span class="directive">public</span> <span class="predefined-type">Integer</span> convert(<span class="predefined-type">String</span> source) {
        <span class="keyword">return</span> <span class="predefined-type">Integer</span>.valueOf(source);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core-convert-ConverterFactory-SPI"><a class="anchor" href="core.html#core-convert-ConverterFactory-SPI"></a>3.5.2. ConverterFactory</h4>
<div class="paragraph">
<p>When you need to centralize the conversion logic for an entire class hierarchy, for
example, when converting from String to java.lang.Enum objects, implement
<code>ConverterFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert.converter</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">ConverterFactory</span>&lt;S, R&gt; {

    &lt;T <span class="directive">extends</span> R&gt; Converter&lt;S, T&gt; getConverter(<span class="predefined-type">Class</span>&lt;T&gt; targetType);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameterize S to be the type you are converting from and R to be the base type defining
the <em>range</em> of classes you can convert to. Then implement getConverter(Class&lt;T&gt;),
where T is a subclass of R.</p>
</div>
<div class="paragraph">
<p>Consider the <code>StringToEnum</code> ConverterFactory as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert.support</span>;

<span class="directive">final</span> <span class="type">class</span> <span class="class">StringToEnumConverterFactory</span> <span class="directive">implements</span> ConverterFactory&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Enum</span>&gt; {

    <span class="directive">public</span> &lt;T <span class="directive">extends</span> <span class="predefined-type">Enum</span>&gt; Converter&lt;<span class="predefined-type">String</span>, T&gt; getConverter(<span class="predefined-type">Class</span>&lt;T&gt; targetType) {
        <span class="keyword">return</span> <span class="keyword">new</span> StringToEnumConverter(targetType);
    }

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">StringToEnumConverter</span>&lt;T <span class="directive">extends</span> <span class="predefined-type">Enum</span>&gt; <span class="directive">implements</span> Converter&lt;<span class="predefined-type">String</span>, T&gt; {

        <span class="directive">private</span> <span class="predefined-type">Class</span>&lt;T&gt; enumType;

        <span class="directive">public</span> StringToEnumConverter(<span class="predefined-type">Class</span>&lt;T&gt; enumType) {
            <span class="local-variable">this</span>.enumType = enumType;
        }

        <span class="directive">public</span> T convert(<span class="predefined-type">String</span> source) {
            <span class="keyword">return</span> (T) <span class="predefined-type">Enum</span>.valueOf(<span class="local-variable">this</span>.enumType, source.trim());
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core-convert-GenericConverter-SPI"><a class="anchor" href="core.html#core-convert-GenericConverter-SPI"></a>3.5.3. GenericConverter</h4>
<div class="paragraph">
<p>When you require a sophisticated Converter implementation, consider the GenericConverter
interface. With a more flexible but less strongly typed signature, a GenericConverter
supports converting between multiple source and target types. In addition, a
GenericConverter makes available source and target field context you can use when
implementing your conversion logic. Such context allows a type conversion to be driven
by a field annotation, or generic information declared on a field signature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert.converter</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">GenericConverter</span> {

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ConvertiblePair&gt; getConvertibleTypes();

    <span class="predefined-type">Object</span> convert(<span class="predefined-type">Object</span> source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To implement a GenericConverter, have getConvertibleTypes() return the supported
source&#8594;target type pairs. Then implement convert(Object, TypeDescriptor,
TypeDescriptor) to implement your conversion logic. The source TypeDescriptor provides
access to the source field holding the value being converted. The target TypeDescriptor
provides access to the target field where the converted value will be set.</p>
</div>
<div class="paragraph">
<p>A good example of a GenericConverter is a converter that converts between a Java Array
and a Collection. Such an ArrayToCollectionConverter introspects the field that declares
the target Collection type to resolve the Collection&#8217;s element type. This allows each
element in the source array to be converted to the Collection element type before the
Collection is set on the target field.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because GenericConverter is a more complex SPI interface, only use it when you need it.
Favor Converter or ConverterFactory for basic type conversion needs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="core-convert-ConditionalGenericConverter-SPI"><a class="anchor" href="core.html#core-convert-ConditionalGenericConverter-SPI"></a>ConditionalGenericConverter</h5>
<div class="paragraph">
<p>Sometimes you only want a <code>Converter</code> to execute if a specific condition holds true. For
example, you might only want to execute a <code>Converter</code> if a specific annotation is present
on the target field. Or you might only want to execute a <code>Converter</code> if a specific method,
such as a <code>static valueOf</code> method, is defined on the target class.
<code>ConditionalGenericConverter</code> is the union of the <code>GenericConverter</code> and
<code>ConditionalConverter</code> interfaces that allows you to define such custom matching criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ConditionalConverter</span> {

    <span class="type">boolean</span> matches(TypeDescriptor sourceType, TypeDescriptor targetType);

}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">ConditionalGenericConverter</span>
    <span class="directive">extends</span> GenericConverter, ConditionalConverter {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A good example of a <code>ConditionalGenericConverter</code> is an EntityConverter that converts
between an persistent entity identifier and an entity reference. Such a EntityConverter
might only match if the target entity type declares a static finder method e.g.
<code>findAccount(Long)</code>. You would perform such a finder method check in the implementation of
<code>matches(TypeDescriptor, TypeDescriptor)</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core-convert-ConversionService-API"><a class="anchor" href="core.html#core-convert-ConversionService-API"></a>3.5.4. ConversionService API</h4>
<div class="paragraph">
<p>The ConversionService defines a unified API for executing type conversion logic at
runtime. Converters are often executed behind this facade interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.core.convert</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">ConversionService</span> {

    <span class="type">boolean</span> canConvert(<span class="predefined-type">Class</span>&lt;?&gt; sourceType, <span class="predefined-type">Class</span>&lt;?&gt; targetType);

    &lt;T&gt; T convert(<span class="predefined-type">Object</span> source, <span class="predefined-type">Class</span>&lt;T&gt; targetType);

    <span class="type">boolean</span> canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);

    <span class="predefined-type">Object</span> convert(<span class="predefined-type">Object</span> source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most ConversionService implementations also implement <code>ConverterRegistry</code>, which
provides an SPI for registering converters. Internally, a ConversionService
implementation delegates to its registered converters to carry out type conversion logic.</p>
</div>
<div class="paragraph">
<p>A robust ConversionService implementation is provided in the <code>core.convert.support</code>
package. <code>GenericConversionService</code> is the general-purpose implementation suitable for
use in most environments. <code>ConversionServiceFactory</code> provides a convenient factory for
creating common ConversionService configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="core-convert-Spring-config"><a class="anchor" href="core.html#core-convert-Spring-config"></a>3.5.5. Configuring a ConversionService</h4>
<div class="paragraph">
<p>A ConversionService is a stateless object designed to be instantiated at application
startup, then shared between multiple threads. In a Spring application, you typically
configure a ConversionService instance per Spring container (or ApplicationContext).
That ConversionService will be picked up by Spring and then used whenever a type
conversion needs to be performed by the framework. You may also inject this
ConversionService into any of your beans and invoke it directly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If no ConversionService is registered with Spring, the original PropertyEditor-based
system is used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To register a default ConversionService with Spring, add the following bean definition
with id <code>conversionService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">conversionService</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ConversionServiceFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A default ConversionService can convert between strings, numbers, enums, collections,
maps, and other common types. To supplement or override the default converters with your
own custom converter(s), set the <code>converters</code> property. Property values may implement
either of the Converter, ConverterFactory, or GenericConverter interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">conversionService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ConversionServiceFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.MyCustomConverter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also common to use a ConversionService within a Spring MVC application. See
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion">Conversion and Formatting</a> in the Spring MVC chapter.</p>
</div>
<div class="paragraph">
<p>In certain situations you may wish to apply formatting during conversion. See
<a href="core.html#format-FormatterRegistry-SPI">FormatterRegistry SPI</a> for details on using
<code>FormattingConversionServiceFactoryBean</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="core-convert-programmatic-usage"><a class="anchor" href="core.html#core-convert-programmatic-usage"></a>3.5.6. Using a ConversionService programmatically</h4>
<div class="paragraph">
<p>To work with a ConversionService instance programmatically, simply inject a reference to
it like you would for any other bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> MyService(ConversionService conversionService) {
        <span class="local-variable">this</span>.conversionService = conversionService;
    }

    <span class="directive">public</span> <span class="type">void</span> doIt() {
        <span class="local-variable">this</span>.conversionService.convert(...)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For most use cases, the <code>convert</code> method specifying the <em>targetType</em> can be used but it
will not work with more complex types such as a collection of a parameterized element.
If you want to convert a <code>List</code> of <code>Integer</code> to a <code>List</code> of <code>String</code> programmatically,
for instance, you need to provide a formal definition of the source and target types.</p>
</div>
<div class="paragraph">
<p>Fortunately, <code>TypeDescriptor</code> provides various options to make that straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DefaultConversionService cs = <span class="keyword">new</span> DefaultConversionService();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; input = ....
cs.convert(input,
    TypeDescriptor.forObject(input), <span class="comment">// List&lt;Integer&gt; type descriptor</span>
    TypeDescriptor.collection(<span class="predefined-type">List</span>.class, TypeDescriptor.valueOf(<span class="predefined-type">String</span>.class)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>DefaultConversionService</code> registers converters automatically which are
appropriate for most environments. This includes collection converters, scalar
converters, and also basic <code>Object</code> to <code>String</code> converters. The same converters can
be registered with any <code>ConverterRegistry</code> using the <em>static</em> <code>addDefaultConverters</code>
method on the <code>DefaultConversionService</code> class.</p>
</div>
<div class="paragraph">
<p>Converters for value types will be reused for arrays and collections, so there is
no need to create a specific converter to convert from a <code>Collection</code> of <code>S</code> to a
<code>Collection</code> of <code>T</code>, assuming that standard collection handling is appropriate.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="format"><a class="anchor" href="core.html#format"></a>3.6. Spring Field Formatting</h3>
<div class="paragraph">
<p>As discussed in the previous section, <a href="core.html#core-convert"><code>core.convert</code></a> is a
general-purpose type conversion system. It provides a unified ConversionService API as
well as a strongly-typed Converter SPI for implementing conversion logic from one type
to another. A Spring Container uses this system to bind bean property values. In
addition, both the Spring Expression Language (SpEL) and DataBinder use this system to
bind field values. For example, when SpEL needs to coerce a <code>Short</code> to a <code>Long</code> to
complete an <code>expression.setValue(Object bean, Object value)</code> attempt, the core.convert
system performs the coercion.</p>
</div>
<div class="paragraph">
<p>Now consider the type conversion requirements of a typical client environment such as a
web or desktop application. In such environments, you typically convert <em>from String</em>
to support the client postback process, as well as back <em>to String</em> to support the
view rendering process. In addition, you often need to localize String values. The more
general <em>core.convert</em> Converter SPI does not address such <em>formatting</em> requirements
directly. To directly address them, Spring 3 introduces a convenient Formatter SPI that
provides a simple and robust alternative to PropertyEditors for client environments.</p>
</div>
<div class="paragraph">
<p>In general, use the Converter SPI when you need to implement general-purpose type
conversion logic; for example, for converting between a java.util.Date and and
java.lang.Long. Use the Formatter SPI when you&#8217;re working in a client environment, such
as a web application, and need to parse and print localized field values. The
ConversionService provides a unified type conversion API for both SPIs.</p>
</div>
<div class="sect3">
<h4 id="format-Formatter-SPI"><a class="anchor" href="core.html#format-Formatter-SPI"></a>3.6.1. Formatter SPI</h4>
<div class="paragraph">
<p>The Formatter SPI to implement field formatting logic is simple and strongly typed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.format</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Formatter</span>&lt;T&gt; <span class="directive">extends</span> Printer&lt;T&gt;, <span class="predefined-type">Parser</span>&lt;T&gt; {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where Formatter extends from the Printer and Parser building-block interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Printer</span>&lt;T&gt; {
    <span class="predefined-type">String</span> print(T fieldValue, <span class="predefined-type">Locale</span> locale);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.text.ParseException</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Parser</span>&lt;T&gt; {
    T parse(<span class="predefined-type">String</span> clientValue, <span class="predefined-type">Locale</span> locale) <span class="directive">throws</span> <span class="exception">ParseException</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create your own Formatter, simply implement the Formatter interface above.
Parameterize T to be the type of object you wish to format, for example,
<code>java.util.Date</code>. Implement the <code>print()</code> operation to print an instance of T for
display in the client locale. Implement the <code>parse()</code> operation to parse an instance of
T from the formatted representation returned from the client locale. Your Formatter
should throw a ParseException or IllegalArgumentException if a parse attempt fails. Take
care to ensure your Formatter implementation is thread-safe.</p>
</div>
<div class="paragraph">
<p>Several Formatter implementations are provided in <code>format</code> subpackages as a convenience.
The <code>number</code> package provides a <code>NumberFormatter</code>, <code>CurrencyFormatter</code>, and
<code>PercentFormatter</code> to format <code>java.lang.Number</code> objects using a <code>java.text.NumberFormat</code>.
The <code>datetime</code> package provides a <code>DateFormatter</code> to format <code>java.util.Date</code> objects with
a <code>java.text.DateFormat</code>. The <code>datetime.joda</code> package provides comprehensive datetime
formatting support based on the <a href="http://joda-time.sourceforge.net">Joda Time library</a>.</p>
</div>
<div class="paragraph">
<p>Consider <code>DateFormatter</code> as an example <code>Formatter</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.format.datetime</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">DateFormatter</span> <span class="directive">implements</span> <span class="predefined-type">Formatter</span>&lt;<span class="predefined-type">Date</span>&gt; {

    <span class="directive">private</span> <span class="predefined-type">String</span> pattern;

    <span class="directive">public</span> <span class="predefined-type">DateFormatter</span>(<span class="predefined-type">String</span> pattern) {
        <span class="local-variable">this</span>.pattern = pattern;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> print(<span class="predefined-type">Date</span> date, <span class="predefined-type">Locale</span> locale) {
        <span class="keyword">if</span> (date == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">return</span> getDateFormat(locale).format(date);
    }

    <span class="directive">public</span> <span class="predefined-type">Date</span> parse(<span class="predefined-type">String</span> formatted, <span class="predefined-type">Locale</span> locale) <span class="directive">throws</span> <span class="exception">ParseException</span> {
        <span class="keyword">if</span> (formatted.length() == <span class="integer">0</span>) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
        <span class="keyword">return</span> getDateFormat(locale).parse(formatted);
    }

    <span class="directive">protected</span> <span class="predefined-type">DateFormat</span> getDateFormat(<span class="predefined-type">Locale</span> locale) {
        <span class="predefined-type">DateFormat</span> dateFormat = <span class="keyword">new</span> <span class="predefined-type">SimpleDateFormat</span>(<span class="local-variable">this</span>.pattern, locale);
        dateFormat.setLenient(<span class="predefined-constant">false</span>);
        <span class="keyword">return</span> dateFormat;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring team welcomes community-driven <code>Formatter</code> contributions; see
<a href="https://jira.spring.io/browse/SPR">jira.spring.io</a> to contribute.</p>
</div>
</div>
<div class="sect3">
<h4 id="format-CustomFormatAnnotations"><a class="anchor" href="core.html#format-CustomFormatAnnotations"></a>3.6.2. Annotation-driven Formatting</h4>
<div class="paragraph">
<p>As you will see, field formatting can be configured by field type or annotation. To bind
an Annotation to a formatter, implement AnnotationFormatterFactory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.format</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">AnnotationFormatterFactory</span>&lt;A <span class="directive">extends</span> <span class="predefined-type">Annotation</span>&gt; {

    <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getFieldTypes();

    Printer&lt;?&gt; getPrinter(A annotation, <span class="predefined-type">Class</span>&lt;?&gt; fieldType);

    <span class="predefined-type">Parser</span>&lt;?&gt; getParser(A annotation, <span class="predefined-type">Class</span>&lt;?&gt; fieldType);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameterize A to be the field annotationType you wish to associate formatting logic
with, for example <code>org.springframework.format.annotation.DateTimeFormat</code>. Have
<code>getFieldTypes()</code> return the types of fields the annotation may be used on. Have
<code>getPrinter()</code> return a Printer to print the value of an annotated field. Have
<code>getParser()</code> return a Parser to parse a clientValue for an annotated field.</p>
</div>
<div class="paragraph">
<p>The example AnnotationFormatterFactory implementation below binds the @NumberFormat
Annotation to a formatter. This annotation allows either a number style or pattern to be
specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">NumberFormatAnnotationFormatterFactory</span>
        <span class="directive">implements</span> AnnotationFormatterFactory&lt;<span class="predefined-type">NumberFormat</span>&gt; {

    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getFieldTypes() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt;(asList(<span class="keyword">new</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> {
            <span class="predefined-type">Short</span>.class, <span class="predefined-type">Integer</span>.class, <span class="predefined-type">Long</span>.class, <span class="predefined-type">Float</span>.class,
            <span class="predefined-type">Double</span>.class, <span class="predefined-type">BigDecimal</span>.class, <span class="predefined-type">BigInteger</span>.class }));
    }

    <span class="directive">public</span> Printer&lt;<span class="predefined-type">Number</span>&gt; getPrinter(<span class="predefined-type">NumberFormat</span> annotation, <span class="predefined-type">Class</span>&lt;?&gt; fieldType) {
        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="directive">public</span> <span class="predefined-type">Parser</span>&lt;<span class="predefined-type">Number</span>&gt; getParser(<span class="predefined-type">NumberFormat</span> annotation, <span class="predefined-type">Class</span>&lt;?&gt; fieldType) {
        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="directive">private</span> <span class="predefined-type">Formatter</span>&lt;<span class="predefined-type">Number</span>&gt; configureFormatterFrom(<span class="predefined-type">NumberFormat</span> annotation,
            <span class="predefined-type">Class</span>&lt;?&gt; fieldType) {
        <span class="keyword">if</span> (!annotation.pattern().isEmpty()) {
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">NumberFormatter</span>(annotation.pattern());
        } <span class="keyword">else</span> {
            <span class="predefined-type">Style</span> style = annotation.style();
            <span class="keyword">if</span> (style == <span class="predefined-type">Style</span>.PERCENT) {
                <span class="keyword">return</span> <span class="keyword">new</span> PercentFormatter();
            } <span class="keyword">else</span> <span class="keyword">if</span> (style == <span class="predefined-type">Style</span>.CURRENCY) {
                <span class="keyword">return</span> <span class="keyword">new</span> CurrencyFormatter();
            } <span class="keyword">else</span> {
                <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">NumberFormatter</span>();
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To trigger formatting, simply annotate fields with @NumberFormat:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModel</span> {

    <span class="annotation">@NumberFormat</span>(style=<span class="predefined-type">Style</span>.CURRENCY)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> decimal;

}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="format-annotations-api"><a class="anchor" href="core.html#format-annotations-api"></a>Format Annotation API</h5>
<div class="paragraph">
<p>A portable format annotation API exists in the <code>org.springframework.format.annotation</code>
package. Use @NumberFormat to format java.lang.Number fields. Use @DateTimeFormat to
format java.util.Date, java.util.Calendar, java.util.Long, or Joda Time fields.</p>
</div>
<div class="paragraph">
<p>The example below uses @DateTimeFormat to format a java.util.Date as a ISO Date
(yyyy-MM-dd):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyModel</span> {

    <span class="annotation">@DateTimeFormat</span>(iso=ISO.DATE)
    <span class="directive">private</span> <span class="predefined-type">Date</span> date;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="format-FormatterRegistry-SPI"><a class="anchor" href="core.html#format-FormatterRegistry-SPI"></a>3.6.3. FormatterRegistry SPI</h4>
<div class="paragraph">
<p>The FormatterRegistry is an SPI for registering formatters and converters.
<code>FormattingConversionService</code> is an implementation of FormatterRegistry suitable for
most environments. This implementation may be configured programmatically or
declaratively as a Spring bean using <code>FormattingConversionServiceFactoryBean</code>. Because
this implementation also implements <code>ConversionService</code>, it can be directly configured
for use with Spring&#8217;s DataBinder and the Spring Expression Language (SpEL).</p>
</div>
<div class="paragraph">
<p>Review the FormatterRegistry SPI below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.format</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">FormatterRegistry</span> <span class="directive">extends</span> ConverterRegistry {

    <span class="type">void</span> addFormatterForFieldType(<span class="predefined-type">Class</span>&lt;?&gt; fieldType, Printer&lt;?&gt; printer, <span class="predefined-type">Parser</span>&lt;?&gt; parser);

    <span class="type">void</span> addFormatterForFieldType(<span class="predefined-type">Class</span>&lt;?&gt; fieldType, <span class="predefined-type">Formatter</span>&lt;?&gt; formatter);

    <span class="type">void</span> addFormatterForFieldType(<span class="predefined-type">Formatter</span>&lt;?&gt; formatter);

    <span class="type">void</span> addFormatterForAnnotation(AnnotationFormatterFactory&lt;?, ?&gt; factory);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, Formatters can be registered by fieldType or annotation.</p>
</div>
<div class="paragraph">
<p>The FormatterRegistry SPI allows you to configure Formatting rules centrally, instead of
duplicating such configuration across your Controllers. For example, you might want to
enforce that all Date fields are formatted a certain way, or fields with a specific
annotation are formatted in a certain way. With a shared FormatterRegistry, you define
these rules once and they are applied whenever formatting is needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="format-FormatterRegistrar-SPI"><a class="anchor" href="core.html#format-FormatterRegistrar-SPI"></a>3.6.4. FormatterRegistrar SPI</h4>
<div class="paragraph">
<p>The FormatterRegistrar is an SPI for registering formatters and converters through the
FormatterRegistry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.format</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">FormatterRegistrar</span> {

    <span class="type">void</span> registerFormatters(FormatterRegistry registry);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A FormatterRegistrar is useful when registering multiple related converters and
formatters for a given formatting category, such as Date formatting. It can also be
useful where declarative registration is insufficient. For example when a formatter
needs to be indexed under a specific field type different from its own &lt;T&gt; or when
registering a Printer/Parser pair. The next section provides more information on
converter and formatter registration.</p>
</div>
</div>
<div class="sect3">
<h4 id="format-configuring-formatting-mvc"><a class="anchor" href="core.html#format-configuring-formatting-mvc"></a>3.6.5. Configuring Formatting in Spring MVC</h4>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion">Conversion and Formatting</a> in the Spring MVC chapter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="format-configuring-formatting-globaldatetimeformat"><a class="anchor" href="core.html#format-configuring-formatting-globaldatetimeformat"></a>3.7. Configuring a global date &amp; time format</h3>
<div class="paragraph">
<p>By default, date and time fields that are not annotated with <code>@DateTimeFormat</code> are
converted from strings using the <code>DateFormat.SHORT</code> style. If you prefer, you can
change this by defining your own global format.</p>
</div>
<div class="paragraph">
<p>You will need to ensure that Spring does not register default formatters, and instead
you should register all formatters manually. Use the
<code>org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar</code> or
<code>org.springframework.format.datetime.DateFormatterRegistrar</code> class depending on whether
you use the Joda Time library.</p>
</div>
<div class="paragraph">
<p>For example, the following Java configuration will register a global ' `yyyyMMdd&#8217;
format. This example does not depend on the Joda Time library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> FormattingConversionService conversionService() {

        <span class="comment">// Use the DefaultFormattingConversionService but do not register defaults</span>
        DefaultFormattingConversionService conversionService = <span class="keyword">new</span> DefaultFormattingConversionService(<span class="predefined-constant">false</span>);

        <span class="comment">// Ensure @NumberFormat is still supported</span>
        conversionService.addFormatterForFieldAnnotation(<span class="keyword">new</span> NumberFormatAnnotationFormatterFactory());

        <span class="comment">// Register date conversion with a specific global format</span>
        DateFormatterRegistrar registrar = <span class="keyword">new</span> DateFormatterRegistrar();
        registrar.setFormatter(<span class="keyword">new</span> <span class="predefined-type">DateFormatter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyyMMdd</span><span class="delimiter">&quot;</span></span>));
        registrar.registerFormatters(conversionService);

        <span class="keyword">return</span> conversionService;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer XML based configuration you can use a
<code>FormattingConversionServiceFactoryBean</code>. Here is the same example, this time using Joda
Time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><span class="error">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">conversionService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.format.support.FormattingConversionServiceFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">registerDefaultFormatters</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">formatters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;set&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.format.number.NumberFormatAnnotationFormatterFactory</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/set&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">formatterRegistrars</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;set&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateFormatter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.format.datetime.joda.DateTimeFormatterFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pattern</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyyMMdd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/bean&gt;</span>
                    <span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/set&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Joda Time provides separate distinct types to represent <code>date</code>, <code>time</code> and <code>date-time</code>
values. The <code>dateFormatter</code>, <code>timeFormatter</code> and <code>dateTimeFormatter</code> properties of the
<code>JodaTimeFormatterRegistrar</code> should be used to configure the different formats for each
type. The <code>DateTimeFormatterFactoryBean</code> provides a convenient way to create formatters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Spring MVC remember to explicitly configure the conversion service that
is used. For Java based <code>@Configuration</code> this means extending the
<code>WebMvcConfigurationSupport</code> class and overriding the <code>mvcConversionService()</code> method.
For XML you should use the <code>'conversion-service'</code> attribute of the
<code>mvc:annotation-driven</code> element.
See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion">Conversion and Formatting</a> for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="validation-beanvalidation"><a class="anchor" href="core.html#validation-beanvalidation"></a>3.8. Spring Validation</h3>
<div class="paragraph">
<p>Spring 3 introduces several enhancements to its validation support. First, the JSR-303
Bean Validation API is now fully supported. Second, when used programmatically, Spring&#8217;s
DataBinder can now validate objects as well as bind to them. Third, Spring MVC now has
support for declaratively validating <code>@Controller</code> inputs.</p>
</div>
<div class="sect3">
<h4 id="validation-beanvalidation-overview"><a class="anchor" href="core.html#validation-beanvalidation-overview"></a>3.8.1. Overview of the JSR-303 Bean Validation API</h4>
<div class="paragraph">
<p>JSR-303 standardizes validation constraint declaration and metadata for the Java
platform. Using this API, you annotate domain model properties with declarative
validation constraints and the runtime enforces them. There are a number of built-in
constraints you can take advantage of. You may also define your own custom constraints.</p>
</div>
<div class="paragraph">
<p>To illustrate, consider a simple PersonForm model with two properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonForm</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSR-303 allows you to define declarative validation constraints against such properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonForm</span> {

    <span class="annotation">@NotNull</span>
    <span class="annotation">@Size</span>(max=<span class="integer">64</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@Min</span>(<span class="integer">0</span>)
    <span class="directive">private</span> <span class="type">int</span> age;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an instance of this class is validated by a JSR-303 Validator, these constraints
will be enforced.</p>
</div>
<div class="paragraph">
<p>For general information on JSR-303/JSR-349, see the <a href="http://beanvalidation.org/">Bean
Validation website</a>. For information on the specific capabilities of the default
reference implementation, see the <a href="https://www.hibernate.org/412.html">Hibernate
Validator</a> documentation. To learn how to setup a Bean Validation provider as a Spring
bean, keep reading.</p>
</div>
</div>
<div class="sect3">
<h4 id="validation-beanvalidation-spring"><a class="anchor" href="core.html#validation-beanvalidation-spring"></a>3.8.2. Configuring a Bean Validation Provider</h4>
<div class="paragraph">
<p>Spring provides full support for the Bean Validation API. This includes convenient
support for bootstrapping a JSR-303/JSR-349 Bean Validation provider as a Spring bean.
This allows for a <code>javax.validation.ValidatorFactory</code> or <code>javax.validation.Validator</code> to
be injected wherever validation is needed in your application.</p>
</div>
<div class="paragraph">
<p>Use the <code>LocalValidatorFactoryBean</code> to configure a default Validator as a Spring bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.validation.beanvalidation.LocalValidatorFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic configuration above will trigger Bean Validation to initialize using its
default bootstrap mechanism. A JSR-303/JSR-349 provider, such as Hibernate Validator,
is expected to be present in the classpath and will be detected automatically.</p>
</div>
<div class="sect4">
<h5 id="validation-beanvalidation-spring-inject"><a class="anchor" href="core.html#validation-beanvalidation-spring-inject"></a>Injecting a Validator</h5>
<div class="paragraph">
<p><code>LocalValidatorFactoryBean</code> implements both <code>javax.validation.ValidatorFactory</code> and
<code>javax.validation.Validator</code>, as well as Spring&#8217;s
<code>org.springframework.validation.Validator</code>. You may inject a reference to either of
these interfaces into beans that need to invoke validation logic.</p>
</div>
<div class="paragraph">
<p>Inject a reference to <code>javax.validation.Validator</code> if you prefer to work with the Bean
Validation API directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.validation.Validator</span>;

<span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="predefined-type">Validator</span> validator;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inject a reference to <code>org.springframework.validation.Validator</code> if your bean requires
the Spring Validation API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.validation.Validator</span>;

<span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="predefined-type">Validator</span> validator;

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validation-beanvalidation-spring-constraints"><a class="anchor" href="core.html#validation-beanvalidation-spring-constraints"></a>Configuring Custom Constraints</h5>
<div class="paragraph">
<p>Each Bean Validation constraint consists of two parts. First, a <code>@Constraint</code> annotation
that declares the constraint and its configurable properties. Second, an implementation
of the <code>javax.validation.ConstraintValidator</code> interface that implements the constraint&#8217;s
behavior. To associate a declaration with an implementation, each <code>@Constraint</code> annotation
references a corresponding ValidationConstraint implementation class. At runtime, a
<code>ConstraintValidatorFactory</code> instantiates the referenced implementation when the
constraint annotation is encountered in your domain model.</p>
</div>
<div class="paragraph">
<p>By default, the <code>LocalValidatorFactoryBean</code> configures a <code>SpringConstraintValidatorFactory</code>
that uses Spring to create ConstraintValidator instances. This allows your custom
ConstraintValidators to benefit from dependency injection like any other Spring bean.</p>
</div>
<div class="paragraph">
<p>Shown below is an example of a custom <code>@Constraint</code> declaration, followed by an associated
<code>ConstraintValidator</code> implementation that uses Spring for dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.FIELD})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy=MyConstraintValidator.class)
<span class="directive">public</span> <span class="annotation">@interface</span> MyConstraint {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.validation.ConstraintValidator</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyConstraintValidator</span> <span class="directive">implements</span> ConstraintValidator {

    <span class="annotation">@Autowired</span>;
    <span class="directive">private</span> Foo aDependency;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, a ConstraintValidator implementation may have its dependencies
@Autowired like any other Spring bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="validation-beanvalidation-spring-method"><a class="anchor" href="core.html#validation-beanvalidation-spring-method"></a>Spring-driven Method Validation</h5>
<div class="paragraph">
<p>The method validation feature supported by Bean Validation 1.1, and as a custom
extension also by Hibernate Validator 4.3, can be integrated into a Spring context
through a <code>MethodValidationPostProcessor</code> bean definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.validation.beanvalidation.MethodValidationPostProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to be eligible for Spring-driven method validation, all target classes need
to be annotated with Spring&#8217;s <code>@Validated</code> annotation, optionally declaring the
validation groups to use. Check out the <code>MethodValidationPostProcessor</code> javadocs
for setup details with Hibernate Validator and Bean Validation 1.1 providers.</p>
</div>
</div>
<div class="sect4">
<h5 id="validation-beanvalidation-spring-other"><a class="anchor" href="core.html#validation-beanvalidation-spring-other"></a>Additional Configuration Options</h5>
<div class="paragraph">
<p>The default <code>LocalValidatorFactoryBean</code> configuration should prove sufficient for most
cases. There are a number of configuration options for various Bean Validation
constructs, from message interpolation to traversal resolution. See the
<code>LocalValidatorFactoryBean</code> javadocs for more information on these options.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validation-binder"><a class="anchor" href="core.html#validation-binder"></a>3.8.3. Configuring a DataBinder</h4>
<div class="paragraph">
<p>Since Spring 3, a DataBinder instance can be configured with a Validator. Once
configured, the Validator may be invoked by calling <code>binder.validate()</code>. Any validation
Errors are automatically added to the binder&#8217;s BindingResult.</p>
</div>
<div class="paragraph">
<p>When working with the DataBinder programmatically, this can be used to invoke validation
logic after binding to a target object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Foo target = <span class="keyword">new</span> Foo();
DataBinder binder = <span class="keyword">new</span> DataBinder(target);
binder.setValidator(<span class="keyword">new</span> FooValidator());

<span class="comment">// bind to the target object</span>
binder.bind(propertyValues);

<span class="comment">// validate the target object</span>
binder.validate();

<span class="comment">// get BindingResult that includes any validation errors</span>
BindingResult results = binder.getBindingResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>A DataBinder can also be configured with multiple <code>Validator</code> instances via
<code>dataBinder.addValidators</code> and <code>dataBinder.replaceValidators</code>. This is useful when
combining globally configured Bean Validation with a Spring <code>Validator</code> configured
locally on a DataBinder instance. See <a href="core.html#validation-mvc-configuring">[validation-mvc-configuring]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="validation-mvc"><a class="anchor" href="core.html#validation-mvc"></a>3.8.4. Spring MVC 3 Validation</h4>
<div class="paragraph">
<p>See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-validation">Validation</a> in the Spring MVC chapter.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expressions"><a class="anchor" href="core.html#expressions"></a>4. Spring Expression Language (SpEL)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="expressions-intro"><a class="anchor" href="core.html#expressions-intro"></a>4.1. Introduction</h3>
<div class="paragraph">
<p>The Spring Expression Language (SpEL for short) is a powerful expression language that
supports querying and manipulating an object graph at runtime. The language syntax is
similar to Unified EL but offers additional features, most notably method invocation and
basic string templating functionality.</p>
</div>
<div class="paragraph">
<p>While there are several other Java expression languages available, OGNL, MVEL, and JBoss
EL, to name a few, the Spring Expression Language was created to provide the Spring
community with a single well supported expression language that can be used across all
the products in the Spring portfolio. Its language features are driven by the
requirements of the projects in the Spring portfolio, including tooling requirements for
code completion support within the eclipse based Spring Tool Suite. That said,
SpEL is based on a technology agnostic API allowing other expression language
implementations to be integrated should the need arise.</p>
</div>
<div class="paragraph">
<p>While SpEL serves as the foundation for expression evaluation within the Spring
portfolio, it is not directly tied to Spring and can be used independently. In order to
be self contained, many of the examples in this chapter use SpEL as if it were an
independent expression language. This requires creating a few bootstrapping
infrastructure classes such as the parser. Most Spring users will not need to deal with
this infrastructure and will instead only author expression strings for evaluation. An
example of this typical use is the integration of SpEL into creating XML or annotated
based bean definitions as shown in the section <a href="core.html#expressions-beandef">Expression support
for defining bean definitions.</a></p>
</div>
<div class="paragraph">
<p>This chapter covers the features of the expression language, its API, and its language
syntax. In several places an Inventor and Inventor&#8217;s Society class are used as the
target objects for expression evaluation. These class declarations and the data used to
populate them are listed at the end of the chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="expressions-features"><a class="anchor" href="core.html#expressions-features"></a>4.2. Feature overview</h3>
<div class="paragraph">
<p>The expression language supports the following functionality</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literal expressions</p>
</li>
<li>
<p>Boolean and relational operators</p>
</li>
<li>
<p>Regular expressions</p>
</li>
<li>
<p>Class expressions</p>
</li>
<li>
<p>Accessing properties, arrays, lists, maps</p>
</li>
<li>
<p>Method invocation</p>
</li>
<li>
<p>Relational operators</p>
</li>
<li>
<p>Assignment</p>
</li>
<li>
<p>Calling constructors</p>
</li>
<li>
<p>Bean references</p>
</li>
<li>
<p>Array construction</p>
</li>
<li>
<p>Inline lists</p>
</li>
<li>
<p>Inline maps</p>
</li>
<li>
<p>Ternary operator</p>
</li>
<li>
<p>Variables</p>
</li>
<li>
<p>User defined functions</p>
</li>
<li>
<p>Collection projection</p>
</li>
<li>
<p>Collection selection</p>
</li>
<li>
<p>Templated expressions</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="expressions-evaluation"><a class="anchor" href="core.html#expressions-evaluation"></a>4.3. Expression evaluation using Spring&#8217;s Expression interface</h3>
<div class="paragraph">
<p>This section introduces the simple use of SpEL interfaces and its expression language.
The complete language reference can be found in the section
<a href="core.html#expressions-language-ref">Language Reference</a>.</p>
</div>
<div class="paragraph">
<p>The following code introduces the SpEL API to evaluate the literal string expression
'Hello World'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>'Hello World'</strong></span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> message = (<span class="predefined-type">String</span>) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the message variable is simply 'Hello World'.</p>
</div>
<div class="paragraph">
<p>The SpEL classes and interfaces you are most likely to use are located in the packages
<code>org.springframework.expression</code> and its sub packages and <code>spel.support</code>.</p>
</div>
<div class="paragraph">
<p>The interface <code>ExpressionParser</code> is responsible for parsing an expression string. In
this example the expression string is a string literal denoted by the surrounding single
quotes. The interface <code>Expression</code> is responsible for evaluating the previously defined
expression string. There are two exceptions that can be thrown, <code>ParseException</code> and
<code>EvaluationException</code> when calling <code>parser.parseExpression</code> and <code>exp.getValue</code>
respectively.</p>
</div>
<div class="paragraph">
<p>SpEL supports a wide range of features, such as calling methods, accessing properties,
and calling constructors.</p>
</div>
<div class="paragraph">
<p>As an example of method invocation, we call the <code>concat</code> method on the string literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>'Hello World'.concat('!')</strong></span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> message = (<span class="predefined-type">String</span>) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of message is now 'Hello World!'.</p>
</div>
<div class="paragraph">
<p>As an example of calling a JavaBean property, the String property <code>Bytes</code> can be called
as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

<span class="comment">// invokes 'getBytes()'</span>
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>'Hello World'.bytes</strong></span><span class="delimiter">&quot;</span></span>);
<span class="type">byte</span><span class="type">[]</span> bytes = (<span class="type">byte</span><span class="type">[]</span>) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>SpEL also supports nested properties using standard <em>dot</em> notation, i.e.
prop1.prop2.prop3 and the setting of property values</p>
</div>
<div class="paragraph">
<p>Public fields may also be accessed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

<span class="comment">// invokes 'getBytes().length'</span>
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>'Hello World'.bytes.length</strong></span><span class="delimiter">&quot;</span></span>);
<span class="type">int</span> length = (<span class="predefined-type">Integer</span>) exp.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The String&#8217;s constructor can be called instead of using a string literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>new String('hello world').toUpperCase()</strong></span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> message = exp.getValue(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the generic method <code>public &lt;T&gt; T getValue(Class&lt;T&gt; desiredResultType)</code>.
Using this method removes the need to cast the value of the expression to the desired
result type. An <code>EvaluationException</code> will be thrown if the value cannot be cast to the
type <code>T</code> or converted using the registered type converter.</p>
</div>
<div class="paragraph">
<p>The more common usage of SpEL is to provide an expression string that is evaluated
against a specific object instance (called the root object). There are two options here
and which to choose depends on whether the object against which the expression is being
evaluated will be changing with each call to evaluate the expression. In the following
example we retrieve the <code>name</code> property from an instance of the Inventor class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create and set a calendar</span>
<span class="predefined-type">GregorianCalendar</span> c = <span class="keyword">new</span> <span class="predefined-type">GregorianCalendar</span>();
c.set(<span class="integer">1856</span>, <span class="integer">7</span>, <span class="integer">9</span>);

<span class="comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>, c.getTime(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Serbian</span><span class="delimiter">&quot;</span></span>);

ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>name</strong></span><span class="delimiter">&quot;</span></span>);

EvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext(tesla);
<span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) exp.getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last line, the value of the string variable <code>name</code> will be set to "Nikola Tesla".
The class StandardEvaluationContext is where you can specify which object the "name"
property will be evaluated against. This is the mechanism to use if the root object is
unlikely to change, it can simply be set once in the evaluation context. If the root
object is likely to change repeatedly, it can be supplied on each call to <code>getValue</code>, as
this next example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">/ Create and set a calendar
<span class="predefined-type">GregorianCalendar</span> c = <span class="keyword">new</span> <span class="predefined-type">GregorianCalendar</span>();
c.set(<span class="integer">1856</span>, <span class="integer">7</span>, <span class="integer">9</span>);

<span class="comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>, c.getTime(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Serbian</span><span class="delimiter">&quot;</span></span>);

ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
<span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>name</strong></span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) exp.getValue(tesla);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the inventor <code>tesla</code> has been supplied directly to <code>getValue</code> and the
expression evaluation infrastructure creates and manages a default evaluation context
internally - it did not require one to be supplied.</p>
</div>
<div class="paragraph">
<p>The StandardEvaluationContext is relatively expensive to construct and during repeated
usage it builds up cached state that enables subsequent expression evaluations to be
performed more quickly. For this reason it is better to cache and reuse them where
possible, rather than construct a new one for each expression evaluation.</p>
</div>
<div class="paragraph">
<p>In some cases it can be desirable to use a configured evaluation context and yet still
supply a different root object on each call to <code>getValue</code>. <code>getValue</code> allows both to be
specified on the same call. In these situations the root object passed on the call is
considered to override any (which maybe null) specified on the evaluation context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In standalone usage of SpEL there is a need to create the parser, parse expressions and
perhaps provide evaluation contexts and a root context object. However, more common
usage is to provide only the SpEL expression string as part of a configuration file, for
example for Spring bean or Spring Web Flow definitions. In this case, the parser,
evaluation context, root object and any predefined variables are all set up implicitly,
requiring the user to specify nothing other than the expressions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a final introductory example, the use of a boolean operator is shown using the
Inventor object in the previous example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Expression</span> exp = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">name == 'Nikola Tesla'</span><span class="delimiter">&quot;</span></span>);
<span class="type">boolean</span> result = exp.getValue(context, <span class="predefined-type">Boolean</span>.class); <span class="comment">// evaluates to true</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="expressions-evaluation-context"><a class="anchor" href="core.html#expressions-evaluation-context"></a>4.3.1. The EvaluationContext interface</h4>
<div class="paragraph">
<p>The interface <code>EvaluationContext</code> is used when evaluating an expression to resolve
properties, methods, fields, and to help perform type conversion. The out-of-the-box
implementation, <code>StandardEvaluationContext</code>, uses reflection to manipulate the object,
caching <code>java.lang.reflect.Method</code>, <code>java.lang.reflect.Field</code>, and
<code>java.lang.reflect.Constructor</code> instances for increased performance.</p>
</div>
<div class="paragraph">
<p>The <code>StandardEvaluationContext</code> is where you may specify the root object to evaluate
against via the method <code>setRootObject()</code> or passing the root object into the
constructor. You can also specify variables and functions that will be used in the
expression using the methods <code>setVariable()</code> and <code>registerFunction()</code>. The use of
variables and functions are described in the language reference sections
<a href="core.html#expressions-ref-variables">Variables</a> and <a href="core.html#expressions-ref-functions">Functions</a>. The
<code>StandardEvaluationContext</code> is also where you can register custom
<code>ConstructorResolver</code>s, <code>MethodResolver</code>s, and <code>PropertyAccessor</code>s to extend how SpEL
evaluates expressions. Please refer to the javadoc of these classes for more details.</p>
</div>
<div class="sect4">
<h5 id="expressions-type-conversion"><a class="anchor" href="core.html#expressions-type-conversion"></a>Type conversion</h5>
<div class="paragraph">
<p>By default SpEL uses the conversion service available in Spring core (
<code>org.springframework.core.convert.ConversionService</code>). This conversion service comes
with many converters built in for common conversions but is also fully extensible so
custom conversions between types can be added. Additionally it has the key capability
that it is generics aware. This means that when working with generic types in
expressions, SpEL will attempt conversions to maintain type correctness for any objects
it encounters.</p>
</div>
<div class="paragraph">
<p>What does this mean in practice? Suppose assignment, using <code>setValue()</code>, is being used
to set a <code>List</code> property. The type of the property is actually <code>List&lt;Boolean&gt;</code>. SpEL
will recognize that the elements of the list need to be converted to <code>Boolean</code> before
being placed in it. A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Simple</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Boolean</span>&gt; booleanList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Boolean</span>&gt;();
}

Simple simple = <span class="keyword">new</span> Simple();

simple.booleanList.add(<span class="predefined-constant">true</span>);

StandardEvaluationContext simpleContext = <span class="keyword">new</span> StandardEvaluationContext(simple);

<span class="comment">// false is passed in here as a string. SpEL and the conversion service will</span>
<span class="comment">// correctly recognize that it needs to be a Boolean and convert it</span>
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">booleanList[0]</span><span class="delimiter">&quot;</span></span>).setValue(simpleContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// b will be false</span>
<span class="predefined-type">Boolean</span> b = simple.booleanList.get(<span class="integer">0</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-parser-configuration"><a class="anchor" href="core.html#expressions-parser-configuration"></a>4.3.2. Parser configuration</h4>
<div class="paragraph">
<p>It is possible to configure the SpEL expression parser using a parser configuration object
(<code>org.springframework.expression.spel.SpelParserConfiguration</code>). The configuration
object controls the behavior of some of the expression components. For example, if
indexing into an array or collection and the element at the specified index is <code>null</code>
it is possible to automatically create the element. This is useful when using expressions made up of a
chain of property references. If indexing into an array or list
and specifying an index that is beyond the end of the current size of the array or
list it is possible to automatically grow the array or list to accommodate that index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Demo</span> {
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; list;
}

<span class="comment">// Turn on:</span>
<span class="comment">// - auto null reference initialization</span>
<span class="comment">// - auto collection growing</span>
SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(<span class="predefined-constant">true</span>,<span class="predefined-constant">true</span>);

ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);

<span class="predefined-type">Expression</span> expression = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">list[3]</span><span class="delimiter">&quot;</span></span>);

Demo demo = <span class="keyword">new</span> Demo();

<span class="predefined-type">Object</span> o = expression.getValue(demo);

<span class="comment">// demo.list will now be a real collection of 4 entries</span>
<span class="comment">// Each entry is a new empty String</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to configure the behaviour of the SpEL expression compiler.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-spel-compilation"><a class="anchor" href="core.html#expressions-spel-compilation"></a>4.3.3. SpEL compilation</h4>
<div class="paragraph">
<p>Spring Framework 4.1 includes a basic expression compiler. Expressions are usually
interpreted which provides a lot of dynamic flexibility during evaluation but
does not provide the optimum performance. For occasional expression usage
this is fine, but when used by other components like Spring Integration,
performance can be very important and there is no real need for the dynamism.</p>
</div>
<div class="paragraph">
<p>The new SpEL compiler is intended to address this need. The
compiler will generate a real Java class on the fly during evaluation that embodies the
expression behavior and use that to achieve much faster expression
evaluation. Due to the lack of typing around expressions the compiler
uses information gathered during the interpreted evaluations of an
expression when performing compilation. For example, it does not know the type
of a property reference purely from the expression but during the first
interpreted evaluation it will find out what it is. Of course, basing the
compilation on this information could cause trouble later if the types of
the various expression elements change over time. For this reason compilation
is best suited to expressions whose type information is not going to change
on repeated evaluations.</p>
</div>
<div class="paragraph">
<p>For a basic expression like this:</p>
</div>
<div class="paragraph">
<p><code>someArray[0].someProperty.someOtherProperty &lt; 0.1</code></p>
</div>
<div class="paragraph">
<p>which involves array access, some property derefencing and numeric operations, the performance
gain can be very noticeable. In an example micro benchmark run of 50000 iterations, it was
taking 75ms to evaluate using only the interpreter and just 3ms using the compiled version
of the expression.</p>
</div>
<div class="sect4">
<h5 id="expressions-compiler-configuration"><a class="anchor" href="core.html#expressions-compiler-configuration"></a>Compiler configuration</h5>
<div class="paragraph">
<p>The compiler is not turned on by default, but there are two ways to turn
it on. It can be turned on using the parser configuration process discussed earlier or
via a system property when SpEL usage is embedded inside another component. This section
discusses both of these options.</p>
</div>
<div class="paragraph">
<p>It is important to understand that there are a few modes the compiler can operate in, captured
in an enum (<code>org.springframework.expression.spel.SpelCompilerMode</code>). The modes are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OFF</code> - The compiler is switched off; this is the default.</p>
</li>
<li>
<p><code>IMMEDIATE</code> - In immediate mode the expressions are compiled as soon as possible. This
is typically after the first interpreted evaluation. If the compiled expression fails
(typically due to a type changing, as described above) then the caller of the expression
evaluation will receive an exception.</p>
</li>
<li>
<p><code>MIXED</code> - In mixed mode the expressions silently switch between interpreted and compiled
mode over time. After some number of interpreted runs they will switch to compiled
form and if something goes wrong with the compiled form (like a type changing, as
described above) then the expression will automatically switch back to interpreted form
again. Sometime later it may generate another compiled form and switch to it. Basically
the exception that the user gets in <code>IMMEDIATE</code> mode is instead handled internally.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>IMMEDIATE</code> mode exists because <code>MIXED</code> mode could cause issues for expressions that
have side effects. If a compiled expression blows up after partially succeeding it
may have already done something that has affected the state of the system. If this
has happened the caller may not want it to silently re-run in interpreted mode
since part of the expression may be running twice.</p>
</div>
<div class="paragraph">
<p>After selecting a mode, use the <code>SpelParserConfiguration</code> to configure the parser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(SpelCompilerMode.IMMEDIATE,
    <span class="local-variable">this</span>.getClass().getClassLoader());

SpelExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);

<span class="predefined-type">Expression</span> expr = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">payload</span><span class="delimiter">&quot;</span></span>);

MyMessage message = <span class="keyword">new</span> MyMessage();

<span class="predefined-type">Object</span> payload = expr.getValue(message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When specifying the compiler mode it is also possible to specify a classloader (passing null is allowed).
Compiled expressions will be defined in a child classloader created under any that is supplied.
It is important to ensure if a classloader is specified it can see all the types involved in
the expression evaluation process.
If none is specified then a default classloader will be used (typically the context classloader for
the thread that is running during expression evaluation).</p>
</div>
<div class="paragraph">
<p>The second way to configure the compiler is for use when SpEL is embedded inside some other
component and it may not be possible to configure via a configuration object.
In these cases it is possible to use a system property. The property
<code>spring.expression.compiler.mode</code> can be set to one of the <code>SpelCompilerMode</code>
enum values (<code>off</code>, <code>immediate</code>, or <code>mixed</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="expressions-compiler-limitations"><a class="anchor" href="core.html#expressions-compiler-limitations"></a>Compiler limitations</h5>
<div class="paragraph">
<p>With Spring Framework 4.1 the basic compilation framework is in place. However, the framework does not
yet support compiling every kind of expression. The initial focus has been on the common expressions that are
likely to be used in performance critical contexts. These kinds of expression cannot be compiled
at the moment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>expressions involving assignment</p>
</li>
<li>
<p>expressions relying on the conversion service</p>
</li>
<li>
<p>expressions using custom resolvers or accessors</p>
</li>
<li>
<p>expressions using selection or projection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More and more types of expression will be compilable in the future.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expressions-beandef"><a class="anchor" href="core.html#expressions-beandef"></a>4.4. Expression support for defining bean definitions</h3>
<div class="paragraph">
<p>SpEL expressions can be used with XML or annotation-based configuration metadata for
defining <code>BeanDefinition</code>s. In both cases the syntax to define the expression is of the
form <code>#{ &lt;expression string&gt; }</code>.</p>
</div>
<div class="sect3">
<h4 id="expressions-beandef-xml-based"><a class="anchor" href="core.html#expressions-beandef-xml-based"></a>4.4.1. XML based configuration</h4>
<div class="paragraph">
<p>A property or constructor-arg value can be set using expressions as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">numberGuess</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spring.samples.NumberGuess</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomNumber</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ T(java.lang.Math).random() * 100.0 }</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- other properties --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable <code>systemProperties</code> is predefined, so you can use it in your expressions as
shown below. Note that you do not have to prefix the predefined variable with the <code>#</code>
symbol in this context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taxCalculator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spring.samples.TaxCalculator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ systemProperties['user.region'] }</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- other properties --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also refer to other bean properties by name, for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">numberGuess</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spring.samples.NumberGuess</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomNumber</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ T(java.lang.Math).random() * 100.0 }</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- other properties --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shapeGuess</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spring.samples.ShapeGuess</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialShapeSeed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ numberGuess.randomNumber }</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- other properties --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-beandef-annotation-based"><a class="anchor" href="core.html#expressions-beandef-annotation-based"></a>4.4.2. Annotation-based configuration</h4>
<div class="paragraph">
<p>The <code>@Value</code> annotation can be placed on fields, methods and method/constructor
parameters to specify a default value.</p>
</div>
<div class="paragraph">
<p>Here is an example to set the default value of a field variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">FieldValueTestBean</span>

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ systemProperties['user.region'] }</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> defaultLocale;

    <span class="directive">public</span> <span class="type">void</span> setDefaultLocale(<span class="predefined-type">String</span> defaultLocale) {
        <span class="local-variable">this</span>.defaultLocale = defaultLocale;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getDefaultLocale() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.defaultLocale;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent but on a property setter method is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PropertyValueTestBean</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> defaultLocale;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ systemProperties['user.region'] }</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setDefaultLocale(<span class="predefined-type">String</span> defaultLocale) {
        <span class="local-variable">this</span>.defaultLocale = defaultLocale;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getDefaultLocale() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.defaultLocale;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Autowired methods and constructors can also use the <code>@Value</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMovieLister</span> {

    <span class="directive">private</span> MovieFinder movieFinder;
    <span class="directive">private</span> <span class="predefined-type">String</span> defaultLocale;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> configure(MovieFinder movieFinder,
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ systemProperties['user.region'] }</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> defaultLocale) {
        <span class="local-variable">this</span>.movieFinder = movieFinder;
        <span class="local-variable">this</span>.defaultLocale = defaultLocale;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MovieRecommender</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> defaultLocale;

    <span class="directive">private</span> CustomerPreferenceDao customerPreferenceDao;

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao,
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['user.country']}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> defaultLocale) {
        <span class="local-variable">this</span>.customerPreferenceDao = customerPreferenceDao;
        <span class="local-variable">this</span>.defaultLocale = defaultLocale;
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expressions-language-ref"><a class="anchor" href="core.html#expressions-language-ref"></a>4.5. Language Reference</h3>
<div class="sect3">
<h4 id="expressions-ref-literal"><a class="anchor" href="core.html#expressions-ref-literal"></a>4.5.1. Literal expressions</h4>
<div class="paragraph">
<p>The types of literal expressions supported are strings, numeric values (int, real, hex),
boolean and null. Strings are delimited by single quotes. To put a single quote itself
in a string, use two single quote characters.</p>
</div>
<div class="paragraph">
<p>The following listing shows simple usage of literals. Typically they would not be used
in isolation like this but rather as part of a more complex expression, for example
using a literal on one side of a logical comparison operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

<span class="comment">// evals to &quot;Hello World&quot;</span>
<span class="predefined-type">String</span> helloWorld = (<span class="predefined-type">String</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'Hello World'</span><span class="delimiter">&quot;</span></span>).getValue();

<span class="type">double</span> avogadrosNumber = (<span class="predefined-type">Double</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">6.0221415E+23</span><span class="delimiter">&quot;</span></span>).getValue();

<span class="comment">// evals to 2147483647</span>
<span class="type">int</span> maxValue = (<span class="predefined-type">Integer</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">0x7FFFFFFF</span><span class="delimiter">&quot;</span></span>).getValue();

<span class="type">boolean</span> trueValue = (<span class="predefined-type">Boolean</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>).getValue();

<span class="predefined-type">Object</span> nullValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">null</span><span class="delimiter">&quot;</span></span>).getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Numbers support the use of the negative sign, exponential notation, and decimal points.
By default real numbers are parsed using Double.parseDouble().</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-properties-arrays"><a class="anchor" href="core.html#expressions-properties-arrays"></a>4.5.2. Properties, Arrays, Lists, Maps, Indexers</h4>
<div class="paragraph">
<p>Navigating with property references is easy: just use a period to indicate a nested
property value. The instances of the <code>Inventor</code> class, pupin, and tesla, were populated with
data listed in the section <a href="core.html#expressions-example-classes">Classes used in the examples</a>.
To navigate "down" and get Tesla&#8217;s year of birth and Pupin&#8217;s city of birth the following
expressions are used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// evals to 1856</span>
<span class="type">int</span> year = (<span class="predefined-type">Integer</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Birthdate.Year + 1900</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="predefined-type">String</span> city = (<span class="predefined-type">String</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">placeOfBirth.City</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Case insensitivity is allowed for the first letter of property names. The contents of
arrays and lists are obtained using square bracket notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

<span class="comment">// Inventions Array</span>
StandardEvaluationContext teslaContext = <span class="keyword">new</span> StandardEvaluationContext(tesla);

<span class="comment">// evaluates to &quot;Induction motor&quot;</span>
<span class="predefined-type">String</span> invention = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">inventions[3]</span><span class="delimiter">&quot;</span></span>).getValue(
        teslaContext, <span class="predefined-type">String</span>.class);

<span class="comment">// Members List</span>
StandardEvaluationContext societyContext = <span class="keyword">new</span> StandardEvaluationContext(ieee);

<span class="comment">// evaluates to &quot;Nikola Tesla&quot;</span>
<span class="predefined-type">String</span> name = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Members[0].Name</span><span class="delimiter">&quot;</span></span>).getValue(
        societyContext, <span class="predefined-type">String</span>.class);

<span class="comment">// List and Array navigation</span>
<span class="comment">// evaluates to &quot;Wireless communication&quot;</span>
<span class="predefined-type">String</span> invention = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Members[0].Inventions[6]</span><span class="delimiter">&quot;</span></span>).getValue(
        societyContext, <span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of maps are obtained by specifying the literal key value within the
brackets. In this case, because keys for the Officers map are strings, we can specify
string literals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Officer's Dictionary</span>

Inventor pupin = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Officers['president']</span><span class="delimiter">&quot;</span></span>).getValue(
        societyContext, Inventor.class);

<span class="comment">// evaluates to &quot;Idvor&quot;</span>
<span class="predefined-type">String</span> city = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Officers['president'].PlaceOfBirth.City</span><span class="delimiter">&quot;</span></span>).getValue(
        societyContext, <span class="predefined-type">String</span>.class);

<span class="comment">// setting values</span>
parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Officers['advisors'][0].PlaceOfBirth.Country</span><span class="delimiter">&quot;</span></span>).setValue(
        societyContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">Croatia</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-inline-lists"><a class="anchor" href="core.html#expressions-inline-lists"></a>4.5.3. Inline lists</h4>
<div class="paragraph">
<p>Lists can be expressed directly in an expression using <code>{}</code> notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// evaluates to a Java list containing the four numbers</span>
<span class="predefined-type">List</span> numbers = (<span class="predefined-type">List</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">{1,2,3,4}</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="predefined-type">List</span> listOfLists = (<span class="predefined-type">List</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">{{'a','b'},{'x','y'}}</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>{}</code> by itself means an empty list. For performance reasons, if the list is itself
entirely composed of fixed literals then a constant list is created to represent the
expression, rather than building a new list on each evaluation.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-inline-maps"><a class="anchor" href="core.html#expressions-inline-maps"></a>4.5.4. Inline Maps</h4>
<div class="paragraph">
<p>Maps can also be expressed directly in an expression using <code>{key:value}</code> notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// evaluates to a Java map containing the two entries</span>
<span class="predefined-type">Map</span> inventorInfo = (<span class="predefined-type">Map</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">{name:'Nikola',dob:'10-July-1856'}</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="predefined-type">Map</span> mapOfMaps = (<span class="predefined-type">Map</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">{name:{first:'Nikola',last:'Tesla'},dob:{day:10,month:'July',year:1856}}</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>{:}</code> by itself means an empty map. For performance reasons, if the map is itself composed
of fixed literals or other nested constant structures (lists or maps) then a constant map is created
to represent the expression, rather than building a new map on each evaluation. Quoting of the map keys
is optional, the examples above are not using quoted keys.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-array-construction"><a class="anchor" href="core.html#expressions-array-construction"></a>4.5.5. Array construction</h4>
<div class="paragraph">
<p>Arrays can be built using the familiar Java syntax, optionally supplying an initializer
to have the array populated at construction time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span><span class="type">[]</span> numbers1 = (<span class="type">int</span><span class="type">[]</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">new int[4]</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="comment">// Array with initializer</span>
<span class="type">int</span><span class="type">[]</span> numbers2 = (<span class="type">int</span><span class="type">[]</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">new int[]{1,2,3}</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="comment">// Multi dimensional array</span>
<span class="type">int</span><span class="type">[]</span><span class="type">[]</span> numbers3 = (<span class="type">int</span><span class="type">[]</span><span class="type">[]</span>) parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">new int[4][5]</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not currently allowed to supply an initializer when constructing a
multi-dimensional array.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-methods"><a class="anchor" href="core.html#expressions-methods"></a>4.5.6. Methods</h4>
<div class="paragraph">
<p>Methods are invoked using typical Java programming syntax. You may also invoke methods
on literals. Varargs are also supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// string literal, evaluates to &quot;bc&quot;</span>
<span class="predefined-type">String</span> bc = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'abc'.substring(1, 3)</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">String</span>.class);

<span class="comment">// evaluates to true</span>
<span class="type">boolean</span> isMember = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">isMember('Mihajlo Pupin')</span><span class="delimiter">&quot;</span></span>).getValue(
        societyContext, <span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-operators"><a class="anchor" href="core.html#expressions-operators"></a>4.5.7. Operators</h4>
<div class="sect4">
<h5 id="expressions-operators-relational"><a class="anchor" href="core.html#expressions-operators-relational"></a>Relational operators</h5>
<div class="paragraph">
<p>The relational operators; equal, not equal, less than, less than or equal, greater than,
and greater than or equal are supported using standard operator notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// evaluates to true</span>
<span class="type">boolean</span> trueValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">2 == 2</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// evaluates to false</span>
<span class="type">boolean</span> falseValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">2 &lt; -5.0</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// evaluates to true</span>
<span class="type">boolean</span> trueValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">'black' &lt; 'block'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Greater/less-than comparisons against <code>null</code> follow a simple rule: <code>null</code> is treated as
nothing here (i.e. NOT as zero). As a consequence, any other value is always greater
than <code>null</code> (<code>X &gt; null</code> is always <code>true</code>) and no other value is ever less than nothing
(<code>X &lt; null</code> is always <code>false</code>).</p>
</div>
<div class="paragraph">
<p>If you prefer numeric comparisons instead, please avoid number-based <code>null</code> comparisons
in favor of comparisons against zero (e.g. <code>X &gt; 0</code> or <code>X &lt; 0</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to standard relational operators SpEL supports the <code>instanceof</code> and regular
expression based <code>matches</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// evaluates to false</span>
<span class="type">boolean</span> falseValue = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">'xyz' instanceof T(Integer)</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// evaluates to true</span>
<span class="type">boolean</span> trueValue = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">'5.00' matches '</span><span class="content">\^</span><span class="content">-?</span><span class="char">\\</span><span class="content">d+(</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">d{2})?$'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">//evaluates to false</span>
<span class="type">boolean</span> falseValue = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">'5.0067' matches '</span><span class="content">\^</span><span class="content">-?</span><span class="char">\\</span><span class="content">d+(</span><span class="char">\\</span><span class="content">.</span><span class="char">\\</span><span class="content">d{2})?$'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be careful with primitive types as they are immediately boxed up to the wrapper type,
so <code>1 instanceof T(int)</code> evaluates to <code>false</code> while <code>1 instanceof T(Integer)</code>
evaluates to <code>true</code>, as expected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each symbolic operator can also be specified as a purely alphabetic equivalent. This
avoids problems where the symbols used have special meaning for the document type in
which the expression is embedded (eg. an XML document). The textual equivalents are
shown here: <code>lt</code> (<code>&lt;</code>), <code>gt</code> (<code>&gt;</code>), <code>le</code> (<code>&#8656;</code>), <code>ge</code> (<code>&gt;=</code>), <code>eq</code> (<code>==</code>),
<code>ne</code> (<code>!=</code>), <code>div</code> (<code>/</code>), <code>mod</code> (<code>%</code>), <code>not</code> (<code>!</code>). These are case insensitive.</p>
</div>
</div>
<div class="sect4">
<h5 id="expressions-operators-logical"><a class="anchor" href="core.html#expressions-operators-logical"></a>Logical operators</h5>
<div class="paragraph">
<p>The logical operators that are supported are and, or, and not. Their use is demonstrated
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// -- AND --</span>

<span class="comment">// evaluates to false</span>
<span class="type">boolean</span> falseValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">true and false</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// evaluates to true</span>
<span class="predefined-type">String</span> expression = <span class="string"><span class="delimiter">&quot;</span><span class="content">isMember('Nikola Tesla') and isMember('Mihajlo Pupin')</span><span class="delimiter">&quot;</span></span>;
<span class="type">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, <span class="predefined-type">Boolean</span>.class);

<span class="comment">// -- OR --</span>

<span class="comment">// evaluates to true</span>
<span class="type">boolean</span> trueValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">true or false</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// evaluates to true</span>
<span class="predefined-type">String</span> expression = <span class="string"><span class="delimiter">&quot;</span><span class="content">isMember('Nikola Tesla') or isMember('Albert Einstein')</span><span class="delimiter">&quot;</span></span>;
<span class="type">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, <span class="predefined-type">Boolean</span>.class);

<span class="comment">// -- NOT --</span>

<span class="comment">// evaluates to false</span>
<span class="type">boolean</span> falseValue = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">!true</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Boolean</span>.class);

<span class="comment">// -- AND and NOT --</span>
<span class="predefined-type">String</span> expression = <span class="string"><span class="delimiter">&quot;</span><span class="content">isMember('Nikola Tesla') and !isMember('Mihajlo Pupin')</span><span class="delimiter">&quot;</span></span>;
<span class="type">boolean</span> falseValue = parser.parseExpression(expression).getValue(societyContext, <span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="expressions-operators-mathematical"><a class="anchor" href="core.html#expressions-operators-mathematical"></a>Mathematical operators</h5>
<div class="paragraph">
<p>The addition operator can be used on both numbers and strings. Subtraction, multiplication
and division can be used only on numbers. Other mathematical operators supported are
modulus (%) and exponential power (^). Standard operator precedence is enforced. These
operators are demonstrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Addition</span>
<span class="type">int</span> two = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">1 + 1</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// 2</span>

<span class="predefined-type">String</span> testString = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">'test' + ' ' + 'string'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">String</span>.class); <span class="comment">// 'test string'</span>

<span class="comment">// Subtraction</span>
<span class="type">int</span> four = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">1 - -3</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// 4</span>

<span class="type">double</span> d = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">1000.00 - 1e4</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Double</span>.class); <span class="comment">// -9000</span>

<span class="comment">// Multiplication</span>
<span class="type">int</span> six = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">-2 * -3</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// 6</span>

<span class="type">double</span> twentyFour = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0 * 3e0 * 4</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Double</span>.class); <span class="comment">// 24.0</span>

<span class="comment">// Division</span>
<span class="type">int</span> minusTwo = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">6 / -3</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// -2</span>

<span class="type">double</span> one = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">8.0 / 4e0 / 2</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Double</span>.class); <span class="comment">// 1.0</span>

<span class="comment">// Modulus</span>
<span class="type">int</span> three = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">7 % 4</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// 3</span>

<span class="type">int</span> one = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">8 / 5 % 2</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// 1</span>

<span class="comment">// Operator precedence</span>
<span class="type">int</span> minusTwentyOne = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">1+2-3*8</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Integer</span>.class); <span class="comment">// -21</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-assignment"><a class="anchor" href="core.html#expressions-assignment"></a>4.5.8. Assignment</h4>
<div class="paragraph">
<p>Setting of a property is done by using the assignment operator. This would typically be
done within a call to <code>setValue</code> but can also be done inside a call to <code>getValue</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Inventor inventor = <span class="keyword">new</span> Inventor();
StandardEvaluationContext inventorContext = <span class="keyword">new</span> StandardEvaluationContext(inventor);

parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name</span><span class="delimiter">&quot;</span></span>).setValue(inventorContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alexander Seovic2</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// alternatively</span>

<span class="predefined-type">String</span> aleks = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Name = 'Alexandar Seovic'</span><span class="delimiter">&quot;</span></span>).getValue(inventorContext, <span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-types"><a class="anchor" href="core.html#expressions-types"></a>4.5.9. Types</h4>
<div class="paragraph">
<p>The special <code>T</code> operator can be used to specify an instance of java.lang.Class (the
<em>type</em>). Static methods are invoked using this operator as well. The
<code>StandardEvaluationContext</code> uses a <code>TypeLocator</code> to find types and the
<code>StandardTypeLocator</code> (which can be replaced) is built with an understanding of the
java.lang package. This means T() references to types within java.lang do not need to be
fully qualified, but all other type references must be.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Class</span> dateClass = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">T(java.util.Date)</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Class</span>.class);

<span class="predefined-type">Class</span> stringClass = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">T(String)</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">Class</span>.class);

<span class="type">boolean</span> trueValue = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR</span><span class="delimiter">&quot;</span></span>)
        .getValue(<span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-constructors"><a class="anchor" href="core.html#expressions-constructors"></a>4.5.10. Constructors</h4>
<div class="paragraph">
<p>Constructors can be invoked using the new operator. The fully qualified class name
should be used for all but the primitive type and String (where int, float, etc, can be
used).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Inventor einstein = p.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">new org.spring.samples.spel.inventor.Inventor('Albert Einstein', 'German')</span><span class="delimiter">&quot;</span></span>)
        .getValue(Inventor.class);

<span class="comment">//create new inventor instance within add method of List</span>
p.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Members.add(new org.spring.samples.spel.inventor.Inventor(
            'Albert Einstein', 'German'))</span><span class="delimiter">&quot;</span></span>).getValue(societyContext);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-ref-variables"><a class="anchor" href="core.html#expressions-ref-variables"></a>4.5.11. Variables</h4>
<div class="paragraph">
<p>Variables can be referenced in the expression using the syntax <code>#variableName</code>. Variables
are set using the method setVariable on the <code>StandardEvaluationContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Serbian</span><span class="delimiter">&quot;</span></span>);
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext(tesla);
context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">newName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mike Tesla</span><span class="delimiter">&quot;</span></span>);

parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name = #newName</span><span class="delimiter">&quot;</span></span>).getValue(context);

<span class="predefined-type">System</span>.out.println(tesla.getName()) <span class="comment">// &quot;Mike Tesla&quot;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="expressions-this-root"><a class="anchor" href="core.html#expressions-this-root"></a>The #this and #root variables</h5>
<div class="paragraph">
<p>The variable #this is always defined and refers to the current evaluation object
(against which unqualified references are resolved). The variable #root is always
defined and refers to the root context object. Although #this may vary as components of
an expression are evaluated, #root always refers to the root.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create an array of integers</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; primes = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt;();
primes.addAll(<span class="predefined-type">Arrays</span>.asList(<span class="integer">2</span>,<span class="integer">3</span>,<span class="integer">5</span>,<span class="integer">7</span>,<span class="integer">11</span>,<span class="integer">13</span>,<span class="integer">17</span>));

<span class="comment">// create parser and set variable 'primes' as the array of integers</span>
ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();
context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">primes</span><span class="delimiter">&quot;</span></span>,primes);

<span class="comment">// all prime numbers &gt; 10 from the list (using selection ?{...})</span>
<span class="comment">// evaluates to [11, 13, 17]</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; primesGreaterThanTen = (<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt;) parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">#primes.?[#this&gt;10]</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-ref-functions"><a class="anchor" href="core.html#expressions-ref-functions"></a>4.5.12. Functions</h4>
<div class="paragraph">
<p>You can extend SpEL by registering user defined functions that can be called within the
expression string. The function is registered with the <code>StandardEvaluationContext</code> using
the method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> registerFunction(<span class="predefined-type">String</span> name, <span class="predefined-type">Method</span> m)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A reference to a Java Method provides the implementation of the function. For example, a
utility method to reverse a string is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">StringUtils</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> reverseString(<span class="predefined-type">String</span> input) {
        <span class="predefined-type">StringBuilder</span> backwards = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; input.length(); i++)
            backwards.append(input.charAt(input.length() - <span class="integer">1</span> - i));
        }
        <span class="keyword">return</span> backwards.toString();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is then registered with the evaluation context and can be used within an
expression string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();

context.registerFunction(<span class="string"><span class="delimiter">&quot;</span><span class="content">reverseString</span><span class="delimiter">&quot;</span></span>,
    StringUtils.class.getDeclaredMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">reverseString</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class));

<span class="predefined-type">String</span> helloWorldReversed = parser.parseExpression(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">#reverseString('hello')</span><span class="delimiter">&quot;</span></span>).getValue(context, <span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-bean-references"><a class="anchor" href="core.html#expressions-bean-references"></a>4.5.13. Bean references</h4>
<div class="paragraph">
<p>If the evaluation context has been configured with a bean resolver it is possible to
lookup beans from an expression using the (@) symbol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="keyword">new</span> MyBeanResolver());

<span class="comment">// This will end up calling resolve(context,&quot;foo&quot;) on MyBeanResolver during evaluation</span>
<span class="predefined-type">Object</span> bean = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">@foo</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To access a factory bean itself, the bean name should instead be prefixed with a (&amp;) symbol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="keyword">new</span> MyBeanResolver());

<span class="comment">// This will end up calling resolve(context,&quot;&amp;foo&quot;) on MyBeanResolver during evaluation</span>
<span class="predefined-type">Object</span> bean = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">&amp;foo</span><span class="delimiter">&quot;</span></span>).getValue(context);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-operator-ternary"><a class="anchor" href="core.html#expressions-operator-ternary"></a>4.5.14. Ternary Operator (If-Then-Else)</h4>
<div class="paragraph">
<p>You can use the ternary operator for performing if-then-else conditional logic inside
the expression. A minimal example is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> falseString = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">false ? 'trueExp' : 'falseExp'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the boolean false results in returning the string value 'falseExp'. A more
realistic example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name</span><span class="delimiter">&quot;</span></span>).setValue(societyContext, <span class="string"><span class="delimiter">&quot;</span><span class="content">IEEE</span><span class="delimiter">&quot;</span></span>);
societyContext.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">queryName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>);

expression = <span class="string"><span class="delimiter">&quot;</span><span class="content">isMember(#queryName)? #queryName + ' is a member of the ' </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'</span><span class="delimiter">&quot;</span></span>;

<span class="predefined-type">String</span> queryResultString = parser.parseExpression(expression)
        .getValue(societyContext, <span class="predefined-type">String</span>.class);
<span class="comment">// queryResultString = &quot;Nikola Tesla is a member of the IEEE Society&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also see the next section on the Elvis operator for an even shorter syntax for the
ternary operator.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-operator-elvis"><a class="anchor" href="core.html#expressions-operator-elvis"></a>4.5.15. The Elvis Operator</h4>
<div class="paragraph">
<p>The Elvis operator is a shortening of the ternary operator syntax and is used in the
<a href="http://www.groovy-lang.org/operators.html#_elvis_operator">Groovy</a> language.
With the ternary operator syntax you usually have to repeat a variable twice, for
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Elvis Presley</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> displayName = name != <span class="predefined-constant">null</span> ? name : <span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead you can use the Elvis operator, named for the resemblance to Elvis' hair style.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

<span class="predefined-type">String</span> name = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">name?:'Unknown'</span><span class="delimiter">&quot;</span></span>).getValue(<span class="predefined-type">String</span>.class);

<span class="predefined-type">System</span>.out.println(name); <span class="comment">// 'Unknown'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a more complex example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Serbian</span><span class="delimiter">&quot;</span></span>);
StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext(tesla);

<span class="predefined-type">String</span> name = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name?:'Elvis Presley'</span><span class="delimiter">&quot;</span></span>).getValue(context, <span class="predefined-type">String</span>.class);

<span class="predefined-type">System</span>.out.println(name); <span class="comment">// Nikola Tesla</span>

tesla.setName(<span class="predefined-constant">null</span>);

name = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name?:'Elvis Presley'</span><span class="delimiter">&quot;</span></span>).getValue(context, <span class="predefined-type">String</span>.class);

<span class="predefined-type">System</span>.out.println(name); <span class="comment">// Elvis Presley</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expressions-operator-safe-navigation"><a class="anchor" href="core.html#expressions-operator-safe-navigation"></a>4.5.16. Safe Navigation operator</h4>
<div class="paragraph">
<p>The Safe Navigation operator is used to avoid a <code>NullPointerException</code> and comes from
the <a href="http://www.groovy-lang.org/operators.html#_safe_navigation_operator">Groovy</a>
language. Typically when you have a reference to an object you might need to verify that
it is not null before accessing methods or properties of the object. To avoid this, the
safe navigation operator will simply return null instead of throwing an exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nikola Tesla</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Serbian</span><span class="delimiter">&quot;</span></span>);
tesla.setPlaceOfBirth(<span class="keyword">new</span> PlaceOfBirth(<span class="string"><span class="delimiter">&quot;</span><span class="content">Smiljan</span><span class="delimiter">&quot;</span></span>));

StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext(tesla);

<span class="predefined-type">String</span> city = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">PlaceOfBirth?.City</span><span class="delimiter">&quot;</span></span>).getValue(context, <span class="predefined-type">String</span>.class);
<span class="predefined-type">System</span>.out.println(city); <span class="comment">// Smiljan</span>

tesla.setPlaceOfBirth(<span class="predefined-constant">null</span>);

city = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">PlaceOfBirth?.City</span><span class="delimiter">&quot;</span></span>).getValue(context, <span class="predefined-type">String</span>.class);

<span class="predefined-type">System</span>.out.println(city); <span class="comment">// null - does not throw NullPointerException!!!</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Elvis operator can be used to apply default values in expressions, e.g. in an
<code>@Value</code> expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{systemProperties['pop3.port'] ?: 25}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will inject a system property <code>pop3.port</code> if it is defined or 25 if not.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="expressions-collection-selection"><a class="anchor" href="core.html#expressions-collection-selection"></a>4.5.17. Collection Selection</h4>
<div class="paragraph">
<p>Selection is a powerful expression language feature that allows you to transform some
source collection into another by selecting from its entries.</p>
</div>
<div class="paragraph">
<p>Selection uses the syntax <code>.?[selectionExpression]</code>. This will filter the collection and
return a new collection containing a subset of the original elements. For example,
selection would allow us to easily get a list of Serbian inventors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Inventor&gt; list = (<span class="predefined-type">List</span>&lt;Inventor&gt;) parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Members.?[Nationality == 'Serbian']</span><span class="delimiter">&quot;</span></span>).getValue(societyContext);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Selection is possible upon both lists and maps. In the former case the selection
criteria is evaluated against each individual list element whilst against a map the
selection criteria is evaluated against each map entry (objects of the Java type
<code>Map.Entry</code>). Map entries have their key and value accessible as properties for use in
the selection.</p>
</div>
<div class="paragraph">
<p>This expression will return a new map consisting of those elements of the original map
where the entry value is less than 27.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span> newMap = parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">map.?[value&lt;27]</span><span class="delimiter">&quot;</span></span>).getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to returning all the selected elements, it is possible to retrieve just the
first or the last value. To obtain the first entry matching the selection the syntax is
<code>^[&#8230;&#8203;]</code> whilst to obtain the last matching selection the syntax is <code>$[&#8230;&#8203;]</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-collection-projection"><a class="anchor" href="core.html#expressions-collection-projection"></a>4.5.18. Collection Projection</h4>
<div class="paragraph">
<p>Projection allows a collection to drive the evaluation of a sub-expression and the
result is a new collection. The syntax for projection is <code>![projectionExpression]</code>. Most
easily understood by example, suppose we have a list of inventors but want the list of
cities where they were born. Effectively we want to evaluate 'placeOfBirth.city' for
every entry in the inventor list. Using projection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// returns ['Smiljan', 'Idvor' ]</span>
<span class="predefined-type">List</span> placesOfBirth = (<span class="predefined-type">List</span>)parser.parseExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">Members.![placeOfBirth.city]</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A map can also be used to drive projection and in this case the projection expression is
evaluated against each entry in the map (represented as a Java <code>Map.Entry</code>). The result
of a projection across a map is a list consisting of the evaluation of the projection
expression against each map entry.</p>
</div>
</div>
<div class="sect3">
<h4 id="expressions-templating"><a class="anchor" href="core.html#expressions-templating"></a>4.5.19. Expression templating</h4>
<div class="paragraph">
<p>Expression templates allow a mixing of literal text with one or more evaluation blocks.
Each evaluation block is delimited with prefix and suffix characters that you can
define, a common choice is to use <code>#{ }</code> as the delimiters. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> randomPhrase = parser.parseExpression(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">random number is #{T(java.lang.Math).random()}</span><span class="delimiter">&quot;</span></span>,
        <span class="keyword">new</span> TemplateParserContext()).getValue(<span class="predefined-type">String</span>.class);

<span class="comment">// evaluates to &quot;random number is 0.7038186818312008&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The string is evaluated by concatenating the literal text 'random number is ' with the
result of evaluating the expression inside the #{ } delimiter, in this case the result
of calling that random() method. The second argument to the method <code>parseExpression()</code>
is of the type <code>ParserContext</code>. The <code>ParserContext</code> interface is used to influence how
the expression is parsed in order to support the expression templating functionality.
The definition of <code>TemplateParserContext</code> is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TemplateParserContext</span> <span class="directive">implements</span> ParserContext {

    <span class="directive">public</span> <span class="predefined-type">String</span> getExpressionPrefix() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">#{</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getExpressionSuffix() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="directive">public</span> <span class="type">boolean</span> isTemplate() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expressions-example-classes"><a class="anchor" href="core.html#expressions-example-classes"></a>4.6. Classes used in the examples</h3>
<div class="paragraph">
<p>Inventor.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.spring.samples.spel.inventor</span>;

<span class="keyword">import</span> <span class="include">java.util.Date</span>;
<span class="keyword">import</span> <span class="include">java.util.GregorianCalendar</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Inventor</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> nationality;
    <span class="directive">private</span> <span class="predefined-type">String</span><span class="type">[]</span> inventions;
    <span class="directive">private</span> <span class="predefined-type">Date</span> birthdate;
    <span class="directive">private</span> PlaceOfBirth placeOfBirth;

    <span class="directive">public</span> Inventor(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> nationality) {
        <span class="predefined-type">GregorianCalendar</span> c= <span class="keyword">new</span> <span class="predefined-type">GregorianCalendar</span>();
        <span class="local-variable">this</span>.name = name;
        <span class="local-variable">this</span>.nationality = nationality;
        <span class="local-variable">this</span>.birthdate = c.getTime();
    }

    <span class="directive">public</span> Inventor(<span class="predefined-type">String</span> name, <span class="predefined-type">Date</span> birthdate, <span class="predefined-type">String</span> nationality) {
        <span class="local-variable">this</span>.name = name;
        <span class="local-variable">this</span>.nationality = nationality;
        <span class="local-variable">this</span>.birthdate = birthdate;
    }

    <span class="directive">public</span> Inventor() {
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getNationality() {
        <span class="keyword">return</span> nationality;
    }

    <span class="directive">public</span> <span class="type">void</span> setNationality(<span class="predefined-type">String</span> nationality) {
        <span class="local-variable">this</span>.nationality = nationality;
    }

    <span class="directive">public</span> <span class="predefined-type">Date</span> getBirthdate() {
        <span class="keyword">return</span> birthdate;
    }

    <span class="directive">public</span> <span class="type">void</span> setBirthdate(<span class="predefined-type">Date</span> birthdate) {
        <span class="local-variable">this</span>.birthdate = birthdate;
    }

    <span class="directive">public</span> PlaceOfBirth getPlaceOfBirth() {
        <span class="keyword">return</span> placeOfBirth;
    }

    <span class="directive">public</span> <span class="type">void</span> setPlaceOfBirth(PlaceOfBirth placeOfBirth) {
        <span class="local-variable">this</span>.placeOfBirth = placeOfBirth;
    }

    <span class="directive">public</span> <span class="type">void</span> setInventions(<span class="predefined-type">String</span><span class="type">[]</span> inventions) {
        <span class="local-variable">this</span>.inventions = inventions;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span><span class="type">[]</span> getInventions() {
        <span class="keyword">return</span> inventions;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>PlaceOfBirth.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.spring.samples.spel.inventor</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">PlaceOfBirth</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> city;
    <span class="directive">private</span> <span class="predefined-type">String</span> country;

    <span class="directive">public</span> PlaceOfBirth(<span class="predefined-type">String</span> city) {
        <span class="local-variable">this</span>.city=city;
    }

    <span class="directive">public</span> PlaceOfBirth(<span class="predefined-type">String</span> city, <span class="predefined-type">String</span> country) {
        <span class="local-variable">this</span>(city);
        <span class="local-variable">this</span>.country = country;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getCity() {
        <span class="keyword">return</span> city;
    }

    <span class="directive">public</span> <span class="type">void</span> setCity(<span class="predefined-type">String</span> s) {
        <span class="local-variable">this</span>.city = s;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getCountry() {
        <span class="keyword">return</span> country;
    }

    <span class="directive">public</span> <span class="type">void</span> setCountry(<span class="predefined-type">String</span> country) {
        <span class="local-variable">this</span>.country = country;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Society.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.spring.samples.spel.inventor</span>;

<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Society</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> Advisors = <span class="string"><span class="delimiter">&quot;</span><span class="content">advisors</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> President = <span class="string"><span class="delimiter">&quot;</span><span class="content">president</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Inventor&gt; members = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Inventor&gt;();
    <span class="directive">private</span> <span class="predefined-type">Map</span> officers = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();

    <span class="directive">public</span> <span class="predefined-type">List</span> getMembers() {
        <span class="keyword">return</span> members;
    }

    <span class="directive">public</span> <span class="predefined-type">Map</span> getOfficers() {
        <span class="keyword">return</span> officers;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="type">boolean</span> isMember(<span class="predefined-type">String</span> name) {
        <span class="keyword">for</span> (Inventor inventor : members) {
            <span class="keyword">if</span> (inventor.getName().equals(name)) {
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
            }
        }
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aop"><a class="anchor" href="core.html#aop"></a>5. Aspect Oriented Programming with Spring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aop-introduction"><a class="anchor" href="core.html#aop-introduction"></a>5.1. Introduction</h3>
<div class="paragraph">
<p><em>Aspect-Oriented Programming</em> (AOP) complements Object-Oriented Programming (OOP) by
providing another way of thinking about program structure. The key unit of modularity in
OOP is the class, whereas in AOP the unit of modularity is the <em>aspect</em>. Aspects
enable the modularization of concerns such as transaction management that cut across
multiple types and objects. (Such concerns are often termed <em>crosscutting</em> concerns in
AOP literature.)</p>
</div>
<div class="paragraph">
<p>One of the key components of Spring is the <em>AOP framework</em>. While the Spring IoC
container does not depend on AOP, meaning you do not need to use AOP if you don&#8217;t want
to, AOP complements Spring IoC to provide a very capable middleware solution.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Spring 2.0+ AOP</div>
<div class="paragraph">
<p>Spring 2.0 introduced a simpler and more powerful way of writing custom aspects using
either a <a href="core.html#aop-schema">schema-based approach</a> or the <a href="core.html#aop-ataspectj">@AspectJ annotation
style</a>. Both of these styles offer fully typed advice and use of the AspectJ pointcut
language, while still using Spring AOP for weaving.</p>
</div>
<div class="paragraph">
<p>The Spring 2.0+ schema- and @AspectJ-based AOP support is discussed in this chapter.
The lower-level AOP support, as commonly exposed in Spring 1.2 applications, is
discussed in <a href="core.html#aop-api">the following chapter</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>AOP is used in the Spring Framework to&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203; provide declarative enterprise services, especially as a replacement for EJB
declarative services. The most important such service is
<a href="core.html#transaction-declarative"><em>declarative transaction management</em></a>.</p>
</li>
<li>
<p>&#8230;&#8203; allow users to implement custom aspects, complementing their use of OOP with AOP.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are interested only in generic declarative services or other pre-packaged
declarative middleware services such as pooling, you do not need to work directly with
Spring AOP, and can skip most of this chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aop-introduction-defn"><a class="anchor" href="core.html#aop-introduction-defn"></a>5.1.1. AOP concepts</h4>
<div class="paragraph">
<p>Let us begin by defining some central AOP concepts and terminology. These terms are not
Spring-specific&#8230;&#8203; unfortunately, AOP terminology is not particularly intuitive;
however, it would be even more confusing if Spring used its own terminology.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Aspect</em>: a modularization of a concern that cuts across multiple classes.
Transaction management is a good example of a crosscutting concern in enterprise Java
applications. In Spring AOP, aspects are implemented using regular classes
(the <a href="core.html#aop-schema">schema-based approach</a>) or regular classes annotated with the
<code>@Aspect</code> annotation (the <a href="core.html#aop-ataspectj"><code>@AspectJ</code> style</a>).</p>
</li>
<li>
<p><em>Join point</em>: a point during the execution of a program, such as the execution of a
method or the handling of an exception. In Spring AOP, a join point <em>always</em>
represents a method execution.</p>
</li>
<li>
<p><em>Advice</em>: action taken by an aspect at a particular join point. Different types of
advice include "around," "before" and "after" advice. (Advice types are discussed
below.) Many AOP frameworks, including Spring, model an advice as an <em>interceptor</em>,
maintaining a chain of interceptors <em>around</em> the join point.</p>
</li>
<li>
<p><em>Pointcut</em>: a predicate that matches join points. Advice is associated with a
pointcut expression and runs at any join point matched by the pointcut (for example,
the execution of a method with a certain name). The concept of join points as matched
by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut
expression language by default.</p>
</li>
<li>
<p><em>Introduction</em>: declaring additional methods or fields on behalf of a type. Spring
AOP allows you to introduce new interfaces (and a corresponding implementation) to any
advised object. For example, you could use an introduction to make a bean implement an
<code>IsModified</code> interface, to simplify caching. (An introduction is known as an
inter-type declaration in the AspectJ community.)</p>
</li>
<li>
<p><em>Target object</em>: object being advised by one or more aspects. Also referred to as
the <em>advised</em> object. Since Spring AOP is implemented using runtime proxies, this
object will always be a <em>proxied</em> object.</p>
</li>
<li>
<p><em>AOP proxy</em>: an object created by the AOP framework in order to implement the aspect
contracts (advise method executions and so on). In the Spring Framework, an AOP proxy
will be a JDK dynamic proxy or a CGLIB proxy.</p>
</li>
<li>
<p><em>Weaving</em>: linking aspects with other application types or objects to create an
advised object. This can be done at compile time (using the AspectJ compiler, for
example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks,
performs weaving at runtime.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Types of advice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Before advice</em>: Advice that executes before a join point, but which does not have
the ability to prevent execution flow proceeding to the join point (unless it throws
an exception).</p>
</li>
<li>
<p><em>After returning advice</em>: Advice to be executed after a join point completes
normally: for example, if a method returns without throwing an exception.</p>
</li>
<li>
<p><em>After throwing advice</em>: Advice to be executed if a method exits by throwing an
exception.</p>
</li>
<li>
<p><em>After (finally) advice</em>: Advice to be executed regardless of the means by which a
join point exits (normal or exceptional return).</p>
</li>
<li>
<p><em>Around advice</em>: Advice that surrounds a join point such as a method invocation.
This is the most powerful kind of advice. Around advice can perform custom behavior
before and after the method invocation. It is also responsible for choosing whether to
proceed to the join point or to shortcut the advised method execution by returning its
own return value or throwing an exception.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Around advice is the most general kind of advice. Since Spring AOP, like AspectJ,
provides a full range of advice types, we recommend that you use the least powerful
advice type that can implement the required behavior. For example, if you need only to
update a cache with the return value of a method, you are better off implementing an
after returning advice than an around advice, although an around advice can accomplish
the same thing. Using the most specific advice type provides a simpler programming model
with less potential for errors. For example, you do not need to invoke the <code>proceed()</code>
method on the <code>JoinPoint</code> used for around advice, and hence cannot fail to invoke it.</p>
</div>
<div class="paragraph">
<p>In Spring 2.0, all advice parameters are statically typed, so that you work with advice
parameters of the appropriate type (the type of the return value from a method execution
for example) rather than <code>Object</code> arrays.</p>
</div>
<div class="paragraph">
<p>The concept of join points, matched by pointcuts, is the key to AOP which distinguishes
it from older technologies offering only interception. Pointcuts enable advice to be
targeted independently of the Object-Oriented hierarchy. For example, an around advice
providing declarative transaction management can be applied to a set of methods spanning
multiple objects (such as all business operations in the service layer).</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-introduction-spring-defn"><a class="anchor" href="core.html#aop-introduction-spring-defn"></a>5.1.2. Spring AOP capabilities and goals</h4>
<div class="paragraph">
<p>Spring AOP is implemented in pure Java. There is no need for a special compilation
process. Spring AOP does not need to control the class loader hierarchy, and is thus
suitable for use in a Servlet container or application server.</p>
</div>
<div class="paragraph">
<p>Spring AOP currently supports only method execution join points (advising the execution
of methods on Spring beans). Field interception is not implemented, although support for
field interception could be added without breaking the core Spring AOP APIs. If you need
to advise field access and update join points, consider a language such as AspectJ.</p>
</div>
<div class="paragraph">
<p>Spring AOP&#8217;s approach to AOP differs from that of most other AOP frameworks. The aim is
not to provide the most complete AOP implementation (although Spring AOP is quite
capable); it is rather to provide a close integration between AOP implementation and
Spring IoC to help solve common problems in enterprise applications.</p>
</div>
<div class="paragraph">
<p>Thus, for example, the Spring Framework&#8217;s AOP functionality is normally used in
conjunction with the Spring IoC container. Aspects are configured using normal bean
definition syntax (although this allows powerful "autoproxying" capabilities): this is a
crucial difference from other AOP implementations. There are some things you cannot do
easily or efficiently with Spring AOP, such as advise very fine-grained objects (such as
domain objects typically): AspectJ is the best choice in such cases. However, our
experience is that Spring AOP provides an excellent solution to most problems in
enterprise Java applications that are amenable to AOP.</p>
</div>
<div class="paragraph">
<p>Spring AOP will never strive to compete with AspectJ to provide a comprehensive AOP
solution. We believe that both proxy-based frameworks like Spring AOP and full-blown
frameworks such as AspectJ are valuable, and that they are complementary, rather than in
competition. Spring seamlessly integrates Spring AOP and IoC with AspectJ, to enable
all uses of AOP to be catered for within a consistent Spring-based application
architecture. This integration does not affect the Spring AOP API or the AOP Alliance
API: Spring AOP remains backward-compatible. See <a href="core.html#aop-api">the following chapter</a> for a
discussion of the Spring AOP APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One of the central tenets of the Spring Framework is that of <em>non-invasiveness</em>; this
is the idea that you should not be forced to introduce framework-specific classes and
interfaces into your business/domain model. However, in some places the Spring Framework
does give you the option to introduce Spring Framework-specific dependencies into your
codebase: the rationale in giving you such options is because in certain scenarios it
might be just plain easier to read or code some specific piece of functionality in such
a way. The Spring Framework (almost) always offers you the choice though: you have the
freedom to make an informed decision as to which option best suits your particular use
case or scenario.</p>
</div>
<div class="paragraph">
<p>One such choice that is relevant to this chapter is that of which AOP framework (and
which AOP style) to choose. You have the choice of AspectJ and/or Spring AOP, and you
also have the choice of either the @AspectJ annotation-style approach or the Spring XML
configuration-style approach. The fact that this chapter chooses to introduce the
@AspectJ-style approach first should not be taken as an indication that the Spring team
favors the @AspectJ annotation-style approach over the Spring XML configuration-style.</p>
</div>
<div class="paragraph">
<p>See <a href="core.html#aop-choosing">Choosing which AOP declaration style to use</a> for a more complete discussion of the whys and wherefores of each
style.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aop-introduction-proxies"><a class="anchor" href="core.html#aop-introduction-proxies"></a>5.1.3. AOP Proxies</h4>
<div class="paragraph">
<p>Spring AOP defaults to using standard JDK <em>dynamic proxies</em> for AOP proxies. This
enables any interface (or set of interfaces) to be proxied.</p>
</div>
<div class="paragraph">
<p>Spring AOP can also use CGLIB proxies. This is necessary to proxy classes rather than
interfaces. CGLIB is used by default if a business object does not implement an
interface. As it is good practice to program to interfaces rather than classes; business
classes normally will implement one or more business interfaces. It is possible to
<a href="core.html#aop-proxying">force the use of CGLIB</a>, in those (hopefully rare) cases where you
need to advise a method that is not declared on an interface, or where you need to
pass a proxied object to a method as a concrete type.</p>
</div>
<div class="paragraph">
<p>It is important to grasp the fact that Spring AOP is <em>proxy-based</em>. See
<a href="core.html#aop-understanding-aop-proxies">Understanding AOP proxies</a> for a thorough examination of exactly what this
implementation detail actually means.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-ataspectj"><a class="anchor" href="core.html#aop-ataspectj"></a>5.2. @AspectJ support</h3>
<div class="paragraph">
<p>@AspectJ refers to a style of declaring aspects as regular Java classes annotated with
annotations. The @AspectJ style was introduced by the
<a href="https://www.eclipse.org/aspectj">AspectJ project</a> as part of the AspectJ 5 release. Spring
interprets the same annotations as AspectJ 5, using a library supplied by AspectJ
for pointcut parsing and matching. The AOP runtime is still pure Spring AOP though, and
there is no dependency on the AspectJ compiler or weaver.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the AspectJ compiler and weaver enables use of the full AspectJ language, and is
discussed in <a href="core.html#aop-using-aspectj">Using AspectJ with Spring applications</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aop-aspectj-support"><a class="anchor" href="core.html#aop-aspectj-support"></a>5.2.1. Enabling @AspectJ Support</h4>
<div class="paragraph">
<p>To use @AspectJ aspects in a Spring configuration you need to enable Spring support for
configuring Spring AOP based on @AspectJ aspects, and <em>autoproxying</em> beans based on
whether or not they are advised by those aspects. By autoproxying we mean that if Spring
determines that a bean is advised by one or more aspects, it will automatically generate
a proxy for that bean to intercept method invocations and ensure that advice is executed
as needed.</p>
</div>
<div class="paragraph">
<p>The @AspectJ support can be enabled with XML or Java style configuration. In either
case you will also need to ensure that AspectJ&#8217;s <code>aspectjweaver.jar</code> library is on the
classpath of your application (version 1.8 or later). This library is available in the
<code>'lib'</code> directory of an AspectJ distribution or via the Maven Central repository.</p>
</div>
<div class="sect4">
<h5 id="aop-enable-aspectj-java"><a class="anchor" href="core.html#aop-enable-aspectj-java"></a>Enabling @AspectJ Support with Java configuration</h5>
<div class="paragraph">
<p>To enable @AspectJ support with Java <code>@Configuration</code> add the <code>@EnableAspectJAutoProxy</code>
annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAspectJAutoProxy</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-enable-aspectj-xml"><a class="anchor" href="core.html#aop-enable-aspectj-xml"></a>Enabling @AspectJ Support with XML configuration</h5>
<div class="paragraph">
<p>To enable @AspectJ support with XML based configuration use the <code>aop:aspectj-autoproxy</code>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspectj-autoproxy</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes that you are using schema support as described in
<a href="core.html#xsd-schemas">XML Schema-based configuration</a>. See
<a href="core.html#xsd-schemas-aop">the AOP schema</a> for how to import the tags in the <code>aop</code>
namespace.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-at-aspectj"><a class="anchor" href="core.html#aop-at-aspectj"></a>5.2.2. Declaring an aspect</h4>
<div class="paragraph">
<p>With the @AspectJ support enabled, any bean defined in your application context with a
class that is an @AspectJ aspect (has the <code>@Aspect</code> annotation) will be automatically
detected by Spring and used to configure Spring AOP. The following example shows the
minimal definition required for a not-very-useful aspect:</p>
</div>
<div class="paragraph">
<p>A regular bean definition in the application context, pointing to a bean class that has
the <code>@Aspect</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.xyz.NotVeryUsefulAspect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- configure properties of aspect here as normal --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <code>NotVeryUsefulAspect</code> class definition, annotated with
<code>org.aspectj.lang.annotation.Aspect</code> annotation;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.xyz</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NotVeryUsefulAspect</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aspects (classes annotated with <code>@Aspect</code>) may have methods and fields just like any
other class. They may also contain pointcut, advice, and introduction (inter-type)
declarations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Autodetecting aspects through component scanning</div>
<div class="paragraph">
<p>You may register aspect classes as regular beans in your Spring XML configuration, or
autodetect them through classpath scanning - just like any other Spring-managed bean.
However, note that the <em>@Aspect</em> annotation is <em>not</em> sufficient for autodetection in
the classpath: For that purpose, you need to add a separate <em>@Component</em> annotation
(or alternatively a custom stereotype annotation that qualifies, as per the rules of
Spring&#8217;s component scanner).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Advising aspects with other aspects?</div>
<div class="paragraph">
<p>In Spring AOP, it is <em>not</em> possible to have aspects themselves be the target of advice
from other aspects. The <em>@Aspect</em> annotation on a class marks it as an aspect, and
hence excludes it from auto-proxying.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aop-pointcuts"><a class="anchor" href="core.html#aop-pointcuts"></a>5.2.3. Declaring a pointcut</h4>
<div class="paragraph">
<p>Recall that pointcuts determine join points of interest, and thus enable us to control
when advice executes. <em>Spring AOP only supports method execution join points for Spring
beans</em>, so you can think of a pointcut as matching the execution of methods on Spring
beans. A pointcut declaration has two parts: a signature comprising a name and any
parameters, and a pointcut expression that determines <em>exactly</em> which method
executions we are interested in. In the @AspectJ annotation-style of AOP, a pointcut
signature is provided by a regular method definition, and the pointcut expression is
indicated using the <code>@Pointcut</code> annotation (the method serving as the pointcut signature
<em>must</em> have a <code>void</code> return type).</p>
</div>
<div class="paragraph">
<p>An example will help make this distinction between a pointcut signature and a pointcut
expression clear. The following example defines a pointcut named <code>'anyOldTransfer'</code> that
will match the execution of any method named <code>'transfer'</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* transfer(..))</span><span class="delimiter">&quot;</span></span>)<span class="comment">// the pointcut expression</span>
<span class="directive">private</span> <span class="type">void</span> anyOldTransfer() {}<span class="comment">// the pointcut signature</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The pointcut expression that forms the value of the <code>@Pointcut</code> annotation is a regular
AspectJ 5 pointcut expression. For a full discussion of AspectJ&#8217;s pointcut language, see
the <a href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ
Programming Guide</a> (and for extensions, the
<a href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html">AspectJ 5
Developers Notebook</a>) or one of the books on AspectJ such as "Eclipse AspectJ" by Colyer
et. al. or "AspectJ in Action" by Ramnivas Laddad.</p>
</div>
<div class="sect4">
<h5 id="aop-pointcuts-designators"><a class="anchor" href="core.html#aop-pointcuts-designators"></a>Supported Pointcut Designators</h5>
<div class="paragraph">
<p>Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut
expressions:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Other pointcut types</div>
<div class="paragraph">
<p>The full AspectJ pointcut language supports additional pointcut designators that are not
supported in Spring. These are: <code>call, get, set, preinitialization,
staticinitialization, initialization, handler, adviceexecution, withincode, cflow,
cflowbelow, if, @this</code>, and <code>@withincode</code>. Use of these pointcut designators in pointcut
expressions interpreted by Spring AOP will result in an <code>IllegalArgumentException</code> being
thrown.</p>
</div>
<div class="paragraph">
<p>The set of pointcut designators supported by Spring AOP may be extended in future
releases to support more of the AspectJ pointcut designators.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>execution</em> - for matching method execution join points, this is the primary
pointcut designator you will use when working with Spring AOP</p>
</li>
<li>
<p><em>within</em> - limits matching to join points within certain types (simply the execution
of a method declared within a matching type when using Spring AOP)</p>
</li>
<li>
<p><em>this</em> - limits matching to join points (the execution of methods when using Spring
AOP) where the bean reference (Spring AOP proxy) is an instance of the given type</p>
</li>
<li>
<p><em>target</em> - limits matching to join points (the execution of methods when using
Spring AOP) where the target object (application object being proxied) is an instance
of the given type</p>
</li>
<li>
<p><em>args</em> - limits matching to join points (the execution of methods when using Spring
AOP) where the arguments are instances of the given types</p>
</li>
<li>
<p><em>@target</em> - limits matching to join points (the execution of methods when using
Spring AOP) where the class of the executing object has an annotation of the given type</p>
</li>
<li>
<p><em>@args</em> - limits matching to join points (the execution of methods when using Spring
AOP) where the runtime type of the actual arguments passed have annotations of the
given type(s)</p>
</li>
<li>
<p><em>@within</em> - limits matching to join points within types that have the given
annotation (the execution of methods declared in types with the given annotation when
using Spring AOP)</p>
</li>
<li>
<p><em>@annotation</em> - limits matching to join points where the subject of the join point
(method being executed in Spring AOP) has the given annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because Spring AOP limits matching to only method execution join points, the discussion
of the pointcut designators above gives a narrower definition than you will find in the
AspectJ programming guide. In addition, AspectJ itself has type-based semantics and at
an execution join point both <code>this</code> and <code>target</code> refer to the same object - the
object executing the method. Spring AOP is a proxy-based system and differentiates
between the proxy object itself (bound to <code>this</code>) and the target object behind the
proxy (bound to <code>target</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the proxy-based nature of Spring&#8217;s AOP framework, calls within the target object
are by definition <em>not</em> intercepted. For JDK proxies, only public interface method
calls on the proxy can be intercepted. With CGLIB, public and protected method calls on
the proxy will be intercepted, and even package-visible methods if necessary. However,
common interactions through proxies should always be designed through public signatures.</p>
</div>
<div class="paragraph">
<p>Note that pointcut definitions are generally matched against any intercepted method.
If a pointcut is strictly meant to be public-only, even in a CGLIB proxy scenario with
potential non-public interactions through proxies, it needs to be defined accordingly.</p>
</div>
<div class="paragraph">
<p>If your interception needs include method calls or even constructors within the target
class, consider the use of Spring-driven <a href="core.html#aop-aj-ltw">native AspectJ weaving</a> instead
of Spring&#8217;s proxy-based AOP framework. This constitutes a different mode of AOP usage
with different characteristics, so be sure to make yourself familiar with weaving first
before making a decision.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring AOP also supports an additional PCD named <code>bean</code>. This PCD allows you to limit
the matching of join points to a particular named Spring bean, or to a set of named
Spring beans (when using wildcards). The <code>bean</code> PCD has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bean(idOrNameOfBean)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>idOrNameOfBean</code> token can be the name of any Spring bean: limited wildcard
support using the <code>*</code> character is provided, so if you establish some naming
conventions for your Spring beans you can quite easily write a <code>bean</code> PCD expression
to pick them out. As is the case with other pointcut designators, the <code>bean</code> PCD can
be &amp;&amp;'ed, ||'ed, and ! (negated) too.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that the <code>bean</code> PCD is <em>only</em> supported in Spring AOP - and <em>not</em> in
native AspectJ weaving. It is a Spring-specific extension to the standard PCDs that
AspectJ defines and therefore not available for aspects declared in the <code>@Aspect</code> model.</p>
</div>
<div class="paragraph">
<p>The <code>bean</code> PCD operates at the <em>instance</em> level (building on the Spring bean name
concept) rather than at the type level only (which is what weaving-based AOP is limited
to). Instance-based pointcut designators are a special capability of Spring&#8217;s
proxy-based AOP framework and its close integration with the Spring bean factory, where
it is natural and straightforward to identify specific beans by name.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-pointcuts-combining"><a class="anchor" href="core.html#aop-pointcuts-combining"></a>Combining pointcut expressions</h5>
<div class="paragraph">
<p>Pointcut expressions can be combined using '&amp;&amp;', '||' and '!'. It is also possible to
refer to pointcut expressions by name. The following example shows three pointcut
expressions: <code>anyPublicOperation</code> (which matches if a method execution join point
represents the execution of any public method); <code>inTrading</code> (which matches if a method
execution is in the trading module), and <code>tradingOperation</code> (which matches if a method
execution represents any public method in the trading module).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * *(..))</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">void</span> anyPublicOperation() {}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">within(com.xyz.someapp.trading..*)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">void</span> inTrading() {}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">anyPublicOperation() &amp;&amp; inTrading()</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">void</span> tradingOperation() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a best practice to build more complex pointcut expressions out of smaller named
components as shown above. When referring to pointcuts by name, normal Java visibility
rules apply (you can see private pointcuts in the same type, protected pointcuts in the
hierarchy, public pointcuts anywhere and so on). Visibility does not affect pointcut
<em>matching</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-common-pointcuts"><a class="anchor" href="core.html#aop-common-pointcuts"></a>Sharing common pointcut definitions</h5>
<div class="paragraph">
<p>When working with enterprise applications, you often want to refer to modules of the
application and particular sets of operations from within several aspects. We recommend
defining a "SystemArchitecture" aspect that captures common pointcut expressions for
this purpose. A typical such aspect would look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.xyz.someapp</span>;

<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Pointcut</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SystemArchitecture</span> {

    <span class="comment">/**
     * A join point is in the web layer if the method is defined
     * in a type in the com.xyz.someapp.web package or any sub-package
     * under that.
     */</span>
    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">within(com.xyz.someapp.web..*)</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> inWebLayer() {}

    <span class="comment">/**
     * A join point is in the service layer if the method is defined
     * in a type in the com.xyz.someapp.service package or any sub-package
     * under that.
     */</span>
    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">within(com.xyz.someapp.service..*)</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> inServiceLayer() {}

    <span class="comment">/**
     * A join point is in the data access layer if the method is defined
     * in a type in the com.xyz.someapp.dao package or any sub-package
     * under that.
     */</span>
    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">within(com.xyz.someapp.dao..*)</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> inDataAccessLayer() {}

    <span class="comment">/**
     * A business service is the execution of any method defined on a service
     * interface. This definition assumes that interfaces are placed in the
     * &quot;service&quot; package, and that implementation types are in sub-packages.
     *
     * If you group service interfaces by functional area (for example,
     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service) then
     * the pointcut expression &quot;execution(* com.xyz.someapp..service.*.*(..))&quot;
     * could be used instead.
     *
     * Alternatively, you can write the expression using the 'bean'
     * PCD, like so &quot;bean(*Service)&quot;. (This assumes that you have
     * named your Spring service beans in a consistent fashion.)
     */</span>
    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.someapp..service.*.*(..))</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> businessService() {}

    <span class="comment">/**
     * A data access operation is the execution of any method defined on a
     * dao interface. This definition assumes that interfaces are placed in the
     * &quot;dao&quot; package, and that implementation types are in sub-packages.
     */</span>
    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.someapp.dao.*.*(..))</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> dataAccessOperation() {}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pointcuts defined in such an aspect can be referred to anywhere that you need a
pointcut expression. For example, to make the service layer transactional, you could
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>
    <span class="tag">&lt;aop:advisor</span>
        <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.someapp.SystemArchitecture.businessService()</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">advice-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tx-advice</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span>

<span class="tag">&lt;tx:advice</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tx-advice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tx:attributes&gt;</span>
        <span class="tag">&lt;tx:method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">propagation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tx:attributes&gt;</span>
<span class="tag">&lt;/tx:advice&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;aop:config&gt;</code> and <code>&lt;aop:advisor&gt;</code> elements are discussed in <a href="core.html#aop-schema">Schema-based AOP support</a>. The
transaction elements are discussed in <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">Transaction Management</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-pointcuts-examples"><a class="anchor" href="core.html#aop-pointcuts-examples"></a>Examples</h5>
<div class="paragraph">
<p>Spring AOP users are likely to use the <code>execution</code> pointcut designator the most often.
The format of an execution expression is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern)
            <span class="directive">throws</span>-pattern?)</code></pre>
</div>
</div>
<div class="paragraph">
<p>All parts except the returning type pattern (ret-type-pattern in the snippet above),
name pattern, and parameters pattern are optional. The returning type pattern determines
what the return type of the method must be in order for a join point to be matched. Most
frequently you will use <code>*</code> as the returning type pattern, which matches any return
type. A fully-qualified type name will match only when the method returns the given
type. The name pattern matches the method name. You can use the <code>*</code> wildcard as all or
part of a name pattern. If specifying a declaring type pattern
then include a trailing <code>.</code> to join it to the name pattern component.
The parameters pattern is slightly more complex: <code>()</code> matches a
method that takes no parameters, whereas <code>(..)</code> matches any number of parameters (zero
or more). The pattern <code>(*)</code> matches a method taking one parameter of any type,
<code>(*,String)</code> matches a method taking two parameters, the first can be of any type, the
second must be a String. Consult the
<a href="https://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html">Language
Semantics</a> section of the AspectJ Programming Guide for more information.</p>
</div>
<div class="paragraph">
<p>Some examples of common pointcut expressions are given below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the execution of any public method:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(<span class="directive">public</span> * *(..))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the execution of any method with a name beginning with "set":</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(* set*(..))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the execution of any method defined by the <code>AccountService</code> interface:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(* com.xyz.service.AccountService.*(..))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the execution of any method defined in the service package:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(* com.xyz.service.*.*(..))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the execution of any method defined in the service package or a sub-package:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">execution(* com.xyz.service..*.*(..))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) within the service package:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">within(com.xyz.service.*)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) within the service package or a
sub-package:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">within(com.xyz.service..*)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) where the proxy implements the
<code>AccountService</code> interface:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="local-variable">this</span>(com.xyz.service.AccountService)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'this' is more commonly used in a binding form :- see the following section on advice
for how to make the proxy object available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) where the target object
implements the <code>AccountService</code> interface:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">target(com.xyz.service.AccountService)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'target' is more commonly used in a binding form :- see the following section on advice
for how to make the target object available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) which takes a single parameter,
and where the argument passed at runtime is <code>Serializable</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">args(java.io.Serializable)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'args' is more commonly used in a binding form :- see the following section on advice
for how to make the method arguments available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the pointcut given in this example is different to <code>execution(*
*(java.io.Serializable))</code>: the args version matches if the argument passed at runtime is
Serializable, the execution version matches if the method signature declares a single
parameter of type <code>Serializable</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) where the target object has an
<code>@Transactional</code> annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@target</span>(org.springframework.transaction.annotation.Transactional)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'@target' can also be used in a binding form :- see the following section on advice for
how to make the annotation object available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) where the declared type of the
target object has an <code>@Transactional</code> annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@within</span>(org.springframework.transaction.annotation.Transactional)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'@within' can also be used in a binding form :- see the following section on advice for
how to make the annotation object available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) where the executing method has an
<code>@Transactional</code> annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@annotation</span>(org.springframework.transaction.annotation.Transactional)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'@annotation' can also be used in a binding form :- see the following section on advice
for how to make the annotation object available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) which takes a single parameter,
and where the runtime type of the argument passed has the <code>@Classified</code> annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@args</span>(com.xyz.security.Classified)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'@args' can also be used in a binding form :- see the following section on advice for
how to make the annotation object(s) available in the advice body.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) on a Spring bean named
<code>tradeService</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bean(tradeService)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>any join point (method execution only in Spring AOP) on Spring beans having names that
match the wildcard expression <code>*Service</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">bean(*Service)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="writing-good-pointcuts"><a class="anchor" href="core.html#writing-good-pointcuts"></a>Writing good pointcuts</h5>
<div class="paragraph">
<p>During compilation, AspectJ processes pointcuts in order to try and optimize matching
performance. Examining code and determining if each join point matches (statically or
dynamically) a given pointcut is a costly process. (A dynamic match means the match
cannot be fully determined from static analysis and a test will be placed in the code to
determine if there is an actual match when the code is running). On first encountering a
pointcut declaration, AspectJ will rewrite it into an optimal form for the matching
process. What does this mean? Basically pointcuts are rewritten in DNF (Disjunctive
Normal Form) and the components of the pointcut are sorted such that those components
that are cheaper to evaluate are checked first. This means you do not have to worry
about understanding the performance of various pointcut designators and may supply them
in any order in a pointcut declaration.</p>
</div>
<div class="paragraph">
<p>However, AspectJ can only work with what it is told, and for optimal performance of
matching you should think about what they are trying to achieve and narrow the search
space for matches as much as possible in the definition. The existing designators
naturally fall into one of three groups: kinded, scoping and context:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kinded designators are those which select a particular kind of join point. For
example: execution, get, set, call, handler</p>
</li>
<li>
<p>Scoping designators are those which select a group of join points of interest (of
probably many kinds). For example: within, withincode</p>
</li>
<li>
<p>Contextual designators are those that match (and optionally bind) based on context.
For example: this, target, @annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A well written pointcut should try and include at least the first two types (kinded and
scoping), whilst the contextual designators may be included if wishing to match based on
join point context, or bind that context for use in the advice. Supplying either just a
kinded designator or just a contextual designator will work but could affect weaving
performance (time and memory used) due to all the extra processing and analysis. Scoping
designators are very fast to match and their usage means AspectJ can very quickly
dismiss groups of join points that should not be further processed - that is why a good
pointcut should always include one if possible.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-advice"><a class="anchor" href="core.html#aop-advice"></a>5.2.4. Declaring advice</h4>
<div class="paragraph">
<p>Advice is associated with a pointcut expression, and runs before, after, or around
method executions matched by the pointcut. The pointcut expression may be either a
simple reference to a named pointcut, or a pointcut expression declared in place.</p>
</div>
<div class="sect4">
<h5 id="aop-advice-before"><a class="anchor" href="core.html#aop-advice-before"></a>Before advice</h5>
<div class="paragraph">
<p>Before advice is declared in an aspect using the <code>@Before</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Before</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeforeExample</span> {

    <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doAccessCheck() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If using an in-place pointcut expression we could rewrite the above example as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Before</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeforeExample</span> {

    <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.dao.*.*(..))</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doAccessCheck() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-advice-after-returning"><a class="anchor" href="core.html#aop-advice-after-returning"></a>After returning advice</h5>
<div class="paragraph">
<p>After returning advice runs when a matched method execution returns normally. It is
declared using the <code>@AfterReturning</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.AfterReturning</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfterReturningExample</span> {

    <span class="annotation">@AfterReturning</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doAccessCheck() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note: it is of course possible to have multiple advice declarations, and other members
as well, all inside the same aspect. We&#8217;re just showing a single advice declaration in
these examples to focus on the issue under discussion at the time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you need access in the advice body to the actual value that was returned. You
can use the form of <code>@AfterReturning</code> that binds the return value for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.AfterReturning</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfterReturningExample</span> {

    <span class="annotation">@AfterReturning</span>(
        pointcut=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>,
        returning=<span class="string"><span class="delimiter">&quot;</span><span class="content">retVal</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doAccessCheck(<span class="predefined-type">Object</span> retVal) {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name used in the <code>returning</code> attribute must correspond to the name of a parameter in
the advice method. When a method execution returns, the return value will be passed to
the advice method as the corresponding argument value. A <code>returning</code> clause also
restricts matching to only those method executions that return a value of the specified
type ( <code>Object</code> in this case, which will match any return value).</p>
</div>
<div class="paragraph">
<p>Please note that it is <em>not</em> possible to return a totally different reference when
using after-returning advice.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-advice-after-throwing"><a class="anchor" href="core.html#aop-advice-after-throwing"></a>After throwing advice</h5>
<div class="paragraph">
<p>After throwing advice runs when a matched method execution exits by throwing an
exception. It is declared using the <code>@AfterThrowing</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.AfterThrowing</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfterThrowingExample</span> {

    <span class="annotation">@AfterThrowing</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doRecoveryActions() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often you want the advice to run only when exceptions of a given type are thrown, and
you also often need access to the thrown exception in the advice body. Use the
<code>throwing</code> attribute to both restrict matching (if desired, use <code>Throwable</code> as the
exception type otherwise) and bind the thrown exception to an advice parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.AfterThrowing</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfterThrowingExample</span> {

    <span class="annotation">@AfterThrowing</span>(
        pointcut=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>,
        throwing=<span class="string"><span class="delimiter">&quot;</span><span class="content">ex</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doRecoveryActions(DataAccessException ex) {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name used in the <code>throwing</code> attribute must correspond to the name of a parameter in
the advice method. When a method execution exits by throwing an exception, the exception
will be passed to the advice method as the corresponding argument value. A <code>throwing</code>
clause also restricts matching to only those method executions that throw an exception
of the specified type ( <code>DataAccessException</code> in this case).</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-advice-after-finally"><a class="anchor" href="core.html#aop-advice-after-finally"></a>After (finally) advice</h5>
<div class="paragraph">
<p>After (finally) advice runs however a matched method execution exits. It is declared
using the <code>@After</code> annotation. After advice must be prepared to handle both normal and
exception return conditions. It is typically used for releasing resources, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.After</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfterFinallyExample</span> {

    <span class="annotation">@After</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> doReleaseLock() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-ataspectj-around-advice"><a class="anchor" href="core.html#aop-ataspectj-around-advice"></a>Around advice</h5>
<div class="paragraph">
<p>The final kind of advice is around advice. Around advice runs "around" a matched method
execution. It has the opportunity to do work both before and after the method executes,
and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method
execution in a thread-safe manner (starting and stopping a timer for example). Always
use the least powerful form of advice that meets your requirements (i.e. don&#8217;t use
around advice if simple before advice would do).</p>
</div>
<div class="paragraph">
<p>Around advice is declared using the <code>@Around</code> annotation. The first parameter of the
advice method must be of type <code>ProceedingJoinPoint</code>. Within the body of the advice,
calling <code>proceed()</code> on the <code>ProceedingJoinPoint</code> causes the underlying method to
execute. The <code>proceed</code> method may also be called passing in an <code>Object[]</code> - the values
in the array will be used as the arguments to the method execution when it proceeds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The behavior of proceed when called with an Object[] is a little different than the
behavior of proceed for around advice compiled by the AspectJ compiler. For around
advice written using the traditional AspectJ language, the number of arguments passed to
proceed must match the number of arguments passed to the around advice (not the number
of arguments taken by the underlying join point), and the value passed to proceed in a
given argument position supplants the original value at the join point for the entity
the value was bound to (Don&#8217;t worry if this doesn&#8217;t make sense right now!). The approach
taken by Spring is simpler and a better match to its proxy-based, execution only
semantics. You only need to be aware of this difference if you are compiling @AspectJ
aspects written for Spring and using proceed with arguments with the AspectJ compiler
and weaver. There is a way to write such aspects that is 100% compatible across both
Spring AOP and AspectJ, and this is discussed in the following section on advice
parameters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Around</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.ProceedingJoinPoint</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AroundExample</span> {

    <span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Object</span> doBasicProfiling(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="comment">// start stopwatch</span>
        <span class="predefined-type">Object</span> retVal = pjp.proceed();
        <span class="comment">// stop stopwatch</span>
        <span class="keyword">return</span> retVal;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value returned by the around advice will be the return value seen by the caller of
the method. A simple caching aspect for example could return a value from a cache if it
has one, and invoke proceed() if it does not. Note that proceed may be invoked once,
many times, or not at all within the body of the around advice, all of these are quite
legal.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-ataspectj-advice-params"><a class="anchor" href="core.html#aop-ataspectj-advice-params"></a>Advice parameters</h5>
<div class="paragraph">
<p>Spring offers fully typed advice - meaning that you declare the parameters you need
in the advice signature (as we saw for the returning and throwing examples above) rather
than work with <code>Object[]</code> arrays all the time. We&#8217;ll see how to make argument and other
contextual values available to the advice body in a moment. First let&#8217;s take a look at
how to write generic advice that can find out about the method the advice is currently
advising.</p>
</div>
<div class="sect5">
<h6 id="aop-ataspectj-advice-params-the-joinpoint"><a class="anchor" href="core.html#aop-ataspectj-advice-params-the-joinpoint"></a>Access to the current JoinPoint</h6>
<div class="paragraph">
<p>Any advice method may declare as its first parameter, a parameter of type
<code>org.aspectj.lang.JoinPoint</code> (please note that around advice is <em>required</em> to declare
a first parameter of type <code>ProceedingJoinPoint</code>, which is a subclass of <code>JoinPoint</code>. The
<code>JoinPoint</code> interface provides a number of useful methods such as <code>getArgs()</code> (returns
the method arguments), <code>getThis()</code> (returns the proxy object), <code>getTarget()</code> (returns
the target object), <code>getSignature()</code> (returns a description of the method that is being
advised) and <code>toString()</code> (prints a useful description of the method being advised).
Please do consult the javadocs for full details.</p>
</div>
</div>
<div class="sect5">
<h6 id="aop-ataspectj-advice-params-passing"><a class="anchor" href="core.html#aop-ataspectj-advice-params-passing"></a>Passing parameters to advice</h6>
<div class="paragraph">
<p>We&#8217;ve already seen how to bind the returned value or exception value (using after
returning and after throwing advice). To make argument values available to the advice
body, you can use the binding form of <code>args</code>. If a parameter name is used in place of a
type name in an args expression, then the value of the corresponding argument will be
passed as the parameter value when the advice is invoked. An example should make this
clearer. Suppose you want to advise the execution of dao operations that take an Account
object as the first parameter, and you need access to the account in the advice body.
You could write the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> validateAccount(Account account) {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>args(account,..)</code> part of the pointcut expression serves two purposes: firstly, it
restricts matching to only those method executions where the method takes at least one
parameter, and the argument passed to that parameter is an instance of <code>Account</code>;
secondly, it makes the actual <code>Account</code> object available to the advice via the <code>account</code>
parameter.</p>
</div>
<div class="paragraph">
<p>Another way of writing this is to declare a pointcut that "provides" the <code>Account</code>
object value when it matches a join point, and then just refer to the named pointcut
from the advice. This would look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">void</span> accountDataAccessOperation(Account account) {}

<span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDataAccessOperation(account)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> validateAccount(Account account) {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interested reader is once more referred to the AspectJ programming guide for more
details.</p>
</div>
<div class="paragraph">
<p>The proxy object ( <code>this</code>), target object ( <code>target</code>), and annotations ( <code>@within,
@target, @annotation, @args</code>) can all be bound in a similar fashion. The following
example shows how you could match the execution of methods annotated with an
<code>@Auditable</code> annotation, and extract the audit code.</p>
</div>
<div class="paragraph">
<p>First the definition of the <code>@Auditable</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.METHOD)
<span class="directive">public</span> <span class="annotation">@interface</span> Auditable {
    AuditCode value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then the advice that matches the execution of <code>@Auditable</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> audit(Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="aop-ataspectj-advice-params-generics"><a class="anchor" href="core.html#aop-ataspectj-advice-params-generics"></a>Advice parameters and generics</h6>
<div class="paragraph">
<p>Spring AOP can handle generics used in class declarations and method parameters. Suppose
you have a generic type like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Sample</span>&lt;T&gt; {
    <span class="type">void</span> sampleGenericMethod(T param);
    <span class="type">void</span> sampleGenericCollectionMethod(<span class="predefined-type">Collection</span>&lt;T&gt; param);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can restrict interception of method types to certain parameter types by simply
typing the advice parameter to the parameter type you want to intercept the method for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> beforeSampleMethod(MyType param) {
    <span class="comment">// Advice implementation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That this works is pretty obvious as we already discussed above. However, it&#8217;s worth
pointing out that this won&#8217;t work for generic collections. So you cannot define a
pointcut like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> beforeSampleMethod(<span class="predefined-type">Collection</span>&lt;MyType&gt; param) {
    <span class="comment">// Advice implementation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work we would have to inspect every element of the collection, which is not
reasonable as we also cannot decide how to treat <code>null</code> values in general. To achieve
something similar to this you have to type the parameter to <code>Collection&lt;?&gt;</code> and manually
check the type of the elements.</p>
</div>
</div>
<div class="sect5">
<h6 id="aop-ataspectj-advice-params-names"><a class="anchor" href="core.html#aop-ataspectj-advice-params-names"></a>Determining argument names</h6>
<div class="paragraph">
<p>The parameter binding in advice invocations relies on matching names used in pointcut
expressions to declared parameter names in (advice and pointcut) method signatures.
Parameter names are <em>not</em> available through Java reflection, so Spring AOP uses the
following strategies to determine parameter names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the parameter names have been specified by the user explicitly, then the specified
parameter names are used: both the advice and the pointcut annotations have
an optional "argNames" attribute which can be used to specify the argument names of
the annotated method - these argument names <em>are</em> available at runtime. For example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)</span><span class="delimiter">&quot;</span></span>,
        argNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean,auditable</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> audit(<span class="predefined-type">Object</span> bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="comment">// ... use code and bean</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the first parameter is of the <code>JoinPoint</code>, <code>ProceedingJoinPoint</code>, or
<code>JoinPoint.StaticPart</code> type, you may leave out the name of the parameter from the value
of the "argNames" attribute. For example, if you modify the preceding advice to receive
the join point object, the "argNames" attribute need not include it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)</span><span class="delimiter">&quot;</span></span>,
        argNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean,auditable</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> audit(JoinPoint jp, <span class="predefined-type">Object</span> bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="comment">// ... use code, bean, and jp</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The special treatment given to the first parameter of the <code>JoinPoint</code>,
<code>ProceedingJoinPoint</code>, and <code>JoinPoint.StaticPart</code> types is particularly convenient for
advice that do not collect any other join point context. In such situations, you may
simply omit the "argNames" attribute. For example, the following advice need not declare
the "argNames" attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.lib.Pointcuts.anyPublicMethod()</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> audit(JoinPoint jp) {
    <span class="comment">// ... use jp</span>
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>'argNames'</code> attribute is a little clumsy, so if the <code>'argNames'</code> attribute
has not been specified, then Spring AOP will look at the debug information for the
class and try to determine the parameter names from the local variable table. This
information will be present as long as the classes have been compiled with debug
information ( <code>'-g:vars'</code> at a minimum). The consequences of compiling with this flag
on are: (1) your code will be slightly easier to understand (reverse engineer), (2)
the class file sizes will be very slightly bigger (typically inconsequential), (3) the
optimization to remove unused local variables will not be applied by your compiler. In
other words, you should encounter no difficulties building with this flag on.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If an @AspectJ aspect has been compiled by the AspectJ compiler (ajc) even without the
debug information then there is no need to add the argNames attribute as the compiler
will retain the needed information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>If the code has been compiled without the necessary debug information, then Spring AOP
will attempt to deduce the pairing of binding variables to parameters (for example, if
only one variable is bound in the pointcut expression, and the advice method only
takes one parameter, the pairing is obvious!). If the binding of variables is
ambiguous given the available information, then an <code>AmbiguousBindingException</code> will be
thrown.</p>
</li>
<li>
<p>If all of the above strategies fail then an <code>IllegalArgumentException</code> will be thrown.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="aop-ataspectj-advice-proceeding-with-the-call"><a class="anchor" href="core.html#aop-ataspectj-advice-proceeding-with-the-call"></a>Proceeding with arguments</h6>
<div class="paragraph">
<p>We remarked earlier that we would describe how to write a proceed call <em>with
arguments</em> that works consistently across Spring AOP and AspectJ. The solution is
simply to ensure that the advice signature binds each of the method parameters in order.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(List&lt;Account&gt; find*(..)) &amp;&amp; </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">args(accountHolderNamePattern)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Object</span> preProcessQueryPattern(ProceedingJoinPoint pjp,
        <span class="predefined-type">String</span> accountHolderNamePattern) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
    <span class="predefined-type">String</span> newPattern = preProcess(accountHolderNamePattern);
    <span class="keyword">return</span> pjp.proceed(<span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span> {newPattern});
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In many cases you will be doing this binding anyway (as in the example above).</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-ataspectj-advice-ordering"><a class="anchor" href="core.html#aop-ataspectj-advice-ordering"></a>Advice ordering</h5>
<div class="paragraph">
<p>What happens when multiple pieces of advice all want to run at the same join point?
Spring AOP follows the same precedence rules as AspectJ to determine the order of advice
execution. The highest precedence advice runs first "on the way in" (so given two pieces
of before advice, the one with highest precedence runs first). "On the way out" from a
join point, the highest precedence advice runs last (so given two pieces of after
advice, the one with the highest precedence will run second).</p>
</div>
<div class="paragraph">
<p>When two pieces of advice defined in <em>different</em> aspects both need to run at the same
join point, unless you specify otherwise the order of execution is undefined. You can
control the order of execution by specifying precedence. This is done in the normal
Spring way by either implementing the <code>org.springframework.core.Ordered</code> interface in
the aspect class or annotating it with the <code>Order</code> annotation. Given two aspects, the
aspect returning the lower value from <code>Ordered.getValue()</code> (or the annotation value) has
the higher precedence.</p>
</div>
<div class="paragraph">
<p>When two pieces of advice defined in <em>the same</em> aspect both need to run at the same
join point, the ordering is undefined (since there is no way to retrieve the declaration
order via reflection for javac-compiled classes). Consider collapsing such advice
methods into one advice method per join point in each aspect class, or refactor the
pieces of advice into separate aspect classes - which can be ordered at the aspect level.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-introductions"><a class="anchor" href="core.html#aop-introductions"></a>5.2.5. Introductions</h4>
<div class="paragraph">
<p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare
that advised objects implement a given interface, and to provide an implementation of
that interface on behalf of those objects.</p>
</div>
<div class="paragraph">
<p>An introduction is made using the <code>@DeclareParents</code> annotation. This annotation is used
to declare that matching types have a new parent (hence the name). For example, given an
interface <code>UsageTracked</code>, and an implementation of that interface <code>DefaultUsageTracked</code>,
the following aspect declares that all implementors of service interfaces also implement
the <code>UsageTracked</code> interface. (In order to expose statistics via JMX for example.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UsageTracking</span> {

    <span class="annotation">@DeclareParents</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xzy.myapp.service.*+</span><span class="delimiter">&quot;</span></span>, defaultImpl=DefaultUsageTracked.class)
    <span class="directive">public</span> <span class="directive">static</span> UsageTracked mixin;

    <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> recordUsage(UsageTracked usageTracked) {
        usageTracked.incrementUseCount();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface to be implemented is determined by the type of the annotated field. The
<code>value</code> attribute of the <code>@DeclareParents</code> annotation is an AspectJ type pattern :- any
bean of a matching type will implement the UsageTracked interface. Note that in the
before advice of the above example, service beans can be directly used as
implementations of the <code>UsageTracked</code> interface. If accessing a bean programmatically
you would write the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-instantiation-models"><a class="anchor" href="core.html#aop-instantiation-models"></a>5.2.6. Aspect instantiation models</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>(This is an advanced topic, so if you are just starting out with AOP you can safely skip
it until later.)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default there will be a single instance of each aspect within the application
context. AspectJ calls this the singleton instantiation model. It is possible to define
aspects with alternate lifecycles :- Spring supports AspectJ&#8217;s <code>perthis</code> and <code>pertarget</code>
instantiation models ( <code>percflow, percflowbelow,</code> and <code>pertypewithin</code> are not currently
supported).</p>
</div>
<div class="paragraph">
<p>A "perthis" aspect is declared by specifying a <code>perthis</code> clause in the <code>@Aspect</code>
annotation. Let&#8217;s look at an example, and then we&#8217;ll explain how it works.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Aspect</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">perthis(com.xyz.myapp.SystemArchitecture.businessService())</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyAspect</span> {

    <span class="directive">private</span> <span class="type">int</span> someState;

    <span class="annotation">@Before</span>(com.xyz.myapp.SystemArchitecture.businessService())
    <span class="directive">public</span> <span class="type">void</span> recordServiceUsage() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The effect of the <code>'perthis'</code> clause is that one aspect instance will be created for
each unique service object executing a business service (each unique object bound to
'this' at join points matched by the pointcut expression). The aspect instance is
created the first time that a method is invoked on the service object. The aspect goes
out of scope when the service object goes out of scope. Before the aspect instance is
created, none of the advice within it executes. As soon as the aspect instance has been
created, the advice declared within it will execute at matched join points, but only
when the service object is the one this aspect is associated with. See the AspectJ
programming guide for more information on per-clauses.</p>
</div>
<div class="paragraph">
<p>The <code>'pertarget'</code> instantiation model works in exactly the same way as perthis, but
creates one aspect instance for each unique target object at matched join points.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-ataspectj-example"><a class="anchor" href="core.html#aop-ataspectj-example"></a>5.2.7. Example</h4>
<div class="paragraph">
<p>Now that you have seen how all the constituent parts work, let&#8217;s put them together to do
something useful!</p>
</div>
<div class="paragraph">
<p>The execution of business services can sometimes fail due to concurrency issues (for
example, deadlock loser). If the operation is retried, it is quite likely to succeed
next time round. For business services where it is appropriate to retry in such
conditions (idempotent operations that don&#8217;t need to go back to the user for conflict
resolution), we&#8217;d like to transparently retry the operation to avoid the client seeing a
<code>PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
multiple services in the service layer, and hence is ideal for implementing via an
aspect.</p>
</div>
<div class="paragraph">
<p>Because we want to retry the operation, we will need to use around advice so that we can
call proceed multiple times. Here&#8217;s how the basic aspect implementation looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConcurrentOperationExecutor</span> <span class="directive">implements</span> Ordered {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DEFAULT_MAX_RETRIES = <span class="integer">2</span>;

    <span class="directive">private</span> <span class="type">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="directive">private</span> <span class="type">int</span> order = <span class="integer">1</span>;

    <span class="directive">public</span> <span class="type">void</span> setMaxRetries(<span class="type">int</span> maxRetries) {
        <span class="local-variable">this</span>.maxRetries = maxRetries;
    }

    <span class="directive">public</span> <span class="type">int</span> getOrder() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.order;
    }

    <span class="directive">public</span> <span class="type">void</span> setOrder(<span class="type">int</span> order) {
        <span class="local-variable">this</span>.order = order;
    }

    <span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Object</span> doConcurrentOperation(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="type">int</span> numAttempts = <span class="integer">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="keyword">do</span> {
            numAttempts++;
            <span class="keyword">try</span> {
                <span class="keyword">return</span> pjp.proceed();
            }
            <span class="keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="keyword">while</span>(numAttempts &lt;= <span class="local-variable">this</span>.maxRetries);
        <span class="keyword">throw</span> lockFailureException;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the aspect implements the <code>Ordered</code> interface so we can set the precedence of
the aspect higher than the transaction advice (we want a fresh transaction each time we
retry). The <code>maxRetries</code> and <code>order</code> properties will both be configured by Spring. The
main action happens in the <code>doConcurrentOperation</code> around advice. Notice that for the
moment we&#8217;re applying the retry logic to all <code>businessService()s</code>. We try to proceed,
and if we fail with an <code>PessimisticLockingFailureException</code> we simply try again unless
we have exhausted all of our retry attempts.</p>
</div>
<div class="paragraph">
<p>The corresponding Spring configuration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspectj-autoproxy</span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrentOperationExecutor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.service.impl.ConcurrentOperationExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxRetries</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To refine the aspect so that it only retries idempotent operations, we might define an
<code>Idempotent</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> Idempotent {
    <span class="comment">// marker annotation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and use the annotation to annotate the implementation of service operations. The change
to the aspect to only retry idempotent operations simply involves refining the pointcut
expression so that only <code>@Idempotent</code> operations match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">@annotation(com.xyz.myapp.service.Idempotent)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Object</span> doConcurrentOperation(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-schema"><a class="anchor" href="core.html#aop-schema"></a>5.3. Schema-based AOP support</h3>
<div class="paragraph">
<p>If you prefer an XML-based format, then Spring also offers support for defining aspects
using the new "aop" namespace tags. The exact same pointcut expressions and advice kinds
are supported as when using the @AspectJ style, hence in this section we will focus on
the new <em>syntax</em> and refer the reader to the discussion in the previous section
(<a href="core.html#aop-ataspectj">@AspectJ support</a>) for an understanding of writing pointcut expressions and the binding
of advice parameters.</p>
</div>
<div class="paragraph">
<p>To use the aop namespace tags described in this section, you need to import the
<code>spring-aop</code> schema as described in <a href="core.html#xsd-schemas">XML Schema-based configuration</a>.
See <a href="core.html#xsd-schemas-aop">the AOP schema</a>
for how to import the tags in the <code>aop</code> namespace.</p>
</div>
<div class="paragraph">
<p>Within your Spring configurations, all aspect and advisor elements must be placed within
an <code>&lt;aop:config&gt;</code> element (you can have more than one <code>&lt;aop:config&gt;</code> element in an
application context configuration). An <code>&lt;aop:config&gt;</code> element can contain pointcut,
advisor, and aspect elements (note these must be declared in that order).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>&lt;aop:config&gt;</code> style of configuration makes heavy use of Spring&#8217;s
<a href="core.html#aop-autoproxy">auto-proxying</a> mechanism. This can cause issues (such as advice not
being woven) if you are already using explicit auto-proxying via the use of
<code>BeanNameAutoProxyCreator</code> or suchlike. The recommended usage pattern is to use either
just the <code>&lt;aop:config&gt;</code> style, or just the <code>AutoProxyCreator</code> style.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aop-schema-declaring-an-aspect"><a class="anchor" href="core.html#aop-schema-declaring-an-aspect"></a>5.3.1. Declaring an aspect</h4>
<div class="paragraph">
<p>Using the schema support, an aspect is simply a regular Java object defined as a bean in
your Spring application context. The state and behavior is captured in the fields and
methods of the object, and the pointcut and advice information is captured in the XML.</p>
</div>
<div class="paragraph">
<p>An aspect is declared using the &lt;aop:aspect&gt; element, and the backing bean is referenced
using the <code>ref</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>
    <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/aop:aspect&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean backing the aspect (" `aBean`" in this case) can of course be configured and
dependency injected just like any other Spring bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-pointcuts"><a class="anchor" href="core.html#aop-schema-pointcuts"></a>5.3.2. Declaring a pointcut</h4>
<div class="paragraph">
<p>A named pointcut can be declared inside an &lt;aop:config&gt; element, enabling the pointcut
definition to be shared across several aspects and advisors.</p>
</div>
<div class="paragraph">
<p>A pointcut representing the execution of any business service in the service layer could
be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the pointcut expression itself is using the same AspectJ pointcut expression
language as described in <a href="core.html#aop-ataspectj">@AspectJ support</a>. If you are using the schema based
declaration style, you can refer to named pointcuts defined in types
(@Aspects) within the pointcut expression. Another way of defining the above pointcut
would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming you have a <code>SystemArchitecture</code> aspect as described in <a href="core.html#aop-common-pointcuts">Sharing common pointcut definitions</a>.</p>
</div>
<div class="paragraph">
<p>Declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        ...

    <span class="tag">&lt;/aop:aspect&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Much the same way in an @AspectJ aspect, pointcuts declared using the schema based
definition style may collect join point context. For example, the following pointcut
collects the 'this' object as the join point context and passes it to advice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..)) </span><span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> <span class="content">this(service)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;aop:before</span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        ...

    <span class="tag">&lt;/aop:aspect&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The advice must be declared to receive the collected join point context by including
parameters of the matching names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> monitor(<span class="predefined-type">Object</span> service) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When combining pointcut sub-expressions, '&amp;&amp;' is awkward within an XML document, and so
the keywords 'and', 'or' and 'not' can be used in place of '&amp;&amp;', '||' and '!'
respectively. For example, the previous pointcut may be better written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..)) **and** this(service)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;aop:before</span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        ...
    <span class="tag">&lt;/aop:aspect&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that pointcuts defined in this way are referred to by their XML id and cannot be
used as named pointcuts to form composite pointcuts. The named pointcut support in the
schema based definition style is thus more limited than that offered by the @AspectJ
style.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-advice"><a class="anchor" href="core.html#aop-schema-advice"></a>5.3.3. Declaring advice</h4>
<div class="paragraph">
<p>The same five advice kinds are supported as for the @AspectJ style, and they have
exactly the same semantics.</p>
</div>
<div class="sect4">
<h5 id="aop-schema-advice-before"><a class="anchor" href="core.html#aop-schema-advice-before"></a>Before advice</h5>
<div class="paragraph">
<p>Before advice runs before a matched method execution. It is declared inside an
<code>&lt;aop:aspect&gt;</code> using the &lt;aop:before&gt; element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beforeExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:before</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doAccessCheck</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>dataAccessOperation</code> is the id of a pointcut defined at the top ( <code>&lt;aop:config&gt;</code>)
level. To define the pointcut inline instead, replace the <code>pointcut-ref</code> attribute with
a <code>pointcut</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beforeExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:before</span>
        <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.dao.*.*(..))</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doAccessCheck</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we noted in the discussion of the @AspectJ style, using named pointcuts can
significantly improve the readability of your code.</p>
</div>
<div class="paragraph">
<p>The method attribute identifies a method ( <code>doAccessCheck</code>) that provides the body of
the advice. This method must be defined for the bean referenced by the aspect element
containing the advice. Before a data access operation is executed (a method execution
join point matched by the pointcut expression), the "doAccessCheck" method on the aspect
bean will be invoked.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-schema-advice-after-returning"><a class="anchor" href="core.html#aop-schema-advice-after-returning"></a>After returning advice</h5>
<div class="paragraph">
<p>After returning advice runs when a matched method execution completes normally. It is
declared inside an <code>&lt;aop:aspect&gt;</code> in the same way as before advice. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterReturningExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:after-returning</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doAccessCheck</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as in the @AspectJ style, it is possible to get hold of the return value within the
advice body. Use the returning attribute to specify the name of the parameter to which
the return value should be passed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterReturningExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:after-returning</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">returning</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">retVal</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doAccessCheck</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The doAccessCheck method must declare a parameter named <code>retVal</code>. The type of this
parameter constrains matching in the same way as described for @AfterReturning. For
example, the method signature may be declared as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> doAccessCheck(<span class="predefined-type">Object</span> retVal) {...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-schema-advice-after-throwing"><a class="anchor" href="core.html#aop-schema-advice-after-throwing"></a>After throwing advice</h5>
<div class="paragraph">
<p>After throwing advice executes when a matched method execution exits by throwing an
exception. It is declared inside an <code>&lt;aop:aspect&gt;</code> using the after-throwing element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterThrowingExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:after-throwing</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doRecoveryActions</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as in the @AspectJ style, it is possible to get hold of the thrown exception within
the advice body. Use the throwing attribute to specify the name of the parameter to
which the exception should be passed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterThrowingExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:after-throwing</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">throwing</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessEx</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doRecoveryActions</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The doRecoveryActions method must declare a parameter named <code>dataAccessEx</code>. The type of
this parameter constrains matching in the same way as described for @AfterThrowing. For
example, the method signature may be declared as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> doRecoveryActions(DataAccessException dataAccessEx) {...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-schema-advice-after-finally"><a class="anchor" href="core.html#aop-schema-advice-after-finally"></a>After (finally) advice</h5>
<div class="paragraph">
<p>After (finally) advice runs however a matched method execution exits. It is declared
using the <code>after</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">afterFinallyExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:after</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataAccessOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doReleaseLock</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-schema-advice-around"><a class="anchor" href="core.html#aop-schema-advice-around"></a>Around advice</h5>
<div class="paragraph">
<p>The final kind of advice is around advice. Around advice runs "around" a matched method
execution. It has the opportunity to do work both before and after the method executes,
and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method
execution in a thread-safe manner (starting and stopping a timer for example). Always
use the least powerful form of advice that meets your requirements; don&#8217;t use around
advice if simple before advice would do.</p>
</div>
<div class="paragraph">
<p>Around advice is declared using the <code>aop:around</code> element. The first parameter of the
advice method must be of type <code>ProceedingJoinPoint</code>. Within the body of the advice,
calling <code>proceed()</code> on the <code>ProceedingJoinPoint</code> causes the underlying method to
execute. The <code>proceed</code> method may also be calling passing in an <code>Object[]</code> - the values
in the array will be used as the arguments to the method execution when it proceeds. See
<a href="core.html#aop-ataspectj-around-advice">Around advice</a> for notes on calling proceed with an <code>Object[]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aroundExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:around</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doBasicProfiling</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    ...

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the <code>doBasicProfiling</code> advice would be exactly the same as in the
@AspectJ example (minus the annotation of course):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> doBasicProfiling(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
    <span class="comment">// start stopwatch</span>
    <span class="predefined-type">Object</span> retVal = pjp.proceed();
    <span class="comment">// stop stopwatch</span>
    <span class="keyword">return</span> retVal;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-schema-params"><a class="anchor" href="core.html#aop-schema-params"></a>Advice parameters</h5>
<div class="paragraph">
<p>The schema based declaration style supports fully typed advice in the same way as
described for the @AspectJ support - by matching pointcut parameters by name against
advice method parameters. See <a href="core.html#aop-ataspectj-advice-params">Advice parameters</a> for details. If you wish
to explicitly specify argument names for the advice methods (not relying on the
detection strategies previously described) then this is done using the <code>arg-names</code>
attribute of the advice element, which is treated in the same manner to the "argNames"
attribute in an advice annotation as described in <a href="core.html#aop-ataspectj-advice-params-names">Determining argument names</a>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:before</span>
    <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">audit</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auditable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>arg-names</code> attribute accepts a comma-delimited list of parameter names.</p>
</div>
<div class="paragraph">
<p>Find below a slightly more involved example of the XSD-based approach that illustrates
some around advice used in conjunction with a number of strongly typed parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">x.y.service</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">FooService</span> {

    Foo getFoo(<span class="predefined-type">String</span> fooName, <span class="type">int</span> age);
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultFooService</span> <span class="directive">implements</span> FooService {

    <span class="directive">public</span> Foo getFoo(<span class="predefined-type">String</span> name, <span class="type">int</span> age) {
        <span class="keyword">return</span> <span class="keyword">new</span> Foo(name, age);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up is the aspect. Notice the fact that the <code>profile(..)</code> method accepts a number of
strongly-typed parameters, the first of which happens to be the join point used to
proceed with the method call: the presence of this parameter is an indication that the
<code>profile(..)</code> is to be used as <code>around</code> advice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">x.y</span>;

<span class="keyword">import</span> <span class="include">org.aspectj.lang.ProceedingJoinPoint</span>;
<span class="keyword">import</span> <span class="include">org.springframework.util.StopWatch</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleProfiler</span> {

    <span class="directive">public</span> <span class="predefined-type">Object</span> profile(ProceedingJoinPoint call, <span class="predefined-type">String</span> name, <span class="type">int</span> age) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        StopWatch clock = <span class="keyword">new</span> StopWatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">Profiling for '</span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">' and '</span><span class="delimiter">&quot;</span></span> + age + <span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">try</span> {
            clock.start(call.toShortString());
            <span class="keyword">return</span> call.proceed();
        } <span class="keyword">finally</span> {
            clock.stop();
            <span class="predefined-type">System</span>.out.println(clock.prettyPrint());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, here is the XML configuration that is required to effect the execution of the
above advice for a particular join point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:aop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.service.DefaultFooService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- this is the actual advice itself --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">profiler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.SimpleProfiler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;aop:config&gt;</span>
        <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">profiler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

            <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theExecutionOfSomeFooServiceMethod</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* x.y.service.FooService.getFoo(String,int))</span>
                <span class="content">and args(name, age)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

            <span class="tag">&lt;aop:around</span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theExecutionOfSomeFooServiceMethod</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">profile</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;/aop:aspect&gt;</span>
    <span class="tag">&lt;/aop:config&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we had the following driver script, we would get output something like this on
standard output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.beans.factory.BeanFactory</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;
<span class="keyword">import</span> <span class="include">x.y.service.FooService</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Boot</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        BeanFactory ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">x/y/plain.xml</span><span class="delimiter">&quot;</span></span>);
        FooService foo = (FooService) ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span>);
        foo.getFoo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pengo</span><span class="delimiter">&quot;</span></span>, <span class="integer">12</span>);
    }
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>StopWatch 'Profiling for 'Pengo' and '12'': running time (millis) = 0
-----------------------------------------
ms     %     Task name
-----------------------------------------
00000  ?  execution(getFoo)</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-ordering"><a class="anchor" href="core.html#aop-ordering"></a>Advice ordering</h5>
<div class="paragraph">
<p>When multiple advice needs to execute at the same join point (executing method) the
ordering rules are as described in <a href="core.html#aop-ataspectj-advice-ordering">Advice ordering</a>. The precedence
between aspects is determined by either adding the <code>Order</code> annotation to the bean
backing the aspect or by having the bean implement the <code>Ordered</code> interface.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-introductions"><a class="anchor" href="core.html#aop-schema-introductions"></a>5.3.4. Introductions</h4>
<div class="paragraph">
<p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare
that advised objects implement a given interface, and to provide an implementation of
that interface on behalf of those objects.</p>
</div>
<div class="paragraph">
<p>An introduction is made using the <code>aop:declare-parents</code> element inside an <code>aop:aspect</code>
This element is used to declare that matching types have a new parent (hence the name).
For example, given an interface <code>UsageTracked</code>, and an implementation of that interface
<code>DefaultUsageTracked</code>, the following aspect declares that all implementors of service
interfaces also implement the <code>UsageTracked</code> interface. (In order to expose statistics
via JMX for example.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usageTrackerAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usageTracking</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;aop:declare-parents</span>
        <span class="attribute-name">types-matching</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xzy.myapp.service.*+</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">implement-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.service.tracking.UsageTracked</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">default-impl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.service.tracking.DefaultUsageTracked</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;aop:before</span>
        <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.businessService()</span>
            <span class="content">and this(usageTracked)</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">recordUsage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The class backing the <code>usageTracking</code> bean would contain the method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface to be implemented is determined by <code>implement-interface</code> attribute. The
value of the <code>types-matching</code> attribute is an AspectJ type pattern :- any bean of a
matching type will implement the <code>UsageTracked</code> interface. Note that in the before
advice of the above example, service beans can be directly used as implementations of
the <code>UsageTracked</code> interface. If accessing a bean programmatically you would write the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-instatiation-models"><a class="anchor" href="core.html#aop-schema-instatiation-models"></a>5.3.5. Aspect instantiation models</h4>
<div class="paragraph">
<p>The only supported instantiation model for schema-defined aspects is the singleton
model. Other instantiation models may be supported in future releases.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-advisors"><a class="anchor" href="core.html#aop-schema-advisors"></a>5.3.6. Advisors</h4>
<div class="paragraph">
<p>The concept of "advisors" is brought forward from the AOP support defined in Spring
and does not have a direct equivalent in AspectJ. An advisor is like a small
self-contained aspect that has a single piece of advice. The advice itself is
represented by a bean, and must implement one of the advice interfaces described in
<a href="core.html#aop-api-advice-types">Advice types in Spring</a>. Advisors can take advantage of AspectJ pointcut expressions
though.</p>
</div>
<div class="paragraph">
<p>Spring supports the advisor concept with the <code>&lt;aop:advisor&gt;</code> element. You will most
commonly see it used in conjunction with transactional advice, which also has its own
namespace support in Spring. Here&#8217;s how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;aop:advisor</span>
        <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">advice-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tx-advice</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span>

<span class="tag">&lt;tx:advice</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tx-advice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tx:attributes&gt;</span>
        <span class="tag">&lt;tx:method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">propagation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tx:attributes&gt;</span>
<span class="tag">&lt;/tx:advice&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as the <code>pointcut-ref</code> attribute used in the above example, you can also use the
<code>pointcut</code> attribute to define a pointcut expression inline.</p>
</div>
<div class="paragraph">
<p>To define the precedence of an advisor so that the advice can participate in ordering,
use the <code>order</code> attribute to define the <code>Ordered</code> value of the advisor.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-schema-example"><a class="anchor" href="core.html#aop-schema-example"></a>5.3.7. Example</h4>
<div class="paragraph">
<p>Let&#8217;s see how the concurrent locking failure retry example from
<a href="core.html#aop-ataspectj-example">Example</a> looks when rewritten using the schema support.</p>
</div>
<div class="paragraph">
<p>The execution of business services can sometimes fail due to concurrency issues (for
example, deadlock loser). If the operation is retried, it is quite likely it will
succeed next time round. For business services where it is appropriate to retry in such
conditions (idempotent operations that don&#8217;t need to go back to the user for conflict
resolution), we&#8217;d like to transparently retry the operation to avoid the client seeing a
<code>PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
multiple services in the service layer, and hence is ideal for implementing via an
aspect.</p>
</div>
<div class="paragraph">
<p>Because we want to retry the operation, we&#8217;ll need to use around advice so that we can
call proceed multiple times. Here&#8217;s how the basic aspect implementation looks (it&#8217;s just
a regular Java class using the schema support):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ConcurrentOperationExecutor</span> <span class="directive">implements</span> Ordered {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DEFAULT_MAX_RETRIES = <span class="integer">2</span>;

    <span class="directive">private</span> <span class="type">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="directive">private</span> <span class="type">int</span> order = <span class="integer">1</span>;

    <span class="directive">public</span> <span class="type">void</span> setMaxRetries(<span class="type">int</span> maxRetries) {
        <span class="local-variable">this</span>.maxRetries = maxRetries;
    }

    <span class="directive">public</span> <span class="type">int</span> getOrder() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.order;
    }

    <span class="directive">public</span> <span class="type">void</span> setOrder(<span class="type">int</span> order) {
        <span class="local-variable">this</span>.order = order;
    }

    <span class="directive">public</span> <span class="predefined-type">Object</span> doConcurrentOperation(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="type">int</span> numAttempts = <span class="integer">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="keyword">do</span> {
            numAttempts++;
            <span class="keyword">try</span> {
                <span class="keyword">return</span> pjp.proceed();
            }
            <span class="keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="keyword">while</span>(numAttempts &lt;= <span class="local-variable">this</span>.maxRetries);
        <span class="keyword">throw</span> lockFailureException;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the aspect implements the <code>Ordered</code> interface so we can set the precedence of
the aspect higher than the transaction advice (we want a fresh transaction each time we
retry). The <code>maxRetries</code> and <code>order</code> properties will both be configured by Spring. The
main action happens in the <code>doConcurrentOperation</code> around advice method. We try to
proceed, and if we fail with a <code>PessimisticLockingFailureException</code> we simply try again
unless we have exhausted all of our retry attempts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This class is identical to the one used in the @AspectJ example, but with the
annotations removed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The corresponding Spring configuration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config&gt;</span>

    <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrentOperationRetry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrentOperationExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">idempotentOperation</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;aop:around</span>
            <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">idempotentOperation</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doConcurrentOperation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;/aop:aspect&gt;</span>

<span class="tag">&lt;/aop:config&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrentOperationExecutor</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.service.impl.ConcurrentOperationExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxRetries</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that for the time being we assume that all business services are idempotent. If
this is not the case we can refine the aspect so that it only retries genuinely
idempotent operations, by introducing an <code>Idempotent</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> Idempotent {
    <span class="comment">// marker annotation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and using the annotation to annotate the implementation of service operations. The
change to the aspect to retry only idempotent operations simply involves refining the
pointcut expression so that only <code>@Idempotent</code> operations match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">idempotentOperation</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.xyz.myapp.service.*.*(..)) and</span>
        <span class="content">@annotation(com.xyz.myapp.service.Idempotent)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-choosing"><a class="anchor" href="core.html#aop-choosing"></a>5.4. Choosing which AOP declaration style to use</h3>
<div class="paragraph">
<p>Once you have decided that an aspect is the best approach for implementing a given
requirement, how do you decide between using Spring AOP or AspectJ, and between the
Aspect language (code) style, @AspectJ annotation style, or the Spring XML style? These
decisions are influenced by a number of factors including application requirements,
development tools, and team familiarity with AOP.</p>
</div>
<div class="sect3">
<h4 id="aop-spring-or-aspectj"><a class="anchor" href="core.html#aop-spring-or-aspectj"></a>5.4.1. Spring AOP or full AspectJ?</h4>
<div class="paragraph">
<p>Use the simplest thing that can work. Spring AOP is simpler than using full AspectJ as
there is no requirement to introduce the AspectJ compiler / weaver into your development
and build processes. If you only need to advise the execution of operations on Spring
beans, then Spring AOP is the right choice. If you need to advise objects not managed by
the Spring container (such as domain objects typically), then you will need to use
AspectJ. You will also need to use AspectJ if you wish to advise join points other than
simple method executions (for example, field get or set join points, and so on).</p>
</div>
<div class="paragraph">
<p>When using AspectJ, you have the choice of the AspectJ language syntax (also known as
the "code style") or the @AspectJ annotation style. Clearly, if you are not using Java
5+ then the choice has been made for you&#8230;&#8203; use the code style. If aspects play a large
role in your design, and you are able to use the <a href="https://www.eclipse.org/ajdt/">AspectJ
Development Tools (AJDT)</a> plugin for Eclipse, then the AspectJ language syntax is the
preferred option: it is cleaner and simpler because the language was purposefully
designed for writing aspects. If you are not using Eclipse, or have only a few aspects
that do not play a major role in your application, then you may want to consider using
the @AspectJ style and sticking with a regular Java compilation in your IDE, and adding
an aspect weaving phase to your build script.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-ataspectj-or-xml"><a class="anchor" href="core.html#aop-ataspectj-or-xml"></a>5.4.2. @AspectJ or XML for Spring AOP?</h4>
<div class="paragraph">
<p>If you have chosen to use Spring AOP, then you have a choice of @AspectJ or XML style.
There are various tradeoffs to consider.</p>
</div>
<div class="paragraph">
<p>The XML style will be most familiar to existing Spring users and it is backed by genuine
POJOs. When using AOP as a tool to configure enterprise services then XML can be a good
choice (a good test is whether you consider the pointcut expression to be a part of your
configuration you might want to change independently). With the XML style arguably it is
clearer from your configuration what aspects are present in the system.</p>
</div>
<div class="paragraph">
<p>The XML style has two disadvantages. Firstly it does not fully encapsulate the
implementation of the requirement it addresses in a single place. The DRY principle says
that there should be a single, unambiguous, authoritative representation of any piece of
knowledge within a system. When using the XML style, the knowledge of <em>how</em> a
requirement is implemented is split across the declaration of the backing bean class,
and the XML in the configuration file. When using the @AspectJ style there is a single
module - the aspect - in which this information is encapsulated. Secondly, the XML style
is slightly more limited in what it can express than the @AspectJ style: only the
"singleton" aspect instantiation model is supported, and it is not possible to combine
named pointcuts declared in XML. For example, in the @AspectJ style you can write
something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pointcut</span>(execution(* get*()))
<span class="directive">public</span> <span class="type">void</span> propertyAccess() {}

<span class="annotation">@Pointcut</span>(execution(org.xyz.Account+ *(..))
<span class="directive">public</span> <span class="type">void</span> operationReturningAnAccount() {}

<span class="annotation">@Pointcut</span>(propertyAccess() &amp;&amp; operationReturningAnAccount())
<span class="directive">public</span> <span class="type">void</span> accountPropertyAccess() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the XML style I can declare the first two pointcuts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyAccess</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* get*())</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operationReturningAnAccount</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(org.xyz.Account+ *(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The downside of the XML approach is that you cannot define the
<code>accountPropertyAccess</code> pointcut by combining these definitions.</p>
</div>
<div class="paragraph">
<p>The @AspectJ style supports additional instantiation models, and richer pointcut
composition. It has the advantage of keeping the aspect as a modular unit. It also has
the advantage the @AspectJ aspects can be understood (and thus consumed) both by Spring
AOP and by AspectJ - so if you later decide you need the capabilities of AspectJ to
implement additional requirements then it is very easy to migrate to an AspectJ-based
approach. On balance the Spring team prefer the @AspectJ style whenever you have aspects
that do more than simple "configuration" of enterprise services.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-mixing-styles"><a class="anchor" href="core.html#aop-mixing-styles"></a>5.5. Mixing aspect types</h3>
<div class="paragraph">
<p>It is perfectly possible to mix @AspectJ style aspects using the autoproxying support,
schema-defined <code>&lt;aop:aspect&gt;</code> aspects, <code>&lt;aop:advisor&gt;</code> declared advisors and even
proxies and interceptors defined using the Spring 1.2 style in the same configuration.
All of these are implemented using the same underlying support mechanism and will
co-exist without any difficulty.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-proxying"><a class="anchor" href="core.html#aop-proxying"></a>5.6. Proxying mechanisms</h3>
<div class="paragraph">
<p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given
target object. (JDK dynamic proxies are preferred whenever you have a choice).</p>
</div>
<div class="paragraph">
<p>If the target object to be proxied implements at least one interface then a JDK dynamic
proxy will be used. All of the interfaces implemented by the target type will be
proxied. If the target object does not implement any interfaces then a CGLIB proxy will
be created.</p>
</div>
<div class="paragraph">
<p>If you want to force the use of CGLIB proxying (for example, to proxy every method
defined for the target object, not just those implemented by its interfaces) you can do
so. However, there are some issues to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>final</code> methods cannot be advised, as they cannot be overridden.</p>
</li>
<li>
<p>As of Spring 3.2, it is no longer necessary to add CGLIB to your project classpath, as
CGLIB classes are repackaged under org.springframework and included directly in the
spring-core JAR. This means that CGLIB-based proxy support 'just works' in the same
way that JDK dynamic proxies always have.</p>
</li>
<li>
<p>As of Spring 4.0, the constructor of your proxied object will NOT be called twice
anymore since the CGLIB proxy instance will be created via Objenesis. Only if your
JVM does not allow for constructor bypassing, you might see double invocations and
corresponding debug log entries from Spring&#8217;s AOP support.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To force the use of CGLIB proxies set the value of the <code>proxy-target-class</code> attribute of
the <code>&lt;aop:config&gt;</code> element to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:config</span> <span class="attribute-name">proxy-target-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- other beans defined here... --&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To force CGLIB proxying when using the @AspectJ autoproxy support, set the
<code>'proxy-target-class'</code> attribute of the <code>&lt;aop:aspectj-autoproxy&gt;</code> element to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspectj-autoproxy</span> <span class="attribute-name">proxy-target-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Multiple <code>&lt;aop:config/&gt;</code> sections are collapsed into a single unified auto-proxy creator
at runtime, which applies the <em>strongest</em> proxy settings that any of the
<code>&lt;aop:config/&gt;</code> sections (typically from different XML bean definition files) specified.
This also applies to the <code>&lt;tx:annotation-driven/&gt;</code> and <code>&lt;aop:aspectj-autoproxy/&gt;</code>
elements.</p>
</div>
<div class="paragraph">
<p>To be clear: using <code>proxy-target-class="true"</code> on <code>&lt;tx:annotation-driven/&gt;</code>,
<code>&lt;aop:aspectj-autoproxy/&gt;</code> or <code>&lt;aop:config/&gt;</code> elements will force the use of CGLIB
proxies <em>for all three of them</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aop-understanding-aop-proxies"><a class="anchor" href="core.html#aop-understanding-aop-proxies"></a>5.6.1. Understanding AOP proxies</h4>
<div class="paragraph">
<p>Spring AOP is <em>proxy-based</em>. It is vitally important that you grasp the semantics of
what that last statement actually means before you write your own aspects or use any of
the Spring AOP-based aspects supplied with the Spring Framework.</p>
</div>
<div class="paragraph">
<p>Consider first the scenario where you have a plain-vanilla, un-proxied,
nothing-special-about-it, straight object reference, as illustrated by the following
code snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimplePojo</span> <span class="directive">implements</span> Pojo {

    <span class="directive">public</span> <span class="type">void</span> foo() {
        <span class="comment">// this next method invocation is a direct call on the 'this' reference</span>
        <span class="local-variable">this</span>.bar();
    }

    <span class="directive">public</span> <span class="type">void</span> bar() {
        <span class="comment">// some logic...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you invoke a method on an object reference, the method is invoked <em>directly</em> on
that object reference, as can be seen below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aop-proxy-plain-pojo-call.png" alt="aop proxy plain pojo call">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        Pojo pojo = <span class="keyword">new</span> SimplePojo();

        <span class="comment">// this is a direct method call on the 'pojo' reference</span>
        pojo.foo();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Things change slightly when the reference that client code has is a proxy. Consider the
following diagram and code snippet.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aop-proxy-call.png" alt="aop proxy call">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(<span class="keyword">new</span> SimplePojo());
        factory.addInterface(Pojo.class);
        factory.addAdvice(<span class="keyword">new</span> RetryAdvice());

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key thing to understand here is that the client code inside the <code>main(..)</code> of the
<code>Main</code> class <em>has a reference to the proxy</em>. This means that method calls on that
object reference will be calls on the proxy, and as such the proxy will be able to
delegate to all of the interceptors (advice) that are relevant to that particular method
call. However, once the call has finally reached the target object, the <code>SimplePojo</code>
reference in this case, any method calls that it may make on itself, such as
<code>this.bar()</code> or <code>this.foo()</code>, are going to be invoked against the <em>this</em> reference,
and <em>not</em> the proxy. This has important implications. It means that self-invocation is
<em>not</em> going to result in the advice associated with a method invocation getting a
chance to execute.</p>
</div>
<div class="paragraph">
<p>Okay, so what is to be done about this? The best approach (the term best is used loosely
here) is to refactor your code such that the self-invocation does not happen. For sure,
this does entail some work on your part, but it is the best, least-invasive approach.
The next approach is absolutely horrendous, and I am almost reticent to point it out
precisely because it is so horrendous. You can (choke!) totally tie the logic within
your class to Spring AOP by doing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimplePojo</span> <span class="directive">implements</span> Pojo {

    <span class="directive">public</span> <span class="type">void</span> foo() {
        <span class="comment">// this works, but... gah!</span>
        ((Pojo) AopContext.currentProxy()).bar();
    }

    <span class="directive">public</span> <span class="type">void</span> bar() {
        <span class="comment">// some logic...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This totally couples your code to Spring AOP, <em>and</em> it makes the class itself aware of
the fact that it is being used in an AOP context, which flies in the face of AOP. It
also requires some additional configuration when the proxy is being created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(<span class="keyword">new</span> SimplePojo());
        factory.adddInterface(Pojo.class);
        factory.addAdvice(<span class="keyword">new</span> RetryAdvice());
        factory.setExposeProxy(<span class="predefined-constant">true</span>);

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, it must be noted that AspectJ does not have this self-invocation issue because
it is not a proxy-based AOP framework.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-aspectj-programmatic"><a class="anchor" href="core.html#aop-aspectj-programmatic"></a>5.7. Programmatic creation of @AspectJ Proxies</h3>
<div class="paragraph">
<p>In addition to declaring aspects in your configuration using either <code>&lt;aop:config&gt;</code> or
<code>&lt;aop:aspectj-autoproxy&gt;</code>, it is also possible programmatically to create proxies that
advise target objects. For the full details of Spring&#8217;s AOP API, see the next chapter.
Here we want to focus on the ability to automatically create proxies using @AspectJ
aspects.</p>
</div>
<div class="paragraph">
<p>The class <code>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> can be used
to create a proxy for a target object that is advised by one or more @AspectJ aspects.
Basic usage for this class is very simple, as illustrated below. See the javadocs for
full information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create a factory that can generate a proxy for the given target object</span>
AspectJProxyFactory factory = <span class="keyword">new</span> AspectJProxyFactory(targetObject);

<span class="comment">// add an aspect, the class must be an @AspectJ aspect</span>
<span class="comment">// you can call this as many times as you need with different aspects</span>
factory.addAspect(<span class="predefined-type">SecurityManager</span>.class);

<span class="comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span>
factory.addAspect(usageTracker);

<span class="comment">// now get the proxy object...</span>
MyInterfaceType proxy = factory.getProxy();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-using-aspectj"><a class="anchor" href="core.html#aop-using-aspectj"></a>5.8. Using AspectJ with Spring applications</h3>
<div class="paragraph">
<p>Everything we&#8217;ve covered so far in this chapter is pure Spring AOP. In this section,
we&#8217;re going to look at how you can use the AspectJ compiler/weaver instead of, or in
addition to, Spring AOP if your needs go beyond the facilities offered by Spring AOP
alone.</p>
</div>
<div class="paragraph">
<p>Spring ships with a small AspectJ aspect library, which is available standalone in your
distribution as <code>spring-aspects.jar</code>; you&#8217;ll need to add this to your classpath in order
to use the aspects in it. <a href="core.html#aop-atconfigurable">Using AspectJ to dependency inject domain objects with Spring</a> and <a href="core.html#aop-ajlib-other">Other Spring aspects for AspectJ</a> discuss the
content of this library and how you can use it. <a href="core.html#aop-aj-configure">Configuring AspectJ aspects using Spring IoC</a> discusses how to
dependency inject AspectJ aspects that are woven using the AspectJ compiler. Finally,
<a href="core.html#aop-aj-ltw">Load-time weaving with AspectJ in the Spring Framework</a> provides an introduction to load-time weaving for Spring applications
using AspectJ.</p>
</div>
<div class="sect3">
<h4 id="aop-atconfigurable"><a class="anchor" href="core.html#aop-atconfigurable"></a>5.8.1. Using AspectJ to dependency inject domain objects with Spring</h4>
<div class="paragraph">
<p>The Spring container instantiates and configures beans defined in your application
context. It is also possible to ask a bean factory to configure a <em>pre-existing</em>
object given the name of a bean definition containing the configuration to be applied.
The <code>spring-aspects.jar</code> contains an annotation-driven aspect that exploits this
capability to allow dependency injection of <em>any object</em>. The support is intended to
be used for objects created <em>outside of the control of any container</em>. Domain objects
often fall into this category because they are often created programmatically using the
<code>new</code> operator, or by an ORM tool as a result of a database query.</p>
</div>
<div class="paragraph">
<p>The <code>@Configurable</code> annotation marks a class as eligible for Spring-driven
configuration. In the simplest case it can be used just as a marker annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.xyz.myapp.domain</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Configurable</span>;

<span class="annotation">@Configurable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When used as a marker interface in this way, Spring will configure new instances of the
annotated type ( <code>Account</code> in this case) using a bean definition (typically
prototype-scoped) with the same name as the fully-qualified type name (
<code>com.xyz.myapp.domain.Account</code>). Since the default name for a bean is the
fully-qualified name of its type, a convenient way to declare the prototype definition
is simply to omit the <code>id</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.domain.Account</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fundsTransferService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fundsTransferService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to explicitly specify the name of the prototype bean definition to use, you
can do so directly in the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.xyz.myapp.domain</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Configurable</span>;

<span class="annotation">@Configurable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">account</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring will now look for a bean definition named "account" and use that as the
definition to configure new <code>Account</code> instances.</p>
</div>
<div class="paragraph">
<p>You can also use autowiring to avoid having to specify a dedicated bean definition at
all. To have Spring apply autowiring use the <code>autowire</code> property of the
<code>@Configurable</code> annotation: specify either <code>@Configurable(autowire=Autowire.BY_TYPE)</code> or
<code>@Configurable(autowire=Autowire.BY_NAME</code> for autowiring by type or by name
respectively. As an alternative, as of Spring 2.5 it is preferable to specify explicit,
annotation-driven dependency injection for your <code>@Configurable</code> beans by using
<code>@Autowired</code> or <code>@Inject</code> at the field or method level (see <a href="core.html#beans-annotation-config">Annotation-based container configuration</a>
for further details).</p>
</div>
<div class="paragraph">
<p>Finally you can enable Spring dependency checking for the object references in the newly
created and configured object by using the <code>dependencyCheck</code> attribute (for example:
<code>@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>). If this attribute is
set to true, then Spring will validate after configuration that all properties (<em>which
are not primitives or collections</em>) have been set.</p>
</div>
<div class="paragraph">
<p>Using the annotation on its own does nothing of course. It is the
<code>AnnotationBeanConfigurerAspect</code> in <code>spring-aspects.jar</code> that acts on the presence of
the annotation. In essence the aspect says "after returning from the initialization of a
new object of a type annotated with <code>@Configurable</code>, configure the newly created object
using Spring in accordance with the properties of the annotation". In this context,
<em>initialization</em> refers to newly instantiated objects (e.g., objects instantiated with
the <code>new</code> operator) as well as to <code>Serializable</code> objects that are undergoing
deserialization (e.g., via
<a href="http://docs.oracle.com/javase/6/docs/api/java/io/Serializable.html">readResolve()</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One of the key phrases in the above paragraph is '<em>in essence</em>'. For most cases, the
exact semantics of '<em>after returning from the initialization of a new object</em>' will be
fine&#8230;&#8203; in this context, '<em>after initialization</em>' means that the dependencies will be
injected <em>after</em> the object has been constructed - this means that the dependencies
will not be available for use in the constructor bodies of the class. If you want the
dependencies to be injected <em>before</em> the constructor bodies execute, and thus be
available for use in the body of the constructors, then you need to define this on the
<code>@Configurable</code> declaration like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configurable</span>(preConstruction=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find out more information about the language semantics of the various pointcut
types in AspectJ
<a href="https://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html">in this
appendix</a> of the <a href="https://www.eclipse.org/aspectj/doc/next/progguide/index.html">AspectJ
Programming Guide</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this to work the annotated types must be woven with the AspectJ weaver - you can
either use a build-time Ant or Maven task to do this (see for example the
<a href="https://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html">AspectJ Development
Environment Guide</a>) or load-time weaving (see <a href="core.html#aop-aj-ltw">Load-time weaving with AspectJ in the Spring Framework</a>). The
<code>AnnotationBeanConfigurerAspect</code> itself needs configuring by Spring (in order to obtain
a reference to the bean factory that is to be used to configure new objects). If you are
using Java based configuration simply add <code>@EnableSpringConfigured</code> to any
<code>@Configuration</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableSpringConfigured</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer XML based configuration, the Spring
<a href="core.html#xsd-schemas-context"><code>context</code> namespace</a>
defines a convenient <code>context:spring-configured</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:spring-configured</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instances of <code>@Configurable</code> objects created <em>before</em> the aspect has been configured
will result in a message being issued to the debug log and no configuration of the
object taking place. An example might be a bean in the Spring configuration that creates
domain objects when it is initialized by Spring. In this case you can use the
"depends-on" bean attribute to manually specify that the bean depends on the
configuration aspect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xzy.myapp.service.MyService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">depends-on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- ... --&gt;</span>

<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not activate <code>@Configurable</code> processing through the bean configurer aspect unless you
really mean to rely on its semantics at runtime. In particular, make sure that you do
not use <code>@Configurable</code> on bean classes which are registered as regular Spring beans
with the container: You would get double initialization otherwise, once through the
container and once through the aspect.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="aop-configurable-testing"><a class="anchor" href="core.html#aop-configurable-testing"></a>Unit testing @Configurable objects</h5>
<div class="paragraph">
<p>One of the goals of the <code>@Configurable</code> support is to enable independent unit testing of
domain objects without the difficulties associated with hard-coded lookups. If
<code>@Configurable</code> types have not been woven by AspectJ then the annotation has no affect
during unit testing, and you can simply set mock or stub property references in the
object under test and proceed as normal. If <code>@Configurable</code> types <em>have</em> been woven by
AspectJ then you can still unit test outside of the container as normal, but you will
see a warning message each time that you construct an <code>@Configurable</code> object indicating
that it has not been configured by Spring.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-configurable-container"><a class="anchor" href="core.html#aop-configurable-container"></a>Working with multiple application contexts</h5>
<div class="paragraph">
<p>The <code>AnnotationBeanConfigurerAspect</code> used to implement the <code>@Configurable</code> support is an
AspectJ singleton aspect. The scope of a singleton aspect is the same as the scope of
<code>static</code> members, that is to say there is one aspect instance per classloader that
defines the type. This means that if you define multiple application contexts within the
same classloader hierarchy you need to consider where to define the
<code>@EnableSpringConfigured</code> bean and where to place <code>spring-aspects.jar</code> on the classpath.</p>
</div>
<div class="paragraph">
<p>Consider a typical Spring web-app configuration with a shared parent application context
defining common business services and everything needed to support them, and one child
application context per servlet containing definitions particular to that servlet. All
of these contexts will co-exist within the same classloader hierarchy, and so the
<code>AnnotationBeanConfigurerAspect</code> can only hold a reference to one of them. In this case
we recommend defining the <code>@EnableSpringConfigured</code> bean in the shared (parent)
application context: this defines the services that you are likely to want to inject
into domain objects. A consequence is that you cannot configure domain objects with
references to beans defined in the child (servlet-specific) contexts using the
@Configurable mechanism (probably not something you want to do anyway!).</p>
</div>
<div class="paragraph">
<p>When deploying multiple web-apps within the same container, ensure that each
web-application loads the types in <code>spring-aspects.jar</code> using its own classloader (for
example, by placing <code>spring-aspects.jar</code> in <code>'WEB-INF/lib'</code>). If <code>spring-aspects.jar</code> is
only added to the container wide classpath (and hence loaded by the shared parent
classloader), all web applications will share the same aspect instance which is probably
not what you want.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-ajlib-other"><a class="anchor" href="core.html#aop-ajlib-other"></a>5.8.2. Other Spring aspects for AspectJ</h4>
<div class="paragraph">
<p>In addition to the <code>@Configurable</code> aspect, <code>spring-aspects.jar</code> contains an AspectJ
aspect that can be used to drive Spring&#8217;s transaction management for types and methods
annotated with the <code>@Transactional</code> annotation. This is primarily intended for users who
want to use the Spring Framework&#8217;s transaction support outside of the Spring container.</p>
</div>
<div class="paragraph">
<p>The aspect that interprets <code>@Transactional</code> annotations is the
<code>AnnotationTransactionAspect</code>. When using this aspect, you must annotate the
<em>implementation</em> class (and/or methods within that class), <em>not</em> the interface (if
any) that the class implements. AspectJ follows Java&#8217;s rule that annotations on
interfaces are <em>not inherited</em>.</p>
</div>
<div class="paragraph">
<p>A <code>@Transactional</code> annotation on a class specifies the default transaction semantics for
the execution of any <em>public</em> operation in the class.</p>
</div>
<div class="paragraph">
<p>A <code>@Transactional</code> annotation on a method within the class overrides the default
transaction semantics given by the class annotation (if present). Methods of any
visibility may be annotated, including private methods. Annotating non-public methods
directly is the only way to get transaction demarcation for the execution of such methods.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since Spring Framework 4.2, <code>spring-aspects</code> provides a similar aspect that offers the
exact same features for the standard <code>javax.transaction.Transactional</code> annotation. Check
<code>JtaAnnotationTransactionAspect</code> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For AspectJ programmers that want to use the Spring configuration and transaction
management support but don&#8217;t want to (or cannot) use annotations, <code>spring-aspects.jar</code>
also contains <code>abstract</code> aspects you can extend to provide your own pointcut
definitions. See the sources for the <code>AbstractBeanConfigurerAspect</code> and
<code>AbstractTransactionAspect</code> aspects for more information. As an example, the following
excerpt shows how you could write an aspect to configure all instances of objects
defined in the domain model using prototype bean definitions that match the
fully-qualified class names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> aspect DomainObjectConfiguration <span class="directive">extends</span> AbstractBeanConfigurerAspect {

    <span class="directive">public</span> DomainObjectConfiguration() {
        setBeanWiringInfoResolver(<span class="keyword">new</span> ClassNameBeanWiringInfoResolver());
    }

    <span class="comment">// the creation of a new bean (any object in the domain model)</span>
    <span class="directive">protected</span> pointcut beanCreation(<span class="predefined-type">Object</span> beanInstance) :
        initialization(<span class="keyword">new</span>(..)) &amp;&amp;
        SystemArchitecture.inDomainModel() &amp;&amp;
        <span class="local-variable">this</span>(beanInstance);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-aj-configure"><a class="anchor" href="core.html#aop-aj-configure"></a>5.8.3. Configuring AspectJ aspects using Spring IoC</h4>
<div class="paragraph">
<p>When using AspectJ aspects with Spring applications, it is natural to both want and
expect to be able to configure such aspects using Spring. The AspectJ runtime itself is
responsible for aspect creation, and the means of configuring the AspectJ created
aspects via Spring depends on the AspectJ instantiation model (the <code>per-xxx</code> clause)
used by the aspect.</p>
</div>
<div class="paragraph">
<p>The majority of AspectJ aspects are <em>singleton</em> aspects. Configuration of these
aspects is very easy: simply create a bean definition referencing the aspect type as
normal, and include the bean attribute <code>'factory-method="aspectOf"'</code>. This ensures that
Spring obtains the aspect instance by asking AspectJ for it rather than trying to create
an instance itself. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">profiler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.profiler.Profiler</span><span class="delimiter">&quot;</span></span>
        <span class="error"><strong></span><span class="error"></strong></span><span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspectOf</span><span class="delimiter">&quot;</span></span><span class="error"><strong></span><span class="error"></strong></span><span class="tag">&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">profilingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jamonProfilingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Non-singleton aspects are harder to configure: however it is possible to do so by
creating prototype bean definitions and using the <code>@Configurable</code> support from
<code>spring-aspects.jar</code> to configure the aspect instances once they have bean created by
the AspectJ runtime.</p>
</div>
<div class="paragraph">
<p>If you have some @AspectJ aspects that you want to weave with AspectJ (for example,
using load-time weaving for domain model types) and other @AspectJ aspects that you want
to use with Spring AOP, and these aspects are all configured using Spring, then you will
need to tell the Spring AOP @AspectJ autoproxying support which exact subset of the
@AspectJ aspects defined in the configuration should be used for autoproxying. You can
do this by using one or more <code>&lt;include/&gt;</code> elements inside the <code>&lt;aop:aspectj-autoproxy/&gt;</code>
declaration. Each <code>&lt;include/&gt;</code> element specifies a name pattern, and only beans with
names matched by at least one of the patterns will be used for Spring AOP autoproxy
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aop:aspectj-autoproxy&gt;</span>
    <span class="tag">&lt;aop:include</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thisBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;aop:include</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thatBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/aop:aspectj-autoproxy&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not be misled by the name of the <code>&lt;aop:aspectj-autoproxy/&gt;</code> element: using it will
result in the creation of <em>Spring AOP proxies</em>. The @AspectJ style of aspect
declaration is just being used here, but the AspectJ runtime is <em>not</em> involved.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aop-aj-ltw"><a class="anchor" href="core.html#aop-aj-ltw"></a>5.8.4. Load-time weaving with AspectJ in the Spring Framework</h4>
<div class="paragraph">
<p>Load-time weaving (LTW) refers to the process of weaving AspectJ aspects into an
application&#8217;s class files as they are being loaded into the Java virtual machine (JVM).
The focus of this section is on configuring and using LTW in the specific context of the
Spring Framework: this section is not an introduction to LTW though. For full details on
the specifics of LTW and configuring LTW with just AspectJ (with Spring not being
involved at all), see the
<a href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw.html">LTW section of the AspectJ
Development Environment Guide</a>.</p>
</div>
<div class="paragraph">
<p>The value-add that the Spring Framework brings to AspectJ LTW is in enabling much
finer-grained control over the weaving process. 'Vanilla' AspectJ LTW is effected using
a Java (5+) agent, which is switched on by specifying a VM argument when starting up a
JVM. It is thus a JVM-wide setting, which may be fine in some situations, but often is a
little too coarse. Spring-enabled LTW enables you to switch on LTW on a
<em>per-ClassLoader</em> basis, which obviously is more fine-grained and which can make more
sense in a 'single-JVM-multiple-application' environment (such as is found in a typical
application server environment).</p>
</div>
<div class="paragraph">
<p>Further, <a href="core.html#aop-aj-ltw-environments">in certain environments</a>, this support enables
load-time weaving <em>without making any modifications to the application server&#8217;s launch
script</em> that will be needed to add <code>-javaagent:path/to/aspectjweaver.jar</code> or (as we
describe later in this section)
<code>-javaagent:path/to/org.springframework.instrument-{version}.jar</code> (previously named
<code>spring-agent.jar</code>). Developers simply modify one or more files that form the
application context to enable load-time weaving instead of relying on administrators who
typically are in charge of the deployment configuration such as the launch script.</p>
</div>
<div class="paragraph">
<p>Now that the sales pitch is over, let us first walk through a quick example of AspectJ
LTW using Spring, followed by detailed specifics about elements introduced in the
following example. For a complete example, please see the
<a href="https://github.com/spring-projects/spring-petclinic">Petclinic sample application</a>.</p>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-first-example"><a class="anchor" href="core.html#aop-aj-ltw-first-example"></a>A first example</h5>
<div class="paragraph">
<p>Let us assume that you are an application developer who has been tasked with diagnosing
the cause of some performance problems in a system. Rather than break out a profiling
tool, what we are going to do is switch on a simple profiling aspect that will enable us
to very quickly get some performance metrics, so that we can then apply a finer-grained
profiling tool to that specific area immediately afterwards.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The example presented here uses XML style configuration, it is also possible to
configure and use @AspectJ with <a href="core.html#beans-java">Java Configuration</a>.
Specifically the <code>@EnableLoadTimeWeaving</code> annotation can be used as an alternative to
<code>&lt;context:load-time-weaver/&gt;</code> (see <a href="core.html#aop-aj-ltw-spring">below</a> for details).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is the profiling aspect. Nothing too fancy, just a quick-and-dirty time-based
profiler, using the @AspectJ-style of aspect declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">foo</span>;

<span class="keyword">import</span> <span class="include">org.aspectj.lang.ProceedingJoinPoint</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Aspect</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Around</span>;
<span class="keyword">import</span> <span class="include">org.aspectj.lang.annotation.Pointcut</span>;
<span class="keyword">import</span> <span class="include">org.springframework.util.StopWatch</span>;
<span class="keyword">import</span> <span class="include">org.springframework.core.annotation.Order</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProfilingAspect</span> {

    <span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">methodsToBeProfiled()</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Object</span> profile(ProceedingJoinPoint pjp) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        StopWatch sw = <span class="keyword">new</span> StopWatch(getClass().getSimpleName());
        <span class="keyword">try</span> {
            sw.start(pjp.getSignature().getName());
            <span class="keyword">return</span> pjp.proceed();
        } <span class="keyword">finally</span> {
            sw.stop();
            <span class="predefined-type">System</span>.out.println(sw.prettyPrint());
        }
    }

    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * foo..*.*(..))</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> methodsToBeProfiled(){}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will also need to create an <code>META-INF/aop.xml</code> file, to inform the AspectJ weaver
that we want to weave our <code>ProfilingAspect</code> into our classes. This file convention,
namely the presence of a file (or files) on the Java classpath called
<code>META-INF/aop.xml</code> is standard AspectJ.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE aspectj PUBLIC &quot;-//AspectJ//DTD//EN&quot; &quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;&gt;</span>
<span class="tag">&lt;aspectj&gt;</span>

    <span class="tag">&lt;weaver&gt;</span>
        <span class="comment">&lt;!-- only weave classes in our application-specific packages --&gt;</span>
        <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/weaver&gt;</span>

    <span class="tag">&lt;aspects&gt;</span>
        <span class="comment">&lt;!-- weave in just this aspect --&gt;</span>
        <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.ProfilingAspect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/aspects&gt;</span>

<span class="tag">&lt;/aspectj&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to the Spring-specific portion of the configuration. We need to configure a
<code>LoadTimeWeaver</code> (all explained later, just take it on trust for now). This load-time
weaver is the essential component responsible for weaving the aspect configuration in
one or more <code>META-INF/aop.xml</code> files into the classes in your application. The good
thing is that it does not require a lot of configuration, as can be seen below (there
are some more options that you can specify, but these are detailed later).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- a service object; we will be profiling its methods --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entitlementCalculationService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.StubEntitlementCalculationService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- this switches on the load-time weaving --&gt;</span>
    <strong><span class="tag">&lt;context:load-time-weaver</span><span class="tag">/&gt;</span></strong>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that all the required artifacts are in place - the aspect, the <code>META-INF/aop.xml</code>
file, and the Spring configuration -, let us create a simple driver class with a
<code>main(..)</code> method to demonstrate the LTW in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Main</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>, Main.class);

        EntitlementCalculationService entitlementCalculationService
            = (EntitlementCalculationService) ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">entitlementCalculationService</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// the profiling aspect is 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one last thing to do. The introduction to this section did say that one could
switch on LTW selectively on a per- <code>ClassLoader</code> basis with Spring, and this is true.
However, just for this example, we are going to use a Java agent (supplied with Spring)
to switch on the LTW. This is the command line we will use to run the above <code>Main</code> class:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-javaagent</code> is a flag for specifying and enabling
<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/instrument/package-summary.html">agents
to instrument programs running on the JVM</a>. The Spring Framework ships with such an
agent, the <code>InstrumentationSavingAgent</code>, which is packaged in the
<code>spring-instrument.jar</code> that was supplied as the value of the <code>-javaagent</code> argument in
the above example.</p>
</div>
<div class="paragraph">
<p>The output from the execution of the <code>Main</code> program will look something like that below.
(I have introduced a <code>Thread.sleep(..)</code> statement into the <code>calculateEntitlement()</code>
implementation so that the profiler actually captures something other than 0
milliseconds - the <code>01234</code> milliseconds is <em>not</em> an overhead introduced by the AOP :) )</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Calculating entitlement

StopWatch 'ProfilingAspect': running time (millis) = 1234
------ ----- ----------------------------
ms     %     Task name
------ ----- ----------------------------
01234  100%  calculateEntitlement</pre>
</div>
</div>
<div class="paragraph">
<p>Since this LTW is effected using full-blown AspectJ, we are not just limited to advising
Spring beans; the following slight variation on the <code>Main</code> program will yield the same
result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Main</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>, Main.class);

        EntitlementCalculationService entitlementCalculationService =
            <span class="keyword">new</span> StubEntitlementCalculationService();

        <span class="comment">// the profiling aspect will be 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how in the above program we are simply bootstrapping the Spring container, and
then creating a new instance of the <code>StubEntitlementCalculationService</code> totally outside
the context of Spring&#8230;&#8203; the profiling advice still gets woven in.</p>
</div>
<div class="paragraph">
<p>The example admittedly is simplistic&#8230;&#8203; however the basics of the LTW support in Spring
have all been introduced in the above example, and the rest of this section will explain
the 'why' behind each bit of configuration and usage in detail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ProfilingAspect</code> used in this example may be basic, but it is quite useful. It is a
nice example of a development-time aspect that developers can use during development (of
course), and then quite easily exclude from builds of the application being deployed
into UAT or production.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-the-aspects"><a class="anchor" href="core.html#aop-aj-ltw-the-aspects"></a>Aspects</h5>
<div class="paragraph">
<p>The aspects that you use in LTW have to be AspectJ aspects. They can be written in
either the AspectJ language itself or you can write your aspects in the @AspectJ-style.
It means that your aspects are then both valid AspectJ <em>and</em> Spring AOP aspects.
Furthermore, the compiled aspect classes need to be available on the classpath.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-aop_dot_xml"><a class="anchor" href="core.html#aop-aj-ltw-aop_dot_xml"></a>'META-INF/aop.xml'</h5>
<div class="paragraph">
<p>The AspectJ LTW infrastructure is configured using one or more <code>META-INF/aop.xml</code>
files, that are on the Java classpath (either directly, or more typically in jar files).</p>
</div>
<div class="paragraph">
<p>The structure and contents of this file is detailed in the main AspectJ reference
documentation, and the interested reader is
<a href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html">referred to
that resource</a>. (I appreciate that this section is brief, but the <code>aop.xml</code> file is
100% AspectJ - there is no Spring-specific information or semantics that apply to it,
and so there is no extra value that I can contribute either as a result), so rather than
rehash the quite satisfactory section that the AspectJ developers wrote, I am just
directing you there.)</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-libraries"><a class="anchor" href="core.html#aop-aj-ltw-libraries"></a>Required libraries (JARS)</h5>
<div class="paragraph">
<p>At a minimum you will need the following libraries to use the Spring Framework&#8217;s support
for AspectJ LTW:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring-aop.jar</code> (version 2.5 or later, plus all mandatory dependencies)</p>
</li>
<li>
<p><code>aspectjweaver.jar</code> (version 1.6.8 or later)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using the <a href="core.html#aop-aj-ltw-environment-generic">Spring-provided agent to enable
instrumentation</a>, you will also need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring-instrument.jar</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-spring"><a class="anchor" href="core.html#aop-aj-ltw-spring"></a>Spring configuration</h5>
<div class="paragraph">
<p>The key component in Spring&#8217;s LTW support is the <code>LoadTimeWeaver</code> interface (in the
<code>org.springframework.instrument.classloading</code> package), and the numerous implementations
of it that ship with the Spring distribution. A <code>LoadTimeWeaver</code> is responsible for
adding one or more <code>java.lang.instrument.ClassFileTransformers</code> to a <code>ClassLoader</code> at
runtime, which opens the door to all manner of interesting applications, one of which
happens to be the LTW of aspects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are unfamiliar with the idea of runtime class file transformation, you are
encouraged to read the javadoc API documentation for the <code>java.lang.instrument</code> package
before continuing. This is not a huge chore because there is - rather annoyingly -
precious little documentation there&#8230;&#8203; the key interfaces and classes will at least be
laid out in front of you for reference as you read through this section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring a <code>LoadTimeWeaver</code> for a particular <code>ApplicationContext</code> can be as easy as
adding one line. (Please note that you almost certainly will need to be using an
<code>ApplicationContext</code> as your Spring container - typically a <code>BeanFactory</code> will not be
enough because the LTW support makes use of <code>BeanFactoryPostProcessors</code>.)</p>
</div>
<div class="paragraph">
<p>To enable the Spring Framework&#8217;s LTW support, you need to configure a <code>LoadTimeWeaver</code>,
which typically is done using the <code>@EnableLoadTimeWeaving</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableLoadTimeWeaving</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you prefer XML based configuration, use the
<code>&lt;context:load-time-weaver/&gt;</code> element. Note that the element is defined in the
<code>context</code> namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:load-time-weaver</span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will define and register a number of LTW-specific infrastructure
beans for you automatically, such as a <code>LoadTimeWeaver</code> and an <code>AspectJWeavingEnabler</code>.
The default <code>LoadTimeWeaver</code> is the <code>DefaultContextLoadTimeWeaver</code> class, which attempts
to decorate an automatically detected <code>LoadTimeWeaver</code>: the exact type of
<code>LoadTimeWeaver</code> that will be 'automatically detected' is dependent upon your runtime
environment (summarized in the following table).</p>
</div>
<table id="aop-aj-ltw-spring-env-impls" class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. DefaultContextLoadTimeWeaver LoadTimeWeavers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Runtime Environment</th>
<th class="tableblock halign-left valign-top"><code>LoadTimeWeaver</code> implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in Oracle&#8217;s
<a href="http://www.oracle.com/technetwork/middleware/weblogic/overview/index-085209.html">WebLogic</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebLogicLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in Oracle&#8217;s <a href="http://glassfish.dev.java.net/">GlassFish</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GlassFishLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in <a href="https://tomcat.apache.org/">Apache Tomcat</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TomcatLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in Red Hat&#8217;s <a href="http://www.jboss.org/jbossas/">JBoss AS</a> or <a href="http://www.wildfly.org/">WildFly</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JBossLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in IBM&#8217;s <a href="https://www-01.ibm.com/software/webservers/appserv/was/">WebSphere</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebSphereLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JVM started with Spring <code>InstrumentationSavingAgent</code> <em>(java
-javaagent:path/to/spring-instrument.jar)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InstrumentationLoadTimeWeaver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fallback, expecting the underlying ClassLoader to follow common conventions (e.g.
applicable to <code>TomcatInstrumentableClassLoader</code> and <a href="http://www.caucho.com/">Resin</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReflectiveLoadTimeWeaver</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that these are just the <code>LoadTimeWeavers</code> that are autodetected when using the
<code>DefaultContextLoadTimeWeaver</code>: it is of course possible to specify exactly which
<code>LoadTimeWeaver</code> implementation that you wish to use.</p>
</div>
<div class="paragraph">
<p>To specify a specific <code>LoadTimeWeaver</code> with Java configuration implement the
<code>LoadTimeWeavingConfigurer</code> interface and override the <code>getLoadTimeWeaver()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableLoadTimeWeaving</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> <span class="directive">implements</span> LoadTimeWeavingConfigurer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> LoadTimeWeaver getLoadTimeWeaver() {
        <span class="keyword">return</span> <span class="keyword">new</span> ReflectiveLoadTimeWeaver();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using XML based configuration you can specify the fully-qualified classname
as the value of the <code>weaver-class</code> attribute on the <code>&lt;context:load-time-weaver/&gt;</code>
element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/context</span>
        <span class="content">http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:load-time-weaver</span>
            <span class="attribute-name">weaver-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LoadTimeWeaver</code> that is defined and registered by the configuration can be later
retrieved from the Spring container using the well-known name <code>loadTimeWeaver</code>.
Remember that the <code>LoadTimeWeaver</code> exists just as a mechanism for Spring&#8217;s LTW
infrastructure to add one or more <code>ClassFileTransformers</code>. The actual
<code>ClassFileTransformer</code> that does the LTW is the <code>ClassPreProcessorAgentAdapter</code> (from
the <code>org.aspectj.weaver.loadtime</code> package) class. See the class-level javadocs of the
<code>ClassPreProcessorAgentAdapter</code> class for further details, because the specifics of how
the weaving is actually effected is beyond the scope of this section.</p>
</div>
<div class="paragraph">
<p>There is one final attribute of the configuration left to discuss: the
<code>aspectjWeaving</code> attribute (or <code>aspectj-weaving</code> if you are using XML). This is a
simple attribute that controls whether LTW is enabled or not; it is as simple as that.
It accepts one of three possible values, summarized below, with the default value being
<code>autodetect</code> if the attribute is not present.</p>
</div>
<table id="aop-aj-ltw-ltw-tag-attrs" class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. AspectJ weaving attribute values</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation Value</th>
<th class="tableblock halign-left valign-top">XML Value</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENABLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>on</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AspectJ weaving is on, and aspects will be woven at load-time as appropriate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DISABLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>off</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LTW is off&#8230;&#8203; no aspect will be woven at load-time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTODETECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autodetect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the Spring LTW infrastructure can find at least one <code>META-INF/aop.xml</code> file,
then AspectJ weaving is on, else it is off. This is the default value.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="aop-aj-ltw-environments"><a class="anchor" href="core.html#aop-aj-ltw-environments"></a>Environment-specific configuration</h5>
<div class="paragraph">
<p>This last section contains any additional settings and configuration that you will need
when using Spring&#8217;s LTW support in environments such as application servers and web
containers.</p>
</div>
<div class="sect5">
<h6 id="aop-aj-ltw-environment-tomcat"><a class="anchor" href="core.html#aop-aj-ltw-environment-tomcat"></a>Tomcat</h6>
<div class="paragraph">
<p>Historically, <a href="https://tomcat.apache.org/">Apache Tomcat</a>'s default class loader did not
support class transformation which is why Spring provides an enhanced implementation
that addresses this need. Named <code>TomcatInstrumentableClassLoader</code>, the loader works on
Tomcat 6.0 and above.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not define <code>TomcatInstrumentableClassLoader</code> anymore on Tomcat 8.0 and higher.
Instead, let Spring automatically use Tomcat&#8217;s new native <code>InstrumentableClassLoader</code>
facility through the <code>TomcatLoadTimeWeaver</code> strategy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you still need to use <code>TomcatInstrumentableClassLoader</code>, it can be registered
individually for <em>each</em> web application as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy <code>org.springframework.instrument.tomcat.jar</code> into <em>$CATALINA_HOME</em>/lib, where
<em>$CATALINA_HOME</em> represents the root of the Tomcat installation)</p>
</li>
<li>
<p>Instruct Tomcat to use the custom class loader (instead of the default) by editing the
web application context file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Context</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/myWebApp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">docBase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/my/webApp/location</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Loader</span>
        <span class="attribute-name">loaderClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Context&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apache Tomcat (6.0+) supports several context locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>server configuration file - <em>$CATALINA_HOME/conf/server.xml</em></p>
</li>
<li>
<p>default context configuration - <em>$CATALINA_HOME/conf/context.xml</em> - that affects all
deployed web applications</p>
</li>
<li>
<p>per-web application configuration which can be deployed either on the server-side at
<em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em> or embedded
inside the web-app archive at <em>META-INF/context.xml</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For efficiency, the embedded per-web-app configuration style is recommended because it
will impact only applications that use the custom class loader and does not require any
changes to the server configuration. See the Tomcat 6.0.x
<a href="https://tomcat.apache.org/tomcat-6.0-doc/config/context.html">documentation</a> for more
details about available context locations.</p>
</div>
<div class="paragraph">
<p>Alternatively, consider the use of the Spring-provided generic VM agent, to be specified
in Tomcat&#8217;s launch script (see above). This will make instrumentation available to all
deployed web applications, no matter what ClassLoader they happen to run on.</p>
</div>
</div>
<div class="sect5">
<h6 id="aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss"><a class="anchor" href="core.html#aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss"></a>WebLogic, WebSphere, Resin, GlassFish, JBoss</h6>
<div class="paragraph">
<p>Recent versions of WebLogic Server (version 10 and above), IBM WebSphere Application
Server (version 7 and above), Resin (3.1 and above) and JBoss (6.x or above) provide a
ClassLoader that is capable of local instrumentation. Spring&#8217;s native LTW leverages such
ClassLoaders to enable AspectJ weaving. You can enable LTW by simply activating
load-time weaving as described earlier. Specifically, you do <em>not</em> need to modify the
launch script to add <code>-javaagent:path/to/spring-instrument.jar</code>.</p>
</div>
<div class="paragraph">
<p>Note that GlassFish instrumentation-capable ClassLoader is available only in its EAR
environment. For GlassFish web applications, follow the Tomcat setup instructions as
outlined above.</p>
</div>
<div class="paragraph">
<p>Note that on JBoss 6.x, the app server scanning needs to be disabled to prevent it from
loading the classes before the application actually starts. A quick workaround is to add
to your artifact a file named <code>WEB-INF/jboss-scanning.xml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;scanning</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:scanning:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="aop-aj-ltw-environment-generic"><a class="anchor" href="core.html#aop-aj-ltw-environment-generic"></a>Generic Java applications</h6>
<div class="paragraph">
<p>When class instrumentation is required in environments that do not support or are not
supported by the existing <code>LoadTimeWeaver</code> implementations, a JDK agent can be the only
solution. For such cases, Spring provides <code>InstrumentationLoadTimeWeaver</code>, which
requires a Spring-specific (but very general) VM agent,
<code>org.springframework.instrument-{version}.jar</code> (previously named <code>spring-agent.jar</code>).</p>
</div>
<div class="paragraph">
<p>To use it, you must start the virtual machine with the Spring agent, by supplying the
following JVM options:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>-javaagent:/path/to/org.springframework.instrument-{version}.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this requires modification of the VM launch script which may prevent you from
using this in application server environments (depending on your operation policies).
Additionally, the JDK agent will instrument the <em>entire</em> VM which can prove expensive.</p>
</div>
<div class="paragraph">
<p>For performance reasons, it is recommended to use this configuration only if your target
environment (such as <a href="https://www.eclipse.org/jetty/">Jetty</a>) does not have (or does not
support) a dedicated LTW.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-resources"><a class="anchor" href="core.html#aop-resources"></a>5.9. Further Resources</h3>
<div class="paragraph">
<p>More information on AspectJ can be found on the <a href="https://www.eclipse.org/aspectj">AspectJ
website</a>.</p>
</div>
<div class="paragraph">
<p>The book <em>Eclipse AspectJ</em> by Adrian Colyer et. al. (Addison-Wesley, 2005) provides a
comprehensive introduction and reference for the AspectJ language.</p>
</div>
<div class="paragraph">
<p>The book <em>AspectJ in Action, Second Edition</em> by Ramnivas Laddad (Manning, 2009) comes highly
recommended; the focus of the book is on AspectJ, but a lot of general AOP themes are
explored (in some depth).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aop-api"><a class="anchor" href="core.html#aop-api"></a>6. Spring AOP APIs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="aop-api-introduction"><a class="anchor" href="core.html#aop-api-introduction"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>The previous chapter described the Spring&#8217;s support for AOP using
@AspectJ and schema-based aspect definitions. In this chapter we discuss the lower-level
Spring AOP APIs and the AOP support typically used in Spring 1.2 applications. For new
applications, we recommend the use of the Spring 2.0 and later AOP support described in
the previous chapter, but when working with existing applications, or when reading books
and articles, you may come across Spring 1.2 style examples. Spring 5 remains backwards
compatible with Spring 1.2 and everything described in this chapter is fully supported
in Spring 5.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-api-pointcuts"><a class="anchor" href="core.html#aop-api-pointcuts"></a>6.2. Pointcut API in Spring</h3>
<div class="paragraph">
<p>Let&#8217;s look at how Spring handles the crucial pointcut concept.</p>
</div>
<div class="sect3">
<h4 id="aop-api-concepts"><a class="anchor" href="core.html#aop-api-concepts"></a>6.2.1. Concepts</h4>
<div class="paragraph">
<p>Spring&#8217;s pointcut model enables pointcut reuse independent of advice types. It&#8217;s
possible to target different advice using the same pointcut.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.aop.Pointcut</code> interface is the central interface, used to
target advices to particular classes and methods. The complete interface is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Pointcut</span> {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Splitting the <code>Pointcut</code> interface into two parts allows reuse of class and method
matching parts, and fine-grained composition operations (such as performing a "union"
with another method matcher).</p>
</div>
<div class="paragraph">
<p>The <code>ClassFilter</code> interface is used to restrict the pointcut to a given set of target
classes. If the <code>matches()</code> method always returns true, all target classes will be
matched:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ClassFilter</span> {

    <span class="type">boolean</span> matches(<span class="predefined-type">Class</span> clazz);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MethodMatcher</code> interface is normally more important. The complete interface is
shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MethodMatcher</span> {

    <span class="type">boolean</span> matches(<span class="predefined-type">Method</span> m, <span class="predefined-type">Class</span> targetClass);

    <span class="type">boolean</span> isRuntime();

    <span class="type">boolean</span> matches(<span class="predefined-type">Method</span> m, <span class="predefined-type">Class</span> targetClass, <span class="predefined-type">Object</span><span class="type">[]</span> args);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>matches(Method, Class)</code> method is used to test whether this pointcut will ever
match a given method on a target class. This evaluation can be performed when an AOP
proxy is created, to avoid the need for a test on every method invocation. If the
2-argument matches method returns true for a given method, and the <code>isRuntime()</code> method
for the MethodMatcher returns true, the 3-argument matches method will be invoked on
every method invocation. This enables a pointcut to look at the arguments passed to the
method invocation immediately before the target advice is to execute.</p>
</div>
<div class="paragraph">
<p>Most MethodMatchers are static, meaning that their <code>isRuntime()</code> method returns false.
In this case, the 3-argument matches method will never be invoked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If possible, try to make pointcuts static, allowing the AOP framework to cache the
results of pointcut evaluation when an AOP proxy is created.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-pointcut-ops"><a class="anchor" href="core.html#aop-api-pointcut-ops"></a>6.2.2. Operations on pointcuts</h4>
<div class="paragraph">
<p>Spring supports operations on pointcuts: notably, <em>union</em> and <em>intersection</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Union means the methods that either pointcut matches.</p>
</li>
<li>
<p>Intersection means the methods that both pointcuts match.</p>
</li>
<li>
<p>Union is usually more useful.</p>
</li>
<li>
<p>Pointcuts can be composed using the static methods in the
<em>org.springframework.aop.support.Pointcuts</em> class, or using the
<em>ComposablePointcut</em> class in the same package. However, using AspectJ pointcut
expressions is usually a simpler approach.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-pointcuts-aspectj"><a class="anchor" href="core.html#aop-api-pointcuts-aspectj"></a>6.2.3. AspectJ expression pointcuts</h4>
<div class="paragraph">
<p>Since 2.0, the most important type of pointcut used by Spring is
<code>org.springframework.aop.aspectj.AspectJExpressionPointcut</code>. This is a pointcut that
uses an AspectJ supplied library to parse an AspectJ pointcut expression string.</p>
</div>
<div class="paragraph">
<p>See the previous chapter for a discussion of supported AspectJ pointcut primitives.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-pointcuts-impls"><a class="anchor" href="core.html#aop-api-pointcuts-impls"></a>6.2.4. Convenience pointcut implementations</h4>
<div class="paragraph">
<p>Spring provides several convenient pointcut implementations. Some can be used out of the
box; others are intended to be subclassed in application-specific pointcuts.</p>
</div>
<div class="sect4">
<h5 id="aop-api-pointcuts-static"><a class="anchor" href="core.html#aop-api-pointcuts-static"></a>Static pointcuts</h5>
<div class="paragraph">
<p>Static pointcuts are based on method and target class, and cannot take into account the
method&#8217;s arguments. Static pointcuts are sufficient - <em>and best</em> - for most usages.
It&#8217;s possible for Spring to evaluate a static pointcut only once, when a method is first
invoked: after that, there is no need to evaluate the pointcut again with each method
invocation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider some static pointcut implementations included with Spring.</p>
</div>
<div class="sect5">
<h6 id="aop-api-pointcuts-regex"><a class="anchor" href="core.html#aop-api-pointcuts-regex"></a>Regular expression pointcuts</h6>
<div class="paragraph">
<p>One obvious way to specify static pointcuts is regular expressions. Several AOP
frameworks besides Spring make this possible.
<code>org.springframework.aop.support.JdkRegexpMethodPointcut</code> is a generic regular
expression pointcut, using the regular expression support in the JDK.</p>
</div>
<div class="paragraph">
<p>Using the <code>JdkRegexpMethodPointcut</code> class, you can provide a list of pattern Strings. If
any of these is a match, the pointcut will evaluate to true. (So the result is
effectively the union of these pointcuts.)</p>
</div>
<div class="paragraph">
<p>The usage is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">settersAndAbsquatulatePointcut</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.support.JdkRegexpMethodPointcut</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">patterns</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>.*set.*<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>.*absquatulate<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring provides a convenience class, <code>RegexpMethodPointcutAdvisor</code>, that allows us to
also reference an Advice (remember that an Advice can be an interceptor, before advice,
throws advice etc.). Behind the scenes, Spring will use a <code>JdkRegexpMethodPointcut</code>.
Using <code>RegexpMethodPointcutAdvisor</code> simplifies wiring, as the one bean encapsulates both
pointcut and advice, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">settersAndAbsquatulateAdvisor</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.support.RegexpMethodPointcutAdvisor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanNameOfAopAllianceInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">patterns</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>.*set.*<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>.*absquatulate<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>RegexpMethodPointcutAdvisor</em> can be used with any Advice type.</p>
</div>
</div>
<div class="sect5">
<h6 id="aop-api-pointcuts-attribute-driven"><a class="anchor" href="core.html#aop-api-pointcuts-attribute-driven"></a>Attribute-driven pointcuts</h6>
<div class="paragraph">
<p>An important type of static pointcut is a <em>metadata-driven</em> pointcut. This uses the
values of metadata attributes: typically, source-level metadata.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-pointcuts-dynamic"><a class="anchor" href="core.html#aop-api-pointcuts-dynamic"></a>Dynamic pointcuts</h5>
<div class="paragraph">
<p>Dynamic pointcuts are costlier to evaluate than static pointcuts. They take into account
method <em>arguments</em>, as well as static information. This means that they must be
evaluated with every method invocation; the result cannot be cached, as arguments will
vary.</p>
</div>
<div class="paragraph">
<p>The main example is the <code>control flow</code> pointcut.</p>
</div>
<div class="sect5">
<h6 id="aop-api-pointcuts-cflow"><a class="anchor" href="core.html#aop-api-pointcuts-cflow"></a>Control flow pointcuts</h6>
<div class="paragraph">
<p>Spring control flow pointcuts are conceptually similar to AspectJ <em>cflow</em> pointcuts,
although less powerful. (There is currently no way to specify that a pointcut executes
below a join point matched by another pointcut.) A control flow pointcut matches the
current call stack. For example, it might fire if the join point was invoked by a method
in the <code>com.mycompany.web</code> package, or by the <code>SomeCaller</code> class. Control flow pointcuts
are specified using the <code>org.springframework.aop.support.ControlFlowPointcut</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Control flow pointcuts are significantly more expensive to evaluate at runtime than even
other dynamic pointcuts. In Java 1.4, the cost is about 5 times that of other dynamic
pointcuts.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-pointcuts-superclasses"><a class="anchor" href="core.html#aop-api-pointcuts-superclasses"></a>6.2.5. Pointcut superclasses</h4>
<div class="paragraph">
<p>Spring provides useful pointcut superclasses to help you to implement your own pointcuts.</p>
</div>
<div class="paragraph">
<p>Because static pointcuts are most useful, you&#8217;ll probably subclass
StaticMethodMatcherPointcut, as shown below. This requires implementing just one
abstract method (although it&#8217;s possible to override other methods to customize behavior):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">TestStaticPointcut</span> <span class="directive">extends</span> StaticMethodMatcherPointcut {

    <span class="directive">public</span> <span class="type">boolean</span> matches(<span class="predefined-type">Method</span> m, <span class="predefined-type">Class</span> targetClass) {
        <span class="comment">// return true if custom criteria match</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also superclasses for dynamic pointcuts.</p>
</div>
<div class="paragraph">
<p>You can use custom pointcuts with any advice type in Spring 1.0 RC2 and above.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-pointcuts-custom"><a class="anchor" href="core.html#aop-api-pointcuts-custom"></a>6.2.6. Custom pointcuts</h4>
<div class="paragraph">
<p>Because pointcuts in Spring AOP are Java classes, rather than language features (as in
AspectJ) it&#8217;s possible to declare custom pointcuts, whether static or dynamic. Custom
pointcuts in Spring can be arbitrarily complex. However, using the AspectJ pointcut
expression language is recommended if possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Later versions of Spring may offer support for "semantic pointcuts" as offered by JAC:
for example, "all methods that change instance variables in the target object."</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-api-advice"><a class="anchor" href="core.html#aop-api-advice"></a>6.3. Advice API in Spring</h3>
<div class="paragraph">
<p>Let&#8217;s now look at how Spring AOP handles advice.</p>
</div>
<div class="sect3">
<h4 id="aop-api-advice-lifecycle"><a class="anchor" href="core.html#aop-api-advice-lifecycle"></a>6.3.1. Advice lifecycles</h4>
<div class="paragraph">
<p>Each advice is a Spring bean. An advice instance can be shared across all advised
objects, or unique to each advised object. This corresponds to <em>per-class</em> or
<em>per-instance</em> advice.</p>
</div>
<div class="paragraph">
<p>Per-class advice is used most often. It is appropriate for generic advice such as
transaction advisors. These do not depend on the state of the proxied object or add new
state; they merely act on the method and arguments.</p>
</div>
<div class="paragraph">
<p>Per-instance advice is appropriate for introductions, to support mixins. In this case,
the advice adds state to the proxied object.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to use a mix of shared and per-instance advice in the same AOP proxy.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-advice-types"><a class="anchor" href="core.html#aop-api-advice-types"></a>6.3.2. Advice types in Spring</h4>
<div class="paragraph">
<p>Spring provides several advice types out of the box, and is extensible to support
arbitrary advice types. Let us look at the basic concepts and standard advice types.</p>
</div>
<div class="sect4">
<h5 id="aop-api-advice-around"><a class="anchor" href="core.html#aop-api-advice-around"></a>Interception around advice</h5>
<div class="paragraph">
<p>The most fundamental advice type in Spring is <em>interception around advice</em>.</p>
</div>
<div class="paragraph">
<p>Spring is compliant with the AOP Alliance interface for around advice using method
interception. MethodInterceptors implementing around advice should implement the
following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MethodInterceptor</span> <span class="directive">extends</span> Interceptor {

    <span class="predefined-type">Object</span> invoke(MethodInvocation invocation) <span class="directive">throws</span> <span class="predefined-type">Throwable</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MethodInvocation</code> argument to the <code>invoke()</code> method exposes the method being
invoked; the target join point; the AOP proxy; and the arguments to the method. The
<code>invoke()</code> method should return the invocation&#8217;s result: the return value of the join
point.</p>
</div>
<div class="paragraph">
<p>A simple <code>MethodInterceptor</code> implementation looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DebugInterceptor</span> <span class="directive">implements</span> MethodInterceptor {

    <span class="directive">public</span> <span class="predefined-type">Object</span> invoke(MethodInvocation invocation) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before: invocation=[</span><span class="delimiter">&quot;</span></span> + invocation + <span class="string"><span class="delimiter">&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Object</span> rval = invocation.proceed();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invocation returned</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> rval;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the call to the MethodInvocation&#8217;s <code>proceed()</code> method. This proceeds down the
interceptor chain towards the join point. Most interceptors will invoke this method, and
return its return value. However, a MethodInterceptor, like any around advice, can
return a different value or throw an exception rather than invoke the proceed method.
However, you don&#8217;t want to do this without good reason!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>MethodInterceptors offer interoperability with other AOP Alliance-compliant AOP
implementations. The other advice types discussed in the remainder of this section
implement common AOP concepts, but in a Spring-specific way. While there is an advantage
in using the most specific advice type, stick with MethodInterceptor around advice if
you are likely to want to run the aspect in another AOP framework. Note that pointcuts
are not currently interoperable between frameworks, and the AOP Alliance does not
currently define pointcut interfaces.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-advice-before"><a class="anchor" href="core.html#aop-api-advice-before"></a>Before advice</h5>
<div class="paragraph">
<p>A simpler advice type is a <em>before advice</em>. This does not need a <code>MethodInvocation</code>
object, since it will only be called before entering the method.</p>
</div>
<div class="paragraph">
<p>The main advantage of a before advice is that there is no need to invoke the <code>proceed()</code>
method, and therefore no possibility of inadvertently failing to proceed down the
interceptor chain.</p>
</div>
<div class="paragraph">
<p>The <code>MethodBeforeAdvice</code> interface is shown below. (Spring&#8217;s API design would allow for
field before advice, although the usual objects apply to field interception and it&#8217;s
unlikely that Spring will ever implement it).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MethodBeforeAdvice</span> <span class="directive">extends</span> BeforeAdvice {

    <span class="type">void</span> before(<span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target) <span class="directive">throws</span> <span class="predefined-type">Throwable</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the return type is <code>void</code>. Before advice can insert custom behavior before the join
point executes, but cannot change the return value. If a before advice throws an
exception, this will abort further execution of the interceptor chain. The exception
will propagate back up the interceptor chain. If it is unchecked, or on the signature of
the invoked method, it will be passed directly to the client; otherwise it will be
wrapped in an unchecked exception by the AOP proxy.</p>
</div>
<div class="paragraph">
<p>An example of a before advice in Spring, which counts all method invocations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CountingBeforeAdvice</span> <span class="directive">implements</span> MethodBeforeAdvice {

    <span class="directive">private</span> <span class="type">int</span> count;

    <span class="directive">public</span> <span class="type">void</span> before(<span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        ++count;
    }

    <span class="directive">public</span> <span class="type">int</span> getCount() {
        <span class="keyword">return</span> count;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before advice can be used with any pointcut.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-advice-throws"><a class="anchor" href="core.html#aop-api-advice-throws"></a>Throws advice</h5>
<div class="paragraph">
<p><em>Throws advice</em> is invoked after the return of the join point if the join point threw
an exception. Spring offers typed throws advice. Note that this means that the
<code>org.springframework.aop.ThrowsAdvice</code> interface does not contain any methods: It is a
tag interface identifying that the given object implements one or more typed throws
advice methods. These should be in the form of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">afterThrowing([<span class="predefined-type">Method</span>, args, target], subclassOfThrowable)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the last argument is required. The method signatures may have either one or four
arguments, depending on whether the advice method is interested in the method and
arguments. The following classes are examples of throws advice.</p>
</div>
<div class="paragraph">
<p>The advice below is invoked if a <code>RemoteException</code> is thrown (including subclasses):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RemoteThrowsAdvice</span> <span class="directive">implements</span> ThrowsAdvice {

    <span class="directive">public</span> <span class="type">void</span> afterThrowing(<span class="exception">RemoteException</span> ex) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="comment">// Do something with remote exception</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following advice is invoked if a <code>ServletException</code> is thrown. Unlike the above
advice, it declares 4 arguments, so that it has access to the invoked method, method
arguments and target object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ServletThrowsAdviceWithArguments</span> <span class="directive">implements</span> ThrowsAdvice {

    <span class="directive">public</span> <span class="type">void</span> afterThrowing(<span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target, ServletException ex) {
        <span class="comment">// Do something with all arguments</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final example illustrates how these two methods could be used in a single class,
which handles both <code>RemoteException</code> and <code>ServletException</code>. Any number of throws advice
methods can be combined in a single class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CombinedThrowsAdvice</span> <span class="directive">implements</span> ThrowsAdvice {

    <span class="directive">public</span> <span class="type">void</span> afterThrowing(<span class="exception">RemoteException</span> ex) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="comment">// Do something with remote exception</span>
    }

    <span class="directive">public</span> <span class="type">void</span> afterThrowing(<span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target, ServletException ex) {
        <span class="comment">// Do something with all arguments</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a throws-advice method throws an exception itself, it will override the
original exception (i.e. change the exception thrown to the user). The overriding
exception will typically be a RuntimeException; this is compatible with any method
signature. However, if a throws-advice method throws a checked exception, it will have
to match the declared exceptions of the target method and is hence to some degree
coupled to specific target method signatures. <em>Do not throw an undeclared checked
exception that is incompatible with the target method&#8217;s signature!</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Throws advice can be used with any pointcut.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-advice-after-returning"><a class="anchor" href="core.html#aop-api-advice-after-returning"></a>After Returning advice</h5>
<div class="paragraph">
<p>An after returning advice in Spring must implement the
<em>org.springframework.aop.AfterReturningAdvice</em> interface, shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AfterReturningAdvice</span> <span class="directive">extends</span> Advice {

    <span class="type">void</span> afterReturning(<span class="predefined-type">Object</span> returnValue, <span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target)
            <span class="directive">throws</span> <span class="predefined-type">Throwable</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An after returning advice has access to the return value (which it cannot modify),
invoked method, methods arguments and target.</p>
</div>
<div class="paragraph">
<p>The following after returning advice counts all successful method invocations that have
not thrown exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CountingAfterReturningAdvice</span> <span class="directive">implements</span> AfterReturningAdvice {

    <span class="directive">private</span> <span class="type">int</span> count;

    <span class="directive">public</span> <span class="type">void</span> afterReturning(<span class="predefined-type">Object</span> returnValue, <span class="predefined-type">Method</span> m, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target)
            <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        ++count;
    }

    <span class="directive">public</span> <span class="type">int</span> getCount() {
        <span class="keyword">return</span> count;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This advice doesn&#8217;t change the execution path. If it throws an exception, this will be
thrown up the interceptor chain instead of the return value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After returning advice can be used with any pointcut.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-advice-introduction"><a class="anchor" href="core.html#aop-api-advice-introduction"></a>Introduction advice</h5>
<div class="paragraph">
<p>Spring treats introduction advice as a special kind of interception advice.</p>
</div>
<div class="paragraph">
<p>Introduction requires an <code>IntroductionAdvisor</code>, and an <code>IntroductionInterceptor</code>,
implementing the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IntroductionInterceptor</span> <span class="directive">extends</span> MethodInterceptor {

    <span class="type">boolean</span> implementsInterface(<span class="predefined-type">Class</span> intf);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>invoke()</code> method inherited from the AOP Alliance <code>MethodInterceptor</code> interface must
implement the introduction: that is, if the invoked method is on an introduced
interface, the introduction interceptor is responsible for handling the method call - it
cannot invoke <code>proceed()</code>.</p>
</div>
<div class="paragraph">
<p>Introduction advice cannot be used with any pointcut, as it applies only at class,
rather than method, level. You can only use introduction advice with the
<code>IntroductionAdvisor</code>, which has the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IntroductionAdvisor</span> <span class="directive">extends</span> Advisor, IntroductionInfo {

    ClassFilter getClassFilter();

    <span class="type">void</span> validateInterfaces() <span class="directive">throws</span> <span class="exception">IllegalArgumentException</span>;
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">IntroductionInfo</span> {

    <span class="predefined-type">Class</span><span class="type">[]</span> getInterfaces();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no <code>MethodMatcher</code>, and hence no <code>Pointcut</code>, associated with introduction
advice. Only class filtering is logical.</p>
</div>
<div class="paragraph">
<p>The <code>getInterfaces()</code> method returns the interfaces introduced by this advisor.</p>
</div>
<div class="paragraph">
<p>The <code>validateInterfaces()</code> method is used internally to see whether or not the
introduced interfaces can be implemented by the configured <code>IntroductionInterceptor</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example from the Spring test suite. Let&#8217;s suppose we want to
introduce the following interface to one or more objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Lockable</span> {
    <span class="type">void</span> lock();
    <span class="type">void</span> unlock();
    <span class="type">boolean</span> locked();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This illustrates a <em>mixin</em>. We want to be able to cast advised objects to Lockable,
whatever their type, and call lock and unlock methods. If we call the lock() method, we
want all setter methods to throw a <code>LockedException</code>. Thus we can add an aspect that
provides the ability to make objects immutable, without them having any knowledge of it:
a good example of AOP.</p>
</div>
<div class="paragraph">
<p>Firstly, we&#8217;ll need an <code>IntroductionInterceptor</code> that does the heavy lifting. In this
case, we extend the <code>org.springframework.aop.support.DelegatingIntroductionInterceptor</code>
convenience class. We could implement IntroductionInterceptor directly, but using
<code>DelegatingIntroductionInterceptor</code> is best for most cases.</p>
</div>
<div class="paragraph">
<p>The <code>DelegatingIntroductionInterceptor</code> is designed to delegate an introduction to an
actual implementation of the introduced interface(s), concealing the use of interception
to do so. The delegate can be set to any object using a constructor argument; the
default delegate (when the no-arg constructor is used) is this. Thus in the example
below, the delegate is the <code>LockMixin</code> subclass of <code>DelegatingIntroductionInterceptor</code>.
Given a delegate (by default itself), a <code>DelegatingIntroductionInterceptor</code> instance
looks for all interfaces implemented by the delegate (other than
IntroductionInterceptor), and will support introductions against any of them. It&#8217;s
possible for subclasses such as <code>LockMixin</code> to call the <code>suppressInterface(Class intf)</code>
method to suppress interfaces that should not be exposed. However, no matter how many
interfaces an <code>IntroductionInterceptor</code> is prepared to support, the
<code>IntroductionAdvisor</code> used will control which interfaces are actually exposed. An
introduced interface will conceal any implementation of the same interface by the target.</p>
</div>
<div class="paragraph">
<p>Thus <code>LockMixin</code> extends <code>DelegatingIntroductionInterceptor</code> and implements <code>Lockable</code>
itself. The superclass automatically picks up that Lockable can be supported for
introduction, so we don&#8217;t need to specify that. We could introduce any number of
interfaces in this way.</p>
</div>
<div class="paragraph">
<p>Note the use of the <code>locked</code> instance variable. This effectively adds additional state
to that held in the target object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LockMixin</span> <span class="directive">extends</span> DelegatingIntroductionInterceptor <span class="directive">implements</span> Lockable {

    <span class="directive">private</span> <span class="type">boolean</span> locked;

    <span class="directive">public</span> <span class="type">void</span> lock() {
        <span class="local-variable">this</span>.locked = <span class="predefined-constant">true</span>;
    }

    <span class="directive">public</span> <span class="type">void</span> unlock() {
        <span class="local-variable">this</span>.locked = <span class="predefined-constant">false</span>;
    }

    <span class="directive">public</span> <span class="type">boolean</span> locked() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.locked;
    }

    <span class="directive">public</span> <span class="predefined-type">Object</span> invoke(MethodInvocation invocation) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
        <span class="keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">set</span><span class="delimiter">&quot;</span></span>) == <span class="integer">0</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> LockedException();
        }
        <span class="keyword">return</span> <span class="local-variable">super</span>.invoke(invocation);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often it isn&#8217;t necessary to override the <code>invoke()</code> method: the
<code>DelegatingIntroductionInterceptor</code> implementation - which calls the delegate method if
the method is introduced, otherwise proceeds towards the join point - is usually
sufficient. In the present case, we need to add a check: no setter method can be invoked
if in locked mode.</p>
</div>
<div class="paragraph">
<p>The introduction advisor required is simple. All it needs to do is hold a distinct
<code>LockMixin</code> instance, and specify the introduced interfaces - in this case, just
<code>Lockable</code>. A more complex example might take a reference to the introduction
interceptor (which would be defined as a prototype): in this case, there&#8217;s no
configuration relevant for a <code>LockMixin</code>, so we simply create it using <code>new</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LockMixinAdvisor</span> <span class="directive">extends</span> DefaultIntroductionAdvisor {

    <span class="directive">public</span> LockMixinAdvisor() {
        <span class="local-variable">super</span>(<span class="keyword">new</span> LockMixin(), Lockable.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can apply this advisor very simply: it requires no configuration. (However, it <em>is</em>
necessary: It&#8217;s impossible to use an <code>IntroductionInterceptor</code> without an
<em>IntroductionAdvisor</em>.) As usual with introductions, the advisor must be per-instance,
as it is stateful. We need a different instance of <code>LockMixinAdvisor</code>, and hence
<code>LockMixin</code>, for each advised object. The advisor comprises part of the advised object&#8217;s
state.</p>
</div>
<div class="paragraph">
<p>We can apply this advisor programmatically, using the <code>Advised.addAdvisor()</code> method, or
(the recommended way) in XML configuration, like any other advisor. All proxy creation
choices discussed below, including "auto proxy creators," correctly handle introductions
and stateful mixins.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-api-advisor"><a class="anchor" href="core.html#aop-api-advisor"></a>6.4. Advisor API in Spring</h3>
<div class="paragraph">
<p>In Spring, an Advisor is an aspect that contains just a single advice object associated
with a pointcut expression.</p>
</div>
<div class="paragraph">
<p>Apart from the special case of introductions, any advisor can be used with any advice.
<code>org.springframework.aop.support.DefaultPointcutAdvisor</code> is the most commonly used
advisor class. For example, it can be used with a <code>MethodInterceptor</code>, <code>BeforeAdvice</code> or
<code>ThrowsAdvice</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to mix advisor and advice types in Spring in the same AOP proxy. For
example, you could use a interception around advice, throws advice and before advice in
one proxy configuration: Spring will automatically create the necessary interceptor
chain.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-pfb"><a class="anchor" href="core.html#aop-pfb"></a>6.5. Using the ProxyFactoryBean to create AOP proxies</h3>
<div class="paragraph">
<p>If you&#8217;re using the Spring IoC container (an ApplicationContext or BeanFactory) for your
business objects - and you should be! - you will want to use one of Spring&#8217;s AOP
FactoryBeans. (Remember that a factory bean introduces a layer of indirection, enabling
it to create objects of a different type.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Spring AOP support also uses factory beans under the covers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic way to create an AOP proxy in Spring is to use the
<em>org.springframework.aop.framework.ProxyFactoryBean</em>. This gives complete control over
the pointcuts and advice that will apply, and their ordering. However, there are simpler
options that are preferable if you don&#8217;t need such control.</p>
</div>
<div class="sect3">
<h4 id="aop-pfb-1"><a class="anchor" href="core.html#aop-pfb-1"></a>6.5.1. Basics</h4>
<div class="paragraph">
<p>The <code>ProxyFactoryBean</code>, like other Spring <code>FactoryBean</code> implementations, introduces a
level of indirection. If you define a <code>ProxyFactoryBean</code> with name <code>foo</code>, what objects
referencing <code>foo</code> see is not the <code>ProxyFactoryBean</code> instance itself, but an object
created by the <code>ProxyFactoryBean</code>'s implementation of the <code>getObject()</code> method. This
method will create an AOP proxy wrapping a target object.</p>
</div>
<div class="paragraph">
<p>One of the most important benefits of using a <code>ProxyFactoryBean</code> or another IoC-aware
class to create AOP proxies, is that it means that advices and pointcuts can also be
managed by IoC. This is a powerful feature, enabling certain approaches that are hard to
achieve with other AOP frameworks. For example, an advice may itself reference
application objects (besides the target, which should be available in any AOP
framework), benefiting from all the pluggability provided by Dependency Injection.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-pfb-2"><a class="anchor" href="core.html#aop-pfb-2"></a>6.5.2. JavaBean properties</h4>
<div class="paragraph">
<p>In common with most <code>FactoryBean</code> implementations provided with Spring, the
<code>ProxyFactoryBean</code> class is itself a JavaBean. Its properties are used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the target you want to proxy.</p>
</li>
<li>
<p>Specify whether to use CGLIB (see below and also <a href="core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some key properties are inherited from <code>org.springframework.aop.framework.ProxyConfig</code>
(the superclass for all AOP proxy factories in Spring). These key properties include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTargetClass</code>: <code>true</code> if the target class is to be proxied, rather than the
target class' interfaces. If this property value is set to <code>true</code>, then CGLIB proxies
will be created (but see also <a href="core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</p>
</li>
<li>
<p><code>optimize</code>: controls whether or not aggressive optimizations are applied to proxies
<em>created via CGLIB</em>. One should not blithely use this setting unless one fully
understands how the relevant AOP proxy handles optimization. This is currently used
only for CGLIB proxies; it has no effect with JDK dynamic proxies.</p>
</li>
<li>
<p><code>frozen</code>: if a proxy configuration is <code>frozen</code>, then changes to the configuration are
no longer allowed. This is useful both as a slight optimization and for those cases
when you don&#8217;t want callers to be able to manipulate the proxy (via the <code>Advised</code>
interface) after the proxy has been created. The default value of this property is
<code>false</code>, so changes such as adding additional advice are allowed.</p>
</li>
<li>
<p><code>exposeProxy</code>: determines whether or not the current proxy should be exposed in a
<code>ThreadLocal</code> so that it can be accessed by the target. If a target needs to obtain
the proxy and the <code>exposeProxy</code> property is set to <code>true</code>, the target can use the
<code>AopContext.currentProxy()</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other properties specific to <code>ProxyFactoryBean</code> include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyInterfaces</code>: array of String interface names. If this isn&#8217;t supplied, a CGLIB
proxy for the target class will be used (but see also <a href="core.html#aop-pfb-proxy-types">JDK- and CGLIB-based proxies</a>).</p>
</li>
<li>
<p><code>interceptorNames</code>: String array of <code>Advisor</code>, interceptor or other advice names to
apply. Ordering is significant, on a first come-first served basis. That is to say
that the first interceptor in the list will be the first to be able to intercept the
invocation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The names are bean names in the current factory, including bean names from ancestor
factories. You can&#8217;t mention bean references here since doing so would result in the
<code>ProxyFactoryBean</code> ignoring the singleton setting of the advice.</p>
</div>
<div class="paragraph">
<p>You can append an interceptor name with an asterisk ( <code>*</code>). This will result in the
application of all advisor beans with names starting with the part before the asterisk
to be applied. An example of using this feature can be found in <a href="core.html#aop-global-advisors">Using 'global' advisors</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>singleton: whether or not the factory should return a single object, no matter how
often the <code>getObject()</code> method is called. Several <code>FactoryBean</code> implementations offer
such a method. The default value is <code>true</code>. If you want to use stateful advice - for
example, for stateful mixins - use prototype advices along with a singleton value of
<code>false</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="aop-pfb-proxy-types"><a class="anchor" href="core.html#aop-pfb-proxy-types"></a>6.5.3. JDK- and CGLIB-based proxies</h4>
<div class="paragraph">
<p>This section serves as the definitive documentation on how the <code>ProxyFactoryBean</code>
chooses to create one of either a JDK- and CGLIB-based proxy for a particular target
object (that is to be proxied).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The behavior of the <code>ProxyFactoryBean</code> with regard to creating JDK- or CGLIB-based
proxies changed between versions 1.2.x and 2.0 of Spring. The <code>ProxyFactoryBean</code> now
exhibits similar semantics with regard to auto-detecting interfaces as those of the
<code>TransactionProxyFactoryBean</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the class of a target object that is to be proxied (hereafter simply referred to as
the target class) doesn&#8217;t implement any interfaces, then a CGLIB-based proxy will be
created. This is the easiest scenario, because JDK proxies are interface based, and no
interfaces means JDK proxying isn&#8217;t even possible. One simply plugs in the target bean,
and specifies the list of interceptors via the <code>interceptorNames</code> property. Note that a
CGLIB-based proxy will be created even if the <code>proxyTargetClass</code> property of the
<code>ProxyFactoryBean</code> has been set to <code>false</code>. (Obviously this makes no sense, and is best
removed from the bean definition because it is at best redundant, and at worst
confusing.)</p>
</div>
<div class="paragraph">
<p>If the target class implements one (or more) interfaces, then the type of proxy that is
created depends on the configuration of the <code>ProxyFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyTargetClass</code> property of the <code>ProxyFactoryBean</code> has been set to <code>true</code>,
then a CGLIB-based proxy will be created. This makes sense, and is in keeping with the
principle of least surprise. Even if the <code>proxyInterfaces</code> property of the
<code>ProxyFactoryBean</code> has been set to one or more fully qualified interface names, the fact
that the <code>proxyTargetClass</code> property is set to <code>true</code> <em>will</em> cause CGLIB-based
proxying to be in effect.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyInterfaces</code> property of the <code>ProxyFactoryBean</code> has been set to one or more
fully qualified interface names, then a JDK-based proxy will be created. The created
proxy will implement all of the interfaces that were specified in the <code>proxyInterfaces</code>
property; if the target class happens to implement a whole lot more interfaces than
those specified in the <code>proxyInterfaces</code> property, that is all well and good but those
additional interfaces will not be implemented by the returned proxy.</p>
</div>
<div class="paragraph">
<p>If the <code>proxyInterfaces</code> property of the <code>ProxyFactoryBean</code> has <em>not</em> been set, but
the target class <em>does implement one (or more)</em> interfaces, then the
<code>ProxyFactoryBean</code> will auto-detect the fact that the target class does actually
implement at least one interface, and a JDK-based proxy will be created. The interfaces
that are actually proxied will be <em>all</em> of the interfaces that the target class
implements; in effect, this is the same as simply supplying a list of each and every
interface that the target class implements to the <code>proxyInterfaces</code> property. However,
it is significantly less work, and less prone to typos.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-proxying-intf"><a class="anchor" href="core.html#aop-api-proxying-intf"></a>6.5.4. Proxying interfaces</h4>
<div class="paragraph">
<p>Let&#8217;s look at a simple example of <code>ProxyFactoryBean</code> in action. This example involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>target bean</em> that will be proxied. This is the "personTarget" bean definition in
the example below.</p>
</li>
<li>
<p>An Advisor and an Interceptor used to provide advice.</p>
</li>
<li>
<p>An AOP proxy bean definition specifying the target object (the personTarget bean) and
the interfaces to proxy, along with the advices to apply.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personTarget</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.PersonImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">51</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAdvisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyAdvisor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Custom string property value</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debugInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.interceptor.DebugInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.ProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyInterfaces</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.Person</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>myAdvisor<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>debugInterceptor<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>interceptorNames</code> property takes a list of String: the bean names of the
interceptor or advisors in the current factory. Advisors, interceptors, before, after
returning and throws advice objects can be used. The ordering of advisors is significant.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might be wondering why the list doesn&#8217;t hold bean references. The reason for this is
that if the ProxyFactoryBean&#8217;s singleton property is set to false, it must be able to
return independent proxy instances. If any of the advisors is itself a prototype, an
independent instance would need to be returned, so it&#8217;s necessary to be able to obtain
an instance of the prototype from the factory; holding a reference isn&#8217;t sufficient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The "person" bean definition above can be used in place of a Person implementation, as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Person person = (Person) factory.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other beans in the same IoC context can express a strongly typed dependency on it, as
with an ordinary Java object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personUser</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.PersonUser</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonUser</code> class in this example would expose a property of type Person. As far as
it&#8217;s concerned, the AOP proxy can be used transparently in place of a "real" person
implementation. However, its class would be a dynamic proxy class. It would be possible
to cast it to the <code>Advised</code> interface (discussed below).</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to conceal the distinction between target and proxy using an anonymous
<em>inner bean</em>, as follows. Only the <code>ProxyFactoryBean</code> definition is different; the
advice is included only for completeness:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAdvisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyAdvisor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Custom string property value</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debugInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.interceptor.DebugInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.ProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyInterfaces</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.Person</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Use inner bean, not local reference to target --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.PersonImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">51</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>myAdvisor<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>debugInterceptor<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This has the advantage that there&#8217;s only one object of type <code>Person</code>: useful if we want
to prevent users of the application context from obtaining a reference to the un-advised
object, or need to avoid any ambiguity with Spring IoC <em>autowiring</em>. There&#8217;s also
arguably an advantage in that the ProxyFactoryBean definition is self-contained.
However, there are times when being able to obtain the un-advised target from the
factory might actually be an <em>advantage</em>: for example, in certain test scenarios.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-api-proxying-class"><a class="anchor" href="core.html#aop-api-proxying-class"></a>6.5.5. Proxying classes</h4>
<div class="paragraph">
<p>What if you need to proxy a class, rather than one or more interfaces?</p>
</div>
<div class="paragraph">
<p>Imagine that in our example above, there was no <code>Person</code> interface: we needed to advise
a class called <code>Person</code> that didn&#8217;t implement any business interface. In this case, you
can configure Spring to use CGLIB proxying, rather than dynamic proxies. Simply set the
<code>proxyTargetClass</code> property on the ProxyFactoryBean above to true. While it&#8217;s best to
program to interfaces, rather than classes, the ability to advise classes that don&#8217;t
implement interfaces can be useful when working with legacy code. (In general, Spring
isn&#8217;t prescriptive. While it makes it easy to apply good practices, it avoids forcing a
particular approach.)</p>
</div>
<div class="paragraph">
<p>If you want to, you can force the use of CGLIB in any case, even if you do have
interfaces.</p>
</div>
<div class="paragraph">
<p>CGLIB proxying works by generating a subclass of the target class at runtime. Spring
configures this generated subclass to delegate method calls to the original target: the
subclass is used to implement the <em>Decorator</em> pattern, weaving in the advice.</p>
</div>
<div class="paragraph">
<p>CGLIB proxying should generally be transparent to users. However, there are some issues
to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Final</code> methods can&#8217;t be advised, as they can&#8217;t be overridden.</p>
</li>
<li>
<p>There is no need to add CGLIB to your classpath. As of Spring 3.2, CGLIB is repackaged
and included in the spring-core JAR. In other words, CGLIB-based AOP will work "out of
the box" just as do JDK dynamic proxies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;s little performance difference between CGLIB proxying and dynamic proxies. As of
Spring 1.0, dynamic proxies are slightly faster. However, this may change in the future.
Performance should not be a decisive consideration in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-global-advisors"><a class="anchor" href="core.html#aop-global-advisors"></a>6.5.6. Using 'global' advisors</h4>
<div class="paragraph">
<p>By appending an asterisk to an interceptor name, all advisors with bean names matching
the part before the asterisk, will be added to the advisor chain. This can come in handy
if you need to add a standard set of 'global' advisors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.ProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>global*<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global_debug</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.interceptor.DebugInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">global_performance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.interceptor.PerformanceMonitorInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-concise-proxy"><a class="anchor" href="core.html#aop-concise-proxy"></a>6.6. Concise proxy definitions</h3>
<div class="paragraph">
<p>Especially when defining transactional proxies, you may end up with many similar proxy
definitions. The use of parent and child bean definitions, along with inner bean
definitions, can result in much cleaner and more concise proxy definitions.</p>
</div>
<div class="paragraph">
<p>First a parent, <em>template</em>, bean definition is created for the proxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">txProxyTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.interceptor.TransactionProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionAttributes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will never be instantiated itself, so may actually be incomplete. Then each proxy
which needs to be created is just a child bean definition, which wraps the target of the
proxy as an inner bean definition, since the target will never be used on its own anyway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">txProxyTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.samples.MyServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is of course possible to override properties from the parent template, such as in
this case, the transaction propagation settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">txProxyTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.samples.MySpecialServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionAttributes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">get*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">find*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">load*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">store*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the example above, we have explicitly marked the parent bean definition as
<em>abstract</em> by using the <em>abstract</em> attribute, as described
<a href="core.html#beans-child-bean-definitions">previously</a>, so that it may not actually ever be
instantiated. Application contexts (but not simple bean factories) will by default
pre-instantiate all singletons. It is therefore important (at least for singleton beans)
that if you have a (parent) bean definition which you intend to use only as a template,
and this definition specifies a class, you must make sure to set the <em>abstract</em>
attribute to <em>true</em>, otherwise the application context will actually try to
pre-instantiate it.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-prog"><a class="anchor" href="core.html#aop-prog"></a>6.7. Creating AOP proxies programmatically with the ProxyFactory</h3>
<div class="paragraph">
<p>It&#8217;s easy to create AOP proxies programmatically using Spring. This enables you to use
Spring AOP without dependency on Spring IoC.</p>
</div>
<div class="paragraph">
<p>The following listing shows creation of a proxy for a target object, with one
interceptor and one advisor. The interfaces implemented by the target object will
automatically be proxied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);
factory.addAdvice(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is to construct an object of type
<code>org.springframework.aop.framework.ProxyFactory</code>. You can create this with a target
object, as in the above example, or specify the interfaces to be proxied in an alternate
constructor.</p>
</div>
<div class="paragraph">
<p>You can add advices (with interceptors as a specialized kind of advice) and/or advisors,
and manipulate them for the life of the ProxyFactory. If you add an
IntroductionInterceptionAroundAdvisor, you can cause the proxy to implement additional
interfaces.</p>
</div>
<div class="paragraph">
<p>There are also convenience methods on ProxyFactory (inherited from <code>AdvisedSupport</code>)
which allow you to add other advice types such as before and throws advice.
AdvisedSupport is the superclass of both ProxyFactory and ProxyFactoryBean.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Integrating AOP proxy creation with the IoC framework is best practice in most
applications. We recommend that you externalize configuration from Java code with AOP,
as in general.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="aop-api-advised"><a class="anchor" href="core.html#aop-api-advised"></a>6.8. Manipulating advised objects</h3>
<div class="paragraph">
<p>However you create AOP proxies, you can manipulate them using the
<code>org.springframework.aop.framework.Advised</code> interface. Any AOP proxy can be cast to this
interface, whichever other interfaces it implements. This interface includes the
following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Advisor<span class="type">[]</span> getAdvisors();

<span class="type">void</span> addAdvice(Advice advice) <span class="directive">throws</span> AopConfigException;

<span class="type">void</span> addAdvice(<span class="type">int</span> pos, Advice advice) <span class="directive">throws</span> AopConfigException;

<span class="type">void</span> addAdvisor(Advisor advisor) <span class="directive">throws</span> AopConfigException;

<span class="type">void</span> addAdvisor(<span class="type">int</span> pos, Advisor advisor) <span class="directive">throws</span> AopConfigException;

<span class="type">int</span> indexOf(Advisor advisor);

<span class="type">boolean</span> removeAdvisor(Advisor advisor) <span class="directive">throws</span> AopConfigException;

<span class="type">void</span> removeAdvisor(<span class="type">int</span> index) <span class="directive">throws</span> AopConfigException;

<span class="type">boolean</span> replaceAdvisor(Advisor a, Advisor b) <span class="directive">throws</span> AopConfigException;

<span class="type">boolean</span> isFrozen();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getAdvisors()</code> method will return an Advisor for every advisor, interceptor or
other advice type that has been added to the factory. If you added an Advisor, the
returned advisor at this index will be the object that you added. If you added an
interceptor or other advice type, Spring will have wrapped this in an advisor with a
pointcut that always returns true. Thus if you added a <code>MethodInterceptor</code>, the advisor
returned for this index will be an <code>DefaultPointcutAdvisor</code> returning your
<code>MethodInterceptor</code> and a pointcut that matches all classes and methods.</p>
</div>
<div class="paragraph">
<p>The <code>addAdvisor()</code> methods can be used to add any Advisor. Usually the advisor holding
pointcut and advice will be the generic <code>DefaultPointcutAdvisor</code>, which can be used with
any advice or pointcut (but not for introductions).</p>
</div>
<div class="paragraph">
<p>By default, it&#8217;s possible to add or remove advisors or interceptors even once a proxy
has been created. The only restriction is that it&#8217;s impossible to add or remove an
introduction advisor, as existing proxies from the factory will not show the interface
change. (You can obtain a new proxy from the factory to avoid this problem.)</p>
</div>
<div class="paragraph">
<p>A simple example of casting an AOP proxy to the <code>Advised</code> interface and examining and
manipulating its advice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Advised advised = (Advised) myObject;
Advisor<span class="type">[]</span> advisors = advised.getAdvisors();
<span class="type">int</span> oldAdvisorCount = advisors.length;
<span class="predefined-type">System</span>.out.println(oldAdvisorCount + <span class="string"><span class="delimiter">&quot;</span><span class="content"> advisors</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Add an advice like an interceptor without a pointcut</span>
<span class="comment">// Will match all proxied methods</span>
<span class="comment">// Can use for interceptors, before, after returning or throws advice</span>
advised.addAdvice(<span class="keyword">new</span> DebugInterceptor());

<span class="comment">// Add selective advice using a pointcut</span>
advised.addAdvisor(<span class="keyword">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Added two advisors</span><span class="delimiter">&quot;</span></span>, oldAdvisorCount + <span class="integer">2</span>, advised.getAdvisors().length);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s questionable whether it&#8217;s advisable (no pun intended) to modify advice on a
business object in production, although there are no doubt legitimate usage cases.
However, it can be very useful in development: for example, in tests. I have sometimes
found it very useful to be able to add test code in the form of an interceptor or other
advice, getting inside a method invocation I want to test. (For example, the advice can
get inside a transaction created for that method: for example, to run SQL to check that
a database was correctly updated, before marking the transaction for roll back.)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on how you created the proxy, you can usually set a <code>frozen</code> flag, in which
case the <code>Advised</code> <code>isFrozen()</code> method will return true, and any attempts to modify
advice through addition or removal will result in an <code>AopConfigException</code>. The ability
to freeze the state of an advised object is useful in some cases, for example, to
prevent calling code removing a security interceptor. It may also be used in Spring 1.1
to allow aggressive optimization if runtime advice modification is known not to be
required.</p>
</div>
</div>
<div class="sect2">
<h3 id="aop-autoproxy"><a class="anchor" href="core.html#aop-autoproxy"></a>6.9. Using the "auto-proxy" facility</h3>
<div class="paragraph">
<p>So far we&#8217;ve considered explicit creation of AOP proxies using a <code>ProxyFactoryBean</code> or
similar factory bean.</p>
</div>
<div class="paragraph">
<p>Spring also allows us to use "auto-proxy" bean definitions, which can automatically
proxy selected bean definitions. This is built on Spring "bean post processor"
infrastructure, which enables modification of any bean definition as the container loads.</p>
</div>
<div class="paragraph">
<p>In this model, you set up some special bean definitions in your XML bean definition file
to configure the auto proxy infrastructure. This allows you just to declare the targets
eligible for auto-proxying: you don&#8217;t need to use <code>ProxyFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>There are two ways to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using an auto-proxy creator that refers to specific beans in the current context.</p>
</li>
<li>
<p>A special case of auto-proxy creation that deserves to be considered separately;
auto-proxy creation driven by source-level metadata attributes.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="aop-autoproxy-choices"><a class="anchor" href="core.html#aop-autoproxy-choices"></a>6.9.1. Autoproxy bean definitions</h4>
<div class="paragraph">
<p>The <code>org.springframework.aop.framework.autoproxy</code> package provides the following
standard auto-proxy creators.</p>
</div>
<div class="sect4">
<h5 id="aop-api-autoproxy"><a class="anchor" href="core.html#aop-api-autoproxy"></a>BeanNameAutoProxyCreator</h5>
<div class="paragraph">
<p>The <code>BeanNameAutoProxyCreator</code> class is a <code>BeanPostProcessor</code> that automatically creates
AOP proxies for beans with names matching literal values or wildcards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanNames</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdk*,onlyJdk</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>myInterceptor<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>ProxyFactoryBean</code>, there is an <code>interceptorNames</code> property rather than a list
of interceptors, to allow correct behavior for prototype advisors. Named "interceptors"
can be advisors or any advice type.</p>
</div>
<div class="paragraph">
<p>As with auto proxying in general, the main point of using <code>BeanNameAutoProxyCreator</code> is
to apply the same configuration consistently to multiple objects, with minimal volume of
configuration. It is a popular choice for applying declarative transactions to multiple
objects.</p>
</div>
<div class="paragraph">
<p>Bean definitions whose names match, such as "jdkMyBean" and "onlyJdk" in the above
example, are plain old bean definitions with the target class. An AOP proxy will be
created automatically by the <code>BeanNameAutoProxyCreator</code>. The same advice will be applied
to all matching beans. Note that if advisors are used (rather than the interceptor in
the above example), the pointcuts may apply differently to different beans.</p>
</div>
</div>
<div class="sect4">
<h5 id="aop-api-autoproxy-default"><a class="anchor" href="core.html#aop-api-autoproxy-default"></a>DefaultAdvisorAutoProxyCreator</h5>
<div class="paragraph">
<p>A more general and extremely powerful auto proxy creator is
<code>DefaultAdvisorAutoProxyCreator</code>. This will automagically apply eligible advisors in the
current context, without the need to include specific bean names in the auto-proxy
advisor&#8217;s bean definition. It offers the same merit of consistent configuration and
avoidance of duplication as <code>BeanNameAutoProxyCreator</code>.</p>
</div>
<div class="paragraph">
<p>Using this mechanism involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifying a <code>DefaultAdvisorAutoProxyCreator</code> bean definition.</p>
</li>
<li>
<p>Specifying any number of Advisors in the same or related contexts. Note that these
<em>must</em> be Advisors, not just interceptors or other advices. This is necessary
because there must be a pointcut to evaluate, to check the eligibility of each advice
to candidate bean definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>DefaultAdvisorAutoProxyCreator</code> will automatically evaluate the pointcut contained
in each advisor, to see what (if any) advice it should apply to each business object
(such as "businessObject1" and "businessObject2" in the example).</p>
</div>
<div class="paragraph">
<p>This means that any number of advisors can be applied automatically to each business
object. If no pointcut in any of the advisors matches any method in a business object,
the object will not be proxied. As bean definitions are added for new business objects,
they will automatically be proxied if necessary.</p>
</div>
<div class="paragraph">
<p>Autoproxying in general has the advantage of making it impossible for callers or
dependencies to obtain an un-advised object. Calling getBean("businessObject1") on this
ApplicationContext will return an AOP proxy, not the target business object. (The "inner
bean" idiom shown earlier also offers this benefit.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customAdvisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyAdvisor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObject1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.BusinessObject1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Properties omitted --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObject2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.BusinessObject2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DefaultAdvisorAutoProxyCreator</code> is very useful if you want to apply the same advice
consistently to many business objects. Once the infrastructure definitions are in place,
you can simply add new business objects without including specific proxy configuration.
You can also drop in additional aspects very easily - for example, tracing or
performance monitoring aspects - with minimal change to configuration.</p>
</div>
<div class="paragraph">
<p>The DefaultAdvisorAutoProxyCreator offers support for filtering (using a naming
convention so that only certain advisors are evaluated, allowing use of multiple,
differently configured, AdvisorAutoProxyCreators in the same factory) and ordering.
Advisors can implement the <code>org.springframework.core.Ordered</code> interface to ensure
correct ordering if this is an issue. The TransactionAttributeSourceAdvisor used in the
above example has a configurable order value; the default setting is unordered.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-targetsource"><a class="anchor" href="core.html#aop-targetsource"></a>6.10. Using TargetSources</h3>
<div class="paragraph">
<p>Spring offers the concept of a <em>TargetSource</em>, expressed in the
<code>org.springframework.aop.TargetSource</code> interface. This interface is responsible for
returning the "target object" implementing the join point. The <code>TargetSource</code>
implementation is asked for a target instance each time the AOP proxy handles a method
invocation.</p>
</div>
<div class="paragraph">
<p>Developers using Spring AOP don&#8217;t normally need to work directly with TargetSources, but
this provides a powerful means of supporting pooling, hot swappable and other
sophisticated targets. For example, a pooling TargetSource can return a different target
instance for each invocation, using a pool to manage instances.</p>
</div>
<div class="paragraph">
<p>If you do not specify a TargetSource, a default implementation is used that wraps a
local object. The same target is returned for each invocation (as you would expect).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the standard target sources provided with Spring, and how you can use them.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using a custom target source, your target will usually need to be a prototype
rather than a singleton bean definition. This allows Spring to create a new target
instance when required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aop-ts-swap"><a class="anchor" href="core.html#aop-ts-swap"></a>6.10.1. Hot swappable target sources</h4>
<div class="paragraph">
<p>The <code>org.springframework.aop.target.HotSwappableTargetSource</code> exists to allow the target
of an AOP proxy to be switched while allowing callers to keep their references to it.</p>
</div>
<div class="paragraph">
<p>Changing the target source&#8217;s target takes effect immediately. The
<code>HotSwappableTargetSource</code> is threadsafe.</p>
</div>
<div class="paragraph">
<p>You can change the target via the <code>swap()</code> method on HotSwappableTargetSource as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotSwappableTargetSource swapper = (HotSwappableTargetSource) beanFactory.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">swapper</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Object</span> oldTarget = swapper.swap(newTarget);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML definitions required look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialTarget</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mycompany.OldTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">swapper</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.target.HotSwappableTargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">swappable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.ProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">swapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>swap()</code> call changes the target of the swappable bean. Clients who hold a
reference to that bean will be unaware of the change, but will immediately start hitting
the new target.</p>
</div>
<div class="paragraph">
<p>Although this example doesn&#8217;t add any advice - and it&#8217;s not necessary to add advice to
use a <code>TargetSource</code> - of course any <code>TargetSource</code> can be used in conjunction with
arbitrary advice.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-ts-pool"><a class="anchor" href="core.html#aop-ts-pool"></a>6.10.2. Pooling target sources</h4>
<div class="paragraph">
<p>Using a pooling target source provides a similar programming model to stateless session
EJBs, in which a pool of identical instances is maintained, with method invocations
going to free objects in the pool.</p>
</div>
<div class="paragraph">
<p>A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can
be applied to any POJO. As with Spring in general, this service can be applied in a
non-invasive way.</p>
</div>
<div class="paragraph">
<p>Spring provides out-of-the-box support for Commons Pool 2.2, which provides a
fairly efficient pooling implementation. You&#8217;ll need the commons-pool Jar on your
application&#8217;s classpath to use this feature. It&#8217;s also possible to subclass
<code>org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any other
pooling API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Commons Pool 1.5+ is also supported but deprecated as of Spring Framework 4.2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sample configuration is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObjectTarget</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyBusinessObject</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ... properties omitted
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">poolTargetSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.target.CommonsPool2TargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetBeanName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObjectTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.framework.ProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">poolTargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptorNames</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the target object - "businessObjectTarget" in the example - <em>must</em> be a
prototype. This allows the <code>PoolingTargetSource</code> implementation to create new instances
of the target to grow the pool as necessary. See the javadocs of
<code>AbstractPoolingTargetSource</code> and the concrete subclass you wish to use for information
about its properties: "maxSize" is the most basic, and always guaranteed to be present.</p>
</div>
<div class="paragraph">
<p>In this case, "myInterceptor" is the name of an interceptor that would need to be
defined in the same IoC context. However, it isn&#8217;t necessary to specify interceptors to
use pooling. If you want only pooling, and no other advice, don&#8217;t set the
interceptorNames property at all.</p>
</div>
<div class="paragraph">
<p>It&#8217;s possible to configure Spring so as to be able to cast any pooled object to the
<code>org.springframework.aop.target.PoolingConfig</code> interface, which exposes information
about the configuration and current size of the pool through an introduction. You&#8217;ll
need to define an advisor like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">poolConfigAdvisor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.MethodInvokingFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">poolTargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getPoolingConfigMixin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This advisor is obtained by calling a convenience method on the
<code>AbstractPoolingTargetSource</code> class, hence the use of MethodInvokingFactoryBean. This
advisor&#8217;s name ("poolConfigAdvisor" here) must be in the list of interceptors names in
the ProxyFactoryBean exposing the pooled object.</p>
</div>
<div class="paragraph">
<p>The cast will look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PoolingConfig conf = (PoolingConfig) beanFactory.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObject</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Max pool size is </span><span class="delimiter">&quot;</span></span> + conf.getMaxSize());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Pooling stateless service objects is not usually necessary. We don&#8217;t believe it should
be the default choice, as most stateless objects are naturally thread safe, and instance
pooling is problematic if resources are cached.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Simpler pooling is available using auto-proxying. It&#8217;s possible to set the TargetSources
used by any auto-proxy creator.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-ts-prototype"><a class="anchor" href="core.html#aop-ts-prototype"></a>6.10.3. Prototype target sources</h4>
<div class="paragraph">
<p>Setting up a "prototype" target source is similar to a pooling TargetSource. In this
case, a new instance of the target will be created on every method invocation. Although
the cost of creating a new object isn&#8217;t high in a modern JVM, the cost of wiring up the
new object (satisfying its IoC dependencies) may be more expensive. Thus you shouldn&#8217;t
use this approach without very good reason.</p>
</div>
<div class="paragraph">
<p>To do this, you could modify the <code>poolTargetSource</code> definition shown above as follows.
(I&#8217;ve also changed the name, for clarity.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototypeTargetSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.target.PrototypeTargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetBeanName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObjectTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s only one property: the name of the target bean. Inheritance is used in the
TargetSource implementations to ensure consistent naming. As with the pooling target
source, the target bean must be a prototype bean definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="aop-ts-threadlocal"><a class="anchor" href="core.html#aop-ts-threadlocal"></a>6.10.4. ThreadLocal target sources</h4>
<div class="paragraph">
<p><code>ThreadLocal</code> target sources are useful if you need an object to be created for each
incoming request (per thread that is). The concept of a <code>ThreadLocal</code> provide a JDK-wide
facility to transparently store resource alongside a thread. Setting up a
<code>ThreadLocalTargetSource</code> is pretty much the same as was explained for the other types
of target source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">threadlocalTargetSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.aop.target.ThreadLocalTargetSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetBeanName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessObjectTarget</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ThreadLocals come with serious issues (potentially resulting in memory leaks) when
incorrectly using them in a multi-threaded and multi-classloader environments. One
should always consider wrapping a threadlocal in some other class and never directly use
the <code>ThreadLocal</code> itself (except of course in the wrapper class). Also, one should
always remember to correctly set and unset (where the latter simply involved a call to
<code>ThreadLocal.set(null)</code>) the resource local to the thread. Unsetting should be done in
any case since not unsetting it might result in problematic behavior. Spring&#8217;s
ThreadLocal support does this for you and should always be considered in favor of using
ThreadLocals without other proper handling code.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aop-extensibility"><a class="anchor" href="core.html#aop-extensibility"></a>6.11. Defining new Advice types</h3>
<div class="paragraph">
<p>Spring AOP is designed to be extensible. While the interception implementation strategy
is presently used internally, it is possible to support arbitrary advice types in
addition to the out-of-the-box interception around advice, before, throws advice and
after returning advice.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.aop.framework.adapter</code> package is an SPI package allowing
support for new custom advice types to be added without changing the core framework.
The only constraint on a custom <code>Advice</code> type is that it must implement the
<code>org.aopalliance.aop.Advice</code> marker interface.</p>
</div>
<div class="paragraph">
<p>Please refer to the <code>org.springframework.aop.framework.adapter</code> javadocs for further
information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="null-safety"><a class="anchor" href="core.html#null-safety"></a>7. Null-safety</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Java does not allow to express null-safety with its type system, Spring Framework
now provides following annotations in the <code>org.springframework.lang</code> package to declare
nullability of APIs and fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/lang/NonNull.html"><code>@NonNull</code></a> annotation where specific parameter,
return value or field cannot be <code>null</code> (not needed on parameter and return value
where <code>@NonNullApi</code> and <code>@NonNullFields</code> apply) .</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/lang/Nullable.html"><code>@Nullable</code></a> annotation where specific
parameter, return value or field can be <code>null</code>.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/lang/NonNullApi.html"><code>@NonNullApi</code></a> annotation at package level
declares non-null as the default behavior for parameters and return values.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/lang/NonNullFields.html"><code>@NonNullFields</code></a> annotation at package
level declares non-null as the default behavior for fields.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Framework leverages itself these annotations, but they can also be used in any Spring based
Java project to declare null-safe APIs and optionally null-safe fields. Generic type arguments,
varargs and array elements nullability are not supported yet, but should be in an upcoming
release, see <a href="https://jira.spring.io/browse/SPR-15942">SPR-15942</a> for up-to-date information.
Nullability declaration are expected to be fine-tuned between Spring Framework release,
including minor ones. Nullability of types used inside method bodies is outside of the
scope of this feature.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Libraries like Reactor or Spring Data provide null-safe APIs leveraging this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="use-cases"><a class="anchor" href="core.html#use-cases"></a>7.1. Use cases</h3>
<div class="paragraph">
<p>In addition to providing an explicit declaration for Spring Framework API nullability,
these annotation can be used by IDE (such as IDEA or Eclipse) to provide useful
warnings to Java developers related to null-safety in order to avoid <code>NullPointerException</code>
at runtime.</p>
</div>
<div class="paragraph">
<p>They are also used to make Spring API null-safe in Kotlin projects since Kotlin natively
supports <a href="https://kotlinlang.org/docs/reference/null-safety.html">null-safety</a>. More details
are available in <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#kotlin-null-safety">Kotlin support documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jsr-305-meta-annotations"><a class="anchor" href="core.html#jsr-305-meta-annotations"></a>7.2. JSR 305 meta-annotations</h3>
<div class="paragraph">
<p>Spring annotations are meta-annotated with <a href="https://jcp.org/en/jsr/detail?id=305">JSR 305</a>
annotations (a dormant but widely spread JSR). JSR 305 meta-annotations allows tooling vendors
like IDEA or Kotlin to provide null-safety support in a generic way, without having to hard-code
support for Spring annotations.</p>
</div>
<div class="paragraph">
<p>It is not necessary nor recommended to add JSR 305 dependency in project classpath to
take advantage of Spring null-safe API. Only projects like
Spring-based libraries using null-safety annotations in their codebase should add
<code>com.google.code.findbugs:jsr305:3.0.2</code> with <code>compileOnly</code> Gradle configuration or Maven
<code>provided</code> scope to avoid compile warnings.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="databuffers"><a class="anchor" href="core.html#databuffers"></a>8. Data Buffers and Codecs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction"><a class="anchor" href="core.html#introduction"></a>8.1. Introduction</h3>
<div class="paragraph">
<p>The <code>DataBuffer</code> interface defines an abstraction over byte buffers.
The main reason for introducing it, and not use the standard <code>java.nio.ByteBuffer</code> instead, is Netty.
Netty does not use <code>ByteBuffer</code>, but instead offers <code>ByteBuf</code> as an alternative.
Spring&#8217;s <code>DataBuffer</code> is a simple abstraction over <code>ByteBuf</code> that can also be used on non-Netty
platforms (i.e. Servlet 3.1+).</p>
</div>
</div>
<div class="sect2">
<h3 id="code-databufferfactory-code"><a class="anchor" href="core.html#code-databufferfactory-code"></a>8.2. <code>DataBufferFactory</code></h3>
<div class="paragraph">
<p>The <code>DataBufferFactory</code> offers functionality to allocate new data buffers, as well as to wrap
existing data.
The <code>allocate</code> methods allocate a new data buffer, with a default or given capacity.
Though <code>DataBuffer</code> implementation grow and shrink on demand, it is more efficient to give the
capacity upfront, if known.
The <code>wrap</code> methods decorate an existing <code>ByteBuffer</code> or byte array.
Wrapping does not involve allocation: it simply decorates the given data with a <code>DataBuffer</code>
implementation.</p>
</div>
<div class="paragraph">
<p>There are two implementation of <code>DataBufferFactory</code>: the <code>NettyDataBufferFactory</code> which is meant
to be used on Netty platforms, such as Reactor Netty.
The other implementation, the <code>DefaultDataBufferFactory</code>, is used on other platforms, such as
Servlet 3.1+ servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-code-databuffer-code-interface"><a class="anchor" href="core.html#the-code-databuffer-code-interface"></a>8.3. The <code>DataBuffer</code> interface</h3>
<div class="paragraph">
<p>The <code>DataBuffer</code> interface is similar to <code>ByteBuffer</code>, but offers a number of advantages.
Similar to Netty&#8217;s <code>ByteBuf</code>, the <code>DataBuffer</code> abstraction offers independent read and write
positions.
This is different from the JDK&#8217;s <code>ByteBuffer</code>, which only exposes one position for both reading and
writing, and a separate <code>flip()</code> operation to switch between the two I/O operations.
In general, the following invariant holds for the read position, write position, and the capacity:</p>
</div>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>`0` &lt;= _read position_ &lt;= _write position_ &lt;= _capacity_</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When reading bytes from the <code>DataBuffer</code>, the read position is automatically updated in accordance with
the amount of data read from the buffer.
Similarly, when writing bytes to the <code>DataBuffer</code>, the write position is updated with the amount of
data written to the buffer.
Also, when writing data, the capacity of a <code>DataBuffer</code> is automatically expanded, just like <code>StringBuilder</code>,
<code>ArrayList</code>, and similar types.</p>
</div>
<div class="paragraph">
<p>Besides the reading and writing functionality mentioned above, the <code>DataBuffer</code> also has methods to
view a (slice of a) buffer as <code>ByteBuffer</code>, <code>InputStream</code>, or <code>OutputStream</code>.
Additionally, it offers methods to determine the index of a given byte.</p>
</div>
<div class="paragraph">
<p>There are two implementation of <code>DataBuffer</code>: the <code>NettyDataBuffer</code> which is meant to be used on
Netty platforms, such as Reactor Netty.
The other implementation, the <code>DefaultDataBuffer</code>, is used on other platforms, such as Servlet 3.1+
servers.</p>
</div>
<div class="sect3">
<h4 id="code-pooleddatabuffer-code"><a class="anchor" href="core.html#code-pooleddatabuffer-code"></a>8.3.1. <code>PooledDataBuffer</code></h4>
<div class="paragraph">
<p>The <code>PooledDataBuffer</code> is an extension to <code>DataBuffer</code> that adds methods for reference counting.
The <code>retain</code> method increases the reference count by one.
The <code>release</code> method decreases the count by one, and releases the buffer&#8217;s memory when the count
reaches 0.
Both of these methods are related to <em>reference counting</em>, a mechanism that is explained below.</p>
</div>
<div class="paragraph">
<p>Note that <code>DataBufferUtils</code> offers useful utility methods for releasing and retaining pooled data
buffers.
These methods take a plain <code>DataBuffer</code> as parameter, but only call <code>retain</code> or <code>release</code> if the
passed data buffer is an instance of <code>PooledDataBuffer</code>.</p>
</div>
<div class="sect4">
<h5 id="databuffer-reference-counting"><a class="anchor" href="core.html#databuffer-reference-counting"></a>Reference Counting</h5>
<div class="paragraph">
<p>Reference counting is not a common technique in Java; it is much more common in other programming
languages such as Object C and C++.
In and of itself, reference counting is not complex: it basically involves tracking the number of
references that apply to an object.
The reference count of a <code>PooledDataBuffer</code> starts at 1, is incremented by calling <code>retain</code>,
and decremented by calling <code>release</code>.
As long as the buffer&#8217;s reference count is larger than 0 the buffer will not be released.
When the number decreases to 0, the instance will be released.
In practice, this means that the reserved memory captured by the buffer will be returned back to
the memory pool, ready to be used for future allocations.</p>
</div>
<div class="paragraph">
<p>In general, <em>the last component to access a <code>DataBuffer</code> is responsible for releasing it</em>.
Withing Spring, there are two sorts of components that release buffers: decoders and transports.
Decoders are responsible for transforming a stream of buffers into other types (see <a href="core.html#codecs">Codecs</a> below),
and transports are responsible for sending buffers across a network boundary, typically as an HTTP message.
This means that if you allocate data buffers for the purpose of putting them into an outbound HTTP
message (i.e. client-side request or server-side response), they do not have to be released.
The other consequence of this rule is that if you allocate data buffers that do not end up in the
body, for instance because of a thrown exception, you will have to release them yourself.
The following snippet shows a typical <code>DataBuffer</code> usage scenario when dealing with methods that
throw exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DataBufferFactory factory = ...
DataBuffer buffer = factory.allocateBuffer(); <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">boolean</span> release = <span class="predefined-constant">true</span>; <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">try</span> {
    writeDataToBuffer(buffer); <i class="conum" data-value="3"></i><b>(3)</b>
    putBufferInHttpBody(buffer);
    release = <span class="predefined-constant">false</span>; <i class="conum" data-value="4"></i><b>(4)</b>
}
<span class="keyword">finally</span> {
    <span class="keyword">if</span> (release) {
        DataBufferUtils.release(buffer); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}

<span class="directive">private</span> <span class="type">void</span> writeDataToBuffer(<span class="predefined-type">DataBuffer</span> buffer) <span class="directive">throws</span> <span class="exception">IOException</span> { <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new buffer is allocated.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A boolean flag indicates whether the allocated buffer should be released.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This example method loads data into the buffer. Note that the method can throw an <code>IOException</code>,
and therefore a <code>finally</code> block to release the buffer is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If no exception occurred, we switch the <code>release</code> flag to <code>false</code> as the buffer will now be
released as part of sending the HTTP body across the wire.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If an exception did occur, the flag is still set to <code>true</code>, and the buffer will be released
here.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="databufferutils"><a class="anchor" href="core.html#databufferutils"></a>8.3.2. DataBufferUtils</h4>
<div class="paragraph">
<p><code>DataBufferUtils</code> contains various utility methods that operate on data buffers.
It contains methods for reading a <code>Flux</code> of <code>DataBuffer</code> objects from an <code>InputStream</code> or NIO
<code>Channel</code>, and methods for writing a data buffer <code>Flux</code> to an <code>OutputStream</code> or <code>Channel</code>.
<code>DataBufferUtils</code> also exposes <code>retain</code> and <code>release</code> methods that operate on plain <code>DataBuffer</code>
instances (so that casting to a <code>PooledDataBuffer</code> is not required).</p>
</div>
<div class="paragraph">
<p>Additionally, <code>DataBufferUtils</code> exposes <code>compose</code>, which merges a stream of data buffers into one.
For instance, this method can be used to convert the entire HTTP body into a single buffer (and
from that, a <code>String</code>, or <code>InputStream</code>).
This is particularly useful when dealing with older, blocking APIs.
Note, however, that this puts the entire body in memory, and therefore uses more memory than a pure
streaming solution would.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="codecs"><a class="anchor" href="core.html#codecs"></a>Codecs</h3>
<div class="paragraph">
<p>The <code>org.springframework.core.codec</code> package contains the two main abstractions for converting a
stream of bytes into a stream of objects, or vice-versa.
The <code>Encoder</code> is a strategy interface that encodes a stream of objects into an output stream of
data buffers.
The <code>Decoder</code> does the reverse: it turns a stream of data buffers into a stream of objects.
Note that a decoder instance needs to consider <a href="core.html#databuffer-reference-counting">reference counting</a>.</p>
</div>
<div class="paragraph">
<p>Spring comes with a wide array of default codecs, capable of converting from/to <code>String</code>,
<code>ByteBuffer</code>, byte arrays, and also codecs that support marshalling libraries such as JAXB and
Jackson (with <a href="https://github.com/FasterXML/jackson-core/issues/57">Jackson 2.9+ support for non-blocking parsing</a>).
Withing the context of Spring WebFlux, codecs are used to convert the request body into a
<code>@RequestMapping</code> parameter, or to convert the return type into the response body that is sent back
to the client.
The default codecs are configured in the <code>WebFluxConfigurationSupport</code> class, and can easily be
changed by overriding the <code>configureHttpMessageCodecs</code> when inheriting from that class.
For more information about using codecs in WebFlux, see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-codecs">this section</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="core.html#appendix"></a>9. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="xsd-schemas"><a class="anchor" href="core.html#xsd-schemas"></a>9.1. XML Schemas</h3>
<div class="paragraph">
<p>This part of the appendix lists XML schemas related to the core container.</p>
</div>
<div class="sect3">
<h4 id="xsd-schemas-util"><a class="anchor" href="core.html#xsd-schemas-util"></a>9.1.1. The util schema</h4>
<div class="paragraph">
<p>As the name implies, the <code>util</code> tags deal with common, <em>utility</em> configuration
issues, such as configuring collections, referencing constants, and suchlike.
To use the tags in the <code>util</code> schema, you need to have the following preamble at the top
of your Spring XML configuration file; the text in the snippet below references the
correct schema so that the tags in the <code>util</code> namespace are available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:util</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/util</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-constant"><a class="anchor" href="core.html#xsd-schemas-util-constant"></a>&lt;util:constant/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isolation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Connection.TRANSACTION_SERIALIZABLE</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.FieldRetrievingFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>FieldRetrievingFactoryBean</code>, to set the value of the <code>isolation</code> property on a bean
to the value of the <code>java.sql.Connection.TRANSACTION_SERIALIZABLE</code> constant. This is
all well and good, but it is a tad verbose and (unnecessarily) exposes Spring&#8217;s internal
plumbing to the end user.</p>
</div>
<div class="paragraph">
<p>The following XML Schema-based version is more concise and clearly expresses the
developer&#8217;s intent (<em>'inject this constant value'</em>), and it just reads better.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isolation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Connection.TRANSACTION_SERIALIZABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="xsd-schemas-util-frfb"><a class="anchor" href="core.html#xsd-schemas-util-frfb"></a>Setting a bean property or constructor arg from a field value</h6>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html"><code>FieldRetrievingFactoryBean</code></a>
is a <code>FactoryBean</code> which retrieves a <code>static</code> or non-static field value. It is typically
used for retrieving <code>public</code> <code>static</code> <code>final</code> constants, which may then be used to set a
property value or constructor arg for another bean.</p>
</div>
<div class="paragraph">
<p>Find below an example which shows how a <code>static</code> field is exposed, by using the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html#setStaticField(java.lang.String)"><code>staticField</code></a>
property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myField</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.FieldRetrievingFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">staticField</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Connection.TRANSACTION_SERIALIZABLE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a convenience usage form where the <code>static</code> field is specified as the bean
name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Connection.TRANSACTION_SERIALIZABLE</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.FieldRetrievingFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This does mean that there is no longer any choice in what the bean id is (so any other
bean that refers to it will also have to use this longer name), but this form is very
concise to define, and very convenient to use as an inner bean since the id doesn&#8217;t have
to be specified for the bean reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isolation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Connection.TRANSACTION_SERIALIZABLE</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.FieldRetrievingFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to access a non-static (instance) field of another bean, as
described in the API documentation for the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/beans/factory/config/FieldRetrievingFactoryBean.html"><code>FieldRetrievingFactoryBean</code></a>
class.</p>
</div>
<div class="paragraph">
<p>Injecting enum values into beans as either property or constructor arguments is very
easy to do in Spring, in that you don&#8217;t actually have to <em>do</em> anything or know
anything about the Spring internals (or even about classes such as the
<code>FieldRetrievingFactoryBean</code>). Let&#8217;s look at an example to see how easy injecting an
enum value is; consider this enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">javax.persistence</span>;

<span class="directive">public</span> <span class="type">enum</span> PersistenceContextType {

    TRANSACTION,
    EXTENDED
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now consider a setter of type <code>PersistenceContextType</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Client</span> {

    <span class="directive">private</span> PersistenceContextType persistenceContextType;

    <span class="directive">public</span> <span class="type">void</span> setPersistenceContextType(PersistenceContextType type) {
        <span class="local-variable">this</span>.persistenceContextType = type;
    }
}</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>and the corresponding bean definition:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.Client</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistenceContextType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRANSACTION</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-property-path"><a class="anchor" href="core.html#xsd-schemas-util-property-path"></a>&lt;util:property-path/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- target bean to be referenced by name --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spouse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- will result in 10, which is the value of property 'age' of bean 'testBean' --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean.age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>PropertyPathFactoryBean</code>, to create a bean (of type <code>int</code>) called <code>testBean.age</code> that
has a value equal to the <code>age</code> property of the <code>testBean</code> bean.</p>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- target bean to be referenced by name --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spouse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- will result in 10, which is the value of property 'age' of bean 'testBean' --&gt;</span>
<span class="tag">&lt;util:property-path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean.age</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>path</code> attribute of the <code>&lt;property-path/&gt;</code> tag follows the form
<code>beanName.beanProperty</code>.</p>
</div>
<div class="sect5">
<h6 id="xsd-schemas-util-property-path-dependency"><a class="anchor" href="core.html#xsd-schemas-util-property-path-dependency"></a>Using &lt;util:property-path/&gt; to set a bean property or constructor-argument</h6>
<div class="paragraph">
<p><code>PropertyPathFactoryBean</code> is a <code>FactoryBean</code> that evaluates a property path on a given
target object. The target object can be specified directly or via a bean name. This
value may then be used in another bean definition as a property value or constructor
argument.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example where a path is used against another bean, by name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">// target bean to be referenced by name
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spouse</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

// will result in 11, which is the value of property 'spouse.age' of bean 'person'
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theAge</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetBeanName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyPath</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spouse.age</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, a path is evaluated against an inner bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- will result in 12, which is the value of property 'age' of the inner bean --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theAge</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.TestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyPath</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a shortcut form, where the bean name is the property path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- will result in 10, which is the value of property 'age' of bean 'person' --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person.age</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This form does mean that there is no choice in the name of the bean. Any reference to it
will also have to use the same id, which is the path. Of course, if used as an inner
bean, there is no need to refer to it at all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">person.age</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPathFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result type may be specifically set in the actual definition. This is not necessary
for most use cases, but can be of use for some. Please see the Javadocs for more info on
this feature.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-properties"><a class="anchor" href="core.html#xsd-schemas-util-properties"></a>&lt;util:properties/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbcConfiguration</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertiesFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/foo/jdbc-production.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>PropertiesFactoryBean</code>, to instantiate a <code>java.util.Properties</code> instance with values
loaded from the supplied <a href="core.html#resources"><code>Resource</code></a> location).</p>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Properties instance with values loaded from the supplied location --&gt;</span>
<span class="tag">&lt;util:properties</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbcConfiguration</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/foo/jdbc-production.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-list"><a class="anchor" href="core.html#xsd-schemas-util-list"></a>&lt;util:list/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.List instance with values loaded from the supplied 'sourceList' --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.ListFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a2d2c7c1cacdd0cbcce2cac7d0cd8ccdd0c5">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e19380928a8e8d8f888a8e97a1928d948c92cf8e9386">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7d0e091c0b0f121a14133d1a120b53120f1a">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c6c736e7a756e655c7b736a32736e7b">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>ListFactoryBean</code>, to create a <code>java.util.List</code> instance initialized with values taken
from the supplied <code>sourceList</code>.</p>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.List instance with the supplied values --&gt;</span>
<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="176772747f78657e79577f72657839786570">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f58794869e9a999b9c9e9a83b58699809886db9a8792">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9be8effaede9f4fcf2f5dbfcf4edb5f4e9fc">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aadac5d8ccc3d8d3eacdc5dc84c5d8cd">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also explicitly control the exact type of <code>List</code> that will be instantiated and
populated via the use of the <code>list-class</code> attribute on the <code>&lt;util:list/&gt;</code> element. For
example, if we really need a <code>java.util.LinkedList</code> to be instantiated, we could use the
following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">list-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.LinkedList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b2d8d3d1d9c1dad3d4c6ddd7f2c4d3d5d3d0dddcd69cddc0d5">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f2979e9b8893b2869a9b9c999b9c959f939c819180879f829786dc9d8095">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2b5d4a4543444e406b5b42594a5f4e0544594c">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span>d'<a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d899aabbb9bbb0b7b698b6bdb5bdabb1abf6b7aabf">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no <code>list-class</code> attribute is supplied, a <code>List</code> implementation will be chosen by
the container.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-map"><a class="anchor" href="core.html#xsd-schemas-util-map"></a>&lt;util:map/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Map instance with values loaded from the supplied 'sourceMap' --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.MapFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pechorin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="166673757e79647f78567e73647938796471">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">raskolnikov</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="592b382a323635373032362f192a352c342a77362b3e">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stavrogin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="36454257404459515f587651594018594451">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">porfiry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9feff0edf9f6ede6dff8f0e9b1f0edf8">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>MapFactoryBean</code>, to create a <code>java.util.Map</code> instance initialized with key-value pairs
taken from the supplied <code>'sourceMap'</code>.</p>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Map instance with the supplied key-value pairs --&gt;</span>
<span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pechorin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="621207010a0d100b0c220a07100d4c0d1005">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">raskolnikov</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cfbdaebca4a0a3a1a6a4a0b98fbca3baa2bce1a0bda8">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stavrogin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3d4e495c4b4f525a54537d5a524b13524f5a">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">porfiry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="64140b16020d161d24030b124a0b1603">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also explicitly control the exact type of <code>Map</code> that will be instantiated and
populated via the use of the <code>'map-class'</code> attribute on the <code>&lt;util:map/&gt;</code> element. For
example, if we really need a <code>java.util.TreeMap</code> to be instantiated, we could use the
following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">map-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.TreeMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pechorin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="59293c3a31362b303719313c2b3677362b3e">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">raskolnikov</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="087a697b636764666163677e487b647d657b26677a6f">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stavrogin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4033342136322f27292e00272f366e2f3227">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">porfiry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="25554a57434c575c65424a530b4a5742">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no <code>'map-class'</code> attribute is supplied, a <code>Map</code> implementation will be chosen by the
container.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-util-set"><a class="anchor" href="core.html#xsd-schemas-util-set"></a>&lt;util:set/&gt;</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Set instance with values loaded from the supplied 'sourceSet' --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.SetFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceSet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8c8dddbd0d7cad1d6f8d0ddcad796d7cadf">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b1c3d0c2dadedddfd8dadec7f1c2ddc4dcc29fdec3d6">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bfcccbdec9cdd0d8d6d1ffd8d0c991d0cdd8">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f989968b9f908b80b99e968fd7968b9e">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration uses a Spring <code>FactoryBean</code> implementation, the
<code>SetFactoryBean</code>, to create a <code>java.util.Set</code> instance initialized with values taken
from the supplied <code>'sourceSet'</code>.</p>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- creates a java.util.Set instance with the supplied values --&gt;</span>
<span class="tag">&lt;util:set</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2d5d484e45425f44436d45485f4203425f4a">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0d7f6c7e666261636466627b4d7e6178607e23627f6a">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9cefe8fdeaeef3fbf5f2dcfbf3eab2f3eefb">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0f7f607d69667d764f68607921607d68">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/util:set&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also explicitly control the exact type of <code>Set</code> that will be instantiated and
populated via the use of the <code>'set-class'</code> attribute on the <code>&lt;util:set/&gt;</code> element. For
example, if we really need a <code>java.util.TreeSet</code> to be instantiated, we could use the
following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;util:set</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">set-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.TreeSet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8afaefe9e2e5f8e3e4cae2eff8e5a4e5f8ed">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8cad9cbd3d7d4d6d1d3d7cef8cbd4cdd5cb96d7cadf">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="26555247505449414f486641495008495441">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;value&gt;</span><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="80f0eff2e6e9f2f9c0e7eff6aeeff2e7">[email&#160;protected]</a><span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/util:set&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no <code>'set-class'</code> attribute is supplied, a <code>Set</code> implementation will be chosen by the
container.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-aop"><a class="anchor" href="core.html#xsd-schemas-aop"></a>9.1.2. The aop schema</h4>
<div class="paragraph">
<p>The <code>aop</code> tags deal with configuring all things AOP in Spring: this includes Spring&#8217;s
own proxy-based AOP framework and Spring&#8217;s integration with the AspectJ AOP framework.
These tags are comprehensively covered in the chapter entitled <a href="core.html#aop">Aspect Oriented Programming with Spring</a>.</p>
</div>
<div class="paragraph">
<p>In the interest of completeness, to use the tags in the <code>aop</code> schema, you need to have
the following preamble at the top of your Spring XML configuration file; the text in the
following snippet references the correct schema so that the tags in the <code>aop</code> namespace
are available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:aop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-context"><a class="anchor" href="core.html#xsd-schemas-context"></a>9.1.3. The context schema</h4>
<div class="paragraph">
<p>The <code>context</code> tags deal with <code>ApplicationContext</code> configuration that relates to plumbing
- that is, not usually beans that are important to an end-user but rather beans that do
a lot of grunt work in Spring, such as <code>BeanfactoryPostProcessors</code>. The following
snippet references the correct schema so that the tags in the <code>context</code> namespace are
available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-pphc"><a class="anchor" href="core.html#xsd-schemas-context-pphc"></a>&lt;property-placeholder/&gt;</h5>
<div class="paragraph">
<p>This element activates the replacement of <code>${&#8230;&#8203;}</code> placeholders, resolved against the
specified properties file (as a <a href="core.html#resources">Spring resource location</a>). This element is
a convenience mechanism that sets up a<a href="core.html#beans-factory-placeholderconfigurer"><code>PropertyPlaceholderConfigurer</code></a> for you; if you need more control over the
<code>PropertyPlaceholderConfigurer</code>, just define one yourself explicitly.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-ac"><a class="anchor" href="core.html#xsd-schemas-context-ac"></a>&lt;annotation-config/&gt;</h5>
<div class="paragraph">
<p>Activates the Spring infrastructure for various annotations to be detected in bean
classes: Spring&#8217;s <a href="core.html#beans-required-annotation"><code>@Required</code></a> and
<a href="core.html#beans-annotation-config"><code>@Autowired</code></a>, as well as JSR 250&#8217;s <code>@PostConstruct</code>,
<code>@PreDestroy</code> and <code>@Resource</code> (if available), and JPA&#8217;s <code>@PersistenceContext</code> and
<code>@PersistenceUnit</code> (if available). Alternatively, you can choose to activate the
individual <code>BeanPostProcessors</code> for those annotations explicitly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This element does <em>not</em> activate processing of Spring&#8217;s
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative-annotations"><code>@Transactional</code></a> annotation. Use the
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#tx-decl-explained"><code>&lt;tx:annotation-driven/&gt;</code></a> element for that purpose.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-component-scan"><a class="anchor" href="core.html#xsd-schemas-context-component-scan"></a>&lt;component-scan/&gt;</h5>
<div class="paragraph">
<p>This element is detailed in <a href="core.html#beans-annotation-config">Annotation-based container configuration</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-ltw"><a class="anchor" href="core.html#xsd-schemas-context-ltw"></a>&lt;load-time-weaver/&gt;</h5>
<div class="paragraph">
<p>This element is detailed in <a href="core.html#aop-aj-ltw">Load-time weaving with AspectJ in the Spring Framework</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-sc"><a class="anchor" href="core.html#xsd-schemas-context-sc"></a>&lt;spring-configured/&gt;</h5>
<div class="paragraph">
<p>This element is detailed in <a href="core.html#aop-atconfigurable">Using AspectJ to dependency inject domain objects with Spring</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-context-mbe"><a class="anchor" href="core.html#xsd-schemas-context-mbe"></a>&lt;mbean-export/&gt;</h5>
<div class="paragraph">
<p>This element is detailed in <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jmx-context-mbeanexport">Configuring annotation based MBean export</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-beans"><a class="anchor" href="core.html#xsd-schemas-beans"></a>9.1.4. The beans schema</h4>
<div class="paragraph">
<p>Last but not least we have the tags in the <code>beans</code> schema. These are the same tags that
have been in Spring since the very dawn of the framework. Examples of the various tags
in the <code>beans</code> schema are not shown here because they are quite comprehensively covered
in <a href="core.html#beans-factory-properties-detailed">Dependencies and configuration in detail</a>
(and indeed in that entire <a href="core.html#beans">chapter</a>).</p>
</div>
<div class="paragraph">
<p>Note that it is possible to add zero or more key / value pairs to <code>&lt;bean/&gt;</code> XML definitions.
What, if anything, is done with this extra metadata is totally up to your own custom
logic (and so is typically only of use if you are writing your own custom tags as described
in the appendix entitled <a href="core.html#xml-custom">XML Schema Authoring</a>).</p>
</div>
<div class="paragraph">
<p>Find below an example of the <code>&lt;meta/&gt;</code> tag in the context of a surrounding <code>&lt;bean/&gt;</code>
(please note that without any logic to interpret it the metadata is effectively useless
as-is).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <em><span class="tag">&lt;meta</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></em>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Rick</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the above example, you would assume that there is some logic that will
consume the bean definition and set up some caching infrastructure using the supplied
metadata.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xml-custom"><a class="anchor" href="core.html#xml-custom"></a>9.2. XML Schema Authoring</h3>
<div class="sect3">
<h4 id="xsd-custom-introduction"><a class="anchor" href="core.html#xsd-custom-introduction"></a>9.2.1. Introduction</h4>
<div class="paragraph">
<p>Since version 2.0, Spring has featured a mechanism for schema-based extensions to the
basic Spring XML format for defining and configuring beans. This section is devoted to
detailing how you would go about writing your own custom XML bean definition parsers and
integrating such parsers into the Spring IoC container.</p>
</div>
<div class="paragraph">
<p>To facilitate the authoring of configuration files using a schema-aware XML editor,
Spring&#8217;s extensible XML configuration mechanism is based on XML Schema. If you are not
familiar with Spring&#8217;s current XML configuration extensions that come with the standard
Spring distribution, please first read the appendix entitled<a href="core.html#xsd-config">[xsd-config]</a>.</p>
</div>
<div class="paragraph">
<p>Creating new XML configuration extensions can be done by following these (relatively)
simple steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="core.html#xsd-custom-schema">Authoring</a> an XML schema to describe your custom element(s).</p>
</li>
<li>
<p><a href="core.html#xsd-custom-namespacehandler">Coding</a> a custom <code>NamespaceHandler</code> implementation
(this is an easy step, don&#8217;t worry).</p>
</li>
<li>
<p><a href="core.html#xsd-custom-parser">Coding</a> one or more <code>BeanDefinitionParser</code> implementations
(this is where the real work is done).</p>
</li>
<li>
<p><a href="core.html#xsd-custom-registration">Registering</a> the above artifacts with Spring (this too
is an easy step).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What follows is a description of each of these steps. For the example, we will create an
XML extension (a custom XML element) that allows us to configure objects of the type
<code>SimpleDateFormat</code> (from the <code>java.text</code> package) in an easy manner. When we are done,
we will be able to define bean definitions of type <code>SimpleDateFormat</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;myns:dateformat</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateFormat</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd HH:mm</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">lenient</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>(Don&#8217;t worry about the fact that this example is very simple; much more detailed
examples follow afterwards. The intent in this first simple example is to walk you
through the basic steps involved.)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-schema"><a class="anchor" href="core.html#xsd-custom-schema"></a>9.2.2. Authoring the schema</h4>
<div class="paragraph">
<p>Creating an XML configuration extension for use with Spring&#8217;s IoC container starts with
authoring an XML Schema to describe the extension. What follows is the schema we&#8217;ll use
to configure <code>SimpleDateFormat</code> objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- myns.xsd (inside package org/springframework/samples/xml) --&gt;</span>

<span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;xsd:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.mycompany.com/schema/myns</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsd</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:beans</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.mycompany.com/schema/myns</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;xsd:import</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateformat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:complexType&gt;</span>
            <span class="tag">&lt;xsd:complexContent&gt;</span>
                <span class="tag">&lt;xsd:extension</span> <span class="attribute-name">base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans:identifiedType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lenient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pattern</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/xsd:extension&gt;</span>
            <span class="tag">&lt;/xsd:complexContent&gt;</span>
        <span class="tag">&lt;/xsd:complexType&gt;</span>
    <span class="tag">&lt;/xsd:element&gt;</span>
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(The emphasized line contains an extension base for all tags that will be identifiable
(meaning they have an <code>id</code> attribute that will be used as the bean identifier in the
container). We are able to use this attribute because we imported the Spring-provided
<code>'beans'</code> namespace.)</p>
</div>
<div class="paragraph">
<p>The above schema will be used to configure <code>SimpleDateFormat</code> objects, directly in an
XML application context file using the <code>&lt;myns:dateformat/&gt;</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;myns:dateformat</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateFormat</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd HH:mm</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">lenient</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that after we&#8217;ve created the infrastructure classes, the above snippet of XML will
essentially be exactly the same as the following XML snippet. In other words, we&#8217;re just
creating a bean in the container, identified by the name <code>'dateFormat'</code> of type
<code>SimpleDateFormat</code>, with a couple of properties set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateFormat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.text.SimpleDateFormat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-HH-dd HH:mm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lenient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The schema-based approach to creating configuration format allows for tight integration
with an IDE that has a schema-aware XML editor. Using a properly authored schema, you
can use autocompletion to have a user choose between several configuration options
defined in the enumeration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-namespacehandler"><a class="anchor" href="core.html#xsd-custom-namespacehandler"></a>9.2.3. Coding a NamespaceHandler</h4>
<div class="paragraph">
<p>In addition to the schema, we need a <code>NamespaceHandler</code> that will parse all elements of
this specific namespace Spring encounters while parsing configuration files. The
<code>NamespaceHandler</code> should in our case take care of the parsing of the <code>myns:dateformat</code>
element.</p>
</div>
<div class="paragraph">
<p>The <code>NamespaceHandler</code> interface is pretty simple in that it features just three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>init()</code> - allows for initialization of the <code>NamespaceHandler</code> and will be called by
Spring before the handler is used</p>
</li>
<li>
<p><code>BeanDefinition parse(Element, ParserContext)</code> - called when Spring encounters a
top-level element (not nested inside a bean definition or a different namespace).
This method can register bean definitions itself and/or return a bean definition.</p>
</li>
<li>
<p><code>BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code> - called
when Spring encounters an attribute or nested element of a different namespace.
The decoration of one or more bean definitions is used for example with the
<a href="core.html#beans-factory-scopes">out-of-the-box scopes Spring supports</a>.
We&#8217;ll start by highlighting a simple example, without using decoration, after which
we will show decoration in a somewhat more advanced example.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although it is perfectly possible to code your own <code>NamespaceHandler</code> for the entire
namespace (and hence provide code that parses each and every element in the namespace),
it is often the case that each top-level XML element in a Spring XML configuration file
results in a single bean definition (as in our case, where a single <code>&lt;myns:dateformat/&gt;</code>
element results in a single <code>SimpleDateFormat</code> bean definition). Spring features a
number of convenience classes that support this scenario. In this example, we&#8217;ll make
use the <code>NamespaceHandlerSupport</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.samples.xml</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.NamespaceHandlerSupport</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyNamespaceHandler</span> <span class="directive">extends</span> NamespaceHandlerSupport {

    <span class="directive">public</span> <span class="type">void</span> init() {
        <strong>registerBeanDefinitionParser(<span class="string"><span class="delimiter">&quot;</span><span class="content">dateformat</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> SimpleDateFormatBeanDefinitionParser());</strong>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The observant reader will notice that there isn&#8217;t actually a whole lot of parsing logic
in this class. Indeed&#8230;&#8203; the <code>NamespaceHandlerSupport</code> class has a built in notion of
delegation. It supports the registration of any number of <code>BeanDefinitionParser</code>
instances, to which it will delegate to when it needs to parse an element in its
namespace. This clean separation of concerns allows a <code>NamespaceHandler</code> to handle the
orchestration of the parsing of <em>all</em> of the custom elements in its namespace, while
delegating to <code>BeanDefinitionParsers</code> to do the grunt work of the XML parsing; this
means that each <code>BeanDefinitionParser</code> will contain just the logic for parsing a single
custom element, as we can see in the next step</p>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-parser"><a class="anchor" href="core.html#xsd-custom-parser"></a>9.2.4. BeanDefinitionParser</h4>
<div class="paragraph">
<p>A <code>BeanDefinitionParser</code> will be used if the <code>NamespaceHandler</code> encounters an XML
element of the type that has been mapped to the specific bean definition parser (which
is <code>'dateformat'</code> in this case). In other words, the <code>BeanDefinitionParser</code> is
responsible for parsing <em>one</em> distinct top-level XML element defined in the schema. In
the parser, we&#8217;ll have access to the XML element (and thus its subelements too) so that
we can parse our custom XML content, as can be seen in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.samples.xml</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.BeanDefinitionBuilder</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser</span>;
<span class="keyword">import</span> <span class="include">org.springframework.util.StringUtils</span>;
<span class="keyword">import</span> <span class="include">org.w3c.dom.Element</span>;

<span class="keyword">import</span> <span class="include">java.text.SimpleDateFormat</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleDateFormatBeanDefinitionParser</span> <span class="directive">extends</span> AbstractSingleBeanDefinitionParser { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">protected</span> <span class="predefined-type">Class</span> getBeanClass(<span class="predefined-type">Element</span> element) {
        <span class="keyword">return</span> <span class="predefined-type">SimpleDateFormat</span>.class; <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="directive">protected</span> <span class="type">void</span> doParse(<span class="predefined-type">Element</span> element, BeanDefinitionBuilder bean) {
        <span class="comment">// this will never be null since the schema explicitly requires that a value be supplied</span>
        <span class="predefined-type">String</span> pattern = element.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">pattern</span><span class="delimiter">&quot;</span></span>);
        bean.addConstructorArg(pattern);

        <span class="comment">// this however is an optional property</span>
        <span class="predefined-type">String</span> lenient = element.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">lenient</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (StringUtils.hasText(lenient)) {
            bean.addPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">lenient</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Boolean</span>.valueOf(lenient));
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use the Spring-provided <code>AbstractSingleBeanDefinitionParser</code> to handle a lot of
the basic grunt work of creating a <em>single</em> <code>BeanDefinition</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We supply the <code>AbstractSingleBeanDefinitionParser</code> superclass with the type that our
single <code>BeanDefinition</code> will represent.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this simple case, this is all that we need to do. The creation of our single
<code>BeanDefinition</code> is handled by the <code>AbstractSingleBeanDefinitionParser</code> superclass, as
is the extraction and setting of the bean definition&#8217;s unique identifier.</p>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-registration"><a class="anchor" href="core.html#xsd-custom-registration"></a>9.2.5. Registering the handler and the schema</h4>
<div class="paragraph">
<p>The coding is finished! All that remains to be done is to somehow make the Spring XML
parsing infrastructure aware of our custom element; we do this by registering our custom
<code>namespaceHandler</code> and custom XSD file in two special purpose properties files. These
properties files are both placed in a <code>'META-INF'</code> directory in your application, and
can, for example, be distributed alongside your binary classes in a JAR file. The Spring
XML parsing infrastructure will automatically pick up your new extension by consuming
these special properties files, the formats of which are detailed below.</p>
</div>
<div class="sect4">
<h5 id="xsd-custom-registration-spring-handlers"><a class="anchor" href="core.html#xsd-custom-registration-spring-handlers"></a>'META-INF/spring.handlers'</h5>
<div class="paragraph">
<p>The properties file called <code>'spring.handlers'</code> contains a mapping of XML Schema URIs to
namespace handler classes. So for our example, we need to write the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http\://www.mycompany.com/schema/myns=org.springframework.samples.xml.MyNamespaceHandler</pre>
</div>
</div>
<div class="paragraph">
<p><em>(The <code>':'</code> character is a valid delimiter in the Java properties format, and so the
<code>':'</code> character in the URI needs to be escaped with a backslash.)</em></p>
</div>
<div class="paragraph">
<p>The first part (the key) of the key-value pair is the URI associated with your custom
namespace extension, and needs to <em>match exactly</em> the value of the <code>'targetNamespace'</code>
attribute as specified in your custom XSD schema.</p>
</div>
</div>
<div class="sect4">
<h5 id="xsd-custom-registration-spring-schemas"><a class="anchor" href="core.html#xsd-custom-registration-spring-schemas"></a>'META-INF/spring.schemas'</h5>
<div class="paragraph">
<p>The properties file called <code>'spring.schemas'</code> contains a mapping of XML Schema locations
(referred to along with the schema declaration in XML files that use the schema as part
of the <code>'xsi:schemaLocation'</code> attribute) to <em>classpath</em> resources. This file is needed
to prevent Spring from absolutely having to use a default <code>EntityResolver</code> that requires
Internet access to retrieve the schema file. If you specify the mapping in this
properties file, Spring will search for the schema on the classpath (in this case
<code>'myns.xsd'</code> in the <code>'org.springframework.samples.xml'</code> package):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http\://www.mycompany.com/schema/myns/myns.xsd=org/springframework/samples/xml/myns.xsd</pre>
</div>
</div>
<div class="paragraph">
<p>The upshot of this is that you are encouraged to deploy your XSD file(s) right alongside
the <code>NamespaceHandler</code> and <code>BeanDefinitionParser</code> classes on the classpath.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-using"><a class="anchor" href="core.html#xsd-custom-using"></a>9.2.6. Using a custom extension in your Spring XML configuration</h4>
<div class="paragraph">
<p>Using a custom extension that you yourself have implemented is no different from using
one of the 'custom' extensions that Spring provides straight out of the box. Find below
an example of using the custom <code>&lt;dateformat/&gt;</code> element developed in the previous steps
in a Spring XML configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:myns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.mycompany.com/schema/myns</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.mycompany.com/schema/myns http://www.mycompany.com/schema/myns/myns.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- as a top-level bean --&gt;</span>
    <span class="tag">&lt;myns:dateformat</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultDateFormat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd HH:mm</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lenient</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetailTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateFormat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- as an inner bean --&gt;</span>
            <span class="tag">&lt;myns:dateformat</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HH:mm MM-dd-yyyy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-custom-meat"><a class="anchor" href="core.html#xsd-custom-meat"></a>9.2.7. Meatier examples</h4>
<div class="paragraph">
<p>Find below some much meatier examples of custom XML extensions.</p>
</div>
<div class="sect4">
<h5 id="xsd-custom-custom-nested"><a class="anchor" href="core.html#xsd-custom-custom-nested"></a>Nesting custom tags within custom tags</h5>
<div class="paragraph">
<p>This example illustrates how you might go about writing the various artifacts required
to satisfy a target of the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:foo</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.foo.com/schema/component</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.foo.com/schema/component http://www.foo.com/schema/component/component.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;foo:component</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bionic-family</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Bionic-1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;foo:component</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mother-1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;foo:component</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Karate-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;foo:component</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sport-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/foo:component&gt;</span>
        <span class="tag">&lt;foo:component</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Rock-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/foo:component&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration actually nests custom extensions within each other. The class
that is actually configured by the above <code>&lt;foo:component/&gt;</code> element is the <code>Component</code>
class (shown directly below). Notice how the <code>Component</code> class does <em>not</em> expose a
setter method for the <code>'components'</code> property; this makes it hard (or rather impossible)
to configure a bean definition for the <code>Component</code> class using setter injection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Component</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Component</span>&gt; components = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Component</span>&gt; ();

    <span class="comment">// mmm, there is no setter method for the 'components'</span>
    <span class="directive">public</span> <span class="type">void</span> addComponent(<span class="predefined-type">Component</span> component) {
        <span class="local-variable">this</span>.components.add(component);
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Component</span>&gt; getComponents() {
        <span class="keyword">return</span> components;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The typical solution to this issue is to create a custom <code>FactoryBean</code> that exposes a
setter property for the <code>'components'</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.FactoryBean</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ComponentFactoryBean</span> <span class="directive">implements</span> FactoryBean&lt;<span class="predefined-type">Component</span>&gt; {

    <span class="directive">private</span> <span class="predefined-type">Component</span> parent;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Component</span>&gt; children;

    <span class="directive">public</span> <span class="type">void</span> setParent(<span class="predefined-type">Component</span> parent) {
        <span class="local-variable">this</span>.parent = parent;
    }

    <span class="directive">public</span> <span class="type">void</span> setChildren(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Component</span>&gt; children) {
        <span class="local-variable">this</span>.children = children;
    }

    <span class="directive">public</span> <span class="predefined-type">Component</span> getObject() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">if</span> (<span class="local-variable">this</span>.children != <span class="predefined-constant">null</span> &amp;&amp; <span class="local-variable">this</span>.children.size() &gt; <span class="integer">0</span>) {
            <span class="keyword">for</span> (<span class="predefined-type">Component</span> child : children) {
                <span class="local-variable">this</span>.parent.addComponent(child);
            }
        }
        <span class="keyword">return</span> <span class="local-variable">this</span>.parent;
    }

    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Component</span>&gt; getObjectType() {
        <span class="keyword">return</span> <span class="predefined-type">Component</span>.class;
    }

    <span class="directive">public</span> <span class="type">boolean</span> isSingleton() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all very well, and does work nicely, but exposes a lot of Spring plumbing to the
end user. What we are going to do is write a custom extension that hides away all of
this Spring plumbing. If we stick to <a href="core.html#xsd-custom-introduction">the steps described
previously</a>, we&#8217;ll start off by creating the XSD schema to define the structure of our
custom tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>

<span class="tag">&lt;xsd:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.foo.com/schema/component</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsd</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.foo.com/schema/component</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:complexType&gt;</span>
            <span class="tag">&lt;xsd:choice</span> <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;xsd:element</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:choice&gt;</span>
            <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:ID</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:complexType&gt;</span>
    <span class="tag">&lt;/xsd:element&gt;</span>

<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll then create a custom <code>NamespaceHandler</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.NamespaceHandlerSupport</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ComponentNamespaceHandler</span> <span class="directive">extends</span> NamespaceHandlerSupport {

    <span class="directive">public</span> <span class="type">void</span> init() {
        registerBeanDefinitionParser(<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> ComponentBeanDefinitionParser());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up is the custom <code>BeanDefinitionParser</code>. Remember that what we are creating is a
<code>BeanDefinition</code> describing a <code>ComponentFactoryBean</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.config.BeanDefinition</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.AbstractBeanDefinition</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.BeanDefinitionBuilder</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.ManagedList</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.AbstractBeanDefinitionParser</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.ParserContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.util.xml.DomUtils</span>;
<span class="keyword">import</span> <span class="include">org.w3c.dom.Element</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ComponentBeanDefinitionParser</span> <span class="directive">extends</span> AbstractBeanDefinitionParser {

    <span class="directive">protected</span> AbstractBeanDefinition parseInternal(<span class="predefined-type">Element</span> element, ParserContext parserContext) {
        <span class="keyword">return</span> parseComponentElement(element);
    }

    <span class="directive">private</span> <span class="directive">static</span> AbstractBeanDefinition parseComponentElement(<span class="predefined-type">Element</span> element) {
        BeanDefinitionBuilder factory = BeanDefinitionBuilder.rootBeanDefinition(ComponentFactoryBean.class);
        factory.addPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span>, parseComponent(element));

        <span class="predefined-type">List</span>&lt;<span class="predefined-type">Element</span>&gt; childElements = DomUtils.getChildElementsByTagName(element, <span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (childElements != <span class="predefined-constant">null</span> &amp;&amp; childElements.size() &gt; <span class="integer">0</span>) {
            parseChildComponents(childElements, factory);
        }

        <span class="keyword">return</span> factory.getBeanDefinition();
    }

    <span class="directive">private</span> <span class="directive">static</span> BeanDefinition parseComponent(<span class="predefined-type">Element</span> element) {
        BeanDefinitionBuilder component = BeanDefinitionBuilder.rootBeanDefinition(<span class="predefined-type">Component</span>.class);
        component.addPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, element.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
        <span class="keyword">return</span> component.getBeanDefinition();
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> parseChildComponents(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Element</span>&gt; childElements, BeanDefinitionBuilder factory) {
        ManagedList&lt;BeanDefinition&gt; children = <span class="keyword">new</span> ManagedList&lt;BeanDefinition&gt;(childElements.size());
        <span class="keyword">for</span> (<span class="predefined-type">Element</span> element : childElements) {
            children.add(parseComponentElement(element));
        }
        factory.addPropertyValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">children</span><span class="delimiter">&quot;</span></span>, children);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># in 'META-INF/spring.handlers'
http\://www.foo.com/schema/component=com.foo.ComponentNamespaceHandler</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># in 'META-INF/spring.schemas'
http\://www.foo.com/schema/component/component.xsd=com/foo/component.xsd</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-custom-custom-just-attributes"><a class="anchor" href="core.html#xsd-custom-custom-just-attributes"></a>Custom attributes on 'normal' elements</h5>
<div class="paragraph">
<p>Writing your own custom parser and the associated artifacts isn&#8217;t hard, but sometimes it
is not the right thing to do. Consider the scenario where you need to add metadata to
already existing bean definitions. In this case you certainly don&#8217;t want to have to go
off and write your own entire custom extension; rather you just want to add an
additional attribute to the existing bean definition element.</p>
</div>
<div class="paragraph">
<p>By way of another example, let&#8217;s say that the service class that you are defining a bean
definition for a service object that will (unknown to it) be accessing a clustered
<a href="https://jcp.org/en/jsr/detail?id=107">JCache</a>, and you want to ensure that the named
JCache instance is eagerly started within the surrounding cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkingAccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DefaultCheckingAccountService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">jcache:cache-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checking.account</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- other dependencies here... --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What we are going to do here is create another <code>BeanDefinition</code> when the
<code>'jcache:cache-name'</code> attribute is parsed; this <code>BeanDefinition</code> will then initialize
the named JCache for us. We will also modify the existing <code>BeanDefinition</code> for the
<code>'checkingAccountService'</code> so that it will have a dependency on this new
JCache-initializing <code>BeanDefinition</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JCacheInitializer</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> JCacheInitializer(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="type">void</span> initialize() {
        <span class="comment">// lots of JCache API calls to initialize the named cache...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now onto the custom extension. Firstly, the authoring of the XSD schema describing the
custom attribute (quite easy in this case).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>

<span class="tag">&lt;xsd:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.foo.com/schema/jcache</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsd</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.foo.com/schema/jcache</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;xsd:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the associated <code>NamespaceHandler</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.NamespaceHandlerSupport</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JCacheNamespaceHandler</span> <span class="directive">extends</span> NamespaceHandlerSupport {

    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="local-variable">super</span>.registerBeanDefinitionDecoratorForAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-name</span><span class="delimiter">&quot;</span></span>,
            <span class="keyword">new</span> JCacheInitializingBeanDefinitionDecorator());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the parser. Note that in this case, because we are going to be parsing an XML
attribute, we write a <code>BeanDefinitionDecorator</code> rather than a <code>BeanDefinitionParser</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.config.BeanDefinitionHolder</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.AbstractBeanDefinition</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.support.BeanDefinitionBuilder</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.BeanDefinitionDecorator</span>;
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.xml.ParserContext</span>;
<span class="keyword">import</span> <span class="include">org.w3c.dom.Attr</span>;
<span class="keyword">import</span> <span class="include">org.w3c.dom.Node</span>;

<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.Arrays</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JCacheInitializingBeanDefinitionDecorator</span> <span class="directive">implements</span> BeanDefinitionDecorator {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> EMPTY_STRING_ARRAY = <span class="keyword">new</span> <span class="predefined-type">String</span>[<span class="integer">0</span>];

    <span class="directive">public</span> BeanDefinitionHolder decorate(Node source, BeanDefinitionHolder holder,
            ParserContext ctx) {
        <span class="predefined-type">String</span> initializerBeanName = registerJCacheInitializer(source, ctx);
        createDependencyOnJCacheInitializer(holder, initializerBeanName);
        <span class="keyword">return</span> holder;
    }

    <span class="directive">private</span> <span class="type">void</span> createDependencyOnJCacheInitializer(BeanDefinitionHolder holder,
            <span class="predefined-type">String</span> initializerBeanName) {
        AbstractBeanDefinition definition = ((AbstractBeanDefinition) holder.getBeanDefinition());
        <span class="predefined-type">String</span><span class="type">[]</span> dependsOn = definition.getDependsOn();
        <span class="keyword">if</span> (dependsOn == <span class="predefined-constant">null</span>) {
            dependsOn = <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{initializerBeanName};
        } <span class="keyword">else</span> {
            <span class="predefined-type">List</span> dependencies = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>(<span class="predefined-type">Arrays</span>.asList(dependsOn));
            dependencies.add(initializerBeanName);
            dependsOn = (<span class="predefined-type">String</span><span class="type">[]</span>) dependencies.toArray(EMPTY_STRING_ARRAY);
        }
        definition.setDependsOn(dependsOn);
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> registerJCacheInitializer(Node source, ParserContext ctx) {
        <span class="predefined-type">String</span> cacheName = ((Attr) source).getValue();
        <span class="predefined-type">String</span> beanName = cacheName + <span class="string"><span class="delimiter">&quot;</span><span class="content">-initializer</span><span class="delimiter">&quot;</span></span>;
        <span class="keyword">if</span> (!ctx.getRegistry().containsBeanDefinition(beanName)) {
            BeanDefinitionBuilder initializer = BeanDefinitionBuilder.rootBeanDefinition(JCacheInitializer.class);
            initializer.addConstructorArg(cacheName);
            ctx.getRegistry().registerBeanDefinition(beanName, initializer.getBeanDefinition());
        }
        <span class="keyword">return</span> beanName;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, the various artifacts need to be registered with the Spring XML infrastructure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># in 'META-INF/spring.handlers'
http\://www.foo.com/schema/jcache=com.foo.JCacheNamespaceHandler</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># in 'META-INF/spring.schemas'
http\://www.foo.com/schema/jcache/jcache.xsd=com/foo/jcache.xsd</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="core.html#_footnoteref_1">1</a>. See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/overview.html#background-ioc">Inversion of Control</a>
</div>
<div class="footnote" id="_footnote_2">
<a href="core.html#_footnoteref_2">2</a>. See <a href="core.html#beans-factory-collaborators">Dependency Injection</a>
</div>
<div class="footnote" id="_footnote_3">
<a href="core.html#_footnoteref_3">3</a>. But see also <a href="core.html#resources-filesystemresource-caveats">FileSystemResource caveats</a>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 5.0.4.RELEASE<br>
Last updated 2018-02-19 10:39:28 UTC
</div>
</div>
<script data-cfasync="false" src="../../../../cdn-cgi/scripts/d07b1474/cloudflare-static/email-decode.min.js"></script><script src="tocbot-3.0.2/tocbot.js"></script>
<script>var oldtoc=document.getElementById('toctitle').nextElementSibling;var newtoc=document.createElement('div');newtoc.setAttribute('id','tocbot');newtoc.setAttribute('class','js-toc');oldtoc.parentNode.replaceChild(newtoc,oldtoc);tocbot.init({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',smoothScroll:false});var handleTocOnResize=function(){var width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(width<768){tocbot.refresh({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',collapseDepth:6,activeLinkClass:'ignoreactive',throttleTimeout:1000,smoothScroll:false});}else{tocbot.refresh({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',smoothScroll:false});}};window.addEventListener('resize',handleTocOnResize);handleTocOnResize();var link=document.createElement("a");link.setAttribute("href","index.html");link.innerHTML="<i class=\"fa fa-chevron-left\" aria-hidden=\"true\"></i>&nbsp;&nbsp;Back to index";var p=document.createElement("p");p.appendChild(link);var toc=document.getElementById('toc')
var next=document.getElementById('toctitle').nextElementSibling;toc.insertBefore(p,next);</script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script></body>
</html>