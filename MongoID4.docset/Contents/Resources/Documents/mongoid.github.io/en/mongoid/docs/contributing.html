<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='A Ruby ODM for MongoDB' name='description'>
    <meta content='mongoid, mongodb, ruby, rails, odm, durran jordan' name='keywords'>
    <!--[if lt IE 9]>
      <script src='http://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]-->
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0' name='viewport'>
    <link href="../../../stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/mongoid.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/mongoid-coderay.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="../../../javascripts/jquery-1.8.1.min.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-scrollspy.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-tooltip.js" type="text/javascript"></script>
    <script src="../../../javascripts/mongoid.js" type="text/javascript"></script>
    <title>Mongoid: Contributing</title>
  </head>
  <body data-offset='100' data-spy='scroll-spy' data-target='.page-nav'>
    <div id='content'>
      <div class='container'>
        <p style='background-color:#EEE;padding: 5px 10px;margin-top:30px;'>
          You are looking at the docs for v4.x. You can check out this page for Mongoid
          <a href='https://mongoid.github.io/en/mongoid/v3/contributing.html'>v3.x</a>
          if you haven't upgraded yet.
        </p>
        <h1>Contributing</h1>
        <p>
          Mongoid is open source and embraces the social coding aspect of github.
          Here are some guidelines on contributing to the project and ensuring
          fast acceptance of your contributions.
        </p>
        <div class='page-nav'>
          <div class='container'>
            <ul class='nav nav-pills'>
              <li><a href="contributing.html#issues">Issues</a></li>
              <li><a href="contributing.html#core">Core</a></li>
              <li><a href="contributing.html#documentation">Docs</a></li>
            </ul>
          </div>
        </div>
        <section id='issues'>
          <h2>Issues</h2>
          <p>
            As developers, we hate getting issue reports from users that we cannot
            replicate don't we? The same applies when submitting issues as well. Here
            are some guidelines on what to provide in a Github issue in order for us
            to expedite resolving the problem.
          </p>
          <ul>
            <li>
              The version of Mongoid (and if applicable Moped and Origin) that you are
              using. We cannot assume a particular version since we actively support
              and maintain 10-20 patch releases and 2 major releases at the same time.
            </li>
            <li>
              Your operating system and version. Yes, this is important, especially from
              a database driver perspective.
            </li>
            <li>
              Your Ruby version, with exact patch level. This is also very important
              for the same reasons as above.
            </li>
            <li>
              If you are getting a stack trace, please provide the <i>entire thing</i>, not
              just the message or the last line in it. Stack traces provide context
              and omitting them for the sake of brevity is not helpful.
            </li>
            <li>
              The exact steps in your application to reproduce the error, or some code
              that will reproduce the issue without need for interperetation from our side.
              This is very important as we are not mind readers and cannot make any
              assumptions about how the issue arose. The more information you provide,
              the faster we can address it.
            </li>
          </ul>
        </section>
        <section id='core'>
          <h2>Core Contributions</h2>
          <p>
            Fork the <a href="http://github.com/mongoid/mongoid">repo on github</a>
            and issue a pull request with your changes. No
            other means of supplying code to the team will be accepted.
          </p>
          <div class='well'>
            <table>
              <tr>
                <td class='achtung'><img src="../../../images/achtung.png" /></td>
                <td class='note'>
                  Provide specs with your pull request if the existing specs do not cover
                  the change. Pull requests that provide new functionality without specs
                  will not be pulled in under any circumstance. Also make sure to
                  <code>rebase -i</code> your pull requests into a single commit.
                </td>
              </tr>
            </table>
          </div>
          <h3>Running the Specs</h3>
          <p>
            Getting set up should require minimal effort:
            <ul>
              <li>Install MongoDB.</li>
              <li>Fork and clone the repository.</li>
              <li>Run <code>gem install bundler</code> to get the latest for the gemset.</li>
              <li>Run <code>bundle install</code> for dependencies.</li>
              <li>Run <code>rake</code> to execute all specs.</li>
            </ul>
          </p>
          <p>
            Mongoid uses Guard for automated testing. To run it from the project root:
          </p>
          <div class="CodeRay">
            <div class="code"><pre><span class="error">$</span> bundle exec guard&#x000A;</pre></div>
          </div>
          <h3>Spec Guidelines</h3>
          <p>
            The following code demostrates the desired way to write a spec in Mongoid.
            <ul>
              <li>Use <code>describe</code> blocks for method names.</li>
              <li>Use <code>context</code> blocks for conditions.</li>
              <li>Prefer <code>let</code> over the use of instance variables.</li>
              <li>1 assertion per example block.</li>
              <li>
                When describing methods, prefix with <code>#</code> for instance methods,
                <code>.</code> for class methods.
              </li>
              <li>
                Avoid generating Ruby warnings by not using <code>should ==</code> but
                rather <code>should eq</code>.
              </li>
            </ul>
          </p>
          <div class="CodeRay">
            <div class="code"><pre>require <span class="string"><span class="delimiter">&quot;</span><span class="content">spec_helper</span><span class="delimiter">&quot;</span></span>&#x000A;&#x000A;describe <span class="constant">Mongoid</span>::<span class="constant">Relations</span>::<span class="constant">Embedded</span>::<span class="constant">Many</span> <span class="keyword">do</span>&#x000A;&#x000A;  describe <span class="string"><span class="delimiter">&quot;</span><span class="content">#=</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>&#x000A;&#x000A;    context <span class="string"><span class="delimiter">&quot;</span><span class="content">when the parent is a new record</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>&#x000A;&#x000A;      let(<span class="symbol">:person</span>) <span class="keyword">do</span>&#x000A;        <span class="constant">Person</span>.new&#x000A;      <span class="keyword">end</span>&#x000A;&#x000A;      let(<span class="symbol">:address</span>) <span class="keyword">do</span>&#x000A;        <span class="constant">Address</span>.new&#x000A;      <span class="keyword">end</span>&#x000A;&#x000A;      before <span class="keyword">do</span>&#x000A;        person.addresses = [ address ]&#x000A;      <span class="keyword">end</span>&#x000A;&#x000A;      it <span class="string"><span class="delimiter">&quot;</span><span class="content">sets the target of the relation</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>&#x000A;        person.addresses.should eq([ address ])&#x000A;      <span class="keyword">end</span>&#x000A;    <span class="keyword">end</span>&#x000A;  <span class="keyword">end</span>&#x000A;&#x000A;  describe <span class="string"><span class="delimiter">&quot;</span><span class="content">.macro</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>&#x000A;&#x000A;    it <span class="string"><span class="delimiter">&quot;</span><span class="content">returns :embeds_many</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>&#x000A;      described_class.macro.should eq(<span class="symbol">:embeds_many</span>)&#x000A;    <span class="keyword">end</span>&#x000A;  <span class="keyword">end</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
          <h3>Coding Guidelines</h3>
          <p>
            Mongoid has the design philosophy of having many fine grained, single purpose
            objects in its domain. It makes the design more flexible and much easier to
            test. If you find yourself refactoring at all,
            <a href="http://www.refactoring.com/catalog/extractClass.html">extract class</a>
            is always a good refactoring technique to have in mind.
          </p>
          <p>
            Here are some other simple rules that will help expidite your patch
            acceptance.
            <ul>
              <li>Keep method line counts small and easy to read.</li>
              <li>Copy and pasted code from another library will never be accepted.</li>
              <li>Provide API documentation in the form of YARD.</li>
            </ul>
          </p>
          <div class="CodeRay">
            <div class="code"><pre><span class="comment"># encoding: utf-8</span>&#x000A;<span class="keyword">module</span> <span class="class">Mongoid</span> <span class="comment"># :nodoc:</span>&#x000A;  <span class="keyword">module</span> <span class="class">Relations</span> <span class="comment">#:nodoc:</span>&#x000A;&#x000A;    <span class="comment"># This module contains the core macros for defining relations between</span>&#x000A;    <span class="comment"># documents. They can be either embedded or referenced (relational).</span>&#x000A;    <span class="keyword">module</span> <span class="class">Macros</span>&#x000A;      extend <span class="constant">ActiveSupport</span>::<span class="constant">Concern</span>&#x000A;&#x000A;      <span class="keyword">module</span> <span class="class">ClassMethods</span> <span class="comment">#:nodoc:</span>&#x000A;&#x000A;      <span class="comment"># Adds the relation back to the parent document. This macro is</span>&#x000A;      <span class="comment"># necessary to set the references from the child back to the parent</span>&#x000A;      <span class="comment"># document. If a child does not define this relation calling</span>&#x000A;      <span class="comment"># persistence methods on the child object will cause a save to fail.</span>&#x000A;      <span class="comment">#</span>&#x000A;      <span class="comment"># @example Define the relation.</span>&#x000A;      <span class="comment">#</span>&#x000A;      <span class="comment">#   class Person</span>&#x000A;      <span class="comment">#     include Mongoid::Document</span>&#x000A;      <span class="comment">#     embeds_many :addresses</span>&#x000A;      <span class="comment">#   end</span>&#x000A;      <span class="comment">#</span>&#x000A;      <span class="comment">#   class Address</span>&#x000A;      <span class="comment">#     include Mongoid::Document</span>&#x000A;      <span class="comment">#     embedded_in :person</span>&#x000A;      <span class="comment">#   end</span>&#x000A;      <span class="comment">#</span>&#x000A;      <span class="comment"># @param [ Symbol ] name The name of the relation.</span>&#x000A;      <span class="comment"># @param [ Hash ] options The relation options.</span>&#x000A;      <span class="comment"># @param [ Proc ] block Optional block for defining extensions.</span>&#x000A;      <span class="comment">#</span>&#x000A;      <span class="comment"># @since 2.0.0</span>&#x000A;      <span class="keyword">def</span> <span class="function">embedded_in</span>(name, options = {}, &amp;block)&#x000A;        characterize(name, <span class="constant">Embedded</span>::<span class="constant">In</span>, options, &amp;block).tap <span class="keyword">do</span> |meta|&#x000A;          <span class="predefined-constant">self</span>.embedded = <span class="predefined-constant">true</span>&#x000A;          relate(name, meta)&#x000A;        <span class="keyword">end</span>&#x000A;      <span class="keyword">end</span>&#x000A;    <span class="keyword">end</span>&#x000A;  <span class="keyword">end</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
          <h3>Commit Guidelines</h3>
          <p>
            Ensure to write good descriptive commit messages, and follow the parameters
            set forth <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">
            here</a> by Tim Pope using which are the same standards as the linux kernel.
          </p>
        </section>
        <section id='documentation'>
          <h2>Documentation Contributions</h2>
          <p>
            The Mongoid website is open source as well, and hosted on github. It
            uses middleman as a static content generator, and additions to the
            documentation are always welcome. The same rules apply here:
          </p>
          <p>
            Fork the <a href="http://github.com/mongoid/mongoid-site">repo on github</a>
            and issue a pull request with your changes. No
            other means of supplying code to the team will be accepted.
          </p>
          <p>
            Getting set up here is easy as well:
            <ul>
              <li>Fork and clone the repository.</li>
              <li>Run <code>gem install bundler</code> to get the latest for the gemset.</li>
              <li>Run <code>bundle install</code> for dependencies.</li>
              <li>Run <code>bundle exec middleman</code> to run the site with sinatra.</li>
            </ul>
          </p>
          <p>
            Pull requests will be merged in and regenerated to the mongoid.github.com
            repo where you're contributions can be seen in all their glory.
          </p>
        </section>
      </div>
    </div>
  </body>
</html>
