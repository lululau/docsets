<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='A Ruby ODM for MongoDB' name='description'>
    <meta content='mongoid, mongodb, ruby, rails, odm, durran jordan' name='keywords'>
    <!--[if lt IE 9]>
      <script src='http://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]-->
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0' name='viewport'>
    <link href="../../../stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/mongoid.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/mongoid-coderay.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="../../../javascripts/jquery-1.8.1.min.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-scrollspy.js" type="text/javascript"></script>
    <script src="../../../javascripts/bootstrap-tooltip.js" type="text/javascript"></script>
    <script src="../../../javascripts/mongoid.js" type="text/javascript"></script>
    <title>Mongoid: Rails</title>
  </head>
  <body data-offset='100' data-spy='scroll-spy' data-target='.page-nav'>
    <div id='content'>
      <div class='container'>
        <p style='background-color:#EEE;padding: 5px 10px;margin-top:30px;'>
          You are looking at the docs for v4.x. You can check out this page for Mongoid
          <a href='https://mongoid.github.io/en/mongoid/v3/rails.html'>v3.x</a>
          if you haven't upgraded yet.
        </p>
        <h1>Rails</h1>
        <p>
          Mongoid was built and targeted towards Rails applications, even though it
          will work in any environment. However if you are using Rails consult the
          next two sections on how Mongoid hooks into a Rails application.
        </p>
        <p>
          For a sample Rails application and examples of domain modeling, please see
          the Mongoid demo application,
          <a href="http://github.com/mongoid/echo">Echo</a>. Note that currently the
          application is only models and specs.
        </p>
        <div class='page-nav'>
          <div class='container'>
            <ul class='nav nav-pills'>
              <li><a href="rails.html#multi_param">Multi-Parameter Attributes</a></li>
              <li><a href="rails.html#railties">Railties</a></li>
              <li><a href="rails.html#rake">Rake Tasks</a></li>
            </ul>
          </div>
        </div>
        <section id='multi_param'>
          <h2>Multi Parameter Attributes</h2>
          <p>
            If you want to use multi-paramater attributes with Rails, you will
            need to include an extra Mongoid module to support it.
          </p>
          <div class='well'>
            <table>
              <tr>
                <td class='achtung'><img src="../../../images/achtung.png" /></td>
                <td class='note'>
                  The reason for needing to include a module is due to the fact that
                  we believe this is not a very usable way of handling date/time
                  entry in forms, with a complex implementation.
                </td>
              </tr>
            </table>
          </div>
          <div class="CodeRay">
            <div class="code"><pre><span class="keyword">class</span> <span class="class">Person</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">Document</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">MultiParameterAttributes</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
        </section>
        <section id='railties'>
          <h2>Railties</h2>
          <p>
            Mongoid provides some railties and initializers that one should be
            aware of when writing a Rails application with Mongoid.
          </p>
          <h3>Configuration</h3>
          <p>
            You can set Mongoid configuration options in your <tt>application.rb</tt>
            along with other Rails environment specific options by accessing
            <code>config.mongoid</code>. Options set here will override those set in
            your <code>config/mongoid.yml</code>.
          </p>
          <div class="CodeRay">
            <div class="code"><pre><span class="keyword">module</span> <span class="class">MyApplication</span>&#x000A;  <span class="keyword">class</span> <span class="class">Application</span> &lt; <span class="constant">Rails</span>::<span class="constant">Application</span>&#x000A;    config.mongoid.logger = <span class="constant">Logger</span>.new(<span class="global-variable">$stdout</span>, <span class="symbol">:warn</span>)&#x000A;    config.mongoid.persist_in_safe_mode = <span class="predefined-constant">true</span>&#x000A;  <span class="keyword">end</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
          <h3>Model Preloading</h3>
          <p>
            In order to properly set up single collection inheritance, Mongoid
            needs to preload all models before every request in development mode.
            This can get slow, so if you are not using any inheritance it is
            recommended you turn this feature off.
          </p>
          <div class="CodeRay">
            <div class="code"><pre>config.mongoid.preload_models = <span class="predefined-constant">false</span>&#x000A;</pre></div>
          </div>
          <h3>Exceptions</h3>
          <p>
            Similar to Active Record, Mongoid tells raise to return specific http
            codes when some errors are raised.
            <ul>
              <li><code>Mongoid::Errors::DocumentNotFound</code> : 404</li>
              <li><code>Mongoid::Errors::Validations</code> : 422</li>
            </ul>
          </p>
          <h3>Unicorn and Passenger</h3>
          <p>
            When using Unicorn or Passenger, each time a child process is forked
            when using app preloading or smart spawning, Mongoid will automatically
            reconnect to the master database. If you are doing this in your
            application manually you may remove your code.
          </p>
        </section>
        <section id='rake'>
          <h2>Rake Tasks</h2>
          <p>
            Mongoid provides the following rake tasks when used in a Rails 3 environment:
          </p>
          <ul>
            <li>
              <code>db:create</code>: Exists only for dependency purposes, does not actually
              do anything.
            </li>
            <li>
              <code>db:create_indexes</code>: Reads all index definitions from the models and
              attempts to create them in the database.
            </li>
            <li>
              <code>db:remove_indexes</code>: Reads all secondary index definitions from the
              models and attempts to remove indexes that are not defined.
            </li>
            <li>
              <code>db:drop</code>: Drops all collections in the database with the exception of
              the system collections.
            </li>
            <li>
              <code>db:migrate</code>: Exists only for dependency purposes, does not actually
              do anything.
            </li>
            <li>
              <code>db:purge</code>: Deletes all data, including indexes, from the database.
              <span class="label label-info">Since 3.1.0</span>
            </li>
            <li>
              <code>db:schema:load</code>: Exists only for framework dependency purposes, does
              not actually do anything.
            </li>
            <li>
              <code>db:seed</code>: Seeds the database from db/seeds.rb
            </li>
            <li>
              <code>db:setup</code>: Creates indexes and seeds the database.
            </li>
            <li>
              <code>db:test:prepare</code>: Exists only for framework dependency purposes, does
              not actually do anything.
            </li>
          </ul>
        </section>
      </div>
    </div>
  </body>
</html>
