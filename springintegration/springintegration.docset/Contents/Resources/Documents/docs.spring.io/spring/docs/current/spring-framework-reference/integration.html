<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Integration</title>
<link rel="stylesheet" href="stylesheets/asciidoctor-spring.css" /><link rel="stylesheet" href="tocbot-3.0.2/tocbot.css" /><style>#tocbot a.toc-link.node-name--H1{font-style:italic}@media screen{#tocbot>ul.toc-list{margin-bottom:.5em;margin-left:.125em}#tocbot ul.sectlevel0,#tocbot a.toc-link.node-name--H1+ul{padding-left:0}#tocbot a.toc-link{height:100%}.is-collapsible{max-height:3000px;overflow:hidden}.is-collapsed{max-height:0}.is-active-link{font-weight:700}}@media print{#tocbot a.toc-link.node-name--H4{display:none}}</style>
<link rel="stylesheet" href="../../../../../cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 .5em 0 .25em}.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}table.CodeRay td{vertical-align:top;line-height:1.45}table.CodeRay td.line-numbers{text-align:right}table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}table.CodeRay td.code{padding:0 0 0 .5em}table.CodeRay td.code>pre{padding:0}.CodeRay .debug{color:#fff!important;background:navy!important}.CodeRay .annotation{color:#007}.CodeRay .attribute-name{color:navy}.CodeRay .attribute-value{color:#700}.CodeRay .binary{color:#509}.CodeRay .comment{color:#998;font-style:italic}.CodeRay .char{color:#04d}.CodeRay .char .content{color:#04d}.CodeRay .char .delimiter{color:#039}.CodeRay .class{color:#458;font-weight:bold}.CodeRay .complex{color:#a08}.CodeRay .constant,.CodeRay .predefined-constant{color:teal}.CodeRay .color{color:#099}.CodeRay .class-variable{color:#369}.CodeRay .decorator{color:#b0b}.CodeRay .definition{color:#099}.CodeRay .delimiter{color:#000}.CodeRay .doc{color:#970}.CodeRay .doctype{color:#34b}.CodeRay .doc-string{color:#d42}.CodeRay .escape{color:#666}.CodeRay .entity{color:#800}.CodeRay .error{color:#808}.CodeRay .exception{color:inherit}.CodeRay .filename{color:#099}.CodeRay .function{color:#900;font-weight:bold}.CodeRay .global-variable{color:teal}.CodeRay .hex{color:#058}.CodeRay .integer,.CodeRay .float{color:#099}.CodeRay .include{color:#555}.CodeRay .inline{color:#000}.CodeRay .inline .inline{background:#ccc}.CodeRay .inline .inline .inline{background:#bbb}.CodeRay .inline .inline-delimiter{color:#d14}.CodeRay .inline-delimiter{color:#d14}.CodeRay .important{color:#555;font-weight:bold}.CodeRay .interpreted{color:#b2b}.CodeRay .instance-variable{color:teal}.CodeRay .label{color:#970}.CodeRay .local-variable{color:#963}.CodeRay .octal{color:#40e}.CodeRay .predefined{color:#369}.CodeRay .preprocessor{color:#579}.CodeRay .pseudo-class{color:#555}.CodeRay .directive{font-weight:bold}.CodeRay .type{font-weight:bold}.CodeRay .predefined-type{color:inherit}.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}.CodeRay .key{color:#808}.CodeRay .key .delimiter{color:#606}.CodeRay .key .char{color:#80f}.CodeRay .value{color:#088}.CodeRay .regexp .delimiter{color:#808}.CodeRay .regexp .content{color:#808}.CodeRay .regexp .modifier{color:#808}.CodeRay .regexp .char{color:#d14}.CodeRay .regexp .function{color:#404;font-weight:bold}.CodeRay .string{color:#d20}.CodeRay .string .string .string{background:#ffd0d0}.CodeRay .string .content{color:#d14}.CodeRay .string .char{color:#d14}.CodeRay .string .delimiter{color:#d14}.CodeRay .shell{color:#d14}.CodeRay .shell .delimiter{color:#d14}.CodeRay .symbol{color:#990073}.CodeRay .symbol .content{color:#a60}.CodeRay .symbol .delimiter{color:#630}.CodeRay .tag{color:teal}.CodeRay .tag-special{color:#d70}.CodeRay .variable{color:#036}.CodeRay .insert{background:#afa}.CodeRay .delete{background:#faa}.CodeRay .change{color:#aaf;background:#007}.CodeRay .head{color:#f8f;background:#505}.CodeRay .insert .insert{color:#080}.CodeRay .delete .delete{color:#800}.CodeRay .change .change{color:#66f}.CodeRay .head .head{color:#f4f}</style>
</head>
<body id="spring-integration" class="book toc2 toc-left">
<div id="header">
<h1>Integration</h1>
<div class="details">
<span id="revnumber">version 5.0.4.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="integration.html#remoting">1. Remoting and web services using Spring</a>
<ul class="sectlevel2">
<li><a href="integration.html#remoting-introduction">1.1. Introduction</a></li>
<li><a href="integration.html#remoting-rmi">1.2. Exposing services using RMI</a>
<ul class="sectlevel3">
<li><a href="integration.html#remoting-rmi-server">1.2.1. Exporting the service using the RmiServiceExporter</a></li>
<li><a href="integration.html#remoting-rmi-client">1.2.2. Linking in the service at the client</a></li>
</ul>
</li>
<li><a href="integration.html#remoting-caucho-protocols">1.3. Using Hessian to remotely call services via HTTP</a>
<ul class="sectlevel3">
<li><a href="integration.html#remoting-caucho-protocols-hessian">1.3.1. Wiring up the DispatcherServlet for Hessian and co.</a></li>
<li><a href="integration.html#remoting-caucho-protocols-hessian-server">1.3.2. Exposing your beans by using the HessianServiceExporter</a></li>
<li><a href="integration.html#remoting-caucho-protocols-hessian-client">1.3.3. Linking in the service on the client</a></li>
<li><a href="integration.html#remoting-caucho-protocols-security">1.3.4. Applying HTTP basic authentication to a service exposed through Hessian</a></li>
</ul>
</li>
<li><a href="integration.html#remoting-httpinvoker">1.4. Exposing services using HTTP invokers</a>
<ul class="sectlevel3">
<li><a href="integration.html#remoting-httpinvoker-server">1.4.1. Exposing the service object</a></li>
<li><a href="integration.html#remoting-httpinvoker-client">1.4.2. Linking in the service at the client</a></li>
</ul>
</li>
<li><a href="integration.html#remoting-web-services">1.5. Web services</a>
<ul class="sectlevel3">
<li><a href="integration.html#remoting-web-services-jaxws-export-servlet">1.5.1. Exposing servlet-based web services using JAX-WS</a></li>
<li><a href="integration.html#remoting-web-services-jaxws-export-standalone">1.5.2. Exporting standalone web services using JAX-WS</a></li>
<li><a href="integration.html#remoting-web-services-jaxws-export-ri">1.5.3. Exporting web services using the JAX-WS RI&#8217;s Spring support</a></li>
<li><a href="integration.html#remoting-web-services-jaxws-access">1.5.4. Accessing web services using JAX-WS</a></li>
</ul>
</li>
<li><a href="integration.html#remoting-jms">1.6. JMS</a>
<ul class="sectlevel3">
<li><a href="integration.html#remoting-jms-server">1.6.1. Server-side configuration</a></li>
<li><a href="integration.html#remoting-jms-client">1.6.2. Client-side configuration</a></li>
</ul>
</li>
<li><a href="integration.html#remoting-amqp">1.7. AMQP</a></li>
<li><a href="integration.html#remoting-autodection-remote-interfaces">1.8. Auto-detection is not implemented for remote interfaces</a></li>
<li><a href="integration.html#remoting-considerations">1.9. Considerations when choosing a technology</a></li>
<li><a href="integration.html#rest-client-access">1.10. Accessing REST endpoints</a>
<ul class="sectlevel3">
<li><a href="integration.html#rest-resttemplate">1.10.1. RestTemplate</a>
<ul class="sectlevel4">
<li><a href="integration.html#rest-resttemplate-uri">Working with the URI</a></li>
<li><a href="integration.html#rest-template-headers">Dealing with request and response headers</a></li>
<li><a href="integration.html#rest-template-jsonview">Jackson JSON Views support</a></li>
</ul>
</li>
<li><a href="integration.html#rest-message-conversion">1.10.2. HTTP Message Converters</a>
<ul class="sectlevel4">
<li><a href="integration.html#rest-string-converter">StringHttpMessageConverter</a></li>
<li><a href="integration.html#rest-form-converter">FormHttpMessageConverter</a></li>
<li><a href="integration.html#rest-byte-converter">ByteArrayHttpMessageConverter</a></li>
<li><a href="integration.html#rest-marhsalling-converter">MarshallingHttpMessageConverter</a></li>
<li><a href="integration.html#rest-mapping-json-converter">MappingJackson2HttpMessageConverter</a></li>
<li><a href="integration.html#rest-mapping-xml-converter">MappingJackson2XmlHttpMessageConverter</a></li>
<li><a href="integration.html#rest-source-converter">SourceHttpMessageConverter</a></li>
<li><a href="integration.html#rest-buffered-image-converter">BufferedImageHttpMessageConverter</a></li>
</ul>
</li>
<li><a href="integration.html#rest-async-resttemplate">1.10.3. Async RestTemplate</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="integration.html#ejb">2. Enterprise JavaBeans (EJB) integration</a>
<ul class="sectlevel2">
<li><a href="integration.html#ejb-introduction">2.1. Introduction</a></li>
<li><a href="integration.html#ejb-access">2.2. Accessing EJBs</a>
<ul class="sectlevel3">
<li><a href="integration.html#ejb-access-concepts">2.2.1. Concepts</a></li>
<li><a href="integration.html#ejb-access-local">2.2.2. Accessing local SLSBs</a></li>
<li><a href="integration.html#ejb-access-remote">2.2.3. Accessing remote SLSBs</a></li>
<li><a href="integration.html#ejb-access-ejb2-ejb3">2.2.4. Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="integration.html#jms">3. JMS (Java Message Service)</a>
<ul class="sectlevel2">
<li><a href="integration.html#jms-introduction">3.1. Introduction</a></li>
<li><a href="integration.html#jms-using">3.2. Using Spring JMS</a>
<ul class="sectlevel3">
<li><a href="integration.html#jms-jmstemplate">3.2.1. JmsTemplate</a></li>
<li><a href="integration.html#jms-connections">3.2.2. Connections</a>
<ul class="sectlevel4">
<li><a href="integration.html#jms-caching-resources">Caching Messaging Resources</a></li>
<li><a href="integration.html#jms-connection-factory">SingleConnectionFactory</a></li>
<li><a href="integration.html#jdbc-connection-factory-caching">CachingConnectionFactory</a></li>
</ul>
</li>
<li><a href="integration.html#jms-destinations">3.2.3. Destination Management</a></li>
<li><a href="integration.html#jms-mdp">3.2.4. Message Listener Containers</a>
<ul class="sectlevel4">
<li><a href="integration.html#jms-mdp-simple">SimpleMessageListenerContainer</a></li>
<li><a href="integration.html#jms-mdp-default">DefaultMessageListenerContainer</a></li>
</ul>
</li>
<li><a href="integration.html#jms-tx">3.2.5. Transaction management</a></li>
</ul>
</li>
<li><a href="integration.html#jms-sending">3.3. Sending a Message</a>
<ul class="sectlevel3">
<li><a href="integration.html#jms-msg-conversion">3.3.1. Using Message Converters</a></li>
<li><a href="integration.html#jms-callbacks">3.3.2. SessionCallback and ProducerCallback</a></li>
</ul>
</li>
<li><a href="integration.html#jms-receiving">3.4. Receiving a message</a>
<ul class="sectlevel3">
<li><a href="integration.html#jms-receiving-sync">3.4.1. Synchronous reception</a></li>
<li><a href="integration.html#jms-asynchronousMessageReception">3.4.2. Asynchronous reception: Message-Driven POJOs</a></li>
<li><a href="integration.html#jms-receiving-async-session-aware-message-listener">3.4.3. SessionAwareMessageListener interface</a></li>
<li><a href="integration.html#jms-receiving-async-message-listener-adapter">3.4.4. MessageListenerAdapter</a></li>
<li><a href="integration.html#jms-tx-participation">3.4.5. Processing messages within transactions</a></li>
</ul>
</li>
<li><a href="integration.html#jms-jca-message-endpoint-manager">3.5. Support for JCA Message Endpoints</a></li>
<li><a href="integration.html#jms-annotated">3.6. Annotation-driven listener endpoints</a>
<ul class="sectlevel3">
<li><a href="integration.html#jms-annotated-support">3.6.1. Enable listener endpoint annotations</a></li>
<li><a href="integration.html#jms-annotated-programmatic-registration">3.6.2. Programmatic endpoints registration</a></li>
<li><a href="integration.html#jms-annotated-method-signature">3.6.3. Annotated endpoint method signature</a></li>
<li><a href="integration.html#jms-annotated-response">3.6.4. Response management</a></li>
</ul>
</li>
<li><a href="integration.html#jms-namespace">3.7. JMS namespace support</a></li>
</ul>
</li>
<li><a href="integration.html#jmx">4. JMX</a>
<ul class="sectlevel2">
<li><a href="integration.html#jmx-introduction">4.1. Introduction</a></li>
<li><a href="integration.html#jmx-exporting">4.2. Exporting your beans to JMX</a>
<ul class="sectlevel3">
<li><a href="integration.html#jmx-exporting-mbeanserver">4.2.1. Creating an MBeanServer</a></li>
<li><a href="integration.html#jmx-mbean-server">4.2.2. Reusing an existing MBeanServer</a></li>
<li><a href="integration.html#jmx-exporting-lazy">4.2.3. Lazy-initialized MBeans</a></li>
<li><a href="integration.html#jmx-exporting-auto">4.2.4. Automatic registration of MBeans</a></li>
<li><a href="integration.html#jmx-exporting-registration-behavior">4.2.5. Controlling the registration behavior</a></li>
</ul>
</li>
<li><a href="integration.html#jmx-interface">4.3. Controlling the management interface of your beans</a>
<ul class="sectlevel3">
<li><a href="integration.html#jmx-interface-assembler">4.3.1. MBeanInfoAssembler interface</a></li>
<li><a href="integration.html#jmx-interface-metadata">4.3.2. Using source-level metadata: Java annotations</a></li>
<li><a href="integration.html#jmx-interface-metadata-types">4.3.3. Source-level metadata types</a></li>
<li><a href="integration.html#jmx-interface-autodetect">4.3.4. AutodetectCapableMBeanInfoAssembler interface</a></li>
<li><a href="integration.html#jmx-interface-java">4.3.5. Defining management interfaces using Java interfaces</a></li>
<li><a href="integration.html#jmx-interface-methodnames">4.3.6. Using MethodNameBasedMBeanInfoAssembler</a></li>
</ul>
</li>
<li><a href="integration.html#jmx-naming">4.4. Controlling the ObjectNames for your beans</a>
<ul class="sectlevel3">
<li><a href="integration.html#jmx-naming-properties">4.4.1. Reading ObjectNames from Properties</a></li>
<li><a href="integration.html#jmx-naming-metadata">4.4.2. Using the MetadataNamingStrategy</a></li>
<li><a href="integration.html#jmx-context-mbeanexport">4.4.3. Configuring annotation based MBean export</a></li>
</ul>
</li>
<li><a href="integration.html#jmx-jsr160">4.5. JSR-160 Connectors</a>
<ul class="sectlevel3">
<li><a href="integration.html#jmx-jsr160-server">4.5.1. Server-side connectors</a></li>
<li><a href="integration.html#jmx-jsr160-client">4.5.2. Client-side connectors</a></li>
<li><a href="integration.html#jmx-jsr160-protocols">4.5.3. JMX over Hessian or SOAP</a></li>
</ul>
</li>
<li><a href="integration.html#jmx-proxy">4.6. Accessing MBeans via proxies</a></li>
<li><a href="integration.html#jmx-notifications">4.7. Notifications</a>
<ul class="sectlevel3">
<li><a href="integration.html#jmx-notifications-listeners">4.7.1. Registering listeners for notifications</a></li>
<li><a href="integration.html#jmx-notifications-publishing">4.7.2. Publishing Notifications</a></li>
</ul>
</li>
<li><a href="integration.html#jmx-resources">4.8. Further resources</a></li>
</ul>
</li>
<li><a href="integration.html#cci">5. JCA CCI</a>
<ul class="sectlevel2">
<li><a href="integration.html#cci-introduction">5.1. Introduction</a></li>
<li><a href="integration.html#cci-config">5.2. Configuring CCI</a>
<ul class="sectlevel3">
<li><a href="integration.html#cci-config-connector">5.2.1. Connector configuration</a></li>
<li><a href="integration.html#cci-config-connectionfactory">5.2.2. ConnectionFactory configuration in Spring</a></li>
<li><a href="integration.html#cci-config-cci-connections">5.2.3. Configuring CCI connections</a></li>
<li><a href="integration.html#cci-config-single-connection">5.2.4. Using a single CCI connection</a></li>
</ul>
</li>
<li><a href="integration.html#cci-using">5.3. Using Spring&#8217;s CCI access support</a>
<ul class="sectlevel3">
<li><a href="integration.html#cci-record-creator">5.3.1. Record conversion</a></li>
<li><a href="integration.html#cci-using-template">5.3.2. CciTemplate</a></li>
<li><a href="integration.html#cci-using-dao">5.3.3. DAO support</a></li>
<li><a href="integration.html#automatic-output-generation">5.3.4. Automatic output record generation</a></li>
<li><a href="integration.html#template-summary">5.3.5. Summary</a></li>
<li><a href="integration.html#cci-straight">5.3.6. Using a CCI Connection and Interaction directly</a></li>
<li><a href="integration.html#cci-template-example">5.3.7. Example for CciTemplate usage</a></li>
</ul>
</li>
<li><a href="integration.html#cci-object">5.4. Modeling CCI access as operation objects</a>
<ul class="sectlevel3">
<li><a href="integration.html#cci-object-mapping-record">5.4.1. MappingRecordOperation</a></li>
<li><a href="integration.html#cci-object-mapping-comm-area">5.4.2. MappingCommAreaOperation</a></li>
<li><a href="integration.html#cci-automatic-record-gen">5.4.3. Automatic output record generation</a></li>
<li><a href="integration.html#cci-object-summary">5.4.4. Summary</a></li>
<li><a href="integration.html#cci-objects-mappring-record-example">5.4.5. Example for MappingRecordOperation usage</a></li>
<li><a href="integration.html#cci-objects-mapping-comm-area-example">5.4.6. Example for MappingCommAreaOperation usage</a></li>
</ul>
</li>
<li><a href="integration.html#cci-tx">5.5. Transactions</a></li>
</ul>
</li>
<li><a href="integration.html#mail">6. Email</a>
<ul class="sectlevel2">
<li><a href="integration.html#mail-introduction">6.1. Introduction</a></li>
<li><a href="integration.html#mail-usage">6.2. Usage</a>
<ul class="sectlevel3">
<li><a href="integration.html#mail-usage-simple">6.2.1. Basic MailSender and SimpleMailMessage usage</a></li>
<li><a href="integration.html#mail-usage-mime">6.2.2. Using the JavaMailSender and the MimeMessagePreparator</a></li>
</ul>
</li>
<li><a href="integration.html#mail-javamail-mime">6.3. Using the JavaMail MimeMessageHelper</a>
<ul class="sectlevel3">
<li><a href="integration.html#mail-javamail-mime-attachments">6.3.1. Sending attachments and inline resources</a>
<ul class="sectlevel4">
<li><a href="integration.html#mail-javamail-mime-attachments-attachment">Attachments</a></li>
<li><a href="integration.html#mail-javamail-mime-attachments-inline">Inline resources</a></li>
</ul>
</li>
<li><a href="integration.html#mail-templates">6.3.2. Creating email content using a templating library</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="integration.html#scheduling">7. Task Execution and Scheduling</a>
<ul class="sectlevel2">
<li><a href="integration.html#scheduling-introduction">7.1. Introduction</a></li>
<li><a href="integration.html#scheduling-task-executor">7.2. The Spring TaskExecutor abstraction</a>
<ul class="sectlevel3">
<li><a href="integration.html#scheduling-task-executor-types">7.2.1. TaskExecutor types</a></li>
<li><a href="integration.html#scheduling-task-executor-usage">7.2.2. Using a TaskExecutor</a></li>
</ul>
</li>
<li><a href="integration.html#scheduling-task-scheduler">7.3. The Spring TaskScheduler abstraction</a>
<ul class="sectlevel3">
<li><a href="integration.html#scheduling-trigger-interface">7.3.1. Trigger interface</a></li>
<li><a href="integration.html#scheduling-trigger-implementations">7.3.2. Trigger implementations</a></li>
<li><a href="integration.html#scheduling-task-scheduler-implementations">7.3.3. TaskScheduler implementations</a></li>
</ul>
</li>
<li><a href="integration.html#scheduling-annotation-support">7.4. Annotation Support for Scheduling and Asynchronous Execution</a>
<ul class="sectlevel3">
<li><a href="integration.html#scheduling-enable-annotation-support">7.4.1. Enable scheduling annotations</a></li>
<li><a href="integration.html#scheduling-annotation-support-scheduled">7.4.2. The @Scheduled annotation</a></li>
<li><a href="integration.html#scheduling-annotation-support-async">7.4.3. The @Async annotation</a></li>
<li><a href="integration.html#scheduling-annotation-support-qualification">7.4.4. Executor qualification with @Async</a></li>
<li><a href="integration.html#scheduling-annotation-support-exception">7.4.5. Exception management with @Async</a></li>
</ul>
</li>
<li><a href="integration.html#scheduling-task-namespace">7.5. The task namespace</a>
<ul class="sectlevel3">
<li><a href="integration.html#scheduling-task-namespace-scheduler">7.5.1. The 'scheduler' element</a></li>
<li><a href="integration.html#scheduling-task-namespace-executor">7.5.2. The 'executor' element</a></li>
<li><a href="integration.html#scheduling-task-namespace-scheduled-tasks">7.5.3. The 'scheduled-tasks' element</a></li>
</ul>
</li>
<li><a href="integration.html#scheduling-quartz">7.6. Using the Quartz Scheduler</a>
<ul class="sectlevel3">
<li><a href="integration.html#scheduling-quartz-jobdetail">7.6.1. Using the JobDetailFactoryBean</a></li>
<li><a href="integration.html#scheduling-quartz-method-invoking-job">7.6.2. Using the MethodInvokingJobDetailFactoryBean</a></li>
<li><a href="integration.html#scheduling-quartz-cron">7.6.3. Wiring up jobs using triggers and the SchedulerFactoryBean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="integration.html#cache">8. Cache Abstraction</a>
<ul class="sectlevel2">
<li><a href="integration.html#cache-introduction">8.1. Introduction</a></li>
<li><a href="integration.html#cache-strategies">8.2. Understanding the cache abstraction</a></li>
<li><a href="integration.html#cache-annotations">8.3. Declarative annotation-based caching</a>
<ul class="sectlevel3">
<li><a href="integration.html#cache-annotations-cacheable">8.3.1. @Cacheable annotation</a>
<ul class="sectlevel4">
<li><a href="integration.html#cache-annotations-cacheable-default-key">Default Key Generation</a></li>
<li><a href="integration.html#cache-annotations-cacheable-key">Custom Key Generation Declaration</a></li>
<li><a href="integration.html#cache-annotations-cacheable-default-cache-resolver">Default Cache Resolution</a></li>
<li><a href="integration.html#cache-annotations-cacheable-cache-resolver">Custom cache resolution</a></li>
<li><a href="integration.html#cache-annotations-cacheable-synchronized">Synchronized caching</a></li>
<li><a href="integration.html#cache-annotations-cacheable-condition">Conditional caching</a></li>
<li><a href="integration.html#cache-spel-context">Available caching SpEL evaluation context</a></li>
</ul>
</li>
<li><a href="integration.html#cache-annotations-put">8.3.2. @CachePut annotation</a></li>
<li><a href="integration.html#cache-annotations-evict">8.3.3. @CacheEvict annotation</a></li>
<li><a href="integration.html#cache-annotations-caching">8.3.4. @Caching annotation</a></li>
<li><a href="integration.html#cache-annotations-config">8.3.5. @CacheConfig annotation</a></li>
<li><a href="integration.html#cache-annotation-enable">8.3.6. Enable caching annotations</a></li>
<li><a href="integration.html#cache-annotation-stereotype">8.3.7. Using custom annotations</a></li>
</ul>
</li>
<li><a href="integration.html#cache-jsr-107">8.4. JCache (JSR-107) annotations</a>
<ul class="sectlevel3">
<li><a href="integration.html#cache-jsr-107-summary">8.4.1. Feature summary</a></li>
<li><a href="integration.html#enabling-jsr-107-support">8.4.2. Enabling JSR-107 support</a></li>
</ul>
</li>
<li><a href="integration.html#cache-declarative-xml">8.5. Declarative XML-based caching</a></li>
<li><a href="integration.html#cache-store-configuration">8.6. Configuring the cache storage</a>
<ul class="sectlevel3">
<li><a href="integration.html#cache-store-configuration-jdk">8.6.1. JDK ConcurrentMap-based Cache</a></li>
<li><a href="integration.html#cache-store-configuration-ehcache">8.6.2. Ehcache-based Cache</a></li>
<li><a href="integration.html#cache-store-configuration-caffeine">8.6.3. Caffeine Cache</a></li>
<li><a href="integration.html#cache-store-configuration-gemfire">8.6.4. GemFire-based Cache</a></li>
<li><a href="integration.html#cache-store-configuration-jsr107">8.6.5. JSR-107 Cache</a></li>
<li><a href="integration.html#cache-store-configuration-noop">8.6.6. Dealing with caches without a backing store</a></li>
</ul>
</li>
<li><a href="integration.html#cache-plug">8.7. Plugging-in different back-end caches</a></li>
<li><a href="integration.html#cache-specific-config">8.8. How can I set the TTL/TTI/Eviction policy/XXX feature?</a></li>
</ul>
</li>
<li><a href="integration.html#appendix">9. Appendix</a>
<ul class="sectlevel2">
<li><a href="integration.html#xsd-schemas">9.1. XML Schemas</a>
<ul class="sectlevel3">
<li><a href="integration.html#xsd-schemas-jee">9.1.1. The jee schema</a>
<ul class="sectlevel4">
<li><a href="integration.html#xsd-schemas-jee-jndi-lookup">&lt;jee:jndi-lookup/&gt; (simple)</a></li>
<li><a href="integration.html#xsd-schemas-jee-jndi-lookup-environment-single">&lt;jee:jndi-lookup/&gt; (with single JNDI environment setting)</a></li>
<li><a href="integration.html#xsd-schemas-jee-jndi-lookup-evironment-multiple">&lt;jee:jndi-lookup/&gt; (with multiple JNDI environment settings)</a></li>
<li><a href="integration.html#xsd-schemas-jee-jndi-lookup-complex">&lt;jee:jndi-lookup/&gt; (complex)</a></li>
<li><a href="integration.html#xsd-schemas-jee-local-slsb">&lt;jee:local-slsb/&gt; (simple)</a></li>
<li><a href="integration.html#xsd-schemas-jee-local-slsb-complex">&lt;jee:local-slsb/&gt; (complex)</a></li>
<li><a href="integration.html#xsd-schemas-jee-remote-slsb">&lt;jee:remote-slsb/&gt;</a></li>
</ul>
</li>
<li><a href="integration.html#xsd-schemas-jms">9.1.2. The jms schema</a></li>
<li><a href="integration.html#xsd-schemas-context-mbe">9.1.3. &lt;context:mbean-export/&gt;</a></li>
<li><a href="integration.html#xsd-schemas-cache">9.1.4. The cache schema</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This part of the reference documentation covers the Spring Framework&#8217;s integration with
a number of Java EE (and related) technologies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remoting"><a class="anchor" href="integration.html#remoting"></a>1. Remoting and web services using Spring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="remoting-introduction"><a class="anchor" href="integration.html#remoting-introduction"></a>1.1. Introduction</h3>
<div class="paragraph">
<p>Spring features integration classes for remoting support using various technologies. The
remoting support eases the development of remote-enabled services, implemented by your
usual (Spring) POJOs. Currently, Spring supports the following remoting technologies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Remote Method Invocation (RMI)</em>. Through the use of the <code>RmiProxyFactoryBean</code> and
the <code>RmiServiceExporter</code> Spring supports both traditional RMI (with <code>java.rmi.Remote</code>
interfaces and <code>java.rmi.RemoteException</code>) and transparent remoting via RMI invokers
(with any Java interface).</p>
</li>
<li>
<p><em>Spring&#8217;s HTTP invoker</em>. Spring provides a special remoting strategy which allows
for Java serialization via HTTP, supporting any Java interface (just like the RMI
invoker). The corresponding support classes are <code>HttpInvokerProxyFactoryBean</code> and
<code>HttpInvokerServiceExporter</code>.</p>
</li>
<li>
<p><em>Hessian</em>. By using Spring&#8217;s <code>HessianProxyFactoryBean</code> and the
<code>HessianServiceExporter</code> you can transparently expose your services using the
lightweight binary HTTP-based protocol provided by Caucho.</p>
</li>
<li>
<p><em>JAX-WS</em>. Spring provides remoting support for web services via JAX-WS (the
successor of JAX-RPC, as introduced in Java EE 5 and Java 6).</p>
</li>
<li>
<p><em>JMS</em>. Remoting using JMS as the underlying protocol is supported via the
<code>JmsInvokerServiceExporter</code> and <code>JmsInvokerProxyFactoryBean</code> classes.</p>
</li>
<li>
<p><em>AMQP</em>. Remoting using AMQP as the underlying protocol is supported by the Spring
AMQP project.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While discussing the remoting capabilities of Spring, we&#8217;ll use the following domain
model and corresponding services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>{

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> <span class="predefined-type">String</span> getName(){
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountService</span> {

    <span class="directive">public</span> <span class="type">void</span> insertAccount(Account account);

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Account&gt; getAccounts(<span class="predefined-type">String</span> name);

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// the implementation doing nothing at the moment</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AccountServiceImpl</span> <span class="directive">implements</span> AccountService {

    <span class="directive">public</span> <span class="type">void</span> insertAccount(Account acc) {
        <span class="comment">// do something...</span>
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Account&gt; getAccounts(<span class="predefined-type">String</span> name) {
        <span class="comment">// do something...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will start exposing the service to a remote client by using RMI and talk a bit about
the drawbacks of using RMI. We&#8217;ll then continue to show an example using Hessian as the
protocol.</p>
</div>
</div>
<div class="sect2">
<h3 id="remoting-rmi"><a class="anchor" href="integration.html#remoting-rmi"></a>1.2. Exposing services using RMI</h3>
<div class="paragraph">
<p>Using Spring&#8217;s support for RMI, you can transparently expose your services through the
RMI infrastructure. After having this set up, you basically have a configuration similar
to remote EJBs, except for the fact that there is no standard support for security
context propagation or remote transaction propagation. Spring does provide hooks for
such additional invocation context when using the RMI invoker, so you can for example
plug in security frameworks or custom security credentials here.</p>
</div>
<div class="sect3">
<h4 id="remoting-rmi-server"><a class="anchor" href="integration.html#remoting-rmi-server"></a>1.2.1. Exporting the service using the RmiServiceExporter</h4>
<div class="paragraph">
<p>Using the <code>RmiServiceExporter</code>, we can expose the interface of our AccountService object
as RMI object. The interface can be accessed by using <code>RmiProxyFactoryBean</code>, or via
plain RMI in case of a traditional RMI service. The <code>RmiServiceExporter</code> explicitly
supports the exposing of any non-RMI services via RMI invokers.</p>
</div>
<div class="paragraph">
<p>Of course, we first have to set up our service in the Spring container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- any additional properties, maybe a DAO? --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll have to expose our service using the <code>RmiServiceExporter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.rmi.RmiServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- does not necessarily have to be the same name as the bean to be exported --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- defaults to 1099 --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">registryPort</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1199</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we&#8217;re overriding the port for the RMI registry. Often, your application
server also maintains an RMI registry and it is wise to not interfere with that one.
Furthermore, the service name is used to bind the service under. So right now, the
service will be bound at <code>'rmi://HOST:1199/AccountService'</code>. We&#8217;ll use the URL later on
to link in the service at the client side.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>servicePort</code> property has been omitted (it defaults to 0). This means that an
anonymous port will be used to communicate with the service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="remoting-rmi-client"><a class="anchor" href="integration.html#remoting-rmi-client"></a>1.2.2. Linking in the service at the client</h4>
<div class="paragraph">
<p>Our client is a simple object using the <code>AccountService</code> to manage accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleObject</span> {

    <span class="directive">private</span> AccountService accountService;

    <span class="directive">public</span> <span class="type">void</span> setAccountService(AccountService accountService) {
        <span class="local-variable">this</span>.accountService = accountService;
    }

    <span class="comment">// additional methods using the accountService</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To link in the service on the client, we&#8217;ll create a separate Spring container,
containing the simple object and the service linking configuration bits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.rmi.RmiProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmi://HOST:1199/AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all we need to do to support the remote account service on the client. Spring
will transparently create an invoker and remotely enable the account service through the
<code>RmiServiceExporter</code>. At the client we&#8217;re linking it in using the <code>RmiProxyFactoryBean</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remoting-caucho-protocols"><a class="anchor" href="integration.html#remoting-caucho-protocols"></a>1.3. Using Hessian to remotely call services via HTTP</h3>
<div class="paragraph">
<p>Hessian offers a binary HTTP-based remoting protocol. It is developed by Caucho and more
information about Hessian itself can be found at <a href="http://www.caucho.com" class="bare">http://www.caucho.com</a>.</p>
</div>
<div class="sect3">
<h4 id="remoting-caucho-protocols-hessian"><a class="anchor" href="integration.html#remoting-caucho-protocols-hessian"></a>1.3.1. Wiring up the DispatcherServlet for Hessian and co.</h4>
<div class="paragraph">
<p>Hessian communicates via HTTP and does so using a custom servlet. Using Spring&#8217;s
<code>DispatcherServlet</code> principles, as known from Spring Web MVC usage, you can easily wire
up such a servlet exposing your services. First we&#8217;ll have to create a new servlet in
your application (this is an excerpt from <code>'web.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>remoting<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>

<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>remoting<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/remoting/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re probably familiar with Spring&#8217;s <code>DispatcherServlet</code> principles and if so, you
know that now you&#8217;ll have to create a Spring container configuration resource named
<code>'remoting-servlet.xml'</code> (after the name of your servlet) in the <code>'WEB-INF'</code> directory.
The application context will be used in the next section.</p>
</div>
<div class="paragraph">
<p>Alternatively, consider the use of Spring&#8217;s simpler <code>HttpRequestHandlerServlet</code>. This
allows you to embed the remote exporter definitions in your root application context (by
default in <code>'WEB-INF/applicationContext.xml'</code>), with individual servlet definitions
pointing to specific exporter beans. Each servlet name needs to match the bean name of
its target exporter in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="remoting-caucho-protocols-hessian-server"><a class="anchor" href="integration.html#remoting-caucho-protocols-hessian-server"></a>1.3.2. Exposing your beans by using the HessianServiceExporter</h4>
<div class="paragraph">
<p>In the newly created application context called <code>remoting-servlet.xml</code>, we&#8217;ll create a
<code>HessianServiceExporter</code> exporting your services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- any additional properties, maybe a DAO? --&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/AccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.caucho.HessianServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to link in the service at the client. No explicit handler mapping is
specified, mapping request URLs onto services, so <code>BeanNameUrlHandlerMapping</code> will be
used: Hence, the service will be exported at the URL indicated through its bean name
within the containing <code>DispatcherServlet</code>'s mapping (as defined above):
<code>'http://HOST:8080/remoting/AccountService'</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, create a <code>HessianServiceExporter</code> in your root application context (e.g.
in <code>'WEB-INF/applicationContext.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountExporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.caucho.HessianServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the latter case, define a corresponding servlet for this exporter in <code>'web.xml'</code>,
with the same end result: The exporter getting mapped to the request path
<code>/remoting/AccountService</code>. Note that the servlet name needs to match the bean name of
the target exporter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>accountExporter<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.springframework.web.context.support.HttpRequestHandlerServlet<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>

<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>accountExporter<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/remoting/AccountService<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-caucho-protocols-hessian-client"><a class="anchor" href="integration.html#remoting-caucho-protocols-hessian-client"></a>1.3.3. Linking in the service on the client</h4>
<div class="paragraph">
<p>Using the <code>HessianProxyFactoryBean</code> we can link in the service at the client. The same
principles apply as with the RMI example. We&#8217;ll create a separate bean factory or
application context and mention the following beans where the <code>SimpleObject</code> is using
the <code>AccountService</code> to manage accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.SimpleObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.caucho.HessianProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://remotehost:8080/remoting/AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-caucho-protocols-security"><a class="anchor" href="integration.html#remoting-caucho-protocols-security"></a>1.3.4. Applying HTTP basic authentication to a service exposed through Hessian</h4>
<div class="paragraph">
<p>One of the advantages of Hessian is that we can easily apply HTTP basic authentication,
because both protocols are HTTP-based. Your normal HTTP server security mechanism can
easily be applied through using the <code>web.xml</code> security features, for example. Usually,
you don&#8217;t use per-user security credentials here, but rather shared credentials defined
at the <code>HessianProxyFactoryBean</code> level (similar to a JDBC <code>DataSource</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptors</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authorizationInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authorizationInterceptor</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.handler.UserRoleAuthorizationInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authorizedRoles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">administrator,operator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example where we explicitly mention the <code>BeanNameUrlHandlerMapping</code> and set
an interceptor allowing only administrators and operators to call the beans mentioned in
this application context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Of course, this example doesn&#8217;t show a flexible kind of security infrastructure. For
more options as far as security is concerned, have a look at the Spring Security project
at <a href="https://projects.spring.io/spring-security/" class="bare">http://projects.spring.io/spring-security/</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remoting-httpinvoker"><a class="anchor" href="integration.html#remoting-httpinvoker"></a>1.4. Exposing services using HTTP invokers</h3>
<div class="paragraph">
<p>As opposed to Hessian, which are both lightweight protocols using their own slim
serialization mechanisms, Spring HTTP invokers use the standard Java serialization
mechanism to expose services through HTTP. This has a huge advantage if your arguments
and return types are complex types that cannot be serialized using the serialization
mechanisms Hessian uses (refer to the next section for more considerations when
choosing a remoting technology).</p>
</div>
<div class="paragraph">
<p>Under the hood, Spring uses either the standard facilities provided by the JDK or
Apache <code>HttpComponents</code> to perform HTTP calls. Use the latter if you need more
advanced and easier-to-use functionality. Refer to
<a href="https://hc.apache.org/httpcomponents-client-ga/">hc.apache.org/httpcomponents-client-ga/</a>
for more information.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware of vulnerabilities due to unsafe Java deserialization:
Manipulated input streams could lead to unwanted code execution on the server
during the deserialization step. As a consequence, do not expose HTTP invoker
endpoints to untrusted clients but rather just between your own services.
In general, we strongly recommend any other message format (e.g. JSON) instead.</p>
</div>
<div class="paragraph">
<p>If you are concerned about security vulnerabilities due to Java serialization,
consider the general-purpose serialization filter mechanism at the core JVM level,
originally developed for JDK 9 but backported to JDK 8, 7 and 6 in the meantime:
<a href="https://blogs.oracle.com/java-platform-group/entry/incoming_filter_serialization_data_a" class="bare">https://blogs.oracle.com/java-platform-group/entry/incoming_filter_serialization_data_a</a>
<a href="http://openjdk.java.net/jeps/290" class="bare">http://openjdk.java.net/jeps/290</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="remoting-httpinvoker-server"><a class="anchor" href="integration.html#remoting-httpinvoker-server"></a>1.4.1. Exposing the service object</h4>
<div class="paragraph">
<p>Setting up the HTTP invoker infrastructure for a service object resembles closely the
way you would do the same using Hessian. Just as Hessian support provides the
<code>HessianServiceExporter</code>, Spring&#8217;s HttpInvoker support provides the
<code>org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</code>.</p>
</div>
<div class="paragraph">
<p>To expose the <code>AccountService</code> (mentioned above) within a Spring Web MVC
<code>DispatcherServlet</code>, the following configuration needs to be in place in the
dispatcher&#8217;s application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/AccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Such an exporter definition will be exposed through the <code>DispatcherServlet</code>'s standard
mapping facilities, as explained in the section on Hessian.</p>
</div>
<div class="paragraph">
<p>Alternatively, create an <code>HttpInvokerServiceExporter</code> in your root application context
(e.g. in <code>'WEB-INF/applicationContext.xml'</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountExporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, define a corresponding servlet for this exporter in <code>'web.xml'</code>, with the
servlet name matching the bean name of the target exporter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>accountExporter<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.springframework.web.context.support.HttpRequestHandlerServlet<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>

<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>accountExporter<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/remoting/AccountService<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are running outside of a servlet container and are using Oracle&#8217;s Java 6, then you
can use the built-in HTTP server implementation. You can configure the
<code>SimpleHttpServerFactoryBean</code> together with a <code>SimpleHttpInvokerServiceExporter</code> as is
shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountExporter</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.httpinvoker.SimpleHttpInvokerServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.support.SimpleHttpServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">contexts</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/remoting/AccountService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountExporter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/util:map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-httpinvoker-client"><a class="anchor" href="integration.html#remoting-httpinvoker-client"></a>1.4.2. Linking in the service at the client</h4>
<div class="paragraph">
<p>Again, linking in the service from the client much resembles the way you would do it
when using Hessian. Using a proxy, Spring will be able to translate your calls to
HTTP POST requests to the URL pointing to the exported service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpInvokerProxy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://remotehost:8080/remoting/AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, you can choose what HTTP client you want to use. By default, the
<code>HttpInvokerProxy</code> uses the JDK&#8217;s HTTP functionality, but you can also use the Apache
<code>HttpComponents</code> client by setting the <code>httpInvokerRequestExecutor</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpInvokerRequestExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.httpinvoker.HttpComponentsHttpInvokerRequestExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remoting-web-services"><a class="anchor" href="integration.html#remoting-web-services"></a>1.5. Web services</h3>
<div class="paragraph">
<p>Spring provides full support for standard Java web services APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exposing web services using JAX-WS</p>
</li>
<li>
<p>Accessing web services using JAX-WS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to stock support for JAX-WS in Spring Core, the Spring portfolio also
features <a href="http://www.springframework.org/spring-ws">Spring Web Services</a>, a solution for
contract-first, document-driven web services - highly recommended for building modern,
future-proof web services.</p>
</div>
<div class="sect3">
<h4 id="remoting-web-services-jaxws-export-servlet"><a class="anchor" href="integration.html#remoting-web-services-jaxws-export-servlet"></a>1.5.1. Exposing servlet-based web services using JAX-WS</h4>
<div class="paragraph">
<p>Spring provides a convenient base class for JAX-WS servlet endpoint implementations -
<code>SpringBeanAutowiringSupport</code>. To expose our <code>AccountService</code> we extend Spring&#8217;s
<code>SpringBeanAutowiringSupport</code> class and implement our business logic here, usually
delegating the call to the business layer. We&#8217;ll simply use Spring&#8217;s <code>@Autowired</code>
annotation for expressing such dependencies on Spring-managed beans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * JAX-WS compliant AccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-WS requires working with dedicated
 * endpoint classes. If an existing service needs to be exported, a wrapper that
 * extends SpringBeanAutowiringSupport for simple Spring bean autowiring (through
 * the @Autowired annotation) is the simplest JAX-WS compliant way.
 *
 * This is the class registered with the server-side JAX-WS implementation.
 * In the case of a Java EE 5 server, this would simply be defined as a servlet
 * in web.xml, with the server detecting that this is a JAX-WS endpoint and reacting
 * accordingly. The servlet name usually needs to match the specified WS service name.
 *
 * The web service engine manages the lifecycle of instances of this class.
 * Spring bean references will just be wired in here.
 */</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.context.support.SpringBeanAutowiringSupport</span>;

<span class="annotation">@WebService</span>(serviceName=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountService</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AccountServiceEndpoint</span> <span class="directive">extends</span> SpringBeanAutowiringSupport {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> AccountService biz;

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="type">void</span> insertAccount(Account acc) {
        biz.insertAccount(acc);
    }

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> Account<span class="type">[]</span> getAccounts(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> biz.getAccounts(name);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our <code>AccountServiceEndpoint</code> needs to run in the same web application as the Spring
context to allow for access to Spring&#8217;s facilities. This is the case by default in Java
EE 5 environments, using the standard contract for JAX-WS servlet endpoint deployment.
See Java EE 5 web service tutorials for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="remoting-web-services-jaxws-export-standalone"><a class="anchor" href="integration.html#remoting-web-services-jaxws-export-standalone"></a>1.5.2. Exporting standalone web services using JAX-WS</h4>
<div class="paragraph">
<p>The built-in JAX-WS provider that comes with Oracle&#8217;s JDK supports exposure of web
services using the built-in HTTP server that&#8217;s included in the JDK as well. Spring&#8217;s
<code>SimpleJaxWsServiceExporter</code> detects all <code>@WebService</code> annotated beans in the Spring
application context, exporting them through the default JAX-WS server (the JDK HTTP
server).</p>
</div>
<div class="paragraph">
<p>In this scenario, the endpoint instances are defined and managed as Spring beans
themselves; they will be registered with the JAX-WS engine but their lifecycle will be
up to the Spring application context. This means that Spring functionality like explicit
dependency injection may be applied to the endpoint instances. Of course,
annotation-driven injection through <code>@Autowired</code> will work as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseAddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountServiceEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/bean&gt;</span>

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AccountServiceEndpoint</code> may derive from Spring&#8217;s <code>SpringBeanAutowiringSupport</code> but
doesn&#8217;t have to since the endpoint is a fully Spring-managed bean here. This means that
the endpoint implementation may look like as follows, without any superclass declared -
and Spring&#8217;s <code>@Autowired</code> configuration annotation still being honored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebService</span>(serviceName=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountService</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AccountServiceEndpoint</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> AccountService biz;

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="type">void</span> insertAccount(Account acc) {
        biz.insertAccount(acc);
    }

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Account&gt; getAccounts(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> biz.getAccounts(name);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-web-services-jaxws-export-ri"><a class="anchor" href="integration.html#remoting-web-services-jaxws-export-ri"></a>1.5.3. Exporting web services using the JAX-WS RI&#8217;s Spring support</h4>
<div class="paragraph">
<p>Oracle&#8217;s JAX-WS RI, developed as part of the GlassFish project, ships Spring support as
part of its JAX-WS Commons project. This allows for defining JAX-WS endpoints as
Spring-managed beans, similar to the standalone mode discussed in the previous section -
but this time in a Servlet environment. <em>Note that this is not portable in a Java EE 5
environment; it is mainly intended for non-EE environments such as Tomcat, embedding the
JAX-WS RI as part of the web application.</em></p>
</div>
<div class="paragraph">
<p>The difference to the standard style of exporting servlet-based endpoints is that the
lifecycle of the endpoint instances themselves will be managed by Spring here, and that
there will be only one JAX-WS servlet defined in <code>web.xml</code>. With the standard Java EE 5
style (as illustrated above), you&#8217;ll have one servlet definition per service endpoint,
with each endpoint typically delegating to Spring beans (through the use of
<code>@Autowired</code>, as shown above).</p>
</div>
<div class="paragraph">
<p>Check out <a href="https://jax-ws-commons.java.net/spring/">https://jax-ws-commons.java.net/spring/</a>
for details on setup and usage style.</p>
</div>
</div>
<div class="sect3">
<h4 id="remoting-web-services-jaxws-access"><a class="anchor" href="integration.html#remoting-web-services-jaxws-access"></a>1.5.4. Accessing web services using JAX-WS</h4>
<div class="paragraph">
<p>Spring provides two factory beans to create JAX-WS web service proxies, namely
<code>LocalJaxWsServiceFactoryBean</code> and <code>JaxWsPortProxyFactoryBean</code>. The former can only
return a JAX-WS service class for us to work with. The latter is the full-fledged
version that can return a proxy that implements our business service interface. In this
example we use the latter to create a proxy for the <code>AccountService</code> endpoint (again):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountWebService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsdlDocumentUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8888/AccountServiceEndpoint?WSDL</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namespaceUri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">portName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountServiceEndpointPort</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>serviceInterface</code> is our business interface the clients will use.
<code>wsdlDocumentUrl</code> is the URL for the WSDL file. Spring needs this a startup time to
create the JAX-WS Service. <code>namespaceUri</code> corresponds to the targetNamespace in the
.wsdl file. <code>serviceName</code> corresponds to the service name in the .wsdl file. <code>portName</code>
corresponds to the port name in the .wsdl file.</p>
</div>
<div class="paragraph">
<p>Accessing the web service is now very easy as we have a bean factory for it that will
expose it as <code>AccountService</code> interface. We can wire this up in Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AccountClientImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountWebService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From the client code we can access the web service just as if it was a normal class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AccountClientImpl</span> {

    <span class="directive">private</span> AccountService service;

    <span class="directive">public</span> <span class="type">void</span> setService(AccountService service) {
        <span class="local-variable">this</span>.service = service;
    }

    <span class="directive">public</span> <span class="type">void</span> foo() {
        service.insertAccount(...);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above is slightly simplified in that JAX-WS requires endpoint interfaces
and implementation classes to be annotated with <code>@WebService</code>, <code>@SOAPBinding</code> etc
annotations. This means that you cannot (easily) use plain Java interfaces and
implementation classes as JAX-WS endpoint artifacts; you need to annotate them
accordingly first. Check the JAX-WS documentation for details on those requirements.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remoting-jms"><a class="anchor" href="integration.html#remoting-jms"></a>1.6. JMS</h3>
<div class="paragraph">
<p>It is also possible to expose services transparently using JMS as the underlying
communication protocol. The JMS remoting support in the Spring Framework is pretty basic
- it sends and receives on the <code>same thread</code> and in the <em>same non-transactional</em>
<code>Session</code>, and as such throughput will be very implementation dependent. Note that these
single-threaded and non-transactional constraints apply only to Spring&#8217;s JMS
<em>remoting</em> support. See <a href="integration.html#jms">JMS (Java Message Service)</a> for information on Spring&#8217;s rich support for JMS-based
<em>messaging</em>.</p>
</div>
<div class="paragraph">
<p>The following interface is used on both the server and the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">CheckingAccountService</span> {

    <span class="directive">public</span> <span class="type">void</span> cancelAccount(<span class="predefined-type">Long</span> accountId);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following simple implementation of the above interface is used on the server-side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleCheckingAccountService</span> <span class="directive">implements</span> CheckingAccountService {

    <span class="directive">public</span> <span class="type">void</span> cancelAccount(<span class="predefined-type">Long</span> accountId) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cancelling account [</span><span class="delimiter">&quot;</span></span> + accountId + <span class="string"><span class="delimiter">&quot;</span><span class="content">]</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration file contains the JMS-infrastructure beans that are shared on both
the client and server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ActiveMQConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">brokerURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://ep-t43:61616</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.command.ActiveMQQueue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mmm</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="remoting-jms-server"><a class="anchor" href="integration.html#remoting-jms-server"></a>1.6.1. Server-side configuration</h4>
<div class="paragraph">
<p>On the server, you just need to expose the service object using the
<code>JmsInvokerServiceExporter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkingAccountService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.remoting.JmsInvokerServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.CheckingAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.SimpleCheckingAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.SimpleMessageListenerContainer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrentConsumers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkingAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Server</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo/server.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo/jms.xml</span><span class="delimiter">&quot;</span></span>});
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remoting-jms-client"><a class="anchor" href="integration.html#remoting-jms-client"></a>1.6.2. Client-side configuration</h4>
<div class="paragraph">
<p>The client merely needs to create a client-side proxy that will implement the agreed
upon interface ( <code>CheckingAccountService</code>). The resulting object created off the back of
the following bean definition can be injected into other client side objects, and the
proxy will take care of forwarding the call to the server-side object via JMS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkingAccountService</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.remoting.JmsInvokerProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.CheckingAccountService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Client</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(
                <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo/client.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo/jms.xml</span><span class="delimiter">&quot;</span></span>});
        CheckingAccountService service = (CheckingAccountService) ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">checkingAccountService</span><span class="delimiter">&quot;</span></span>);
        service.cancelAccount(<span class="keyword">new</span> <span class="predefined-type">Long</span>(<span class="integer">10</span>));
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remoting-amqp"><a class="anchor" href="integration.html#remoting-amqp"></a>1.7. AMQP</h3>
<div class="paragraph">
<p>Refer to the <a href="https://docs.spring.io/spring-amqp/docs/current/reference/html/_reference.html#remoting">Spring AMQP Reference Document
'Spring Remoting with AMQP' section</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="remoting-autodection-remote-interfaces"><a class="anchor" href="integration.html#remoting-autodection-remote-interfaces"></a>1.8. Auto-detection is not implemented for remote interfaces</h3>
<div class="paragraph">
<p>The main reason why auto-detection of implemented interfaces does not occur for remote
interfaces is to avoid opening too many doors to remote callers. The target object might
implement internal callback interfaces like <code>InitializingBean</code> or <code>DisposableBean</code> which
one would not want to expose to callers.</p>
</div>
<div class="paragraph">
<p>Offering a proxy with all interfaces implemented by the target usually does not matter
in the local case. But when exporting a remote service, you should expose a specific
service interface, with specific operations intended for remote usage. Besides internal
callback interfaces, the target might implement multiple business interfaces, with just
one of them intended for remote exposure. For these reasons, we <em>require</em> such a
service interface to be specified.</p>
</div>
<div class="paragraph">
<p>This is a trade-off between configuration convenience and the risk of accidental
exposure of internal methods. Always specifying a service interface is not too much
effort, and puts you on the safe side regarding controlled exposure of specific methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="remoting-considerations"><a class="anchor" href="integration.html#remoting-considerations"></a>1.9. Considerations when choosing a technology</h3>
<div class="paragraph">
<p>Each and every technology presented here has its drawbacks. You should carefully
consider your needs, the services you are exposing and the objects you&#8217;ll be sending
over the wire when choosing a technology.</p>
</div>
<div class="paragraph">
<p>When using RMI, it&#8217;s not possible to access the objects through the HTTP protocol,
unless you&#8217;re tunneling the RMI traffic. RMI is a fairly heavy-weight protocol in that
it supports full-object serialization which is important when using a complex data model
that needs serialization over the wire. However, RMI-JRMP is tied to Java clients: It is
a Java-to-Java remoting solution.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s HTTP invoker is a good choice if you need HTTP-based remoting but also rely on
Java serialization. It shares the basic infrastructure with RMI invokers, just using
HTTP as transport. Note that HTTP invokers are not only limited to Java-to-Java remoting
but also to Spring on both the client and server side. (The latter also applies to
Spring&#8217;s RMI invoker for non-RMI interfaces.)</p>
</div>
<div class="paragraph">
<p>Hessian might provide significant value when operating in a heterogeneous environment,
because they explicitly allow for non-Java clients. However, non-Java support is still
limited. Known issues include the serialization of Hibernate objects in combination with
lazily-initialized collections. If you have such a data model, consider using RMI or
HTTP invokers instead of Hessian.</p>
</div>
<div class="paragraph">
<p>JMS can be useful for providing clusters of services and allowing the JMS broker to take
care of load balancing, discovery and auto-failover. By default: Java serialization is
used when using JMS remoting but the JMS provider could use a different mechanism for
the wire formatting, such as XStream to allow servers to be implemented in other
technologies.</p>
</div>
<div class="paragraph">
<p>Last but not least, EJB has an advantage over RMI in that it supports standard
role-based authentication and authorization and remote transaction propagation. It is
possible to get RMI invokers or HTTP invokers to support security context propagation as
well, although this is not provided by core Spring: There are just appropriate hooks for
plugging in third-party or custom solutions here.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-client-access"><a class="anchor" href="integration.html#rest-client-access"></a>1.10. Accessing REST endpoints</h3>
<div class="paragraph">
<p>The Spring Framework has two choices for client-side access to REST endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="integration.html#rest-resttemplate">RestTemplate</a>&#8201;&#8212;&#8201;the original Spring REST client with an API similar to other
template classes in Spring such as <code>JdbcTemplate</code>, <code>JmsTemplate</code> and others.
<code>RestTemplate</code> has a synchronous API and relies on blocking I/O which is okay for
client scenarios with low concurrency.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-client">WebClient</a>&#8201;&#8212;&#8201;reactive client with a functional,
fluent API from the <code>spring-webflux</code> module. It relies on non-blocking I/O which allows it
to support high concurrency more efficiently (i.e. using a small number of threads) than the
<code>RestTemplate</code>. <code>WebClient</code> is a natural fit for streaming scenarios.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="rest-resttemplate"><a class="anchor" href="integration.html#rest-resttemplate"></a>1.10.1. RestTemplate</h4>
<div class="paragraph">
<p>The <code>RestTemplate</code> provides a higher level API over HTTP client libraries with methods
that correspond to each of the six main HTTP methods that make invoking many RESTful
services a one-liner and enforce REST best practices.</p>
</div>
<table id="rest-overview-of-resttemplate-methods-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Overview of RestTemplate methods</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">RestTemplate Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#delete(String,%20Object&#8230;&#8203;)">delete</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#getForObject(String,%20Class,%20Object&#8230;&#8203;)">getForObject</a>
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#getForEntity(String,%20Class,%20Object&#8230;&#8203;)">getForEntity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HEAD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#headForHeaders(String,%20Object&#8230;&#8203;)">headForHeaders(String
url, String&#8230;&#8203; uriVariables)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#optionsForAllow(String,%20Object&#8230;&#8203;)">optionsForAllow(String
url, String&#8230;&#8203; uriVariables)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#postForLocation(String,%20Object,%20Object&#8230;&#8203;)">postForLocation(String
url, Object request, String&#8230;&#8203; uriVariables)</a>
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#postForObject(java.lang.String,%20java.lang.Object,%20java.lang.Class,%20java.lang.String&#8230;&#8203;)">postForObject(String
url, Object request, Class&lt;T&gt; responseType, String&#8230;&#8203; uriVariables)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#put(String,%20Object,%20Object&#8230;&#8203;)">put(String
url, Object request, String&#8230;&#8203;uriVariables)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PATCH and others</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#exchange(java.lang.String,%20org.springframework.http.HttpMethod,%20org.springframework.http.HttpEntity,%20java.lang.Class,%20java.lang.Object&#8230;&#8203;)">exchange</a>
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html#execute(java.lang.String,%20org.springframework.http.HttpMethod,%20org.springframework.web.client.RequestCallback,%20org.springframework.web.client.ResponseExtractor,%20java.lang.Object&#8230;&#8203;)">execute</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The names of <code>RestTemplate</code> methods follow a naming convention, the first part indicates
what HTTP method is being invoked and the second part indicates what is returned. For
example, the method <code>getForObject()</code> will perform a GET, convert the HTTP response into
an object type of your choice and return that object. The method <code>postForLocation()</code>
will do a POST, converting the given object into a HTTP request and return the response
HTTP Location header where the newly created object can be found. In case of an
exception processing the HTTP request, an exception of the type <code>RestClientException</code>
will be thrown; this behavior can be changed by plugging in another
<code>ResponseErrorHandler</code> implementation into the <code>RestTemplate</code>.</p>
</div>
<div class="paragraph">
<p>The <code>exchange</code> and <code>execute</code> methods are generalized versions of the more
specific methods listed above them and can support additional combinations and methods,
like HTTP PATCH. However, note that the underlying HTTP library must also support the
desired combination. The JDK <code>HttpURLConnection</code> does not support the <code>PATCH</code> method, but
Apache HttpComponents HttpClient version 4.2 or later does. They also enable
<code>RestTemplate</code> to read an HTTP response to a generic type (e.g. <code>List&lt;Account&gt;</code>), using a
<code>ParameterizedTypeReference</code>, a new class that enables capturing and passing generic
type info.</p>
</div>
<div class="paragraph">
<p>Objects passed to and returned from these methods are converted to and from HTTP
messages by <code>HttpMessageConverter</code> instances. Converters for the main mime types are
registered by default, but you can also write your own converter and register it via the
<code>messageConverters()</code> bean property. The default converter instances registered with the
template are <code>ByteArrayHttpMessageConverter</code>, <code>StringHttpMessageConverter</code>,
<code>FormHttpMessageConverter</code> and <code>SourceHttpMessageConverter</code>. You can override these
defaults using the <code>messageConverters()</code> bean property as would be required if using the
<code>MarshallingHttpMessageConverter</code> or <code>MappingJackson2HttpMessageConverter</code>.</p>
</div>
<div class="paragraph">
<p>Each method takes URI template arguments in two forms, either as a <code>String</code>
variable-length argument or a <code>Map&lt;String,String&gt;</code>. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> result = restTemplate.getForObject(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/hotels/{hotel}/bookings/{booking}</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class,<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">21</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>using variable-length arguments and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; vars = <span class="predefined-type">Collections</span>.singletonMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">hotel</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> result = restTemplate.getForObject(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/hotels/{hotel}/rooms/{hotel}</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class, vars);</code></pre>
</div>
</div>
<div class="paragraph">
<p>using a <code>Map&lt;String,String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>To create an instance of <code>RestTemplate</code> you can simply call the default no-arg
constructor. This will use standard Java classes from the <code>java.net</code> package as the
underlying implementation to create HTTP requests. This can be overridden by specifying
an implementation of <code>ClientHttpRequestFactory</code>. Spring provides the implementation
<code>HttpComponentsClientHttpRequestFactory</code> that uses the Apache HttpComponents
<code>HttpClient</code> to create requests. <code>HttpComponentsClientHttpRequestFactory</code> is configured
using an instance of <code>org.apache.http.client.HttpClient</code> which can in turn be configured
with credentials information or connection pooling functionality.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the <code>java.net</code> implementation for HTTP requests may raise an exception when
accessing the status of a response that represents an error (e.g. 401). If this is an
issue, switch to <code>HttpComponentsClientHttpRequestFactory</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example using Apache HttpComponents <code>HttpClient</code> directly rewritten to use
the <code>RestTemplate</code> is shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">uri = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/hotels/{id}/bookings</span><span class="delimiter">&quot;</span></span>;

RestTemplate template = <span class="keyword">new</span> RestTemplate();

Booking booking = <span class="comment">// create booking object</span>

<span class="predefined-type">URI</span> location = template.postForLocation(uri, booking, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use Apache HttpComponents instead of the native <code>java.net</code> functionality, construct
the <code>RestTemplate</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RestTemplate template = <span class="keyword">new</span> RestTemplate(<span class="keyword">new</span> HttpComponentsClientHttpRequestFactory());</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Apache HttpClient supports gzip encoding. To use it,
construct a <code>HttpComponentsClientHttpRequestFactory</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpClient httpClient = HttpClientBuilder.create().build();
ClientHttpRequestFactory requestFactory = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient);
RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(requestFactory);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The general callback interface is <code>RequestCallback</code> and is called when the execute
method is invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> &lt;T&gt; T execute(<span class="predefined-type">String</span> url, HttpMethod method, RequestCallback requestCallback,
        ResponseExtractor&lt;T&gt; responseExtractor, <span class="predefined-type">String</span>... uriVariables)

<span class="comment">// also has an overload with uriVariables as a Map&lt;String, String&gt;.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RequestCallback</code> interface is defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RequestCallback</span> {
 <span class="type">void</span> doWithRequest(ClientHttpRequest request) <span class="directive">throws</span> <span class="exception">IOException</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and allows you to manipulate the request headers and write to the request body. When
using the execute method you do not have to worry about any resource management, the
template will always close the request and handle any errors. Refer to the API
documentation for more information on using the execute method and the meaning of its
other method arguments.</p>
</div>
<div class="sect4">
<h5 id="rest-resttemplate-uri"><a class="anchor" href="integration.html#rest-resttemplate-uri"></a>Working with the URI</h5>
<div class="paragraph">
<p>For each of the main HTTP methods, the <code>RestTemplate</code> provides two variants that take
either a String URI template or <code>java.net.URI</code> as the first argument. When using a String
URI template, encoding is automatically applied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">restTemplate.getForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/hotel list</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting target URI is "http://example.com/hotel%20list". Alternatively you can
provide an already prepared <code>java.net.URI</code> that will be used as is. For more information
on preparing URIs or customizing how the <code>RestTemplate</code> expands URI templates, see
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-uri-building">URI Links</a> in the "Web Servlet" section.</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-template-headers"><a class="anchor" href="integration.html#rest-template-headers"></a>Dealing with request and response headers</h5>
<div class="paragraph">
<p>Besides the methods described above, the <code>RestTemplate</code> also has the <code>exchange()</code>
method, which can be used for arbitrary HTTP method execution based on the <code>HttpEntity</code>
class.</p>
</div>
<div class="paragraph">
<p>Perhaps most importantly, the <code>exchange()</code> method can be used to add request headers and
read response headers. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHeaders requestHeaders = <span class="keyword">new</span> HttpHeaders();
requestHeaders.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyRequestHeader</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyValue</span><span class="delimiter">&quot;</span></span>);
HttpEntity&lt;?&gt; requestEntity = <span class="keyword">new</span> HttpEntity(requestHeaders);

HttpEntity&lt;<span class="predefined-type">String</span>&gt; response = template.exchange(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/hotels/{hotel}</span><span class="delimiter">&quot;</span></span>,
        HttpMethod.GET, requestEntity, <span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">String</span> responseHeader = response.getHeaders().getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyResponseHeader</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> body = response.getBody();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, we first prepare a request entity that contains the
<code>MyRequestHeader</code> header. We then retrieve the response, and read the <code>MyResponseHeader</code>
and body.</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-template-jsonview"><a class="anchor" href="integration.html#rest-template-jsonview"></a>Jackson JSON Views support</h5>
<div class="paragraph">
<p>It is possible to specify a <a href="http://wiki.fasterxml.com/JacksonJsonViews">Jackson JSON View</a>
to serialize only a subset of the object properties. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MappingJacksonValue value = <span class="keyword">new</span> MappingJacksonValue(<span class="keyword">new</span> User(<span class="string"><span class="delimiter">&quot;</span><span class="content">eric</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">7!jd#h23</span><span class="delimiter">&quot;</span></span>));
value.setSerializationView(User.WithoutPasswordView.class);
HttpEntity&lt;MappingJacksonValue&gt; entity = <span class="keyword">new</span> HttpEntity&lt;MappingJacksonValue&gt;(value);
<span class="predefined-type">String</span> s = template.postForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/user</span><span class="delimiter">&quot;</span></span>, entity, <span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest-message-conversion"><a class="anchor" href="integration.html#rest-message-conversion"></a>1.10.2. HTTP Message Converters</h4>
<div class="paragraph">
<p><span class="small"><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-codecs">Same in Spring WebFlux</a></span></p>
</div>
<div class="paragraph">
<p>The <code>spring-web</code> module contains the <code>HttpMessageConverter</code> contract for reading and
writing the body of HTTP requests and responses via <code>InputStream</code> and <code>OutputStream</code>.
<code>HttpMessageConverter</code>'s are used on the client side, e.g. in the <code>RestTemplate</code>, and
also on the server side, e.g. in Spring MVC REST controllers.</p>
</div>
<div class="paragraph">
<p>Concrete implementations for the main media (mime) types are provided in the framework
and are registered by default with the <code>RestTemplate</code> on the client-side and with
<code>RequestMethodHandlerAdapter</code> on the server-side (see
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-message-converters">Configuring Message Converters</a>).</p>
</div>
<div class="paragraph">
<p>The implementations of <code>HttpMessageConverter</code>s are described in the following sections.
For all converters a default media type is used but can be overridden by setting the
<code>supportedMediaTypes</code> bean property</p>
</div>
<div class="sect4">
<h5 id="rest-string-converter"><a class="anchor" href="integration.html#rest-string-converter"></a>StringHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write Strings from the HTTP
request and response. By default, this converter supports all text media types (
<code>text/*</code>), and writes with a <code>Content-Type</code> of <code>text/plain</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-form-converter"><a class="anchor" href="integration.html#rest-form-converter"></a>FormHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write form data from the HTTP
request and response. By default, this converter reads and writes the media type
<code>application/x-www-form-urlencoded</code>. Form data is read from and written into a
<code>MultiValueMap&lt;String, String&gt;</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-byte-converter"><a class="anchor" href="integration.html#rest-byte-converter"></a>ByteArrayHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write byte arrays from the
HTTP request and response. By default, this converter supports all media types ( <code>*/*</code>),
and writes with a <code>Content-Type</code> of <code>application/octet-stream</code>. This can be overridden
by setting the <code>supportedMediaTypes</code> property, and overriding <code>getContentType(byte[])</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-marhsalling-converter"><a class="anchor" href="integration.html#rest-marhsalling-converter"></a>MarshallingHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write XML using Spring&#8217;s
<code>Marshaller</code> and <code>Unmarshaller</code> abstractions from the <code>org.springframework.oxm</code> package.
This converter requires a <code>Marshaller</code> and <code>Unmarshaller</code> before it can be used. These
can be injected via constructor or bean properties. By default this converter supports (
<code>text/xml</code>) and ( <code>application/xml</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-mapping-json-converter"><a class="anchor" href="integration.html#rest-mapping-json-converter"></a>MappingJackson2HttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write JSON using Jackson&#8217;s
<code>ObjectMapper</code>. JSON mapping can be customized as needed through the use of Jackson&#8217;s
provided annotations. When further control is needed, a custom <code>ObjectMapper</code> can be
injected through the <code>ObjectMapper</code> property for cases where custom JSON
serializers/deserializers need to be provided for specific types. By default this
converter supports ( <code>application/json</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-mapping-xml-converter"><a class="anchor" href="integration.html#rest-mapping-xml-converter"></a>MappingJackson2XmlHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write XML using
<a href="https://github.com/FasterXML/jackson-dataformat-xml">Jackson XML</a> extension&#8217;s
<code>XmlMapper</code>. XML mapping can be customized as needed through the use of JAXB
or Jackson&#8217;s provided annotations. When further control is needed, a custom <code>XmlMapper</code>
can be injected through the <code>ObjectMapper</code> property for cases where custom XML
serializers/deserializers need to be provided for specific types. By default this
converter supports ( <code>application/xml</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-source-converter"><a class="anchor" href="integration.html#rest-source-converter"></a>SourceHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write
<code>javax.xml.transform.Source</code> from the HTTP request and response. Only <code>DOMSource</code>,
<code>SAXSource</code>, and <code>StreamSource</code> are supported. By default, this converter supports (
<code>text/xml</code>) and ( <code>application/xml</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="rest-buffered-image-converter"><a class="anchor" href="integration.html#rest-buffered-image-converter"></a>BufferedImageHttpMessageConverter</h5>
<div class="paragraph">
<p>An <code>HttpMessageConverter</code> implementation that can read and write
<code>java.awt.image.BufferedImage</code> from the HTTP request and response. This converter reads
and writes the media type supported by the Java I/O API.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rest-async-resttemplate"><a class="anchor" href="integration.html#rest-async-resttemplate"></a>1.10.3. Async RestTemplate</h4>
<div class="paragraph">
<p>The <code>AsyncRestTemplate</code> is deprecated.
Please use the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-client">WebClient</a> instead.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ejb"><a class="anchor" href="integration.html#ejb"></a>2. Enterprise JavaBeans (EJB) integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ejb-introduction"><a class="anchor" href="integration.html#ejb-introduction"></a>2.1. Introduction</h3>
<div class="paragraph">
<p>As a lightweight container, Spring is often considered an EJB replacement. We do believe
that for many if not most applications and use cases, Spring as a container, combined
with its rich supporting functionality in the area of transactions, ORM and JDBC access,
is a better choice than implementing equivalent functionality via an EJB container and
EJBs.</p>
</div>
<div class="paragraph">
<p>However, it is important to note that using Spring does not prevent you from using EJBs.
In fact, Spring makes it much easier to access EJBs and implement EJBs and functionality
within them. Additionally, using Spring to access services provided by EJBs allows the
implementation of those services to later transparently be switched between local EJB,
remote EJB, or POJO (plain old Java object) variants, without the client code having to
be changed.</p>
</div>
<div class="paragraph">
<p>In this chapter, we look at how Spring can help you access and implement EJBs. Spring
provides particular value when accessing stateless session beans (SLSBs), so we&#8217;ll begin
by discussing this.</p>
</div>
</div>
<div class="sect2">
<h3 id="ejb-access"><a class="anchor" href="integration.html#ejb-access"></a>2.2. Accessing EJBs</h3>
<div class="sect3">
<h4 id="ejb-access-concepts"><a class="anchor" href="integration.html#ejb-access-concepts"></a>2.2.1. Concepts</h4>
<div class="paragraph">
<p>To invoke a method on a local or remote stateless session bean, client code must
normally perform a JNDI lookup to obtain the (local or remote) EJB Home object, then use
a 'create' method call on that object to obtain the actual (local or remote) EJB object.
One or more methods are then invoked on the EJB.</p>
</div>
<div class="paragraph">
<p>To avoid repeated low-level code, many EJB applications use the Service Locator and
Business Delegate patterns. These are better than spraying JNDI lookups throughout
client code, but their usual implementations have significant disadvantages. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Typically code using EJBs depends on Service Locator or Business Delegate singletons,
making it hard to test.</p>
</li>
<li>
<p>In the case of the Service Locator pattern used without a Business Delegate,
application code still ends up having to invoke the create() method on an EJB home,
and deal with the resulting exceptions. Thus it remains tied to the EJB API and the
complexity of the EJB programming model.</p>
</li>
<li>
<p>Implementing the Business Delegate pattern typically results in significant code
duplication, where we have to write numerous methods that simply call the same method
on the EJB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Spring approach is to allow the creation and use of proxy objects, normally
configured inside a Spring container, which act as codeless business delegates. You do
not need	to write another Service Locator, another JNDI lookup, or duplicate methods in
a hand-coded Business Delegate unless you are actually adding real value in such code.</p>
</div>
</div>
<div class="sect3">
<h4 id="ejb-access-local"><a class="anchor" href="integration.html#ejb-access-local"></a>2.2.2. Accessing local SLSBs</h4>
<div class="paragraph">
<p>Assume that we have a web controller that needs to use a local EJB. We&#8217;ll follow best
practice and use the EJB Business Methods Interface pattern, so that the EJB&#8217;s local
interface extends a non EJB-specific business methods interface. Let&#8217;s call this
business methods interface <code>MyComponent</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MyComponent</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the main reasons to use the Business Methods Interface pattern is to ensure that
synchronization between method signatures in local interface and bean implementation
class is automatic. Another reason is that it later makes it much easier for us to
switch to a POJO (plain old Java object) implementation of the service if it makes sense
to do so. Of course we&#8217;ll also need to implement the local home interface and provide an
implementation class that implements <code>SessionBean</code> and the <code>MyComponent</code> business
methods interface. Now the only Java coding we&#8217;ll need to do to hook up our web tier
controller to the EJB implementation is to expose a setter method of type <code>MyComponent</code>
on the controller. This will save the reference as an instance variable in the
controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> MyComponent myComponent;

<span class="directive">public</span> <span class="type">void</span> setMyComponent(MyComponent myComponent) {
    <span class="local-variable">this</span>.myComponent = myComponent;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can subsequently use this instance variable in any business method in the controller.
Now assuming we are obtaining our controller object out of a Spring container, we can
(in the same context) configure a <code>LocalStatelessSessionProxyFactoryBean</code> instance,
which will be the EJB proxy object. The configuration of the proxy, and setting of the
<code>myComponent</code> property of the controller is done with a configuration entry such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/myBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycom.MyComponent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycom.myController</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a lot of work happening behind the scenes, courtesy of the Spring AOP framework,
although you aren&#8217;t forced to work with AOP concepts to enjoy the results. The
<code>myComponent</code> bean definition creates a proxy for the EJB, which implements the business
method interface. The EJB local home is cached on startup, so there&#8217;s only a single JNDI
lookup. Each time the EJB is invoked, the proxy invokes the <code>classname</code> method on the
local EJB and invokes the	corresponding business method on the EJB.</p>
</div>
<div class="paragraph">
<p>The <code>myController</code> bean definition sets the <code>myComponent</code> property of the controller
class to the EJB proxy.</p>
</div>
<div class="paragraph">
<p>Alternatively (and preferably in case of many such proxy definitions), consider using
the <code>&lt;jee:local-slsb&gt;</code> configuration element in Spring&#8217;s "jee" namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:local-slsb</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/myBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">business-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycom.MyComponent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycom.myController</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myComponent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This EJB access mechanism delivers huge simplification of application code: the web tier
code (or other EJB client code) has no dependence on the use of EJB. If we want to
replace this EJB reference with a POJO or a mock object or other test stub, we could
simply change the <code>myComponent</code> bean definition without changing a line of Java code.
Additionally, we haven&#8217;t had to write a single line of JNDI lookup or other EJB plumbing
code as part of our application.</p>
</div>
<div class="paragraph">
<p>Benchmarks and experience in real applications indicate that the performance overhead of
this approach (which involves reflective invocation of the target EJB) is minimal, and
is typically undetectable in typical use. Remember that we don&#8217;t want to make
fine-grained calls to EJBs anyway, as there&#8217;s a cost associated with the EJB
infrastructure in the application server.</p>
</div>
<div class="paragraph">
<p>There is one caveat with regards to the JNDI lookup. In a bean container, this class is
normally best used as a singleton (there simply is no reason to make it a prototype).
However, if that bean container pre-instantiates singletons (as do the various XML
<code>ApplicationContext</code> variants) you may have a problem if the bean container is loaded
before the EJB container loads the target EJB. That is because the JNDI lookup will be
performed in the <code>init()</code> method of this class and then cached, but the EJB will not
have been bound at the target location yet. The solution is to not pre-instantiate this
factory object, but allow it to be created on first use. In the XML containers, this is
controlled via the <code>lazy-init</code> attribute.</p>
</div>
<div class="paragraph">
<p>Although this will not be of interest to the majority of Spring users, those doing
programmatic AOP work with EJBs may want to look at <code>LocalSlsbInvokerInterceptor</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ejb-access-remote"><a class="anchor" href="integration.html#ejb-access-remote"></a>2.2.3. Accessing remote SLSBs</h4>
<div class="paragraph">
<p>Accessing remote EJBs is essentially identical to accessing local EJBs, except that the
<code>SimpleRemoteStatelessSessionProxyFactoryBean</code> or <code>&lt;jee:remote-slsb&gt;</code> configuration
element is used. Of course, with or without Spring, remote invocation semantics apply; a
call to a method on an object in another VM in another computer does sometimes have to
be treated differently in terms of usage scenarios and failure handling.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s EJB client support adds one more advantage over the non-Spring approach.
Normally it is problematic for EJB client code to be easily switched back and forth
between calling EJBs locally or remotely. This is because the remote interface methods
must declare that they throw <code>RemoteException</code>, and client code must deal with this,
while the local interface methods don&#8217;t. Client code written for local EJBs which needs
to be moved to remote EJBs typically has to be modified to add handling for the remote
exceptions, and client code written for remote EJBs which needs to be moved to local
EJBs, can either stay the same but do a lot of unnecessary handling of remote
exceptions, or needs to be modified to remove that code. With the Spring remote EJB
proxy, you can instead not declare any thrown <code>RemoteException</code> in your Business Method
Interface and implementing EJB code, have a remote interface which is identical except
that it does throw <code>RemoteException</code>, and rely on the proxy to dynamically treat the two
interfaces as if they were the same. That is, client code does not have to deal with the
checked <code>RemoteException</code> class. Any actual <code>RemoteException</code> that is thrown during the
EJB invocation will be re-thrown as the non-checked <code>RemoteAccessException</code> class, which
is a subclass of <code>RuntimeException</code>. The target service can then be switched at will
between a local EJB or remote EJB (or even plain Java object) implementation, without
the client code knowing or caring. Of course, this is optional; there is nothing
stopping you from declaring <code>RemoteExceptions</code> in your business interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="ejb-access-ejb2-ejb3"><a class="anchor" href="integration.html#ejb-access-ejb2-ejb3"></a>2.2.4. Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</h4>
<div class="paragraph">
<p>Accessing EJB 2.x Session Beans and EJB 3 Session Beans via Spring is largely
transparent. Spring&#8217;s EJB accessors, including the <code>&lt;jee:local-slsb&gt;</code> and
<code>&lt;jee:remote-slsb&gt;</code> facilities, transparently adapt to the actual component at runtime.
They handle a home interface if found (EJB 2.x style), or perform straight component
invocations if no home interface is available (EJB 3 style).</p>
</div>
<div class="paragraph">
<p>Note: For EJB 3 Session Beans, you could effectively use a <code>JndiObjectFactoryBean</code> /
<code>&lt;jee:jndi-lookup&gt;</code> as well, since fully usable component references are exposed for
plain JNDI lookups there. Defining explicit <code>&lt;jee:local-slsb&gt;</code> / <code>&lt;jee:remote-slsb&gt;</code>
lookups simply provides consistent and more explicit EJB access configuration.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms"><a class="anchor" href="integration.html#jms"></a>3. JMS (Java Message Service)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="jms-introduction"><a class="anchor" href="integration.html#jms-introduction"></a>3.1. Introduction</h3>
<div class="paragraph">
<p>Spring provides a JMS integration framework that simplifies the use of the JMS API much
like Spring&#8217;s integration does for the JDBC API.</p>
</div>
<div class="paragraph">
<p>JMS can be roughly divided into two areas of functionality, namely the production and
consumption of messages. The <code>JmsTemplate</code> class is used for message production and
synchronous message reception. For asynchronous reception similar to Java EE&#8217;s
message-driven bean style, Spring provides a number of message listener containers that
are used to create Message-Driven POJOs (MDPs). Spring also provides a declarative way
of creating message listeners.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.core</code> provides the core functionality for using
JMS. It contains JMS template classes that simplify the use of the JMS by handling the
creation and release of resources, much like the <code>JdbcTemplate</code> does for JDBC. The
design principle common to Spring template classes is to provide helper methods to
perform common operations and for more sophisticated usage, delegate the essence of the
processing task to user implemented callback interfaces. The JMS template follows the
same design. The classes offer various convenience methods for the sending of messages,
consuming a message synchronously, and exposing the JMS session and message producer to
the user.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support</code> provides <code>JMSException</code> translation
functionality. The translation converts the checked <code>JMSException</code> hierarchy to a
mirrored hierarchy of unchecked exceptions. If there are any provider specific
subclasses of the checked <code>javax.jms.JMSException</code>, this exception is wrapped in the
unchecked <code>UncategorizedJmsException</code>.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support.converter</code> provides a <code>MessageConverter</code>
abstraction to convert between Java objects and JMS messages.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.support.destination</code> provides various strategies
for managing JMS destinations, such as providing a service locator for destinations
stored in JNDI.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.annotation</code> provides the necessary infrastructure
to support annotation-driven listener endpoints using <code>@JmsListener</code>.</p>
</div>
<div class="paragraph">
<p>The package <code>org.springframework.jms.config</code> provides the parser implementation for the
<code>jms</code> namespace as well the java config support to configure listener containers and
create listener endpoints.</p>
</div>
<div class="paragraph">
<p>Finally, the package <code>org.springframework.jms.connection</code> provides an implementation of
the <code>ConnectionFactory</code> suitable for use in standalone applications. It also contains an
implementation of Spring&#8217;s <code>PlatformTransactionManager</code> for JMS (the cunningly named
<code>JmsTransactionManager</code>). This allows for seamless integration of JMS as a transactional
resource into Spring&#8217;s transaction management mechanisms.</p>
</div>
</div>
<div class="sect2">
<h3 id="jms-using"><a class="anchor" href="integration.html#jms-using"></a>3.2. Using Spring JMS</h3>
<div class="sect3">
<h4 id="jms-jmstemplate"><a class="anchor" href="integration.html#jms-jmstemplate"></a>3.2.1. JmsTemplate</h4>
<div class="paragraph">
<p>The <code>JmsTemplate</code> class is the central class in the JMS core package. It simplifies the
use of JMS since it handles the creation and release of resources when sending or
synchronously receiving messages.</p>
</div>
<div class="paragraph">
<p>Code that uses the <code>JmsTemplate</code> only needs to implement callback interfaces giving them
a clearly defined high level contract. The <code>MessageCreator</code> callback interface creates a
message given a <code>Session</code> provided by the calling code in <code>JmsTemplate</code>. In order to
allow for more complex usage of the JMS API, the callback <code>SessionCallback</code> provides the
user with the JMS session and the callback <code>ProducerCallback</code> exposes a <code>Session</code> and
<code>MessageProducer</code> pair.</p>
</div>
<div class="paragraph">
<p>The JMS API exposes two types of send methods, one that takes delivery mode, priority,
and time-to-live as Quality of Service (QOS) parameters and one that takes no QOS
parameters which uses default values. Since there are many send methods in
<code>JmsTemplate</code>, the setting of the QOS parameters have been exposed as bean properties to
avoid duplication in the number of send methods. Similarly, the timeout value for
synchronous receive calls is set using the property <code>setReceiveTimeout</code>.</p>
</div>
<div class="paragraph">
<p>Some JMS providers allow the setting of default QOS values administratively through the
configuration of the <code>ConnectionFactory</code>. This has the effect that a call to
<code>MessageProducer</code>'s send method <code>send(Destination destination, Message message)</code> will
use different QOS default values than those specified in the JMS specification. In order
to provide consistent management of QOS values, the <code>JmsTemplate</code> must therefore be
specifically enabled to use its own QOS values by setting the boolean property
<code>isExplicitQosEnabled</code> to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For convenience, <code>JmsTemplate</code> also exposes a basic request-reply operation that allows
to send a message and wait for a reply on a temporary queue that is created as part of
the operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instances of the <code>JmsTemplate</code> class are <em>thread-safe once configured</em>. This is
important because it means that you can configure a single instance of a <code>JmsTemplate</code>
and then safely inject this <em>shared</em> reference into multiple collaborators. To be
clear, the <code>JmsTemplate</code> is stateful, in that it maintains a reference to a
<code>ConnectionFactory</code>, but this state is <em>not</em> conversational state.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As of Spring Framework 4.1, <code>JmsMessagingTemplate</code> is built on top of <code>JmsTemplate</code>
and provides an integration with the messaging abstraction, i.e.
<code>org.springframework.messaging.Message</code>. This allows you to create the message to
send in generic manner.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-connections"><a class="anchor" href="integration.html#jms-connections"></a>3.2.2. Connections</h4>
<div class="paragraph">
<p>The <code>JmsTemplate</code> requires a reference to a <code>ConnectionFactory</code>. The <code>ConnectionFactory</code>
is part of the JMS specification and serves as the entry point for working with JMS. It
is used by the client application as a factory to create connections with the JMS
provider and encapsulates various configuration parameters, many of which are vendor
specific such as SSL configuration options.</p>
</div>
<div class="paragraph">
<p>When using JMS inside an EJB, the vendor provides implementations of the JMS interfaces
so that they can participate in declarative transaction management and perform pooling
of connections and sessions. In order to use this implementation, Java EE containers
typically require that you declare a JMS connection factory as a <code>resource-ref</code> inside
the EJB or servlet deployment descriptors. To ensure the use of these features with the
<code>JmsTemplate</code> inside an EJB, the client application should ensure that it references the
managed implementation of the <code>ConnectionFactory</code>.</p>
</div>
<div class="sect4">
<h5 id="jms-caching-resources"><a class="anchor" href="integration.html#jms-caching-resources"></a>Caching Messaging Resources</h5>
<div class="paragraph">
<p>The standard API involves creating many intermediate objects. To send a message the
following 'API' walk is performed</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ConnectionFactory-&gt;Connection-&gt;Session-&gt;MessageProducer-&gt;send</pre>
</div>
</div>
<div class="paragraph">
<p>Between the ConnectionFactory and the Send operation there are three intermediate
objects that are created and destroyed. To optimise the resource usage and increase
performance two implementations of <code>ConnectionFactory</code> are provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="jms-connection-factory"><a class="anchor" href="integration.html#jms-connection-factory"></a>SingleConnectionFactory</h5>
<div class="paragraph">
<p>Spring provides an implementation of the <code>ConnectionFactory</code> interface,
<code>SingleConnectionFactory</code>, that will return the same <code>Connection</code> on all
<code>createConnection()</code> calls and ignore calls to <code>close()</code>. This is useful for testing and
standalone environments so that the same connection can be used for multiple
<code>JmsTemplate</code> calls that may span any number of transactions. <code>SingleConnectionFactory</code>
takes a reference to a standard <code>ConnectionFactory</code> that would typically come from JNDI.</p>
</div>
</div>
<div class="sect4">
<h5 id="jdbc-connection-factory-caching"><a class="anchor" href="integration.html#jdbc-connection-factory-caching"></a>CachingConnectionFactory</h5>
<div class="paragraph">
<p>The <code>CachingConnectionFactory</code> extends the functionality of <code>SingleConnectionFactory</code>
and adds the caching of Sessions, MessageProducers, and MessageConsumers. The initial
cache size is set to 1, use the property <code>sessionCacheSize</code> to increase the number of
cached sessions. Note that the number of actual cached sessions will be more than that
number as sessions are cached based on their acknowledgment mode, so there can be up to
4 cached session instances when <code>sessionCacheSize</code> is set to one, one for each
acknowledgment mode. MessageProducers and MessageConsumers are cached within their
owning session and also take into account the unique properties of the producers and
consumers when caching. MessageProducers are cached based on their destination.
MessageConsumers are cached based on a key composed of the destination, selector,
noLocal delivery flag, and the durable subscription name (if creating durable consumers).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-destinations"><a class="anchor" href="integration.html#jms-destinations"></a>3.2.3. Destination Management</h4>
<div class="paragraph">
<p>Destinations, like ConnectionFactories, are JMS administered objects that can be stored
and retrieved in JNDI. When configuring a Spring application context you can use the
JNDI factory class <code>JndiObjectFactoryBean</code> / <code>&lt;jee:jndi-lookup&gt;</code> to perform dependency
injection on your object&#8217;s references to JMS destinations. However, often this strategy
is cumbersome if there are a large number of destinations in the application or if there
are advanced destination management features unique to the JMS provider. Examples of
such advanced destination management would be the creation of dynamic destinations or
support for a hierarchical namespace of destinations. The <code>JmsTemplate</code> delegates the
resolution of a destination name to a JMS destination object to an implementation of the
interface <code>DestinationResolver</code>. <code>DynamicDestinationResolver</code> is the default
implementation used by <code>JmsTemplate</code> and accommodates resolving dynamic destinations. A
<code>JndiDestinationResolver</code> is also provided that acts as a service locator for
destinations contained in JNDI and optionally falls back to the behavior contained in
<code>DynamicDestinationResolver</code>.</p>
</div>
<div class="paragraph">
<p>Quite often the destinations used in a JMS application are only known at runtime and
therefore cannot be administratively created when the application is deployed. This is
often because there is shared application logic between interacting system components
that create destinations at runtime according to a well-known naming convention. Even
though the creation of dynamic destinations is not part of the JMS specification, most
vendors have provided this functionality. Dynamic destinations are created with a name
defined by the user which differentiates them from temporary destinations and are often
not registered in JNDI. The API used to create dynamic destinations varies from provider
to provider since the properties associated with the destination are vendor specific.
However, a simple implementation choice that is sometimes made by vendors is to
disregard the warnings in the JMS specification and to use the <code>TopicSession</code> method
<code>createTopic(String topicName)</code> or the <code>QueueSession</code> method <code>createQueue(String
queueName)</code> to create a new destination with default destination properties. Depending
on the vendor implementation, <code>DynamicDestinationResolver</code> may then also create a
physical destination instead of only resolving one.</p>
</div>
<div class="paragraph">
<p>The boolean property <code>pubSubDomain</code> is used to configure the <code>JmsTemplate</code> with
knowledge of what JMS domain is being used. By default the value of this property is
false, indicating that the point-to-point domain, Queues, will be used. This property
used by <code>JmsTemplate</code> determines the behavior of dynamic destination resolution via
implementations of the <code>DestinationResolver</code> interface.</p>
</div>
<div class="paragraph">
<p>You can also configure the <code>JmsTemplate</code> with a default destination via the property
<code>defaultDestination</code>. The default destination will be used with send and receive
operations that do not refer to a specific destination.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-mdp"><a class="anchor" href="integration.html#jms-mdp"></a>3.2.4. Message Listener Containers</h4>
<div class="paragraph">
<p>One of the most common uses of JMS messages in the EJB world is to drive message-driven
beans (MDBs). Spring offers a solution to create message-driven POJOs (MDPs) in a way
that does not tie a user to an EJB container. (See <a href="integration.html#jms-asynchronousMessageReception">Asynchronous reception: Message-Driven POJOs</a>
for detailed coverage of Spring&#8217;s MDP support.) As from Spring Framework 4.1, endpoint
methods can be simply annotated using <code>@JmsListener</code> see <a href="integration.html#jms-annotated">Annotation-driven listener endpoints</a> for more
details.</p>
</div>
<div class="paragraph">
<p>A message listener container is used to receive messages from a JMS message queue and
drive the <code>MessageListener</code> that is injected into it. The listener container is
responsible for all threading of message reception and dispatches into the listener for
processing. A message listener container is the intermediary between an MDP and a
messaging provider, and takes care of registering to receive messages, participating in
transactions, resource acquisition and release, exception conversion and suchlike. This
allows you as an application developer to write the (possibly complex) business logic
associated with receiving a message (and possibly responding to it), and delegates
boilerplate JMS infrastructure concerns to the framework.</p>
</div>
<div class="paragraph">
<p>There are two standard JMS message listener containers packaged with Spring, each with
its specialised feature set.</p>
</div>
<div class="sect4">
<h5 id="jms-mdp-simple"><a class="anchor" href="integration.html#jms-mdp-simple"></a>SimpleMessageListenerContainer</h5>
<div class="paragraph">
<p>This message listener container is the simpler of the two standard flavors. It creates a
fixed number of JMS sessions and consumers at startup, registers the listener using the
standard JMS <code>MessageConsumer.setMessageListener()</code> method, and leaves it up the JMS
provider to perform listener callbacks. This variant does not allow for dynamic adaption
to runtime demands or for participation in externally managed transactions.
Compatibility-wise, it stays very close to the spirit of the standalone JMS
specification - but is generally not compatible with Java EE&#8217;s JMS restrictions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While <code>SimpleMessageListenerContainer</code> does not allow for the participation in externally
managed transactions, it does support native JMS transactions: simply switch the
'sessionTransacted' flag to 'true' or, in the namespace, set the 'acknowledge' attribute
to 'transacted': Exceptions thrown from your listener will lead to a rollback then, with
the message getting redelivered. Alternatively, consider using 'CLIENT_ACKNOWLEDGE' mode
which provides redelivery in case of an exception as well but does not use transacted
Sessions and therefore does not include any other Session operations (such as sending
response messages) in the transaction protocol.</p>
</div>
<div class="paragraph">
<p><strong>The default 'AUTO_ACKNOWLEDGE' mode does not provide proper reliability guarantees.</strong>
Messages may get lost when listener execution fails (since the provider will automatically
acknowledge each message after listener invocation, with no exceptions to be propagated to
the provider) or when the listener container shuts down (this may be configured through
the 'acceptMessagesWhileStopping' flag). Make sure to use transacted sessions in case of
reliability needs, e.g. for reliable queue handling and durable topic subscriptions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jms-mdp-default"><a class="anchor" href="integration.html#jms-mdp-default"></a>DefaultMessageListenerContainer</h5>
<div class="paragraph">
<p>This message listener container is the one used in most cases. In contrast to
<code>SimpleMessageListenerContainer</code>, this container variant allows for dynamic adaptation
to runtime demands and is able to participate in externally managed transactions. Each
received message is registered with an XA transaction when configured with a
<code>JtaTransactionManager</code>; so processing may take advantage of XA transaction semantics.
This listener container strikes a good balance between low requirements on the JMS
provider, advanced functionality such as the participation in externally managed
transactions, and compatibility with Java EE environments.</p>
</div>
<div class="paragraph">
<p>The cache level of the container can be customized. Note that when no caching is enabled,
a new connection and a new session is created for each message reception. Combining this
with a non durable subscription with high loads may lead to message lost. Make sure to
use a proper cache level in such case.</p>
</div>
<div class="paragraph">
<p>This container also has recoverable capabilities when the broker goes down. By default,
a simple <code>BackOff</code> implementation retries every 5 seconds. It is possible to specify
a custom <code>BackOff</code> implementation for more fine-grained recovery options, see
<code>ExponentialBackOff</code> for an example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Like its sibling <code>SimpleMessageListenerContainer</code>, <code>DefaultMessageListenerContainer</code>
supports native JMS transactions and also allows for customizing the acknowledgment mode.
This is strongly recommended over externally managed transactions if feasible for your
scenario: that is, if you can live with occasional duplicate messages in case of the
JVM dying. Custom duplicate message detection steps in your business logic may cover
such situations, e.g. in the form of a business entity existence check or a protocol
table check. Any such arrangements will be significantly more efficient than the
alternative: wrapping your entire processing with an XA transaction (through configuring
your <code>DefaultMessageListenerContainer</code> with an <code>JtaTransactionManager</code>), covering the
reception of the JMS message as well as the execution of the business logic in your
message listener (including database operations etc).</p>
</div>
<div class="paragraph">
<p><strong>The default 'AUTO_ACKNOWLEDGE' mode does not provide proper reliability guarantees.</strong>
Messages may get lost when listener execution fails (since the provider will automatically
acknowledge each message before listener invocation) or when the listener container shuts
down (this may be configured through the 'acceptMessagesWhileStopping' flag). Make sure
to use transacted sessions in case of reliability needs, e.g. for reliable queue handling
and durable topic subscriptions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-tx"><a class="anchor" href="integration.html#jms-tx"></a>3.2.5. Transaction management</h4>
<div class="paragraph">
<p>Spring provides a <code>JmsTransactionManager</code> that manages transactions for a single JMS
<code>ConnectionFactory</code>. This allows JMS applications to leverage the managed transaction
features of Spring as described in <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">Transaction Management</a>.
The <code>JmsTransactionManager</code> performs local resource transactions, binding a JMS
Connection/Session pair from the specified <code>ConnectionFactory</code> to the thread.
<code>JmsTemplate</code> automatically detects such transactional resources and operates
on them accordingly.</p>
</div>
<div class="paragraph">
<p>In a Java EE environment, the <code>ConnectionFactory</code> will pool Connections and Sessions, so
those resources are efficiently reused across transactions. In a standalone environment,
using Spring&#8217;s <code>SingleConnectionFactory</code> will result in a shared JMS <code>Connection</code>, with
each transaction having its own independent <code>Session</code>. Alternatively, consider the use
of a provider-specific pooling adapter such as ActiveMQ&#8217;s <code>PooledConnectionFactory</code>
class.</p>
</div>
<div class="paragraph">
<p><code>JmsTemplate</code> can also be used with the <code>JtaTransactionManager</code> and an XA-capable JMS
<code>ConnectionFactory</code> for performing distributed transactions. Note that this requires the
use of a JTA transaction manager as well as a properly XA-configured ConnectionFactory!
(Check your Java EE server&#8217;s / JMS provider&#8217;s documentation.)</p>
</div>
<div class="paragraph">
<p>Reusing code across a managed and unmanaged transactional environment can be confusing
when using the JMS API to create a <code>Session</code> from a <code>Connection</code>. This is because the
JMS API has only one factory method to create a <code>Session</code> and it requires values for the
transaction and acknowledgment modes. In a managed environment, setting these values is
the responsibility of the environment&#8217;s transactional infrastructure, so these values
are ignored by the vendor&#8217;s wrapper to the JMS Connection. When using the <code>JmsTemplate</code>
in an unmanaged environment you can specify these values through the use of the
properties <code>sessionTransacted</code> and <code>sessionAcknowledgeMode</code>. When using a
<code>PlatformTransactionManager</code> with <code>JmsTemplate</code>, the template will always be given a
transactional JMS <code>Session</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-sending"><a class="anchor" href="integration.html#jms-sending"></a>3.3. Sending a Message</h3>
<div class="paragraph">
<p>The <code>JmsTemplate</code> contains many convenience methods to send a message. There are send
methods that specify the destination using a <code>javax.jms.Destination</code> object and those
that specify the destination using a string for use in a JNDI lookup. The send method
that takes no destination argument uses the default destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.jms.ConnectionFactory</span>;
<span class="keyword">import</span> <span class="include">javax.jms.JMSException</span>;
<span class="keyword">import</span> <span class="include">javax.jms.Message</span>;
<span class="keyword">import</span> <span class="include">javax.jms.Queue</span>;
<span class="keyword">import</span> <span class="include">javax.jms.Session</span>;

<span class="keyword">import</span> <span class="include">org.springframework.jms.core.MessageCreator</span>;
<span class="keyword">import</span> <span class="include">org.springframework.jms.core.JmsTemplate</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JmsQueueSender</span> {

    <span class="directive">private</span> JmsTemplate jmsTemplate;
    <span class="directive">private</span> <span class="predefined-type">Queue</span> queue;

    <span class="directive">public</span> <span class="type">void</span> setConnectionFactory(ConnectionFactory cf) {
        <span class="local-variable">this</span>.jmsTemplate = <span class="keyword">new</span> JmsTemplate(cf);
    }

    <span class="directive">public</span> <span class="type">void</span> setQueue(<span class="predefined-type">Queue</span> queue) {
        <span class="local-variable">this</span>.queue = queue;
    }

    <span class="directive">public</span> <span class="type">void</span> simpleSend() {
        <span class="local-variable">this</span>.jmsTemplate.send(<span class="local-variable">this</span>.queue, <span class="keyword">new</span> MessageCreator() {
            <span class="directive">public</span> Message createMessage(Session session) <span class="directive">throws</span> JMSException {
                <span class="keyword">return</span> session.createTextMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello queue world</span><span class="delimiter">&quot;</span></span>);
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the <code>MessageCreator</code> callback to create a text message from the
supplied <code>Session</code> object. The <code>JmsTemplate</code> is constructed by passing a reference to a
<code>ConnectionFactory</code>. As an alternative, a zero argument constructor and
<code>connectionFactory</code> is provided and can be used for constructing the instance in
JavaBean style (using a BeanFactory or plain Java code). Alternatively, consider
deriving from Spring&#8217;s <code>JmsGatewaySupport</code> convenience base class, which provides
pre-built bean properties for JMS configuration.</p>
</div>
<div class="paragraph">
<p>The method <code>send(String destinationName, MessageCreator creator)</code> lets you send a
message using the string name of the destination. If these names are registered in JNDI,
you should set the <code>destinationResolver</code> property of the template to an instance of
<code>JndiDestinationResolver</code>.</p>
</div>
<div class="paragraph">
<p>If you created the <code>JmsTemplate</code> and specified a default destination, the
<code>send(MessageCreator c)</code> sends a message to that destination.</p>
</div>
<div class="sect3">
<h4 id="jms-msg-conversion"><a class="anchor" href="integration.html#jms-msg-conversion"></a>3.3.1. Using Message Converters</h4>
<div class="paragraph">
<p>In order to facilitate the sending of domain model objects, the <code>JmsTemplate</code> has
various send methods that take a Java object as an argument for a message&#8217;s data
content. The overloaded methods <code>convertAndSend()</code> and <code>receiveAndConvert()</code> in
<code>JmsTemplate</code> delegate the conversion process to an instance of the <code>MessageConverter</code>
interface. This interface defines a simple contract to convert between Java objects and
JMS messages. The default implementation <code>SimpleMessageConverter</code> supports conversion
between <code>String</code> and <code>TextMessage</code>, <code>byte[]</code> and <code>BytesMesssage</code>, and <code>java.util.Map</code>
and <code>MapMessage</code>. By using the converter, you and your application code can focus on the
business object that is being sent or received via JMS and not be concerned with the
details of how it is represented as a JMS message.</p>
</div>
<div class="paragraph">
<p>The sandbox currently includes a <code>MapMessageConverter</code> which uses reflection to convert
between a JavaBean and a <code>MapMessage</code>. Other popular implementation choices you might
implement yourself are Converters that use an existing XML marshalling package, such as
JAXB, Castor or XStream, to create a <code>TextMessage</code> representing the object.</p>
</div>
<div class="paragraph">
<p>To accommodate the setting of a message&#8217;s properties, headers, and body that can not be
generically encapsulated inside a converter class, the <code>MessagePostProcessor</code> interface
gives you access to the message after it has been converted, but before it is sent. The
example below demonstrates how to modify a message header and a property after a
<code>java.util.Map</code> is converted to a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> sendWithConversion() {
    <span class="predefined-type">Map</span> map = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();
    map.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mark</span><span class="delimiter">&quot;</span></span>);
    map.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Age</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Integer</span>(<span class="integer">47</span>));
    jmsTemplate.convertAndSend(<span class="string"><span class="delimiter">&quot;</span><span class="content">testQueue</span><span class="delimiter">&quot;</span></span>, map, <span class="keyword">new</span> MessagePostProcessor() {
        <span class="directive">public</span> Message postProcessMessage(Message message) <span class="directive">throws</span> JMSException {
            message.setIntProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">AccountID</span><span class="delimiter">&quot;</span></span>, <span class="integer">1234</span>);
            message.setJMSCorrelationID(<span class="string"><span class="delimiter">&quot;</span><span class="content">123-00001</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> message;
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in a message of the form:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>MapMessage={
    Header={
        ... standard headers ...
        CorrelationID={123-00001}
    }
    Properties={
        AccountID={Integer:1234}
    }
    Fields={
        Name={String:Mark}
        Age={Integer:47}
    }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-callbacks"><a class="anchor" href="integration.html#jms-callbacks"></a>3.3.2. SessionCallback and ProducerCallback</h4>
<div class="paragraph">
<p>While the send operations cover many common usage scenarios, there are cases when you
want to perform multiple operations on a JMS <code>Session</code> or <code>MessageProducer</code>. The
<code>SessionCallback</code> and <code>ProducerCallback</code> expose the JMS <code>Session</code> and <code>Session</code> /
<code>MessageProducer</code> pair respectively. The <code>execute()</code> methods on <code>JmsTemplate</code> execute
these callback methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-receiving"><a class="anchor" href="integration.html#jms-receiving"></a>3.4. Receiving a message</h3>
<div class="sect3">
<h4 id="jms-receiving-sync"><a class="anchor" href="integration.html#jms-receiving-sync"></a>3.4.1. Synchronous reception</h4>
<div class="paragraph">
<p>While JMS is typically associated with asynchronous processing, it is possible to
consume messages synchronously. The overloaded <code>receive(..)</code> methods provide this
functionality. During a synchronous receive, the calling thread blocks until a message
becomes available. This can be a dangerous operation since the calling thread can
potentially be blocked indefinitely. The property <code>receiveTimeout</code> specifies how long
the receiver should wait before giving up waiting for a message.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-asynchronousMessageReception"><a class="anchor" href="integration.html#jms-asynchronousMessageReception"></a>3.4.2. Asynchronous reception: Message-Driven POJOs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring also supports annotated-listener endpoints through the use of the <code>@JmsListener</code>
annotation and provides an open infrastructure to register endpoints programmatically. This
is by far the most convenient way to setup an asynchronous receiver, see
<a href="integration.html#jms-annotated-support">Enable listener endpoint annotations</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB world, the Message-Driven
POJO (MDP) acts as a receiver for JMS messages. The one restriction (but see also below
for the discussion of the <code>MessageListenerAdapter</code> class) on an MDP is that it must
implement the <code>javax.jms.MessageListener</code> interface. Please also be aware that in the
case where your POJO will be receiving messages on multiple threads, it is important to
ensure that your implementation is thread-safe.</p>
</div>
<div class="paragraph">
<p>Below is a simple implementation of an MDP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.jms.JMSException</span>;
<span class="keyword">import</span> <span class="include">javax.jms.Message</span>;
<span class="keyword">import</span> <span class="include">javax.jms.MessageListener</span>;
<span class="keyword">import</span> <span class="include">javax.jms.TextMessage</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleListener</span> <span class="directive">implements</span> MessageListener {

    <span class="directive">public</span> <span class="type">void</span> onMessage(Message message) {
        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) {
            <span class="keyword">try</span> {
                <span class="predefined-type">System</span>.out.println(((TextMessage) message).getText());
            }
            <span class="keyword">catch</span> (JMSException ex) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(ex);
            }
        }
        <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message must be of type TextMessage</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve implemented your <code>MessageListener</code>, it&#8217;s time to create a message listener
container.</p>
</div>
<div class="paragraph">
<p>Find below an example of how to define and configure one of the message listener
containers that ships with Spring (in this case the <code>DefaultMessageListenerContainer</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsexample.ExampleListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="comment">&lt;!-- and this is the message listener container --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsContainer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.DefaultMessageListenerContainer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <strong><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></strong>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the Spring javadocs of the various message listener containers for a full
description of the features supported by each implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-receiving-async-session-aware-message-listener"><a class="anchor" href="integration.html#jms-receiving-async-session-aware-message-listener"></a>3.4.3. SessionAwareMessageListener interface</h4>
<div class="paragraph">
<p>The <code>SessionAwareMessageListener</code> interface is a Spring-specific interface that provides
a similar contract to the JMS <code>MessageListener</code> interface, but also provides the message
handling method with access to the JMS <code>Session</code> from which the <code>Message</code> was received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.jms.listener</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">SessionAwareMessageListener</span> {

    <span class="type">void</span> onMessage(Message message, Session session) <span class="directive">throws</span> JMSException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose to have your MDPs implement this interface (in preference to the standard
JMS <code>MessageListener</code> interface) if you want your MDPs to be able to respond to any
received messages (using the <code>Session</code> supplied in the <code>onMessage(Message, Session)</code>
method). All of the message listener container implementations that ship with Spring
have support for MDPs that implement either the <code>MessageListener</code> or
<code>SessionAwareMessageListener</code> interface. Classes that implement the
<code>SessionAwareMessageListener</code> come with the caveat that they are then tied to Spring
through the interface. The choice of whether or not to use it is left entirely up to you
as an application developer or architect.</p>
</div>
<div class="paragraph">
<p>Please note that the <code>'onMessage(..)'</code> method of the <code>SessionAwareMessageListener</code>
interface throws <code>JMSException</code>. In contrast to the standard JMS <code>MessageListener</code>
interface, when using the <code>SessionAwareMessageListener</code> interface, it is the
responsibility of the client code to handle any exceptions thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-receiving-async-message-listener-adapter"><a class="anchor" href="integration.html#jms-receiving-async-message-listener-adapter"></a>3.4.4. MessageListenerAdapter</h4>
<div class="paragraph">
<p>The <code>MessageListenerAdapter</code> class is the final component in Spring&#8217;s asynchronous
messaging support: in a nutshell, it allows you to expose almost <em>any</em> class as a MDP
(there are of course some constraints).</p>
</div>
<div class="paragraph">
<p>Consider the following interface definition. Notice that although the interface extends
neither the <code>MessageListener</code> nor <code>SessionAwareMessageListener</code> interfaces, it can still
be used as a MDP via the use of the <code>MessageListenerAdapter</code> class. Notice also how the
various message handling methods are strongly typed according to the <em>contents</em> of the
various <code>Message</code> types that they can receive and handle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MessageDelegate</span> {

    <span class="type">void</span> handleMessage(<span class="predefined-type">String</span> message);

    <span class="type">void</span> handleMessage(<span class="predefined-type">Map</span> message);

    <span class="type">void</span> handleMessage(<span class="type">byte</span><span class="type">[]</span> message);

    <span class="type">void</span> handleMessage(<span class="predefined-type">Serializable</span> message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultMessageDelegate</span> <span class="directive">implements</span> MessageDelegate {
    <span class="comment">// implementation elided for clarity...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In particular, note how the above implementation of the <code>MessageDelegate</code> interface (the
above <code>DefaultMessageDelegate</code> class) has <em>no</em> JMS dependencies at all. It truly is a
POJO that we will make into an MDP via the following configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span>
<strong><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.adapter.MessageListenerAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsexample.DefaultMessageDelegate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/constructor-arg&gt;</span>
<span class="tag">&lt;/bean&gt;</span></strong>

<span class="comment">&lt;!-- and this is the message listener container... --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsContainer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.DefaultMessageListenerContainer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <strong><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></strong>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is an example of another MDP that can only handle the receiving of JMS
<code>TextMessage</code> messages. Notice how the message handling method is actually called
<code>'receive'</code> (the name of the message handling method in a <code>MessageListenerAdapter</code>
defaults to <code>'handleMessage'</code>), but it is configurable (as you will see below). Notice
also how the <code>'receive(..)'</code> method is strongly typed to receive and respond only to JMS
<code>TextMessage</code> messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TextMessageDelegate</span> {

    <span class="type">void</span> receive(TextMessage message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultTextMessageDelegate</span> <span class="directive">implements</span> TextMessageDelegate {
    <span class="comment">// implementation elided for clarity...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the attendant <code>MessageListenerAdapter</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.adapter.MessageListenerAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsexample.DefaultTextMessageDelegate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/constructor-arg&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultListenerMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">receive</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- we don't want automatic message context extraction --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;null</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that if the above <code>'messageListener'</code> receives a JMS <code>Message</code> of a type
other than <code>TextMessage</code>, an <code>IllegalStateException</code> will be thrown (and subsequently
swallowed). Another of the capabilities of the <code>MessageListenerAdapter</code> class is the
ability to automatically send back a response <code>Message</code> if a handler method returns a
non-void value. Consider the interface and class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ResponsiveTextMessageDelegate</span> {

    <span class="comment">// notice the return type...</span>
    <span class="predefined-type">String</span> receive(TextMessage message);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultResponsiveTextMessageDelegate</span> <span class="directive">implements</span> ResponsiveTextMessageDelegate {
    <span class="comment">// implementation elided for clarity...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the above <code>DefaultResponsiveTextMessageDelegate</code> is used in conjunction with a
<code>MessageListenerAdapter</code> then any non-null value that is returned from the execution of
the <code>'receive(..)'</code> method will (in the default configuration) be converted into a
<code>TextMessage</code>. The resulting <code>TextMessage</code> will then be sent to the <code>Destination</code> (if
one exists) defined in the JMS Reply-To property of the original <code>Message</code>, or the
default <code>Destination</code> set on the <code>MessageListenerAdapter</code> (if one has been configured);
if no <code>Destination</code> is found then an <code>InvalidDestinationException</code> will be thrown (and
please note that this exception <em>will not</em> be swallowed and <em>will</em> propagate up the
call stack).</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-tx-participation"><a class="anchor" href="integration.html#jms-tx-participation"></a>3.4.5. Processing messages within transactions</h4>
<div class="paragraph">
<p>Invoking a message listener within a transaction only requires reconfiguration of the
listener container.</p>
</div>
<div class="paragraph">
<p>Local resource transactions can simply be activated through the <code>sessionTransacted</code> flag
on the listener container definition. Each message listener invocation will then operate
within an active JMS transaction, with message reception rolled back in case of listener
execution failure. Sending a response message (via <code>SessionAwareMessageListener</code>) will
be part of the same local transaction, but any other resource operations (such as
database access) will operate independently. This usually requires duplicate message
detection in the listener implementation, covering the case where database processing
has committed but message processing failed to commit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsContainer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.DefaultMessageListenerContainer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <strong><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionTransacted</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For participating in an externally managed transaction, you will need to configure a
transaction manager and use a listener container which supports externally managed
transactions: typically <code>DefaultMessageListenerContainer</code>.</p>
</div>
<div class="paragraph">
<p>To configure a message listener container for XA transaction participation, you&#8217;ll want
to configure a <code>JtaTransactionManager</code> (which, by default, delegates to the Java EE
server&#8217;s transaction subsystem). Note that the underlying JMS ConnectionFactory needs to
be XA-capable and properly registered with your JTA transaction coordinator! (Check your
Java EE server&#8217;s configuration of JNDI resources.) This allows message reception as well
as e.g. database access to be part of the same transaction (with unified commit
semantics, at the expense of XA transaction log overhead).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.jta.JtaTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you just need to add it to our earlier container configuration. The container will
take care of the rest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsContainer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.DefaultMessageListenerContainer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <strong><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></strong>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-jca-message-endpoint-manager"><a class="anchor" href="integration.html#jms-jca-message-endpoint-manager"></a>3.5. Support for JCA Message Endpoints</h3>
<div class="paragraph">
<p>Beginning with version 2.5, Spring also provides support for a JCA-based
<code>MessageListener</code> container. The <code>JmsMessageEndpointManager</code> will attempt to
automatically determine the <code>ActivationSpec</code> class name from the provider&#8217;s
<code>ResourceAdapter</code> class name. Therefore, it is typically possible to just provide
Spring&#8217;s generic <code>JmsActivationSpecConfig</code> as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.endpoint.JmsMessageEndpointManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activationSpecConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.endpoint.JmsActivationSpecConfig</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destinationName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myQueue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may set up a <code>JmsMessageEndpointManager</code> with a given
<code>ActivationSpec</code> object. The <code>ActivationSpec</code> object may also come from a JNDI lookup
(using <code>&lt;jee:jndi-lookup&gt;</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.listener.endpoint.JmsMessageEndpointManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">activationSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ra.ActiveMQActivationSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myQueue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.jms.Queue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Spring&#8217;s <code>ResourceAdapterFactoryBean</code>, the target <code>ResourceAdapter</code> may be
configured locally as depicted in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.ResourceAdapterFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ra.ActiveMQResourceAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">workManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.work.SimpleTaskWorkManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The specified <code>WorkManager</code> may also point to an environment-specific thread pool -
typically through <code>SimpleTaskWorkManager</code>'s "asyncTaskExecutor" property. Consider
defining a shared thread pool for all your <code>ResourceAdapter</code> instances if you happen to
use multiple adapters.</p>
</div>
<div class="paragraph">
<p>In some environments (e.g. WebLogic 9 or above), the entire <code>ResourceAdapter</code> object may
be obtained from JNDI instead (using <code>&lt;jee:jndi-lookup&gt;</code>). The Spring-based message
listeners can then interact with the server-hosted <code>ResourceAdapter</code>, also using the
server&#8217;s built-in <code>WorkManager</code>.</p>
</div>
<div class="paragraph">
<p>Please consult the javadoc for <code>JmsMessageEndpointManager</code>, <code>JmsActivationSpecConfig</code>,
and <code>ResourceAdapterFactoryBean</code> for more details.</p>
</div>
<div class="paragraph">
<p>Spring also provides a generic JCA message endpoint manager which is not tied to JMS:
<code>org.springframework.jca.endpoint.GenericMessageEndpointManager</code>. This component allows
for using any message listener type (e.g. a CCI MessageListener) and any
provider-specific ActivationSpec object. Check out your JCA provider&#8217;s documentation to
find out about the actual capabilities of your connector, and consult
<code>GenericMessageEndpointManager</code>'s javadoc for the Spring-specific configuration details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JCA-based message endpoint management is very analogous to EJB 2.1 Message-Driven Beans;
it uses the same underlying resource provider contract. Like with EJB 2.1 MDBs, any
message listener interface supported by your JCA provider can be used in the Spring
context as well. Spring nevertheless provides explicit 'convenience' support for JMS,
simply because JMS is the most common endpoint API used with the JCA endpoint management
contract.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="jms-annotated"><a class="anchor" href="integration.html#jms-annotated"></a>3.6. Annotation-driven listener endpoints</h3>
<div class="paragraph">
<p>The easiest way to receive a message asynchronously is to use the annotated listener
endpoint infrastructure. In a nutshell, it allows you to expose a method of a managed
bean as a JMS listener endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> {

    <span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> processOrder(<span class="predefined-type">String</span> data) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The idea of the example above is that whenever a message is available on the
<code>javax.jms.Destination</code> "myDestination", the <code>processOrder</code> method is invoked
accordingly (in this case, with the content of the JMS message similarly to
what the <a href="integration.html#jms-receiving-async-message-listener-adapter"><code>MessageListenerAdapter</code></a>
provides).</p>
</div>
<div class="paragraph">
<p>The annotated endpoint infrastructure creates a message listener container
behind the scenes for each annotated method, using a <code>JmsListenerContainerFactory</code>.
Such a container is not registered against the application context but can be easily
located for management purposes using the <code>JmsListenerEndpointRegistry</code> bean.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@JmsListener</code> is a <em>repeatable</em> annotation on Java 8, so it is possible to associate
several JMS destinations to the same method by adding additional <code>@JmsListener</code>
declarations to it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jms-annotated-support"><a class="anchor" href="integration.html#jms-annotated-support"></a>3.6.1. Enable listener endpoint annotations</h4>
<div class="paragraph">
<p>To enable support for <code>@JmsListener</code> annotations add <code>@EnableJms</code> to one of
your <code>@Configuration</code> classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableJms</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> DefaultJmsListenerContainerFactory jmsListenerContainerFactory() {
        DefaultJmsListenerContainerFactory factory = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory());
        factory.setDestinationResolver(destinationResolver());
        factory.setSessionTransacted(<span class="predefined-constant">true</span>);
        factory.setConcurrency(<span class="string"><span class="delimiter">&quot;</span><span class="content">3-10</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> factory;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the infrastructure looks for a bean named <code>jmsListenerContainerFactory</code>
as the source for the factory to use to create message listener containers. In this
case, and ignoring the JMS infrastructure setup, the <code>processOrder</code> method can be
invoked with a core poll size of 3 threads and a maximum pool size of 10 threads.</p>
</div>
<div class="paragraph">
<p>It is possible to customize the listener container factory to use per annotation or
an explicit default can be configured by implementing the <code>JmsListenerConfigurer</code>
interface. The default is only required if at least one endpoint is registered
without a specific container factory. See the javadoc for full details and examples.</p>
</div>
<div class="paragraph">
<p>If you prefer <a href="integration.html#jms-namespace">XML configuration</a> use the <code>&lt;jms:annotation-driven&gt;</code>
element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jms:annotation-driven</span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsListenerContainerFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jms.config.DefaultJmsListenerContainerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destinationResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destinationResolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionTransacted</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3-10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-annotated-programmatic-registration"><a class="anchor" href="integration.html#jms-annotated-programmatic-registration"></a>3.6.2. Programmatic endpoints registration</h4>
<div class="paragraph">
<p><code>JmsListenerEndpoint</code> provides a model of an JMS endpoint and is responsible for configuring
the container for that model. The infrastructure allows you to configure endpoints
programmatically in addition to the ones that are detected by the <code>JmsListener</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableJms</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> <span class="directive">implements</span> JmsListenerConfigurer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> configureJmsListeners(JmsListenerEndpointRegistrar registrar) {
        SimpleJmsListenerEndpoint endpoint = <span class="keyword">new</span> SimpleJmsListenerEndpoint();
        endpoint.setId(<span class="string"><span class="delimiter">&quot;</span><span class="content">myJmsEndpoint</span><span class="delimiter">&quot;</span></span>);
        endpoint.setDestination(<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherQueue</span><span class="delimiter">&quot;</span></span>);
        endpoint.setMessageListener(message -&gt; {
            <span class="comment">// processing</span>
        });
        registrar.registerEndpoint(endpoint);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we used <code>SimpleJmsListenerEndpoint</code> which provides the actual
<code>MessageListener</code> to invoke but you could just as well build your own endpoint variant
describing a custom invocation mechanism.</p>
</div>
<div class="paragraph">
<p>It should be noted that you could just as well skip the use of <code>@JmsListener</code> altogether
and only register your endpoints programmatically through <code>JmsListenerConfigurer</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jms-annotated-method-signature"><a class="anchor" href="integration.html#jms-annotated-method-signature"></a>3.6.3. Annotated endpoint method signature</h4>
<div class="paragraph">
<p>So far, we have been injecting a simple <code>String</code> in our endpoint but it can actually
have a very flexible method signature. Let&#8217;s rewrite it to inject the <code>Order</code> with
a custom header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> {

    <span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> processOrder(Order order, <span class="annotation">@Header</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">order_type</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> orderType) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the main elements you can inject in JMS listener endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The raw <code>javax.jms.Message</code> or any of its subclasses (provided of course that it
matches the incoming message type).</p>
</li>
<li>
<p>The <code>javax.jms.Session</code> for optional access to the native JMS API e.g. for sending
a custom reply.</p>
</li>
<li>
<p>The <code>org.springframework.messaging.Message</code> representing the incoming JMS message.
Note that this message holds both the custom and the standard headers (as defined
by <code>JmsHeaders</code>).</p>
</li>
<li>
<p><code>@Header</code>-annotated method arguments to extract a specific header value, including
standard JMS headers.</p>
</li>
<li>
<p><code>@Headers</code>-annotated argument that must also be assignable to <code>java.util.Map</code> for
getting access to all headers.</p>
</li>
<li>
<p>A non-annotated element that is not one of the supported types (i.e. <code>Message</code> and
<code>Session</code>) is considered to be the payload. You can make that explicit by annotating
the parameter with <code>@Payload</code>. You can also turn on validation by adding an extra
<code>@Valid</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ability to inject Spring&#8217;s <code>Message</code> abstraction is particularly useful to benefit
from all the information stored in the transport-specific message without relying on
transport-specific API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> processOrder(Message&lt;Order&gt; order) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Handling of method arguments is provided by <code>DefaultMessageHandlerMethodFactory</code> which can be
further customized to support additional method arguments. The conversion and validation
support can be customized there as well.</p>
</div>
<div class="paragraph">
<p>For instance, if we want to make sure our <code>Order</code> is valid before processing it, we can
annotate the payload with <code>@Valid</code> and configure the necessary validator as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableJms</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> <span class="directive">implements</span> JmsListenerConfigurer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> configureJmsListeners(JmsListenerEndpointRegistrar registrar) {
        registrar.setMessageHandlerMethodFactory(myJmsHandlerMethodFactory());
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> DefaultMessageHandlerMethodFactory myHandlerMethodFactory() {
        DefaultMessageHandlerMethodFactory factory = <span class="keyword">new</span> DefaultMessageHandlerMethodFactory();
        factory.setValidator(myValidator());
        <span class="keyword">return</span> factory;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jms-annotated-response"><a class="anchor" href="integration.html#jms-annotated-response"></a>3.6.4. Response management</h4>
<div class="paragraph">
<p>The existing support in <a href="integration.html#jms-receiving-async-message-listener-adapter">MessageListenerAdapter</a>
already allows your method to have a non-<code>void</code> return type. When that&#8217;s the case, the result of
the invocation is encapsulated in a <code>javax.jms.Message</code> sent either in the destination specified
in the <code>JMSReplyTo</code> header of the original message or in the default destination configured on
the listener. That default destination can now be set using the <code>@SendTo</code> annotation of the
messaging abstraction.</p>
</div>
<div class="paragraph">
<p>Assuming our <code>processOrder</code> method should now return an <code>OrderStatus</code>, it is possible to write it
as follow to automatically send a response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SendTo</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> OrderStatus processOrder(Order order) {
    <span class="comment">// order processing</span>
    <span class="keyword">return</span> status;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have several <code>@JmsListener</code>-annotated methods, you can also place the <code>@SendTo</code>
annotation at the class level to share a default reply destination.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to set additional headers in a transport-independent manner, you could return a
<code>Message</code> instead, something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SendTo</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Message&lt;OrderStatus&gt; processOrder(Order order) {
    <span class="comment">// order processing</span>
    <span class="keyword">return</span> MessageBuilder
            .withPayload(status)
            .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="integer">1234</span>)
            .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to compute the response destination at runtime, you can encapsulate your response
in a <code>JmsResponse</code> instance that also provides the destination to use at runtime. The previous
example can be rewritten as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">myDestination</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> JmsResponse&lt;Message&lt;OrderStatus&gt;&gt; processOrder(Order order) {
    <span class="comment">// order processing</span>
    Message&lt;OrderStatus&gt; response = MessageBuilder
            .withPayload(status)
            .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>, <span class="integer">1234</span>)
            .build();
    <span class="keyword">return</span> JmsResponse.forQueue(response, <span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally if you need to specify some QoS values for the response such as the priority or
the time to live, you can configure the <code>JmsListenerContainerFactory</code> accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableJms</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> DefaultJmsListenerContainerFactory jmsListenerContainerFactory() {
        DefaultJmsListenerContainerFactory factory = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory());
        QosSettings replyQosSettings = <span class="keyword">new</span> ReplyQosSettings();
        replyQosSettings.setPriority(<span class="integer">2</span>);
        replyQosSettings.setTimeToLive(<span class="integer">10000</span>);
        factory.setReplyQosSettings(replyQosSettings);
        <span class="keyword">return</span> factory;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-namespace"><a class="anchor" href="integration.html#jms-namespace"></a>3.7. JMS namespace support</h3>
<div class="paragraph">
<p>Spring provides an XML namespace for simplifying JMS configuration. To use the JMS
namespace elements you will need to reference the JMS schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="error"><strong></span><span class="error"></strong></span><span class="attribute-name">xmlns:jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jms</span><span class="delimiter">&quot;</span></span><span class="error"><strong></span><span class="error"></strong></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
            <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
            <span class="content"><strong>http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd</strong></span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The namespace consists of three top-level elements: <code>&lt;annotation-driven/&gt;</code>, <code>&lt;listener-container/&gt;</code>
and <code>&lt;jca-listener-container/&gt;</code>. <code>&lt;annotation-driven</code> enables the use of <a href="integration.html#jms-annotated">annotation-driven listener endpoints</a>. <code>&lt;listener-container/&gt;</code> and <code>&lt;jca-listener-container/&gt;</code>
defines shared listener container configuration and may contain <code>&lt;listener/&gt;</code> child elements. Here
is an example of a basic configuration for two listeners.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jms:listener-container&gt;</span>

    <span class="tag">&lt;jms:listener</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.orders</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">placeOrder</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;jms:listener</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.confirmations</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">confirmationLogger</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/jms:listener-container&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above is equivalent to creating two distinct listener container bean
definitions and two distinct <code>MessageListenerAdapter</code> bean definitions as demonstrated
in <a href="integration.html#jms-receiving-async-message-listener-adapter">MessageListenerAdapter</a>. In addition to the attributes shown
above, the <code>listener</code> element may contain several optional ones. The following table
describes all available attributes:</p>
</div>
<table id="jms-namespace-listener-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Attributes of the JMS &lt;listener&gt; element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bean name for the hosting listener container. If not specified, a bean name will be
automatically generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The destination name for this listener, resolved through the <code>DestinationResolver</code>
strategy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref <em>(required)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bean name of the handler object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the handler method to invoke. If the <code>ref</code> points to a <code>MessageListener</code>
or Spring <code>SessionAwareMessageListener</code>, this attribute may be omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">response-destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the default response destination to send response messages to. This will
be applied in case of a request message that does not carry a "JMSReplyTo" field. The
type of this destination will be determined by the listener-container&#8217;s
"response-destination-type" attribute. Note: This only applies to a listener method with a
return value, for which each result object will be converted into a response message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subscription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the durable subscription, if any.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional message selector for this listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of concurrent sessions/consumers to start for this listener. Can either be
a simple number indicating the maximum number (e.g. "5") or a range indicating the lower
as well as the upper limit (e.g. "3-5"). Note that a specified minimum is just a hint
and might be ignored at runtime. Default is the value provided by the container</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>&lt;listener-container/&gt;</code> element also accepts several optional attributes. This
allows for customization of the various strategies (for example, <code>taskExecutor</code> and
<code>destinationResolver</code>) as well as basic JMS settings and resource references. Using
these attributes, it is possible to define highly-customized listener containers while
still benefiting from the convenience of the namespace.</p>
</div>
<div class="paragraph">
<p>Such settings can be automatically exposed as a <code>JmsListenerContainerFactory</code> by
specifying the id of the bean to expose through the <code>factory-id</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jms:listener-container</span> <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">task-executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTaskExecutor</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destination-resolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDestinationResolver</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTransactionManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">concurrency</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;jms:listener</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.orders</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">placeOrder</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;jms:listener</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.confirmations</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">confirmationLogger</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/jms:listener-container&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes all available attributes. Consult the class-level javadocs
of the <code>AbstractMessageListenerContainer</code> and its concrete subclasses for more details
on the individual properties. The javadocs also provide a discussion of transaction
choices and message redelivery scenarios.</p>
</div>
<table id="jms-namespace-listener-container-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Attributes of the JMS &lt;listener-container&gt; element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of this listener container. Available options are: <code>default</code>, <code>simple</code>,
<code>default102</code>, or <code>simple102</code> (the default value is <code>'default'</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container-class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A custom listener container implementation class as fully qualified class name.
Default is Spring&#8217;s standard <code>DefaultMessageListenerContainer</code> or
<code>SimpleMessageListenerContainer</code>, according to the "container-type" attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">factory-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exposes the settings defined by this element as a <code>JmsListenerContainerFactory</code>
with the specified id so that they can be reused with other endpoints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the JMS <code>ConnectionFactory</code> bean (the default bean name is
<code>'connectionFactory'</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">task-executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the Spring <code>TaskExecutor</code> for the JMS listener invokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination-resolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the <code>DestinationResolver</code> strategy for resolving JMS <code>Destinations</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message-converter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the <code>MessageConverter</code> strategy for converting JMS Messages to listener
method arguments. Default is a <code>SimpleMessageConverter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error-handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an <code>ErrorHandler</code> strategy for handling any uncaught Exceptions that
may occur during the execution of the <code>MessageListener</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for this listener: <code>queue</code>, <code>topic</code>, <code>durableTopic</code>, <code>sharedTopic</code>
or <code>sharedDurableTopic</code>. This enables potentially the <code>pubSubDomain</code>, <code>subscriptionDurable</code>
and <code>subscriptionShared</code> properties of the container. The default is <code>queue</code> (i.e. disabling
those 3 properties).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">response-destination-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for responses: "queue", "topic". Default is the value of the
"destination-type" attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS client id for this listener container. Needs to be specified when using
durable subscriptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cache level for JMS resources: <code>none</code>, <code>connection</code>, <code>session</code>, <code>consumer</code> or
<code>auto</code>. By default ( <code>auto</code>), the cache level will effectively be "consumer", unless
an external transaction manager has been specified - in which case the effective
default will be <code>none</code> (assuming Java EE-style transaction management where the given
ConnectionFactory is an XA-aware pool).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The native JMS acknowledge mode: <code>auto</code>, <code>client</code>, <code>dups-ok</code> or <code>transacted</code>. A value
of <code>transacted</code> activates a locally transacted <code>Session</code>. As an alternative, specify
the <code>transaction-manager</code> attribute described below. Default is <code>auto</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transaction-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an external <code>PlatformTransactionManager</code> (typically an XA-based
transaction coordinator, e.g. Spring&#8217;s <code>JtaTransactionManager</code>). If not specified,
native acknowledging will be used (see "acknowledge" attribute).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of concurrent sessions/consumers to start for each listener. Can either be
a simple number indicating the maximum number (e.g. "5") or a range indicating the
lower as well as the upper limit (e.g. "3-5"). Note that a specified minimum is just a
hint and might be ignored at runtime. Default is 1; keep concurrency limited to 1 in
case of a topic listener or if queue ordering is important; consider raising it for
general queues.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefetch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of messages to load into a single session. Note that raising this
number might lead to starvation of concurrent consumers!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timeout to use for receive calls (in milliseconds). The default is <code>1000</code> ms (1
sec); <code>-1</code> indicates no timeout at all.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">back-off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the <code>BackOff</code> instance to use to compute the interval between recovery
attempts. If the <code>BackOffExecution</code> implementation returns <code>BackOffExecution#STOP</code>,
the listener container will not further attempt to recover. The <code>recovery-interval</code>
value is ignored when this property is set. The default is a <code>FixedBackOff</code> with
an interval of 5000 ms, that is 5 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recovery-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the interval between recovery attempts, in milliseconds. Convenience
way to create a <code>FixedBackOff</code> with the specified interval. For more recovery
options, consider specifying a BackOff instance instead. The default is 5000 ms,
that is 5 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">phase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lifecycle phase within which this container should start and stop. The lower the
value the earlier this container will start and the later it will stop. The default is
<code>Integer.MAX_VALUE</code> meaning the container will start as late as possible and stop as
soon as possible.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Configuring a JCA-based listener container with the "jms" schema support is very similar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jms:jca-listener-container</span> <span class="attribute-name">resource-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myResourceAdapter</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destination-resolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDestinationResolver</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTransactionManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">concurrency</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;jms:listener</span> <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.orders</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/jms:jca-listener-container&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The available configuration options for the JCA variant are described in the following
table:</p>
</div>
<table id="jms-namespace-jca-listener-container-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Attributes of the JMS &lt;jca-listener-container/&gt; element</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">factory-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exposes the settings defined by this element as a <code>JmsListenerContainerFactory</code>
with the specified id so that they can be reused with other endpoints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource-adapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the JCA <code>ResourceAdapter</code> bean (the default bean name is
<code>'resourceAdapter'</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activation-spec-factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the <code>JmsActivationSpecFactory</code>. The default is to autodetect the JMS
provider and its <code>ActivationSpec</code> class (see <code>DefaultJmsActivationSpecFactory</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination-resolver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the <code>DestinationResolver</code> strategy for resolving JMS <code>Destinations</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message-converter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the <code>MessageConverter</code> strategy for converting JMS Messages to listener
method arguments. Default is a <code>SimpleMessageConverter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for this listener: <code>queue</code>, <code>topic</code>, <code>durableTopic</code>, <code>sharedTopic</code>
or <code>sharedDurableTopic</code>. This enables potentially the <code>pubSubDomain</code>, <code>subscriptionDurable</code>
and <code>subscriptionShared</code> properties of the container. The default is <code>queue</code> (i.e. disabling
those 3 properties).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">response-destination-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS destination type for responses: "queue", "topic". Default is the value of the
"destination-type" attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JMS client id for this listener container. Needs to be specified when using
durable subscriptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The native JMS acknowledge mode: <code>auto</code>, <code>client</code>, <code>dups-ok</code> or <code>transacted</code>. A value
of <code>transacted</code> activates a locally transacted <code>Session</code>. As an alternative, specify
the <code>transaction-manager</code> attribute described below. Default is <code>auto</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transaction-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to a Spring <code>JtaTransactionManager</code> or a
<code>javax.transaction.TransactionManager</code> for kicking off an XA transaction for each
incoming message. If not specified, native acknowledging will be used (see the
"acknowledge" attribute).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of concurrent sessions/consumers to start for each listener. Can either be
a simple number indicating the maximum number (e.g. "5") or a range indicating the
lower as well as the upper limit (e.g. "3-5"). Note that a specified minimum is just a
hint and will typically be ignored at runtime when using a JCA listener container.
Default is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefetch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of messages to load into a single session. Note that raising this
number might lead to starvation of concurrent consumers!</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jmx"><a class="anchor" href="integration.html#jmx"></a>4. JMX</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="jmx-introduction"><a class="anchor" href="integration.html#jmx-introduction"></a>4.1. Introduction</h3>
<div class="paragraph">
<p>The JMX support in Spring provides you with the features to easily and transparently
integrate your Spring application into a JMX infrastructure.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">JMX?</div>
<div class="paragraph">
<p>This chapter is not an introduction to JMX&#8230;&#8203; it doesn&#8217;t try to explain the motivations
of why one might want to use JMX (or indeed what the letters JMX actually stand for). If
you are new to JMX, check out <a href="integration.html#jmx-resources">Further resources</a> at the end of this chapter.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifically, Spring&#8217;s JMX support provides four core features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The automatic registration of <em>any</em> Spring bean as a JMX MBean</p>
</li>
<li>
<p>A flexible mechanism for controlling the management interface of your beans</p>
</li>
<li>
<p>The declarative exposure of MBeans over remote, JSR-160 connectors</p>
</li>
<li>
<p>The simple proxying of both local and remote MBean resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These features are designed to work without coupling your application components to
either Spring or JMX interfaces and classes. Indeed, for the most part your application
classes need not be aware of either Spring or JMX in order to take advantage of the
Spring JMX features.</p>
</div>
</div>
<div class="sect2">
<h3 id="jmx-exporting"><a class="anchor" href="integration.html#jmx-exporting"></a>4.2. Exporting your beans to JMX</h3>
<div class="paragraph">
<p>The core class in Spring&#8217;s JMX framework is the <code>MBeanExporter</code>. This class is
responsible for taking your Spring beans and registering them with a JMX <code>MBeanServer</code>.
For example, consider the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.jmx</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JmxTestBean</span> <span class="directive">implements</span> IJmxTestBean {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;
    <span class="directive">private</span> <span class="type">boolean</span> isSuperman;

    <span class="directive">public</span> <span class="type">int</span> getAge() {
        <span class="keyword">return</span> age;
    }

    <span class="directive">public</span> <span class="type">void</span> setAge(<span class="type">int</span> age) {
        <span class="local-variable">this</span>.age = age;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> x, <span class="type">int</span> y) {
        <span class="keyword">return</span> x + y;
    }

    <span class="directive">public</span> <span class="type">void</span> dontExposeMe() {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To expose the properties and methods of this bean as attributes and operations of an
MBean you simply configure an instance of the <code>MBeanExporter</code> class in your
configuration file and pass in the bean as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="comment">&lt;!-- this bean must not be lazily initialized if the exporting is to happen --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lazy-init</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The pertinent bean definition from the above configuration snippet is the <code>exporter</code>
bean. The <code>beans</code> property tells the <code>MBeanExporter</code> exactly which of your beans must be
exported to the JMX <code>MBeanServer</code>. In the default configuration, the key of each entry
in the <code>beans</code> <code>Map</code> is used as the <code>ObjectName</code> for the bean referenced by the
corresponding entry value. This behavior can be changed as described in <a href="integration.html#jmx-naming">Controlling the ObjectNames for your beans</a>.</p>
</div>
<div class="paragraph">
<p>With this configuration the <code>testBean</code> bean is exposed as an MBean under the
<code>ObjectName</code> <code>bean:name=testBean1</code>. By default, all <em>public</em> properties of the bean
are exposed as attributes and all <em>public</em> methods (bar those inherited from the
<code>Object</code> class) are exposed as operations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>MBeanExporter</code> is a <code>Lifecycle</code> bean (see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-factory-lifecycle-processor">Startup and shutdown callbacks</a>) and MBeans are exported as late as possible during
the application lifecycle by default. It is possible to configure the <code>phase</code> at which
the export happens or disable automatic registration by setting the <code>autoStartup</code> flag.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jmx-exporting-mbeanserver"><a class="anchor" href="integration.html#jmx-exporting-mbeanserver"></a>4.2.1. Creating an MBeanServer</h4>
<div class="paragraph">
<p>The above configuration assumes that the application is running in an environment that
has one (and only one) <code>MBeanServer</code> already running. In this case, Spring will attempt
to locate the running <code>MBeanServer</code> and register your beans with that server (if any).
This behavior is useful when your application is running inside a container such as
Tomcat or IBM WebSphere that has its own <code>MBeanServer</code>.</p>
</div>
<div class="paragraph">
<p>However, this approach is of no use in a standalone environment, or when running inside
a container that does not provide an <code>MBeanServer</code>. To address this you can create an
<code>MBeanServer</code> instance declaratively by adding an instance of the
<code>org.springframework.jmx.support.MBeanServerFactoryBean</code> class to your configuration.
You can also ensure that a specific <code>MBeanServer</code> is used by setting the value of the
<code>MBeanExporter</code>'s <code>server</code> property to the <code>MBeanServer</code> value returned by an
<code>MBeanServerFactoryBean</code>; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.MBeanServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!--
    this bean needs to be eagerly pre-instantiated in order for the exporting to occur;
    this means that it must not be marked as lazily initialized
    --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here an instance of <code>MBeanServer</code> is created by the <code>MBeanServerFactoryBean</code> and is
supplied to the <code>MBeanExporter</code> via the server property. When you supply your own
<code>MBeanServer</code> instance, the <code>MBeanExporter</code> will not attempt to locate a running
<code>MBeanServer</code> and will use the supplied <code>MBeanServer</code> instance. For this to work
correctly, you must (of course) have a JMX implementation on your classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-mbean-server"><a class="anchor" href="integration.html#jmx-mbean-server"></a>4.2.2. Reusing an existing MBeanServer</h4>
<div class="paragraph">
<p>If no server is specified, the <code>MBeanExporter</code> tries to automatically detect a running
<code>MBeanServer</code>. This works in most environment where only one <code>MBeanServer</code> instance is
used, however when multiple instances exist, the exporter might pick the wrong server.
In such cases, one should use the <code>MBeanServer</code> <code>agentId</code> to indicate which instance to
be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.MBeanServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- indicate to first look for a server --&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locateExistingServerIfPossible</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!-- search for the MBeanServer instance with the given agentId --&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">agentId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MBeanServer_instance_agentId</span></span><span class="error">&gt;</span>&quot;/<span class="error">&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        ...
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For platforms/cases where the existing <code>MBeanServer</code> has a dynamic (or unknown)
<code>agentId</code> which is retrieved through lookup methods, one should use
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-factory-class-static-factory-method">factory-method</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- Custom MBeanServerLocator --&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">platform.package.MBeanServerLocator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locateMBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- other beans here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx-exporting-lazy"><a class="anchor" href="integration.html#jmx-exporting-lazy"></a>4.2.3. Lazy-initialized MBeans</h4>
<div class="paragraph">
<p>If you configure a bean with the <code>MBeanExporter</code> that is also configured for lazy
initialization, then the <code>MBeanExporter</code> will <em>not</em> break this contract and will avoid
instantiating the bean. Instead, it will register a proxy with the <code>MBeanServer</code> and
will defer obtaining the bean from the container until the first invocation on the proxy
occurs.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-exporting-auto"><a class="anchor" href="integration.html#jmx-exporting-auto"></a>4.2.4. Automatic registration of MBeans</h4>
<div class="paragraph">
<p>Any beans that are exported through the <code>MBeanExporter</code> and are already valid MBeans are
registered as-is with the <code>MBeanServer</code> without further intervention from Spring. MBeans
can be automatically detected by the <code>MBeanExporter</code> by setting the <code>autodetect</code>
property to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autodetect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spring:mbean=true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.TestDynamicMBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the bean called <code>spring:mbean=true</code> is already a valid JMX MBean and will be
automatically registered by Spring. By default, beans that are autodetected for JMX
registration have their bean name used as the <code>ObjectName</code>. This behavior can be
overridden as detailed in <a href="integration.html#jmx-naming">Controlling the ObjectNames for your beans</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-exporting-registration-behavior"><a class="anchor" href="integration.html#jmx-exporting-registration-behavior"></a>4.2.5. Controlling the registration behavior</h4>
<div class="paragraph">
<p>Consider the scenario where a Spring <code>MBeanExporter</code> attempts to register an <code>MBean</code>
with an <code>MBeanServer</code> using the <code>ObjectName</code> <code>'bean:name=testBean1'</code>. If an <code>MBean</code>
instance has already been registered under that same <code>ObjectName</code>, the default behavior
is to fail (and throw an <code>InstanceAlreadyExistsException</code>).</p>
</div>
<div class="paragraph">
<p>It is possible to control the behavior of exactly what happens when an <code>MBean</code> is
registered with an <code>MBeanServer</code>. Spring&#8217;s JMX support allows for three different
registration behaviors to control the registration behavior when the registration
process finds that an <code>MBean</code> has already been registered under the same <code>ObjectName</code>;
these registration behaviors are summarized on the following table:</p>
</div>
<table id="jmx-registration-behaviors" class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Registration Behaviors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Registration behavior</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGISTRATION_FAIL_ON_EXISTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the default registration behavior. If an <code>MBean</code> instance has already been
registered under the same <code>ObjectName</code>, the <code>MBean</code> that is being registered will not
be registered and an <code>InstanceAlreadyExistsException</code> will be thrown. The existing
<code>MBean</code> is unaffected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGISTRATION_IGNORE_EXISTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an <code>MBean</code> instance has already been registered under the same <code>ObjectName</code>, the
<code>MBean</code> that is being registered will <em>not</em> be registered. The existing <code>MBean</code> is
unaffected, and no <code>Exception</code> will be thrown. This is useful in settings where
multiple applications want to share a common <code>MBean</code> in a shared <code>MBeanServer</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGISTRATION_REPLACE_EXISTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an <code>MBean</code> instance has already been registered under the same <code>ObjectName</code>, the
existing <code>MBean</code> that was previously registered will be unregistered and the new
<code>MBean</code> will be registered in its place (the new <code>MBean</code> effectively replaces the
previous instance).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The above values are defined as constants on the <code>MBeanRegistrationSupport</code> class (the
<code>MBeanExporter</code> class derives from this superclass). If you want to change the default
registration behavior, you simply need to set the value of the
<code>registrationBehaviorName</code> property on your <code>MBeanExporter</code> definition to one of those
values.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how to effect a change from the default registration
behavior to the <code>REGISTRATION_REPLACE_EXISTING</code> behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">registrationBehaviorName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REGISTRATION_REPLACE_EXISTING</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-interface"><a class="anchor" href="integration.html#jmx-interface"></a>4.3. Controlling the management interface of your beans</h3>
<div class="paragraph">
<p>In the previous example, you had little control over the management interface of your
bean; <em>all</em> of the <em>public</em> properties and methods of each exported bean was exposed
as JMX attributes and operations respectively. To exercise finer-grained control over
exactly which properties and methods of your exported beans are actually exposed as JMX
attributes and operations, Spring JMX provides a comprehensive and extensible mechanism
for controlling the management interfaces of your beans.</p>
</div>
<div class="sect3">
<h4 id="jmx-interface-assembler"><a class="anchor" href="integration.html#jmx-interface-assembler"></a>4.3.1. MBeanInfoAssembler interface</h4>
<div class="paragraph">
<p>Behind the scenes, the <code>MBeanExporter</code> delegates to an implementation of the
<code>org.springframework.jmx.export.assembler.MBeanInfoAssembler</code> interface which is
responsible for defining the management interface of each bean that is being exposed.
The default implementation,
<code>org.springframework.jmx.export.assembler.SimpleReflectiveMBeanInfoAssembler</code>, simply
defines a management interface that exposes all public properties and methods (as you
saw in the previous examples). Spring provides two additional implementations of the
<code>MBeanInfoAssembler</code> interface that allow you to control the generated management
interface using either source-level metadata or any arbitrary interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-interface-metadata"><a class="anchor" href="integration.html#jmx-interface-metadata"></a>4.3.2. Using source-level metadata: Java annotations</h4>
<div class="paragraph">
<p>Using the <code>MetadataMBeanInfoAssembler</code> you can define the management interfaces for your
beans using source level metadata. The reading of metadata is encapsulated by the
<code>org.springframework.jmx.export.metadata.JmxAttributeSource</code> interface. Spring JMX
provides a default implementation which uses Java annotations, namely
<code>org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</code>. The
<code>MetadataMBeanInfoAssembler</code> <em>must</em> be configured with an implementation instance of
the <code>JmxAttributeSource</code> interface for it to function correctly (there is <em>no</em>
default).</p>
</div>
<div class="paragraph">
<p>To mark a bean for export to JMX, you should annotate the bean class with the
<code>ManagedResource</code> annotation. Each method you wish to expose as an operation must be
marked with the <code>ManagedOperation</code> annotation and each property you wish to expose must
be marked with the <code>ManagedAttribute</code> annotation. When marking properties you can omit
either the annotation of the getter or the setter to create a write-only or read-only
attribute respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>ManagedResource</code> annotated bean must be public as well as the methods exposing
an operation or an attribute.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example below shows the annotated version of the <code>JmxTestBean</code> class that you saw
earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.jmx</span>;

<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.annotation.ManagedResource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.annotation.ManagedOperation</span>;
<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.annotation.ManagedAttribute</span>;

<span class="annotation">@ManagedResource</span>(
        objectName=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean4</span><span class="delimiter">&quot;</span></span>,
        description=<span class="string"><span class="delimiter">&quot;</span><span class="content">My Managed Bean</span><span class="delimiter">&quot;</span></span>,
        log=<span class="predefined-constant">true</span>,
        logFile=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmx.log</span><span class="delimiter">&quot;</span></span>,
        currencyTimeLimit=<span class="integer">15</span>,
        persistPolicy=<span class="string"><span class="delimiter">&quot;</span><span class="content">OnUpdate</span><span class="delimiter">&quot;</span></span>,
        persistPeriod=<span class="integer">200</span>,
        persistLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
        persistName=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnnotationTestBean</span> <span class="directive">implements</span> IJmxTestBean {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;

    <span class="annotation">@ManagedAttribute</span>(description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The Age Attribute</span><span class="delimiter">&quot;</span></span>, currencyTimeLimit=<span class="integer">15</span>)
    <span class="directive">public</span> <span class="type">int</span> getAge() {
        <span class="keyword">return</span> age;
    }

    <span class="directive">public</span> <span class="type">void</span> setAge(<span class="type">int</span> age) {
        <span class="local-variable">this</span>.age = age;
    }

    <span class="annotation">@ManagedAttribute</span>(description=<span class="string"><span class="delimiter">&quot;</span><span class="content">The Name Attribute</span><span class="delimiter">&quot;</span></span>,
            currencyTimeLimit=<span class="integer">20</span>,
            defaultValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
            persistPolicy=<span class="string"><span class="delimiter">&quot;</span><span class="content">OnUpdate</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="annotation">@ManagedAttribute</span>(defaultValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, persistPeriod=<span class="integer">300</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="annotation">@ManagedOperation</span>(description=<span class="string"><span class="delimiter">&quot;</span><span class="content">Add two numbers</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@ManagedOperationParameters</span>({
        <span class="annotation">@ManagedOperationParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">The first number</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@ManagedOperationParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, description = <span class="string"><span class="delimiter">&quot;</span><span class="content">The second number</span><span class="delimiter">&quot;</span></span>)})
    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> x, <span class="type">int</span> y) {
        <span class="keyword">return</span> x + y;
    }

    <span class="directive">public</span> <span class="type">void</span> dontExposeMe() {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <code>JmxTestBean</code> class is marked with the <code>ManagedResource</code>
annotation and that this <code>ManagedResource</code> annotation is configured with a set of
properties. These properties can be used to configure various aspects of the MBean that
is generated by the <code>MBeanExporter</code>, and are explained in greater detail later in
section entitled <a href="integration.html#jmx-interface-metadata-types">Source-level metadata types</a>.</p>
</div>
<div class="paragraph">
<p>You will also notice that both the <code>age</code> and <code>name</code> properties are annotated with the
<code>ManagedAttribute</code> annotation, but in the case of the <code>age</code> property, only the getter is
marked. This will cause both of these properties to be included in the management
interface as attributes, but the <code>age</code> attribute will be read-only.</p>
</div>
<div class="paragraph">
<p>Finally, you will notice that the <code>add(int, int)</code> method is marked with the
<code>ManagedOperation</code> attribute whereas the <code>dontExposeMe()</code> method is not. This will cause
the management interface to contain only one operation, <code>add(int, int)</code>, when using the
<code>MetadataMBeanInfoAssembler</code>.</p>
</div>
<div class="paragraph">
<p>The configuration below shows how you configure the <code>MBeanExporter</code> to use the
<code>MetadataMBeanInfoAssembler</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autodetect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxAttributeSource</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- will create management interface using annotation metadata --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxAttributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- will pick up the ObjectName from the annotation --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.naming.MetadataNamingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxAttributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.AnnotationTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that an <code>MetadataMBeanInfoAssembler</code> bean has been configured with an
instance of the <code>AnnotationJmxAttributeSource</code> class and passed to the <code>MBeanExporter</code>
through the assembler property. This is all that is required to take advantage of
metadata-driven management interfaces for your Spring-exposed MBeans.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-interface-metadata-types"><a class="anchor" href="integration.html#jmx-interface-metadata-types"></a>4.3.3. Source-level metadata types</h4>
<div class="paragraph">
<p>The following source level metadata types are available for use in Spring JMX:</p>
</div>
<table id="jmx-metadata-types" class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Source-level metadata types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Annotation Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark all instances of a <code>Class</code> as JMX managed resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ManagedResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a method as a JMX operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ManagedOperation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a getter or setter as one half of a JMX attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ManagedAttribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method (only getters and setters)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define descriptions for operation parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ManagedOperationParameter</code> and <code>@ManagedOperationParameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Method</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following configuration parameters are available for use on these source-level
metadata types:</p>
</div>
<table id="jmx-metadata-parameters" class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Source-level metadata parameters</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by <code>MetadataNamingStrategy</code> to determine the <code>ObjectName</code> of a managed resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the friendly description of the resource, attribute or operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code>, <code>ManagedAttribute</code>, <code>ManagedOperation</code>, <code>ManagedOperationParameter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>currencyTimeLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>currencyTimeLimit</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code>, <code>ManagedAttribute</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>defaultValue</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedAttribute</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>log</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>logFile</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>persistPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>persistPolicy</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>persistPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>persistPeriod</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>persistLocation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>persistLocation</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>persistName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the value of the <code>persistName</code> descriptor field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the display name of an operation parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedOperationParameter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the index of an operation parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedOperationParameter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="jmx-interface-autodetect"><a class="anchor" href="integration.html#jmx-interface-autodetect"></a>4.3.4. AutodetectCapableMBeanInfoAssembler interface</h4>
<div class="paragraph">
<p>To simplify configuration even further, Spring introduces the
<code>AutodetectCapableMBeanInfoAssembler</code> interface which extends the <code>MBeanInfoAssembler</code>
interface to add support for autodetection of MBean resources. If you configure the
<code>MBeanExporter</code> with an instance of <code>AutodetectCapableMBeanInfoAssembler</code> then it is
allowed to "vote" on the inclusion of beans for exposure to JMX.</p>
</div>
<div class="paragraph">
<p>Out of the box, the only implementation of the <code>AutodetectCapableMBeanInfo</code> interface is
the <code>MetadataMBeanInfoAssembler</code> which will vote to include any bean which is marked
with the <code>ManagedResource</code> attribute. The default approach in this case is to use the
bean name as the <code>ObjectName</code> which results in a configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="comment">&lt;!-- notice how no 'beans' are explicitly configured here --&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autodetect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in this configuration no beans are passed to the <code>MBeanExporter</code>; however,
the <code>JmxTestBean</code> will still be registered since it is marked with the <code>ManagedResource</code>
attribute and the <code>MetadataMBeanInfoAssembler</code> detects this and votes to include it. The
only problem with this approach is that the name of the <code>JmxTestBean</code> now has business
meaning. You can address this issue by changing the default behavior for <code>ObjectName</code>
creation as defined in <a href="integration.html#jmx-naming">Controlling the ObjectNames for your beans</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-interface-java"><a class="anchor" href="integration.html#jmx-interface-java"></a>4.3.5. Defining management interfaces using Java interfaces</h4>
<div class="paragraph">
<p>In addition to the <code>MetadataMBeanInfoAssembler</code>, Spring also includes the
<code>InterfaceBasedMBeanInfoAssembler</code> which allows you to constrain the methods and
properties that are exposed based on the set of methods defined in a collection of
interfaces.</p>
</div>
<div class="paragraph">
<p>Although the standard mechanism for exposing MBeans is to use interfaces and a simple
naming scheme, the <code>InterfaceBasedMBeanInfoAssembler</code> extends this functionality by
removing the need for naming conventions, allowing you to use more than one interface
and removing the need for your beans to implement the MBean interfaces.</p>
</div>
<div class="paragraph">
<p>Consider this interface that is used to define a management interface for the
<code>JmxTestBean</code> class that you saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IJmxTestBean</span> {

    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> x, <span class="type">int</span> y);

    <span class="directive">public</span> <span class="type">long</span> myOperation();

    <span class="directive">public</span> <span class="type">int</span> getAge();

    <span class="directive">public</span> <span class="type">void</span> setAge(<span class="type">int</span> age);

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name);

    <span class="directive">public</span> <span class="predefined-type">String</span> getName();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface defines the methods and properties that will be exposed as operations and
attributes on the JMX MBean. The code below shows how to configure Spring JMX to use
this interface as the definition for the management interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedInterfaces</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;value&gt;</span>org.springframework.jmx.IJmxTestBean<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the <code>InterfaceBasedMBeanInfoAssembler</code> is configured to use the
<code>IJmxTestBean</code> interface when constructing the management interface for any bean. It is
important to understand that beans processed by the <code>InterfaceBasedMBeanInfoAssembler</code>
are <em>not</em> required to implement the interface used to generate the JMX management
interface.</p>
</div>
<div class="paragraph">
<p>In the case above, the <code>IJmxTestBean</code> interface is used to construct all management
interfaces for all beans. In many cases this is not the desired behavior and you may
want to use different interfaces for different beans. In this case, you can pass
<code>InterfaceBasedMBeanInfoAssembler</code> a <code>Properties</code> instance via the <code>interfaceMappings</code>
property, where the key of each entry is the bean name and the value of each entry is a
comma-separated list of interface names to use for that bean.</p>
</div>
<div class="paragraph">
<p>If no management interface is specified through either the <code>managedInterfaces</code> or
<code>interfaceMappings</code> properties, then the <code>InterfaceBasedMBeanInfoAssembler</code> will reflect
on the bean and use all of the interfaces implemented by that bean to create the
management interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-interface-methodnames"><a class="anchor" href="integration.html#jmx-interface-methodnames"></a>4.3.6. Using MethodNameBasedMBeanInfoAssembler</h4>
<div class="paragraph">
<p>The <code>MethodNameBasedMBeanInfoAssembler</code> allows you to specify a list of method names
that will be exposed to JMX as attributes and operations. The code below shows a sample
configuration for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.assembler.MethodNameBasedMBeanInfoAssembler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedMethods</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;value&gt;</span>add,myOperation,getName,setName,getAge<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the methods <code>add</code> and <code>myOperation</code> will be exposed as JMX
operations and <code>getName()</code>, <code>setName(String)</code> and <code>getAge()</code> will be exposed as the
appropriate half of a JMX attribute. In the code above, the method mappings apply to
beans that are exposed to JMX. To control method exposure on a bean-by-bean basis, use
the <code>methodMappings</code> property of <code>MethodNameMBeanInfoAssembler</code> to map bean names to
lists of method names.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-naming"><a class="anchor" href="integration.html#jmx-naming"></a>4.4. Controlling the ObjectNames for your beans</h3>
<div class="paragraph">
<p>Behind the scenes, the <code>MBeanExporter</code> delegates to an implementation of the
<code>ObjectNamingStrategy</code> to obtain <code>ObjectName</code>s for each of the beans it is registering.
The default implementation, <code>KeyNamingStrategy</code>, will, by default, use the key of the
<code>beans</code> <code>Map</code> as the <code>ObjectName</code>. In addition, the <code>KeyNamingStrategy</code> can map the key
of the <code>beans</code> <code>Map</code> to an entry in a <code>Properties</code> file (or files) to resolve the
<code>ObjectName</code>. In addition to the <code>KeyNamingStrategy</code>, Spring provides two additional
<code>ObjectNamingStrategy</code> implementations: the <code>IdentityNamingStrategy</code> that builds an
<code>ObjectName</code> based on the JVM identity of the bean and the <code>MetadataNamingStrategy</code> that
uses source level metadata to obtain the <code>ObjectName</code>.</p>
</div>
<div class="sect3">
<h4 id="jmx-naming-properties"><a class="anchor" href="integration.html#jmx-naming-properties"></a>4.4.1. Reading ObjectNames from Properties</h4>
<div class="paragraph">
<p>You can configure your own <code>KeyNamingStrategy</code> instance and configure it to read
<code>ObjectName</code>s from a <code>Properties</code> instance rather than use bean key. The
<code>KeyNamingStrategy</code> will attempt to locate an entry in the <code>Properties</code> with a key
corresponding to the bean key. If no entry is found or if the <code>Properties</code> instance is
<code>null</code> then the bean key itself is used.</p>
</div>
<div class="paragraph">
<p>The code below shows a sample configuration for the <code>KeyNamingStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.naming.KeyNamingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;props&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>bean:name=testBean1<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingLocations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>names1.properties,names2.properties<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here an instance of <code>KeyNamingStrategy</code> is configured with a <code>Properties</code> instance that
is merged from the <code>Properties</code> instance defined by the mapping property and the
properties files located in the paths defined by the mappings property. In this
configuration, the <code>testBean</code> bean will be given the <code>ObjectName</code> <code>bean:name=testBean1</code>
since this is the entry in the <code>Properties</code> instance that has a key corresponding to the
bean key.</p>
</div>
<div class="paragraph">
<p>If no entry in the <code>Properties</code> instance can be found then the bean key name is used as
the <code>ObjectName</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmx-naming-metadata"><a class="anchor" href="integration.html#jmx-naming-metadata"></a>4.4.2. Using the MetadataNamingStrategy</h4>
<div class="paragraph">
<p>The <code>MetadataNamingStrategy</code> uses the <code>objectName</code> property of the <code>ManagedResource</code>
attribute on each bean to create the <code>ObjectName</code>. The code below shows the
configuration for the <code>MetadataNamingStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namingStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.naming.MetadataNamingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">attributeSource</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no <code>objectName</code> has been provided for the <code>ManagedResource</code> attribute, then an
<code>ObjectName</code> will be created with the following
format:<em>[fully-qualified-package-name]:type=[short-classname],name=[bean-name]</em>. For
example, the generated <code>ObjectName</code> for the following bean would be:
<em>com.foo:type=MyClass,name=myBean</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.MyClass</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx-context-mbeanexport"><a class="anchor" href="integration.html#jmx-context-mbeanexport"></a>4.4.3. Configuring annotation based MBean export</h4>
<div class="paragraph">
<p>If you prefer using <a href="integration.html#jmx-interface-metadata">the annotation based approach</a> to define
your management interfaces, then a convenience subclass of <code>MBeanExporter</code> is available:
<code>AnnotationMBeanExporter</code>. When defining an instance of this subclass, the
<code>namingStrategy</code>, <code>assembler</code>, and <code>attributeSource</code> configuration is no longer needed,
since it will always use standard Java annotation-based metadata (autodetection is
always enabled as well). In fact, rather than defining an <code>MBeanExporter</code> bean, an even
simpler syntax is supported by the <code>@EnableMBeanExport</code> <code>@Configuration</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableMBeanExport</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer XML based configuration the <code>'context:mbean-export'</code> element serves the
same purpose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:mbean-export</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide a reference to a particular MBean <code>server</code> if necessary, and the
<code>defaultDomain</code> attribute (a property of <code>AnnotationMBeanExporter</code>) accepts an alternate
value for the generated MBean `ObjectNames&#8217; domains. This would be used in place of the
fully qualified package name as described in the previous section on
<a href="integration.html#jmx-naming-metadata">MetadataNamingStrategy</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableMBeanExport</span>(server=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMBeanServer</span><span class="delimiter">&quot;</span></span>, defaultDomain=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDomain</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Configuration</span>
ContextConfiguration {

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:mbean-export</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMBeanServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDomain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use interface-based AOP proxies in combination with autodetection of JMX
annotations in your bean classes. Interface-based proxies 'hide' the target class, which
also hides the JMX managed resource annotations. Hence, use target-class proxies in that
case: through setting the 'proxy-target-class' flag on <code>&lt;aop:config/&gt;</code>,
<code>&lt;tx:annotation-driven/&gt;</code>, etc. Otherwise, your JMX beans might be silently ignored at
startup&#8230;&#8203;</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-jsr160"><a class="anchor" href="integration.html#jmx-jsr160"></a>4.5. JSR-160 Connectors</h3>
<div class="paragraph">
<p>For remote access, Spring JMX module offers two <code>FactoryBean</code> implementations inside the
<code>org.springframework.jmx.support</code> package for creating both server- and client-side
connectors.</p>
</div>
<div class="sect3">
<h4 id="jmx-jsr160-server"><a class="anchor" href="integration.html#jmx-jsr160-server"></a>4.5.1. Server-side connectors</h4>
<div class="paragraph">
<p>To have Spring JMX create, start and expose a JSR-160 <code>JMXConnectorServer</code> use the
following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverConnector</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.ConnectorServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <code>ConnectorServerFactoryBean</code> creates a <code>JMXConnectorServer</code> bound to
<code>"service:jmx:jmxmp://localhost:9875"</code>. The <code>serverConnector</code> bean thus exposes the
local <code>MBeanServer</code> to clients through the JMXMP protocol on localhost, port 9875. Note
that the JMXMP protocol is marked as optional by the JSR 160 specification: currently,
the main open-source JMX implementation, MX4J, and the one provided with the JDK
do <em>not</em> support JMXMP.</p>
</div>
<div class="paragraph">
<p>To specify another URL and register the <code>JMXConnectorServer</code> itself with the
<code>MBeanServer</code> use the <code>serviceUrl</code> and <code>ObjectName</code> properties respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverConnector</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.ConnectorServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connector:name=rmi</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>ObjectName</code> property is set Spring will automatically register your connector
with the <code>MBeanServer</code> under that <code>ObjectName</code>. The example below shows the full set of
parameters which you can pass to the <code>ConnectorServerFactoryBean</code> when creating a
JMXConnector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverConnector</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.ConnectorServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connector:name=iiop</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:iiop://localhost/jndi/iiop://localhost:900/myconnector</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">threaded</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">daemon</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">environment</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someValue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using a RMI-based connector you need the lookup service (tnameserv or
rmiregistry) to be started in order for the name registration to complete. If you are
using Spring to export remote services for you via RMI, then Spring will already have
constructed an RMI registry. If not, you can easily start a registry using the following
snippet of configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">registry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.rmi.RmiRegistryFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1099</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx-jsr160-client"><a class="anchor" href="integration.html#jmx-jsr160-client"></a>4.5.2. Client-side connectors</h4>
<div class="paragraph">
<p>To create an <code>MBeanServerConnection</code> to a remote JSR-160 enabled <code>MBeanServer</code> use the
<code>MBeanServerConnectionFactoryBean</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientConnector</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.MBeanServerConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi://localhost/jndi/rmi://localhost:1099/jmxrmi</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx-jsr160-protocols"><a class="anchor" href="integration.html#jmx-jsr160-protocols"></a>4.5.3. JMX over Hessian or SOAP</h4>
<div class="paragraph">
<p>JSR-160 permits extensions to the way in which communication is done between the client
and the server. The examples above are using the mandatory RMI-based implementation
required by the JSR-160 specification (IIOP and JRMP) and the (optional) JMXMP. By using
other providers or JMX implementations (such as <a href="http://mx4j.sourceforge.net">MX4J</a>) you
can take advantage of protocols like SOAP or Hessian over simple HTTP or SSL and others:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverConnector</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.ConnectorServerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connector:name=burlap</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:burlap://localhost:9874</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the above example, MX4J 3.0.0 was used; see the official MX4J
documentation for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-proxy"><a class="anchor" href="integration.html#jmx-proxy"></a>4.6. Accessing MBeans via proxies</h3>
<div class="paragraph">
<p>Spring JMX allows you to create proxies that re-route calls to MBeans registered in a
local or remote <code>MBeanServer</code>. These proxies provide you with a standard Java interface
through which you can interact with your MBeans. The code below shows how to configure a
proxy for an MBean running in a local <code>MBeanServer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.access.MBeanProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.IJmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that a proxy is created for the MBean registered under the
<code>ObjectName</code>: <code>bean:name=testBean</code>. The set of interfaces that the proxy will implement
is controlled by the <code>proxyInterfaces</code> property and the rules for mapping methods and
properties on these interfaces to operations and attributes on the MBean are the same
rules used by the <code>InterfaceBasedMBeanInfoAssembler</code>.</p>
</div>
<div class="paragraph">
<p>The <code>MBeanProxyFactoryBean</code> can create a proxy to any MBean that is accessible via an
<code>MBeanServerConnection</code>. By default, the local <code>MBeanServer</code> is located and used, but
you can override this and provide an <code>MBeanServerConnection</code> pointing to a remote
<code>MBeanServer</code> to cater for proxies pointing to remote MBeans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientConnector</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.support.MBeanServerConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi://remotehost:9875</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.access.MBeanProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.IJmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientConnector</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that we create an <code>MBeanServerConnection</code> pointing to a remote machine
using the <code>MBeanServerConnectionFactoryBean</code>. This <code>MBeanServerConnection</code> is then
passed to the <code>MBeanProxyFactoryBean</code> via the <code>server</code> property. The proxy that is
created will forward all invocations to the <code>MBeanServer</code> via this
<code>MBeanServerConnection</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jmx-notifications"><a class="anchor" href="integration.html#jmx-notifications"></a>4.7. Notifications</h3>
<div class="paragraph">
<p>Spring&#8217;s JMX offering includes comprehensive support for JMX notifications.</p>
</div>
<div class="sect3">
<h4 id="jmx-notifications-listeners"><a class="anchor" href="integration.html#jmx-notifications-listeners"></a>4.7.1. Registering listeners for notifications</h4>
<div class="paragraph">
<p>Spring&#8217;s JMX support makes it very easy to register any number of
<code>NotificationListeners</code> with any number of MBeans (this includes MBeans exported by
Spring&#8217;s <code>MBeanExporter</code> and MBeans registered via some other mechanism). By way of an
example, consider the scenario where one would like to be informed (via a
<code>Notification</code>) each and every time an attribute of a target MBean changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example</span>;

<span class="keyword">import</span> <span class="include">javax.management.AttributeChangeNotification</span>;
<span class="keyword">import</span> <span class="include">javax.management.Notification</span>;
<span class="keyword">import</span> <span class="include">javax.management.NotificationFilter</span>;
<span class="keyword">import</span> <span class="include">javax.management.NotificationListener</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ConsoleLoggingNotificationListener</span>
        <span class="directive">implements</span> <span class="predefined-type">NotificationListener</span>, <span class="predefined-type">NotificationFilter</span> {

    <span class="directive">public</span> <span class="type">void</span> handleNotification(<span class="predefined-type">Notification</span> notification, <span class="predefined-type">Object</span> handback) {
        <span class="predefined-type">System</span>.out.println(notification);
        <span class="predefined-type">System</span>.out.println(handback);
    }

    <span class="directive">public</span> <span class="type">boolean</span> isNotificationEnabled(<span class="predefined-type">Notification</span> notification) {
        <span class="keyword">return</span> <span class="predefined-type">AttributeChangeNotification</span>.class.isAssignableFrom(notification.getClass());
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationListenerMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ConsoleLoggingNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/entry&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above configuration in place, every time a JMX <code>Notification</code> is broadcast from
the target MBean ( <code>bean:name=testBean1</code>), the <code>ConsoleLoggingNotificationListener</code> bean
that was registered as a listener via the <code>notificationListenerMappings</code> property will
be notified. The <code>ConsoleLoggingNotificationListener</code> bean can then take whatever action
it deems appropriate in response to the <code>Notification</code>.</p>
</div>
<div class="paragraph">
<p>You can also use straight bean names as the link between exported beans and listeners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationListenerMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><em>testBean</em></span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ConsoleLoggingNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/entry&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><em>testBean</em></span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If one wants to register a single <code>NotificationListener</code> instance for all of the beans
that the enclosing <code>MBeanExporter</code> is exporting, one can use the special wildcard <code>'*'</code>
(sans quotes) as the key for an entry in the <code>notificationListenerMappings</code> property
map; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationListenerMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map&gt;</span>
        <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ConsoleLoggingNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/entry&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If one needs to do the inverse (that is, register a number of distinct listeners against
an MBean), then one has to use the <code>notificationListeners</code> list property instead (and in
preference to the <code>notificationListenerMappings</code> property). This time, instead of
configuring simply a <code>NotificationListener</code> for a single MBean, one configures
<code>NotificationListenerBean</code> instances&#8230;&#8203; a <code>NotificationListenerBean</code> encapsulates a
<code>NotificationListener</code> and the <code>ObjectName</code> (or <code>ObjectNames</code>) that it is to be
registered against in an <code>MBeanServer</code>. The <code>NotificationListenerBean</code> also encapsulates
a number of other properties such as a <code>NotificationFilter</code> and an arbitrary handback
object that can be used in advanced JMX notification scenarios.</p>
</div>
<div class="paragraph">
<p>The configuration when using <code>NotificationListenerBean</code> instances is not wildly
different to what was presented previously:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationListeners</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.NotificationListenerBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg&gt;</span>
                        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ConsoleLoggingNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/constructor-arg&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappedObjectNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;list&gt;</span>
                            <span class="tag">&lt;value&gt;</span>bean:name=testBean1<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;/list&gt;</span>
                    <span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example is equivalent to the first notification example. Lets assume then that
we want to be given a handback object every time a <code>Notification</code> is raised, and that
additionally we want to filter out extraneous <code>Notifications</code> by supplying a
<code>NotificationFilter</code>. (For a full discussion of just what a handback object is, and
indeed what a <code>NotificationFilter</code> is, please do consult that section of the JMX
specification (1.2) entitled 'The JMX Notification Model'.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exporter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.MBeanExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;map&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean:name=testBean2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationListeners</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;list&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.export.NotificationListenerBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappedObjectNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;list&gt;</span>
                            <span class="comment">&lt;!-- handles notifications from two distinct MBeans --&gt;</span>
                            <span class="tag">&lt;value&gt;</span>bean:name=testBean1<span class="tag">&lt;/value&gt;</span>
                            <span class="tag">&lt;value&gt;</span>bean:name=testBean2<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;/list&gt;</span>
                    <span class="tag">&lt;/property&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">handback</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                            <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">This could be anything...</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/bean&gt;</span>
                    <span class="tag">&lt;/property&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">notificationFilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="comment">&lt;!-- implements both the NotificationListener and NotificationFilter interfaces --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerNotificationListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.ConsoleLoggingNotificationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testBean2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jmx.JmxTestBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ANOTHER TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx-notifications-publishing"><a class="anchor" href="integration.html#jmx-notifications-publishing"></a>4.7.2. Publishing Notifications</h4>
<div class="paragraph">
<p>Spring provides support not just for registering to receive <code>Notifications</code>, but also
for publishing <code>Notifications</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that this section is really only relevant to Spring managed beans that have
been exposed as MBeans via an <code>MBeanExporter</code>; any existing, user-defined MBeans should
use the standard JMX APIs for notification publication.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The key interface in Spring&#8217;s JMX notification publication support is the
<code>NotificationPublisher</code> interface (defined in the
<code>org.springframework.jmx.export.notification</code> package). Any bean that is going to be
exported as an MBean via an <code>MBeanExporter</code> instance can implement the related
<code>NotificationPublisherAware</code> interface to gain access to a <code>NotificationPublisher</code>
instance. The <code>NotificationPublisherAware</code> interface simply supplies an instance of a
<code>NotificationPublisher</code> to the implementing bean via a simple setter method, which the
bean can then use to publish <code>Notifications</code>.</p>
</div>
<div class="paragraph">
<p>As stated in the javadocs of the <code>NotificationPublisher</code> class, managed beans that are
publishing events via the <code>NotificationPublisher</code> mechanism are <em>not</em> responsible for
the state management of any notification listeners and the like &#8230;&#8203; Spring&#8217;s JMX support
will take care of handling all the JMX infrastructure issues. All one need do as an
application developer is implement the <code>NotificationPublisherAware</code> interface and start
publishing events using the supplied <code>NotificationPublisher</code> instance. Note that the
<code>NotificationPublisher</code> will be set <em>after</em> the managed bean has been registered with
an <code>MBeanServer</code>.</p>
</div>
<div class="paragraph">
<p>Using a <code>NotificationPublisher</code> instance is quite straightforward&#8230;&#8203; one simply creates
a JMX <code>Notification</code> instance (or an instance of an appropriate <code>Notification</code>
subclass), populates the notification with the data pertinent to the event that is to be
published, and one then invokes the <code>sendNotification(Notification)</code> on the
<code>NotificationPublisher</code> instance, passing in the <code>Notification</code>.</p>
</div>
<div class="paragraph">
<p>Find below a simple example&#8230;&#8203; in this scenario, exported instances of the <code>JmxTestBean</code>
are going to publish a <code>NotificationEvent</code> every time the <code>add(int, int)</code> operation is
invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.springframework.jmx</span>;

<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.notification.NotificationPublisherAware</span>;
<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.notification.NotificationPublisher</span>;
<span class="keyword">import</span> <span class="include">javax.management.Notification</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JmxTestBean</span> <span class="directive">implements</span> IJmxTestBean, NotificationPublisherAware {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;
    <span class="directive">private</span> <span class="type">boolean</span> isSuperman;
    <span class="directive">private</span> NotificationPublisher publisher;

    <span class="comment">// other getters and setters omitted for clarity</span>

    <span class="directive">public</span> <span class="type">int</span> add(<span class="type">int</span> x, <span class="type">int</span> y) {
        <span class="type">int</span> answer = x + y;
        <span class="local-variable">this</span>.publisher.sendNotification(<span class="keyword">new</span> <span class="predefined-type">Notification</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">add</span><span class="delimiter">&quot;</span></span>, <span class="local-variable">this</span>, <span class="integer">0</span>));
        <span class="keyword">return</span> answer;
    }

    <span class="directive">public</span> <span class="type">void</span> dontExposeMe() {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>();
    }

    <span class="directive">public</span> <span class="type">void</span> setNotificationPublisher(NotificationPublisher notificationPublisher) {
        <span class="local-variable">this</span>.publisher = notificationPublisher;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>NotificationPublisher</code> interface and the machinery to get it all working is one of
the nicer features of Spring&#8217;s JMX support. It does however come with the price tag of
coupling your classes to both Spring and JMX; as always, the advice here is to be
pragmatic&#8230;&#8203; if you need the functionality offered by the <code>NotificationPublisher</code> and
you can accept the coupling to both Spring and JMX, then do so.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-resources"><a class="anchor" href="integration.html#jmx-resources"></a>4.8. Further resources</h3>
<div class="paragraph">
<p>This section contains links to further resources about JMX.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX
homepage</a> at Oracle</p>
</li>
<li>
<p>The <a href="https://jcp.org/aboutJava/communityprocess/final/jsr003/index3.html">JMX
specification</a> (JSR-000003)</p>
</li>
<li>
<p>The <a href="https://jcp.org/aboutJava/communityprocess/final/jsr160/index.html">JMX Remote API
specification</a> (JSR-000160)</p>
</li>
<li>
<p>The <a href="http://mx4j.sourceforge.net/">MX4J homepage</a> (an Open Source implementation of
various JMX specs)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cci"><a class="anchor" href="integration.html#cci"></a>5. JCA CCI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cci-introduction"><a class="anchor" href="integration.html#cci-introduction"></a>5.1. Introduction</h3>
<div class="paragraph">
<p>Java EE provides a specification to standardize access to enterprise information systems
(EIS): the JCA (Java EE Connector Architecture). This specification is divided into
several different parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SPI (Service provider interfaces) that the connector provider must implement. These
interfaces constitute a resource adapter which can be deployed on a Java EE
application server. In such a scenario, the server manages connection pooling,
transaction and security (managed mode). The application server is also responsible
for managing the configuration, which is held outside the client application. A
connector can be used without an application server as well; in this case, the
application must configure it directly (non-managed mode).</p>
</li>
<li>
<p>CCI (Common Client Interface) that an application can use to interact with the
connector and thus communicate with an EIS. An API for local transaction demarcation
is provided as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The aim of the Spring CCI support is to provide classes to access a CCI connector in
typical Spring style, leveraging the Spring Framework&#8217;s general resource and transaction
management facilities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The client side of connectors doesn&#8217;t alway use CCI. Some connectors expose their own
APIs, only providing JCA resource adapter to use the system contracts of a Java EE
container (connection pooling, global transactions, security). Spring does not offer
special support for such connector-specific APIs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cci-config"><a class="anchor" href="integration.html#cci-config"></a>5.2. Configuring CCI</h3>
<div class="sect3">
<h4 id="cci-config-connector"><a class="anchor" href="integration.html#cci-config-connector"></a>5.2.1. Connector configuration</h4>
<div class="paragraph">
<p>The base resource to use JCA CCI is the <code>ConnectionFactory</code> interface. The connector
used must provide an implementation of this interface.</p>
</div>
<div class="paragraph">
<p>To use your connector, you can deploy it on your application server and fetch the
<code>ConnectionFactory</code> from the server&#8217;s JNDI environment (managed mode). The connector
must be packaged as a RAR file (resource adapter archive) and contain a <code>ra.xml</code> file to
describe its deployment characteristics. The actual name of the resource is specified
when you deploy it. To access it within Spring, simply use Spring&#8217;s
<code>JndiObjectFactoryBean</code> / <code>&lt;jee:jndi-lookup&gt;</code> fetch the factory by its JNDI name.</p>
</div>
<div class="paragraph">
<p>Another way to use a connector is to embed it in your application (non-managed mode),
not using an application server to deploy and configure it. Spring offers the
possibility to configure a connector as a bean, through a provided <code>FactoryBean</code> (
<code>LocalConnectionFactoryBean</code>). In this manner, you only need the connector library in
the classpath (no RAR file and no <code>ra.xml</code> descriptor needed). The library must be
extracted from the connector&#8217;s RAR file, if necessary.</p>
</div>
<div class="paragraph">
<p>Once you have got access to your <code>ConnectionFactory</code> instance, you can inject it into
your components. These components can either be coded against the plain CCI API or
leverage Spring&#8217;s support classes for CCI access (e.g. <code>CciTemplate</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you use a connector in non-managed mode, you can&#8217;t use global transactions because
the resource is never enlisted / delisted in the current global transaction of the
current thread. The resource is simply not aware of any global Java EE transactions that
might be running.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cci-config-connectionfactory"><a class="anchor" href="integration.html#cci-config-connectionfactory"></a>5.2.2. ConnectionFactory configuration in Spring</h4>
<div class="paragraph">
<p>In order to make connections to the EIS, you need to obtain a <code>ConnectionFactory</code> from
the application server if you are in a managed mode, or directly from Spring if you are
in a non-managed mode.</p>
</div>
<div class="paragraph">
<p>In a managed mode, you access a <code>ConnectionFactory</code> from JNDI; its properties will be
configured in the application server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eis/cicseci</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In non-managed mode, you must configure the <code>ConnectionFactory</code> you want to use in the
configuration of Spring as a JavaBean. The <code>LocalConnectionFactoryBean</code> class offers
this setup style, passing in the <code>ManagedConnectionFactory</code> implementation of your
connector, exposing the application-level CCI <code>ConnectionFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciManagedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ibm.connector2.cics.ECIManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TXSERIES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">portNumber</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2006</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can&#8217;t directly instantiate a specific <code>ConnectionFactory</code>. You need to go through
the corresponding implementation of the <code>ManagedConnectionFactory</code> interface for your
connector. This interface is part of the JCA SPI specification.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cci-config-cci-connections"><a class="anchor" href="integration.html#cci-config-cci-connections"></a>5.2.3. Configuring CCI connections</h4>
<div class="paragraph">
<p>JCA CCI allow the developer to configure the connections to the EIS using the
<code>ConnectionSpec</code> implementation of your connector. In order to configure its properties,
you need to wrap the target connection factory with a dedicated adapter,
<code>ConnectionSpecConnectionFactoryAdapter</code>. So, the dedicated <code>ConnectionSpec</code> can be
configured with the property <code>connectionSpec</code> (as an inner bean).</p>
</div>
<div class="paragraph">
<p>This property is not mandatory because the CCI <code>ConnectionFactory</code> interface defines two
different methods to obtain a CCI connection. Some of the <code>ConnectionSpec</code> properties
can often be configured in the application server (in managed mode) or on the
corresponding local <code>ManagedConnectionFactory</code> implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ConnectionFactory</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>, <span class="predefined-type">Referenceable</span> {
    ...
    Connection getConnection() <span class="directive">throws</span> ResourceException;
    <span class="predefined-type">Connection</span> getConnection(ConnectionSpec connectionSpec) <span class="directive">throws</span> ResourceException;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring provides a <code>ConnectionSpecConnectionFactoryAdapter</code> that allows for specifying a
<code>ConnectionSpec</code> instance to use for all operations on a given factory. If the adapter&#8217;s
<code>connectionSpec</code> property is specified, the adapter uses the <code>getConnection</code> variant
with the <code>ConnectionSpec</code> argument, otherwise the variant without argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:hsql://localhost:9001</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbcDriver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.connector.cciblackbox.CciConnectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-config-single-connection"><a class="anchor" href="integration.html#cci-config-single-connection"></a>5.2.4. Using a single CCI connection</h4>
<div class="paragraph">
<p>If you want to use a single CCI connection, Spring provides a further
<code>ConnectionFactory</code> adapter to manage this. The <code>SingleConnectionFactory</code> adapter class
will open a single connection lazily and close it when this bean is destroyed at
application shutdown. This class will expose special <code>Connection</code> proxies that behave
accordingly, all sharing the same underlying physical connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciManagedConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ibm.connector2.cics.ECIManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">portNumber</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2006</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetEciConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.connection.SingleConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetEciConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <code>ConnectionFactory</code> adapter cannot directly be configured with a <code>ConnectionSpec</code>.
Use an intermediary <code>ConnectionSpecConnectionFactoryAdapter</code> that the
<code>SingleConnectionFactory</code> talks to if you require a single connection for a specific
<code>ConnectionSpec</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cci-using"><a class="anchor" href="integration.html#cci-using"></a>5.3. Using Spring&#8217;s CCI access support</h3>
<div class="sect3">
<h4 id="cci-record-creator"><a class="anchor" href="integration.html#cci-record-creator"></a>5.3.1. Record conversion</h4>
<div class="paragraph">
<p>One of the aims of the JCA CCI support is to provide convenient facilities for
manipulating CCI records. The developer can specify the strategy to create records and
extract datas from records, for use with Spring&#8217;s <code>CciTemplate</code>. The following
interfaces will configure the strategy to use input and output records if you don&#8217;t want
to work with records directly in your application.</p>
</div>
<div class="paragraph">
<p>In order to create an input <code>Record</code>, the developer can use a dedicated implementation
of the <code>RecordCreator</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RecordCreator</span> {

    Record createRecord(RecordFactory recordFactory) <span class="directive">throws</span> ResourceException, DataAccessException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>createRecord(..)</code> method receives a <code>RecordFactory</code> instance as
parameter, which corresponds to the <code>RecordFactory</code> of the <code>ConnectionFactory</code> used.
This reference can be used to create <code>IndexedRecord</code> or <code>MappedRecord</code> instances. The
following sample shows how to use the <code>RecordCreator</code> interface and indexed/mapped
records.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyRecordCreator</span> <span class="directive">implements</span> RecordCreator {

    <span class="directive">public</span> Record createRecord(RecordFactory recordFactory) <span class="directive">throws</span> ResourceException {
        IndexedRecord input = recordFactory.createIndexedRecord(<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span>);
        input.add(<span class="keyword">new</span> <span class="predefined-type">Integer</span>(id));
        <span class="keyword">return</span> input;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An output <code>Record</code> can be used to receive data back from the EIS. Hence, a specific
implementation of the <code>RecordExtractor</code> interface can be passed to Spring&#8217;s
<code>CciTemplate</code> for extracting data from the output <code>Record</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RecordExtractor</span> {

    <span class="predefined-type">Object</span> extractData(Record record) <span class="directive">throws</span> ResourceException, <span class="exception">SQLException</span>, DataAccessException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sample shows how to use the <code>RecordExtractor</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyRecordExtractor</span> <span class="directive">implements</span> RecordExtractor {

    <span class="directive">public</span> <span class="predefined-type">Object</span> extractData(Record record) <span class="directive">throws</span> ResourceException {
        CommAreaRecord commAreaRecord = (CommAreaRecord) record;
        <span class="predefined-type">String</span> str = <span class="keyword">new</span> <span class="predefined-type">String</span>(commAreaRecord.toByteArray());
        <span class="predefined-type">String</span> field1 = string.substring(<span class="integer">0</span>,<span class="integer">6</span>);
        <span class="predefined-type">String</span> field2 = string.substring(<span class="integer">6</span>,<span class="integer">1</span>);
        <span class="keyword">return</span> <span class="keyword">new</span> OutputObject(<span class="predefined-type">Long</span>.parseLong(field1), field2);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-using-template"><a class="anchor" href="integration.html#cci-using-template"></a>5.3.2. CciTemplate</h4>
<div class="paragraph">
<p>The <code>CciTemplate</code> is the central class of the core CCI support package (
<code>org.springframework.jca.cci.core</code>). It simplifies the use of CCI since it handles the
creation and release of resources. This helps to avoid common errors like forgetting to
always close the connection. It cares for the lifecycle of connection and interaction
objects, letting application code focus on generating input records from application
data and extracting application data from output records.</p>
</div>
<div class="paragraph">
<p>The JCA CCI specification defines two distinct methods to call operations on an EIS. The
CCI <code>Interaction</code> interface provides two execute method signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">javax</span>.resource.cci.Interaction {

    ...

    boolean execute(InteractionSpec spec, Record input, Record output) <span class="directive">throws</span> ResourceException;

    Record execute(InteractionSpec spec, Record input) <span class="directive">throws</span> ResourceException;

    ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the template method called, <code>CciTemplate</code> will know which <code>execute</code> method
to call on the interaction. In any case, a correctly initialized <code>InteractionSpec</code>
instance is mandatory.</p>
</div>
<div class="paragraph">
<p><code>CciTemplate.execute(..)</code> can be used in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With direct <code>Record</code> arguments. In this case, you simply need to pass the CCI input
record in, and the returned object be the corresponding CCI output record.</p>
</li>
<li>
<p>With application objects, using record mapping. In this case, you need to provide
corresponding <code>RecordCreator</code> and <code>RecordExtractor</code> instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the first approach, the following methods of the template will be used. These
methods directly correspond to those on the <code>Interaction</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CciTemplate</span> <span class="directive">implements</span> CciOperations {

    <span class="directive">public</span> Record execute(InteractionSpec spec, Record inputRecord)
            <span class="directive">throws</span> DataAccessException { ... }

    <span class="directive">public</span> <span class="type">void</span> execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
            <span class="directive">throws</span> DataAccessException { ... }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the second approach, we need to specify the record creation and record extraction
strategies as arguments. The interfaces used are those describe in the previous section
on record conversion. The corresponding <code>CciTemplate</code> methods are the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CciTemplate</span> <span class="directive">implements</span> CciOperations {

    <span class="directive">public</span> Record execute(InteractionSpec spec,
            RecordCreator inputCreator) <span class="directive">throws</span> DataAccessException {
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(InteractionSpec spec, Record inputRecord,
            RecordExtractor outputExtractor) <span class="directive">throws</span> DataAccessException {
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(InteractionSpec spec, RecordCreator creator,
            RecordExtractor extractor) <span class="directive">throws</span> DataAccessException {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unless the <code>outputRecordCreator</code> property is set on the template (see the following
section), every method will call the corresponding <code>execute</code> method of the CCI
<code>Interaction</code> with two parameters: <code>InteractionSpec</code> and input <code>Record</code>, receiving an
output <code>Record</code> as return value.</p>
</div>
<div class="paragraph">
<p><code>CciTemplate</code> also provides methods to create <code>IndexRecord</code> and <code>MappedRecord</code> outside a
<code>RecordCreator</code> implementation, through its <code>createIndexRecord(..)</code> and
<code>createMappedRecord(..)</code> methods. This can be used within DAO implementations to create
<code>Record</code> instances to pass into corresponding <code>CciTemplate.execute(..)</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CciTemplate</span> <span class="directive">implements</span> CciOperations {

    <span class="directive">public</span> IndexedRecord createIndexedRecord(<span class="predefined-type">String</span> name) <span class="directive">throws</span> DataAccessException { ... }

    <span class="directive">public</span> MappedRecord createMappedRecord(<span class="predefined-type">String</span> name) <span class="directive">throws</span> DataAccessException { ... }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-using-dao"><a class="anchor" href="integration.html#cci-using-dao"></a>5.3.3. DAO support</h4>
<div class="paragraph">
<p>Spring&#8217;s CCI support provides a abstract class for DAOs, supporting injection of a
<code>ConnectionFactory</code> or a <code>CciTemplate</code> instances. The name of the class is
<code>CciDaoSupport</code>: It provides simple <code>setConnectionFactory</code> and <code>setCciTemplate</code> methods.
Internally, this class will create a <code>CciTemplate</code> instance for a passed-in
<code>ConnectionFactory</code>, exposing it to concrete data access implementations in subclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CciDaoSupport</span> {

    <span class="directive">public</span> <span class="type">void</span> setConnectionFactory(ConnectionFactory connectionFactory) {
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> ConnectionFactory getConnectionFactory() {
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> <span class="type">void</span> setCciTemplate(CciTemplate cciTemplate) {
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> CciTemplate getCciTemplate() {
        <span class="comment">// ...</span>
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-output-generation"><a class="anchor" href="integration.html#automatic-output-generation"></a>5.3.4. Automatic output record generation</h4>
<div class="paragraph">
<p>If the connector used only supports the <code>Interaction.execute(..)</code> method with input and
output records as parameters (that is, it requires the desired output record to be
passed in instead of returning an appropriate output record), you can set the
<code>outputRecordCreator</code> property of the <code>CciTemplate</code> to automatically generate an output
record to be filled by the JCA connector when the response is received. This record will
be then returned to the caller of the template.</p>
</div>
<div class="paragraph">
<p>This property simply holds an implementation of the <code>RecordCreator</code> interface, used for
that purpose. The <code>RecordCreator</code> interface has already been discussed in
<a href="integration.html#cci-record-creator">Record conversion</a>. The <code>outputRecordCreator</code> property must be directly specified on
the <code>CciTemplate</code>. This could be done in the application code like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cciTemplate.setOutputRecordCreator(<span class="keyword">new</span> EciOutputRecordCreator());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or (recommended) in the Spring configuration, if the <code>CciTemplate</code> is configured as a
dedicated bean instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciOutputRecordCreator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eci.EciOutputRecordCreator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cciTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.core.CciTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputRecordCreator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciOutputRecordCreator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As the <code>CciTemplate</code> class is thread-safe, it will usually be configured as a shared
instance.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="template-summary"><a class="anchor" href="integration.html#template-summary"></a>5.3.5. Summary</h4>
<div class="paragraph">
<p>The following table summarizes the mechanisms of the <code>CciTemplate</code> class and the
corresponding methods called on the CCI <code>Interaction</code> interface:</p>
</div>
<table id="cci-interaction-execute-methods" class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Usage of Interaction execute methods</caption>
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CciTemplate method signature</th>
<th class="tableblock halign-left valign-top">CciTemplate outputRecordCreator property</th>
<th class="tableblock halign-left valign-top">execute method called on the CCI Interaction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean execute(InteractionSpec, Record, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, RecordCreator)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, RecordCreator)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record, RecordExtractor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record, RecordExtractor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, RecordCreator, RecordExtractor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, RecordCreator, RecordExtractor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void execute(InteractionSpec, Record, Record)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="cci-straight"><a class="anchor" href="integration.html#cci-straight"></a>5.3.6. Using a CCI Connection and Interaction directly</h4>
<div class="paragraph">
<p><code>CciTemplate</code> also offers the possibility to work directly with CCI connections and
interactions, in the same manner as <code>JdbcTemplate</code> and <code>JmsTemplate</code>. This is useful
when you want to perform multiple operations on a CCI connection or interaction, for
example.</p>
</div>
<div class="paragraph">
<p>The interface <code>ConnectionCallback</code> provides a CCI <code>Connection</code> as argument, in order to
perform custom operations on it, plus the CCI <code>ConnectionFactory</code> which the <code>Connection</code>
was created with. The latter can be useful for example to get an associated
<code>RecordFactory</code> instance and create indexed/mapped records, for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ConnectionCallback</span> {

    <span class="predefined-type">Object</span> doInConnection(<span class="predefined-type">Connection</span> connection, ConnectionFactory connectionFactory)
            <span class="directive">throws</span> ResourceException, <span class="exception">SQLException</span>, DataAccessException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface <code>InteractionCallback</code> provides the CCI <code>Interaction</code>, in order to perform
custom operations on it, plus the corresponding CCI <code>ConnectionFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">InteractionCallback</span> {

    <span class="predefined-type">Object</span> doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
        <span class="directive">throws</span> ResourceException, <span class="exception">SQLException</span>, DataAccessException;

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>InteractionSpec</code> objects can either be shared across multiple template calls or newly
created inside every callback method. This is completely up to the DAO implementation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cci-template-example"><a class="anchor" href="integration.html#cci-template-example"></a>5.3.7. Example for CciTemplate usage</h4>
<div class="paragraph">
<p>In this section, the usage of the <code>CciTemplate</code> will be shown to acces to a CICS with
ECI mode, with the IBM CICS ECI connector.</p>
</div>
<div class="paragraph">
<p>Firstly, some initializations on the CCI <code>InteractionSpec</code> must be done to specify which
CICS program to access and how to interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ECIInteractionSpec interactionSpec = <span class="keyword">new</span> ECIInteractionSpec();
interactionSpec.setFunctionName(<span class="string"><span class="delimiter">&quot;</span><span class="content">MYPROG</span><span class="delimiter">&quot;</span></span>);
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the program can use CCI via Spring&#8217;s template and specify mappings between custom
objects and CCI <code>Records</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDaoImpl</span> <span class="directive">extends</span> CciDaoSupport <span class="directive">implements</span> MyDao {

    <span class="directive">public</span> OutputObject getData(InputObject input) {
        ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (<span class="predefined-type">ObjectOutput</span>) getCciTemplate().execute(interactionSpec,
        <span class="keyword">new</span> RecordCreator() {
            <span class="directive">public</span> Record createRecord(RecordFactory recordFactory) <span class="directive">throws</span> ResourceException {
                <span class="keyword">return</span> <span class="keyword">new</span> CommAreaRecord(input.toString().getBytes());
            }
        },
        <span class="keyword">new</span> RecordExtractor() {
            <span class="directive">public</span> <span class="predefined-type">Object</span> extractData(Record record) <span class="directive">throws</span> ResourceException {
                CommAreaRecord commAreaRecord = (CommAreaRecord)record;
                <span class="predefined-type">String</span> str = <span class="keyword">new</span> <span class="predefined-type">String</span>(commAreaRecord.toByteArray());
                <span class="predefined-type">String</span> field1 = string.substring(<span class="integer">0</span>,<span class="integer">6</span>);
                <span class="predefined-type">String</span> field2 = string.substring(<span class="integer">6</span>,<span class="integer">1</span>);
                <span class="keyword">return</span> <span class="keyword">new</span> OutputObject(<span class="predefined-type">Long</span>.parseLong(field1), field2);
            }
        });

        <span class="keyword">return</span> output;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As discussed previously, callbacks can be used to work directly on CCI connections or
interactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDaoImpl</span> <span class="directive">extends</span> CciDaoSupport <span class="directive">implements</span> MyDao {

    <span class="directive">public</span> OutputObject getData(InputObject input) {
        <span class="predefined-type">ObjectOutput</span> output = (<span class="predefined-type">ObjectOutput</span>) getCciTemplate().execute(
            <span class="keyword">new</span> ConnectionCallback() {
                <span class="directive">public</span> <span class="predefined-type">Object</span> doInConnection(<span class="predefined-type">Connection</span> connection,
                        ConnectionFactory factory) <span class="directive">throws</span> ResourceException {

                    <span class="comment">// do something...</span>

                }
            });
        }
        <span class="keyword">return</span> output;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With a <code>ConnectionCallback</code>, the <code>Connection</code> used will be managed and closed by the
<code>CciTemplate</code>, but any interactions created on the connection must be managed by the
callback implementation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For a more specific callback, you can implement an <code>InteractionCallback</code>. The passed-in
<code>Interaction</code> will be managed and closed by the <code>CciTemplate</code> in this case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDaoImpl</span> <span class="directive">extends</span> CciDaoSupport <span class="directive">implements</span> MyDao {

    <span class="directive">public</span> <span class="predefined-type">String</span> getData(<span class="predefined-type">String</span> input) {
        ECIInteractionSpec interactionSpec = ...;
        <span class="predefined-type">String</span> output = (<span class="predefined-type">String</span>) getCciTemplate().execute(interactionSpec,
            <span class="keyword">new</span> InteractionCallback() {
                <span class="directive">public</span> <span class="predefined-type">Object</span> doInInteraction(Interaction interaction,
                        ConnectionFactory factory) <span class="directive">throws</span> ResourceException {
                    Record input = <span class="keyword">new</span> CommAreaRecord(inputString.getBytes());
                    Record output = <span class="keyword">new</span> CommAreaRecord();
                    interaction.execute(holder.getInteractionSpec(), input, output);
                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span>(output.toByteArray());
                }
            });
        <span class="keyword">return</span> output;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the examples above, the corresponding configuration of the involved Spring beans
could look like this in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ibm.connector2.cics.ECIManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TXSERIES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local:</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CICSUSER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CICS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mypackage.MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eis/cicseci</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cci-object"><a class="anchor" href="integration.html#cci-object"></a>5.4. Modeling CCI access as operation objects</h3>
<div class="paragraph">
<p>The <code>org.springframework.jca.cci.object</code> package contains support classes that allow you
to access the EIS in a different style: through reusable operation objects, analogous to
Spring&#8217;s JDBC operation objects (see JDBC chapter). This will usually encapsulate the
CCI API: an application-level input object will be passed to the operation object, so it
can construct the input record and then convert the received record data to an
application-level output object and return it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This approach is internally based on the <code>CciTemplate</code> class and the
<code>RecordCreator</code> / <code>RecordExtractor</code> interfaces, reusing the machinery of Spring&#8217;s core
CCI support.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cci-object-mapping-record"><a class="anchor" href="integration.html#cci-object-mapping-record"></a>5.4.1. MappingRecordOperation</h4>
<div class="paragraph">
<p><code>MappingRecordOperation</code> essentially performs the same work as <code>CciTemplate</code>, but
represents a specific, pre-configured operation as an object. It provides two template
methods to specify how to convert an input object to a input record, and how to convert
an output record to an output object (record mapping):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createInputRecord(..)</code> to specify how to convert an input object to an input <code>Record</code></p>
</li>
<li>
<p><code>extractOutputData(..)</code> to specify how to extract an output object from an output
<code>Record</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are the signatures of these methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">MappingRecordOperation</span> <span class="directive">extends</span> EisOperation {

    ...

    protected <span class="directive">abstract</span> Record createInputRecord(RecordFactory recordFactory,
            <span class="predefined-type">Object</span> inputObject) <span class="directive">throws</span> ResourceException, DataAccessException {
        <span class="comment">// ...</span>
    }

    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">Object</span> extractOutputData(Record outputRecord)
            <span class="directive">throws</span> ResourceException, <span class="exception">SQLException</span>, DataAccessException {
        <span class="comment">// ...</span>
    }

    ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thereafter, in order to execute an EIS operation, you need to use a single execute
method, passing in an application-level input object and receiving an application-level
output object as result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">MappingRecordOperation</span> <span class="directive">extends</span> EisOperation {

    ...

    public <span class="predefined-type">Object</span> execute(<span class="predefined-type">Object</span> inputObject) <span class="directive">throws</span> DataAccessException {
    }

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, contrary to the <code>CciTemplate</code> class, this <code>execute(..)</code> method does not
have an <code>InteractionSpec</code> as argument. Instead, the <code>InteractionSpec</code> is global to the
operation. The following constructor must be used to instantiate an operation object
with a specific <code>InteractionSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = <span class="keyword">new</span> MyMappingRecordOperation(getConnectionFactory(), spec);
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-object-mapping-comm-area"><a class="anchor" href="integration.html#cci-object-mapping-comm-area"></a>5.4.2. MappingCommAreaOperation</h4>
<div class="paragraph">
<p>Some connectors use records based on a COMMAREA which represents an array of bytes
containing parameters to send to the EIS and data returned by it. Spring provides a
special operation class for working directly on COMMAREA rather than on records. The
<code>MappingCommAreaOperation</code> class extends the <code>MappingRecordOperation</code> class to provide
such special COMMAREA support. It implicitly uses the <code>CommAreaRecord</code> class as input
and output record type, and provides two new methods to convert an input object into an
input COMMAREA and the output COMMAREA into an output object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">MappingCommAreaOperation</span> <span class="directive">extends</span> MappingRecordOperation {

    ...

    protected <span class="directive">abstract</span> <span class="type">byte</span><span class="type">[]</span> objectToBytes(<span class="predefined-type">Object</span> inObject)
            <span class="directive">throws</span> <span class="exception">IOException</span>, DataAccessException;

    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">Object</span> bytesToObject(<span class="type">byte</span><span class="type">[]</span> bytes)
        <span class="directive">throws</span> <span class="exception">IOException</span>, DataAccessException;

    ...

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-automatic-record-gen"><a class="anchor" href="integration.html#cci-automatic-record-gen"></a>5.4.3. Automatic output record generation</h4>
<div class="paragraph">
<p>As every <code>MappingRecordOperation</code> subclass is based on CciTemplate internally, the same
way to automatically generate output records as with <code>CciTemplate</code> is available. Every
operation object provides a corresponding <code>setOutputRecordCreator(..)</code> method. For
further information, see <a href="integration.html#automatic-output-generation">Automatic output record generation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cci-object-summary"><a class="anchor" href="integration.html#cci-object-summary"></a>5.4.4. Summary</h4>
<div class="paragraph">
<p>The operation object approach uses records in the same manner as the <code>CciTemplate</code> class.</p>
</div>
<table id="cci-interaction-methods" class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Usage of Interaction execute methods</caption>
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MappingRecordOperation method signature</th>
<th class="tableblock halign-left valign-top">MappingRecordOperation outputRecordCreator property</th>
<th class="tableblock halign-left valign-top">execute method called on the CCI Interaction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object execute(Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record execute(InteractionSpec, Record)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object execute(Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean execute(InteractionSpec, Record, Record)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="cci-objects-mappring-record-example"><a class="anchor" href="integration.html#cci-objects-mappring-record-example"></a>5.4.5. Example for MappingRecordOperation usage</h4>
<div class="paragraph">
<p>In this section, the usage of the <code>MappingRecordOperation</code> will be shown to access a
database with the Blackbox CCI connector.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The original version of this connector is provided by the Java EE SDK (version 1.3),
available from Oracle.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Firstly, some initializations on the CCI <code>InteractionSpec</code> must be done to specify which
SQL request to execute. In this sample, we directly define the way to convert the
parameters of the request to a CCI record and the way to convert the CCI result record
to an instance of the <code>Person</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonMappingOperation</span> <span class="directive">extends</span> MappingRecordOperation {

    <span class="directive">public</span> PersonMappingOperation(ConnectionFactory connectionFactory) {
        setConnectionFactory(connectionFactory);
        CciInteractionSpec interactionSpec = <span class="keyword">new</span> CciConnectionSpec();
        interactionSpec.setSql(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from person where person_id=?</span><span class="delimiter">&quot;</span></span>);
        setInteractionSpec(interactionSpec);
    }

    <span class="directive">protected</span> Record createInputRecord(RecordFactory recordFactory,
            <span class="predefined-type">Object</span> inputObject) <span class="directive">throws</span> ResourceException {
        <span class="predefined-type">Integer</span> id = (<span class="predefined-type">Integer</span>) inputObject;
        IndexedRecord input = recordFactory.createIndexedRecord(<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span>);
        input.add(<span class="keyword">new</span> <span class="predefined-type">Integer</span>(id));
        <span class="keyword">return</span> input;
    }

    <span class="directive">protected</span> <span class="predefined-type">Object</span> extractOutputData(Record outputRecord)
            <span class="directive">throws</span> ResourceException, <span class="exception">SQLException</span> {
        <span class="predefined-type">ResultSet</span> rs = (<span class="predefined-type">ResultSet</span>) outputRecord;
        Person person = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (rs.next()) {
            Person person = <span class="keyword">new</span> Person();
            person.setId(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">person_id</span><span class="delimiter">&quot;</span></span>));
            person.setLastName(rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">person_last_name</span><span class="delimiter">&quot;</span></span>));
            person.setFirstName(rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">person_first_name</span><span class="delimiter">&quot;</span></span>));
        }
        <span class="keyword">return</span> person;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the application can execute the operation object, with the person identifier as
argument. Note that operation object could be set up as shared instance, as it is
thread-safe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDaoImpl</span> <span class="directive">extends</span> CciDaoSupport <span class="directive">implements</span> MyDao {

    <span class="directive">public</span> Person getPerson(<span class="type">int</span> id) {
        PersonMappingOperation query = <span class="keyword">new</span> PersonMappingOperation(getConnectionFactory());
        Person person = (Person) query.execute(<span class="keyword">new</span> <span class="predefined-type">Integer</span>(id));
        <span class="keyword">return</span> person;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:hsql://localhost:9001</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbcDriver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.connector.cciblackbox.CciConnectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eis/blackbox</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.connector.cciblackbox.CciConnectionSpec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cci-objects-mapping-comm-area-example"><a class="anchor" href="integration.html#cci-objects-mapping-comm-area-example"></a>5.4.6. Example for MappingCommAreaOperation usage</h4>
<div class="paragraph">
<p>In this section, the usage of the <code>MappingCommAreaOperation</code> will be shown: accessing a
CICS with ECI mode with the IBM CICS ECI connector.</p>
</div>
<div class="paragraph">
<p>Firstly, the CCI <code>InteractionSpec</code> needs to be initialized to specify which CICS program
to access and how to interact with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">EciMappingOperation</span> <span class="directive">extends</span> MappingCommAreaOperation {

    <span class="directive">public</span> EciMappingOperation(ConnectionFactory connectionFactory, <span class="predefined-type">String</span> programName) {
        setConnectionFactory(connectionFactory);
        ECIInteractionSpec interactionSpec = <span class="keyword">new</span> ECIInteractionSpec(),
        interactionSpec.setFunctionName(programName);
        interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
        interactionSpec.setCommareaLength(<span class="integer">30</span>);
        setInteractionSpec(interactionSpec);
        setOutputRecordCreator(<span class="keyword">new</span> EciOutputRecordCreator());
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">EciOutputRecordCreator</span> <span class="directive">implements</span> RecordCreator {
        <span class="directive">public</span> Record createRecord(RecordFactory recordFactory) <span class="directive">throws</span> ResourceException {
            <span class="keyword">return</span> <span class="keyword">new</span> CommAreaRecord();
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The abstract <code>EciMappingOperation</code> class can then be subclassed to specify mappings
between custom objects and <code>Records</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDaoImpl</span> <span class="directive">extends</span> CciDaoSupport <span class="directive">implements</span> MyDao {

    <span class="directive">public</span> OutputObject getData(<span class="predefined-type">Integer</span> id) {
        EciMappingOperation query = <span class="keyword">new</span> EciMappingOperation(getConnectionFactory(), <span class="string"><span class="delimiter">&quot;</span><span class="content">MYPROG</span><span class="delimiter">&quot;</span></span>) {

            <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">byte</span><span class="type">[]</span> objectToBytes(<span class="predefined-type">Object</span> inObject) <span class="directive">throws</span> <span class="exception">IOException</span> {
                <span class="predefined-type">Integer</span> id = (<span class="predefined-type">Integer</span>) inObject;
                <span class="keyword">return</span> <span class="predefined-type">String</span>.valueOf(id);
            }

            <span class="directive">protected</span> <span class="directive">abstract</span> <span class="predefined-type">Object</span> bytesToObject(<span class="type">byte</span><span class="type">[]</span> bytes) <span class="directive">throws</span> <span class="exception">IOException</span>;
                <span class="predefined-type">String</span> str = <span class="keyword">new</span> <span class="predefined-type">String</span>(bytes);
                <span class="predefined-type">String</span> field1 = str.substring(<span class="integer">0</span>,<span class="integer">6</span>);
                <span class="predefined-type">String</span> field2 = str.substring(<span class="integer">6</span>,<span class="integer">1</span>);
                <span class="predefined-type">String</span> field3 = str.substring(<span class="integer">7</span>,<span class="integer">1</span>);
                <span class="keyword">return</span> <span class="keyword">new</span> OutputObject(field1, field2, field3);
            }
        });

        <span class="keyword">return</span> (OutputObject) query.execute(<span class="keyword">new</span> <span class="predefined-type">Integer</span>(id));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ibm.connector2.cics.ECIManagedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TXSERIES</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local:</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CICSUSER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CICS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.support.LocalConnectionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managedConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In managed mode (that is, in a Java EE environment), the configuration could look as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eis/cicseci</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">component</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDaoImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cci-tx"><a class="anchor" href="integration.html#cci-tx"></a>5.5. Transactions</h3>
<div class="paragraph">
<p>JCA specifies several levels of transaction support for resource adapters. The kind of
transactions that your resource adapter supports is specified in its <code>ra.xml</code> file.
There are essentially three options: none (for example with CICS EPI connector), local
transactions (for example with a CICS ECI connector), global transactions (for example
with an IMS connector).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;connector&gt;</span>
    <span class="tag">&lt;resourceadapter&gt;</span>
        <span class="comment">&lt;!-- &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt; --&gt;</span>
        <span class="comment">&lt;!-- &lt;transaction-support&gt;LocalTransaction&lt;/transaction-support&gt; --&gt;</span>
        <span class="tag">&lt;transaction-support&gt;</span>XATransaction<span class="tag">&lt;/transaction-support&gt;</span>
    <span class="tag">&lt;resourceadapter&gt;</span>
<span class="tag">&lt;connector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For global transactions, you can use Spring&#8217;s generic transaction infrastructure to
demarcate transactions, with <code>JtaTransactionManager</code> as backend (delegating to the Java
EE server&#8217;s distributed transaction coordinator underneath).</p>
</div>
<div class="paragraph">
<p>For local transactions on a single CCI <code>ConnectionFactory</code>, Spring provides a specific
transaction management strategy for CCI, analogous to the <code>DataSourceTransactionManager</code>
for JDBC. The CCI API defines a local transaction object and corresponding local
transaction demarcation methods. Spring&#8217;s <code>CciLocalTransactionManager</code> executes such
local CCI transactions, fully compliant with Spring&#8217;s generic
<code>PlatformTransactionManager</code> abstraction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eis/cicseci</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciTransactionManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jca.cci.connection.CciLocalTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eciConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both transaction strategies can be used with any of Spring&#8217;s transaction demarcation
facilities, be it declarative or programmatic. This is a consequence of Spring&#8217;s generic
<code>PlatformTransactionManager</code> abstraction, which decouples transaction demarcation from
the actual execution strategy. Simply switch between <code>JtaTransactionManager</code> and
<code>CciLocalTransactionManager</code> as needed, keeping your transaction demarcation as-is.</p>
</div>
<div class="paragraph">
<p>For more information on Spring&#8217;s transaction facilities, see the chapter entitled
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">Transaction Management</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mail"><a class="anchor" href="integration.html#mail"></a>6. Email</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="mail-introduction"><a class="anchor" href="integration.html#mail-introduction"></a>6.1. Introduction</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Library dependencies</div>
<div class="paragraph">
<p>The following JAR needs to be on the classpath of your application in order to use
the Spring Framework&#8217;s email library.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://java.net/projects/javamail/pages/Home">JavaMail</a> library</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This library is freely available on the web&#8201;&#8212;&#8201;for example, in Maven Central as
<code>com.sun.mail:javax.mail</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The Spring Framework provides a helpful utility library for sending email that shields
the user from the specifics of the underlying mailing system and is responsible for low
level resource handling on behalf of the client.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.mail</code> package is the root level package for the Spring
Framework&#8217;s email support. The central interface for sending emails is the <code>MailSender</code>
interface; a simple value object encapsulating the properties of a simple mail such as
<em>from</em> and <em>to</em> (plus many others) is the <code>SimpleMailMessage</code> class. This package
also contains a hierarchy of checked exceptions which provide a higher level of
abstraction over the lower level mail system exceptions with the root exception being
<code>MailException</code>. Please refer to the javadocs for more information on the rich mail
exception hierarchy.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.mail.javamail.JavaMailSender</code> interface adds specialized
<em>JavaMail</em> features such as MIME message support to the <code>MailSender</code> interface (from
which it inherits). <code>JavaMailSender</code> also provides a callback interface for preparation
of JavaMail MIME messages, called
<code>org.springframework.mail.javamail.MimeMessagePreparator</code></p>
</div>
</div>
<div class="sect2">
<h3 id="mail-usage"><a class="anchor" href="integration.html#mail-usage"></a>6.2. Usage</h3>
<div class="paragraph">
<p>Let&#8217;s assume there is a business interface called <code>OrderManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">OrderManager</span> {

    <span class="type">void</span> placeOrder(Order order);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us also assume that there is a requirement stating that an email message with an
order number needs to be generated and sent to a customer placing the relevant order.</p>
</div>
<div class="sect3">
<h4 id="mail-usage-simple"><a class="anchor" href="integration.html#mail-usage-simple"></a>6.2.1. Basic MailSender and SimpleMailMessage usage</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.mail.MailException</span>;
<span class="keyword">import</span> <span class="include">org.springframework.mail.MailSender</span>;
<span class="keyword">import</span> <span class="include">org.springframework.mail.SimpleMailMessage</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleOrderManager</span> <span class="directive">implements</span> OrderManager {

    <span class="directive">private</span> MailSender mailSender;
    <span class="directive">private</span> SimpleMailMessage templateMessage;

    <span class="directive">public</span> <span class="type">void</span> setMailSender(MailSender mailSender) {
        <span class="local-variable">this</span>.mailSender = mailSender;
    }

    <span class="directive">public</span> <span class="type">void</span> setTemplateMessage(SimpleMailMessage templateMessage) {
        <span class="local-variable">this</span>.templateMessage = templateMessage;
    }

    <span class="directive">public</span> <span class="type">void</span> placeOrder(Order order) {

        <span class="comment">// Do the business calculations...</span>

        <span class="comment">// Call the collaborators to persist the order...</span>

        <span class="comment">// Create a thread safe &quot;copy&quot; of the template message and customize it</span>
        SimpleMailMessage msg = <span class="keyword">new</span> SimpleMailMessage(<span class="local-variable">this</span>.templateMessage);
        msg.setTo(order.getCustomer().getEmailAddress());
        msg.setText(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Dear </span><span class="delimiter">&quot;</span></span> + order.getCustomer().getFirstName()
                + order.getCustomer().getLastName()
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">, thank you for placing order. Your order number is </span><span class="delimiter">&quot;</span></span>
                + order.getOrderNumber());
        <span class="keyword">try</span>{
            <span class="local-variable">this</span>.mailSender.send(msg);
        }
        <span class="keyword">catch</span> (MailException ex) {
            <span class="comment">// simply log it and go on...</span>
            <span class="predefined-type">System</span>.err.println(ex.getMessage());
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find below the bean definitions for the above code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mailSender</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.mail.javamail.JavaMailSenderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.mycompany.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- this is a template message that we can pre-load with default state --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">templateMessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.mail.SimpleMailMessage</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="abc8ded8dfc4c6ced9d8ced9ddc2c8ceebc6d2c8c4c6dbcac5d285c8c4c6">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Your order</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.businessapp.support.SimpleOrderManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mailSender</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mailSender</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">templateMessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">templateMessage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mail-usage-mime"><a class="anchor" href="integration.html#mail-usage-mime"></a>6.2.2. Using the JavaMailSender and the MimeMessagePreparator</h4>
<div class="paragraph">
<p>Here is another implementation of <code>OrderManager</code> using the <code>MimeMessagePreparator</code>
callback interface. Please note in this case that the <code>mailSender</code> property is of type
<code>JavaMailSender</code> so that we are able to use the JavaMail <code>MimeMessage</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.mail.Message</span>;
<span class="keyword">import</span> <span class="include">javax.mail.MessagingException</span>;
<span class="keyword">import</span> <span class="include">javax.mail.internet.InternetAddress</span>;
<span class="keyword">import</span> <span class="include">javax.mail.internet.MimeMessage</span>;

<span class="keyword">import</span> <span class="include">javax.mail.internet.MimeMessage</span>;
<span class="keyword">import</span> <span class="include">org.springframework.mail.MailException</span>;
<span class="keyword">import</span> <span class="include">org.springframework.mail.javamail.JavaMailSender</span>;
<span class="keyword">import</span> <span class="include">org.springframework.mail.javamail.MimeMessagePreparator</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleOrderManager</span> <span class="directive">implements</span> OrderManager {

    <span class="directive">private</span> JavaMailSender mailSender;

    <span class="directive">public</span> <span class="type">void</span> setMailSender(JavaMailSender mailSender) {
        <span class="local-variable">this</span>.mailSender = mailSender;
    }

    <span class="directive">public</span> <span class="type">void</span> placeOrder(<span class="directive">final</span> Order order) {

        <span class="comment">// Do the business calculations...</span>

        <span class="comment">// Call the collaborators to persist the order...</span>

        MimeMessagePreparator preparator = <span class="keyword">new</span> MimeMessagePreparator() {

            <span class="directive">public</span> <span class="type">void</span> prepare(MimeMessage mimeMessage) <span class="directive">throws</span> <span class="exception">Exception</span> {

                mimeMessage.setRecipient(Message.RecipientType.TO,
                        <span class="keyword">new</span> InternetAddress(order.getCustomer().getEmailAddress()));
                mimeMessage.setFrom(<span class="keyword">new</span> InternetAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f598949c99b5988c969a9885949b8cdb969a98">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span>));
                mimeMessage.setText(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Dear </span><span class="delimiter">&quot;</span></span> + order.getCustomer().getFirstName() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>
                            + order.getCustomer().getLastName()
                            + <span class="string"><span class="delimiter">&quot;</span><span class="content">, thank you for placing order. Your order number is </span><span class="delimiter">&quot;</span></span>
                            + order.getOrderNumber());
            }
        };

        <span class="keyword">try</span> {
            <span class="local-variable">this</span>.mailSender.send(preparator);
        }
        <span class="keyword">catch</span> (MailException ex) {
            <span class="comment">// simply log it and go on...</span>
            <span class="predefined-type">System</span>.err.println(ex.getMessage());
        }
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The mail code is a crosscutting concern and could well be a candidate for refactoring
into a <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop">custom Spring AOP aspect</a>, which then could be executed at appropriate
joinpoints on the <code>OrderManager</code> target.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Spring Framework&#8217;s mail support ships with the standard JavaMail implementation.
Please refer to the relevant javadocs for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mail-javamail-mime"><a class="anchor" href="integration.html#mail-javamail-mime"></a>6.3. Using the JavaMail MimeMessageHelper</h3>
<div class="paragraph">
<p>A class that comes in pretty handy when dealing with JavaMail messages is the
<code>org.springframework.mail.javamail.MimeMessageHelper</code> class, which shields you from
having to use the verbose JavaMail API. Using the <code>MimeMessageHelper</code> it is pretty easy
to create a <code>MimeMessage</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// of course you would use DI in any real-world cases</span>
JavaMailSenderImpl sender = <span class="keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.host.com</span><span class="delimiter">&quot;</span></span>);

MimeMessage message = sender.createMimeMessage();
MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message);
helper.setTo(<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5e2a3b2d2a1e36312d2a703d3133">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span>);
helper.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Thank you for ordering!</span><span class="delimiter">&quot;</span></span>);

sender.send(message);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="mail-javamail-mime-attachments"><a class="anchor" href="integration.html#mail-javamail-mime-attachments"></a>6.3.1. Sending attachments and inline resources</h4>
<div class="paragraph">
<p>Multipart email messages allow for both attachments and inline resources. Examples of
inline resources would be images or a stylesheet you want to use in your message, but
that you don&#8217;t want displayed as an attachment.</p>
</div>
<div class="sect4">
<h5 id="mail-javamail-mime-attachments-attachment"><a class="anchor" href="integration.html#mail-javamail-mime-attachments-attachment"></a>Attachments</h5>
<div class="paragraph">
<p>The following example shows you how to use the <code>MimeMessageHelper</code> to send an email
along with a single JPEG image attachment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JavaMailSenderImpl sender = <span class="keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.host.com</span><span class="delimiter">&quot;</span></span>);

MimeMessage message = sender.createMimeMessage();

<span class="comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="predefined-constant">true</span>);
helper.setTo(<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a1d5c4d2d5e1c9ced2d58fc2cecc">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span>);

helper.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Check out this image!</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// let's attach the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource file = <span class="keyword">new</span> FileSystemResource(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">c:/Sample.jpg</span><span class="delimiter">&quot;</span></span>));
helper.addAttachment(<span class="string"><span class="delimiter">&quot;</span><span class="content">CoolImage.jpg</span><span class="delimiter">&quot;</span></span>, file);

sender.send(message);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mail-javamail-mime-attachments-inline"><a class="anchor" href="integration.html#mail-javamail-mime-attachments-inline"></a>Inline resources</h5>
<div class="paragraph">
<p>The following example shows you how to use the <code>MimeMessageHelper</code> to send an email
along with an inline image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JavaMailSenderImpl sender = <span class="keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.host.com</span><span class="delimiter">&quot;</span></span>);

MimeMessage message = sender.createMimeMessage();

<span class="comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="predefined-constant">true</span>);
helper.setTo(<span class="string"><span class="delimiter">&quot;</span><span class="content"><a href="https://docs.spring.io/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="205445535460484f53540e434f4d">[email&#160;protected]</a></span><span class="delimiter">&quot;</span></span>);

<span class="comment">// use the true flag to indicate the text included is HTML</span>
helper.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;&lt;body&gt;&lt;img src='cid:identifier1234'&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);

<span class="comment">// let's include the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource res = <span class="keyword">new</span> FileSystemResource(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">c:/Sample.jpg</span><span class="delimiter">&quot;</span></span>));
helper.addInline(<span class="string"><span class="delimiter">&quot;</span><span class="content">identifier1234</span><span class="delimiter">&quot;</span></span>, res);

sender.send(message);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Inline resources are added to the mime message using the specified <code>Content-ID</code> (
<code>identifier1234</code> in the above example). The order in which you are adding the text and
the resource are <em>very</em> important. Be sure to <em>first add the text</em> and after that
the resources. If you are doing it the other way around, it won&#8217;t work!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mail-templates"><a class="anchor" href="integration.html#mail-templates"></a>6.3.2. Creating email content using a templating library</h4>
<div class="paragraph">
<p>The code in the previous examples explicitly created the content of the email message,
using methods calls such as <code>message.setText(..)</code>. This is fine for simple cases, and it
is okay in the context of the aforementioned examples, where the intent was to show you
the very basics of the API.</p>
</div>
<div class="paragraph">
<p>In your typical enterprise application though, you are not going to create the content
of your emails using the above approach for a number of reasons.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating HTML-based email content in Java code is tedious and error prone</p>
</li>
<li>
<p>There is no clear separation between display logic and business logic</p>
</li>
<li>
<p>Changing the display structure of the email content requires writing Java code,
recompiling, redeploying&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typically the approach taken to address these issues is to use a template library such
as FreeMarker to define the display structure of email content. This leaves your code
tasked only with creating the data that is to be rendered in the email template and
sending the email. It is definitely a best practice for when the content of your emails
becomes even moderately complex, and with the Spring Framework&#8217;s support classes for
FreeMarker becomes quite easy to do.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scheduling"><a class="anchor" href="integration.html#scheduling"></a>7. Task Execution and Scheduling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scheduling-introduction"><a class="anchor" href="integration.html#scheduling-introduction"></a>7.1. Introduction</h3>
<div class="paragraph">
<p>The Spring Framework provides abstractions for asynchronous execution and scheduling of
tasks with the <code>TaskExecutor</code> and <code>TaskScheduler</code> interfaces, respectively. Spring also
features implementations of those interfaces that support thread pools or delegation to
CommonJ within an application server environment. Ultimately the use of these
implementations behind the common interfaces abstracts away the differences between Java
SE 5, Java SE 6 and Java EE environments.</p>
</div>
<div class="paragraph">
<p>Spring also features integration classes for supporting scheduling with the <code>Timer</code>,
part of the JDK since 1.3, and the Quartz Scheduler ( <a href="http://quartz-scheduler.org" class="bare">http://quartz-scheduler.org</a>).
Both of those schedulers are set up using a <code>FactoryBean</code> with optional references to
<code>Timer</code> or <code>Trigger</code> instances, respectively. Furthermore, a convenience class for both
the Quartz Scheduler and the <code>Timer</code> is available that allows you to invoke a method of
an existing target object (analogous to the normal <code>MethodInvokingFactoryBean</code>
operation).</p>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-task-executor"><a class="anchor" href="integration.html#scheduling-task-executor"></a>7.2. The Spring TaskExecutor abstraction</h3>
<div class="paragraph">
<p>Executors are the JDK name for the concept of thread pools. The "executor" naming is
due to the fact that there is no guarantee that the underlying implementation is
actually a pool; an executor may be single-threaded or even synchronous. Spring&#8217;s
abstraction hides implementation details between Java SE and Java EE environments.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s <code>TaskExecutor</code> interface is identical to the <code>java.util.concurrent.Executor</code>
interface. In fact, originally, its primary reason for existence was to abstract away
the need for Java 5 when using thread pools. The interface has a single method
<code>execute(Runnable task)</code> that accepts a task for execution based on the semantics
and configuration of the thread pool.</p>
</div>
<div class="paragraph">
<p>The <code>TaskExecutor</code> was originally created to give other Spring components an abstraction
for thread pooling where needed. Components such as the <code>ApplicationEventMulticaster</code>,
JMS&#8217;s <code>AbstractMessageListenerContainer</code>, and Quartz integration all use the
<code>TaskExecutor</code> abstraction to pool threads. However, if your beans need thread pooling
behavior, it is possible to use this abstraction for your own needs.</p>
</div>
<div class="sect3">
<h4 id="scheduling-task-executor-types"><a class="anchor" href="integration.html#scheduling-task-executor-types"></a>7.2.1. TaskExecutor types</h4>
<div class="paragraph">
<p>There are a number of pre-built implementations of <code>TaskExecutor</code> included with the
Spring distribution. In all likelihood, you shouldn&#8217;t ever need to implement your own.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleAsyncTaskExecutor</code>
This implementation does not reuse any threads, rather it starts up a new thread
for each invocation. However, it does support a concurrency limit which will block
any invocations that are over the limit until a slot has been freed up. If you
are looking for true pooling, see the discussions of <code>SimpleThreadPoolTaskExecutor</code>
and <code>ThreadPoolTaskExecutor</code> below.</p>
</li>
<li>
<p><code>SyncTaskExecutor</code>
This implementation doesn&#8217;t execute invocations asynchronously. Instead, each
invocation takes place in the calling thread. It is primarily used in situations
where multi-threading isn&#8217;t necessary such as simple test cases.</p>
</li>
<li>
<p><code>ConcurrentTaskExecutor</code>
This implementation is an adapter for a <code>java.util.concurrent.Executor</code> object.
There is an alternative, <code>ThreadPoolTaskExecutor</code>, that exposes the <code>Executor</code>
configuration parameters as bean properties. It is rare to need to use the
<code>ConcurrentTaskExecutor</code>, but if the <code>ThreadPoolTaskExecutor</code> isn&#8217;t flexible
enough for your needs, the <code>ConcurrentTaskExecutor</code> is an alternative.</p>
</li>
<li>
<p><code>SimpleThreadPoolTaskExecutor</code>
This implementation is actually a subclass of Quartz&#8217;s <code>SimpleThreadPool</code> which
listens to Spring&#8217;s lifecycle callbacks. This is typically used when you have a
thread pool that may need to be shared by both Quartz and non-Quartz components.</p>
</li>
<li>
<p><code>ThreadPoolTaskExecutor</code>
This implementation is the most commonly used one. It exposes bean properties for
configuring a <code>java.util.concurrent.ThreadPoolExecutor</code> and wraps it in a <code>TaskExecutor</code>.
If you need to adapt to a different kind of <code>java.util.concurrent.Executor</code>, it is
recommended that you use a <code>ConcurrentTaskExecutor</code> instead.</p>
</li>
<li>
<p><code>WorkManagerTaskExecutor</code></p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>CommonJ is a set of specifications jointly developed between BEA and IBM. These
specifications are not Java EE standards, but are standard across BEA&#8217;s and IBM&#8217;s
Application Server implementations.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This implementation uses the CommonJ <code>WorkManager</code> as its backing implementation and is
the central convenience class for setting up a CommonJ <code>WorkManager</code> reference in a Spring
context. Similar to the <code>SimpleThreadPoolTaskExecutor</code>, this class implements the
<code>WorkManager</code> interface and therefore can be used directly as a <code>WorkManager</code> as well.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-task-executor-usage"><a class="anchor" href="integration.html#scheduling-task-executor-usage"></a>7.2.2. Using a TaskExecutor</h4>
<div class="paragraph">
<p>Spring&#8217;s <code>TaskExecutor</code> implementations are used as simple JavaBeans. In the example
below, we define a bean that uses the <code>ThreadPoolTaskExecutor</code> to asynchronously print
out a set of messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.core.task.TaskExecutor</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskExecutorExample</span> {

    <span class="directive">private</span> <span class="type">class</span> <span class="class">MessagePrinterTask</span> <span class="directive">implements</span> <span class="predefined-type">Runnable</span> {

        <span class="directive">private</span> <span class="predefined-type">String</span> message;

        <span class="directive">public</span> MessagePrinterTask(<span class="predefined-type">String</span> message) {
            <span class="local-variable">this</span>.message = message;
        }

        <span class="directive">public</span> <span class="type">void</span> run() {
            <span class="predefined-type">System</span>.out.println(message);
        }

    }

    <span class="directive">private</span> TaskExecutor taskExecutor;

    <span class="directive">public</span> TaskExecutorExample(TaskExecutor taskExecutor) {
        <span class="local-variable">this</span>.taskExecutor = taskExecutor;
    }

    <span class="directive">public</span> <span class="type">void</span> printMessages() {
        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">25</span>; i++) {
            taskExecutor.execute(<span class="keyword">new</span> MessagePrinterTask(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span> + i));
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, rather than retrieving a thread from the pool and executing yourself,
you add your <code>Runnable</code> to the queue and the <code>TaskExecutor</code> uses its internal rules to
decide when the task gets executed.</p>
</div>
<div class="paragraph">
<p>To configure the rules that the <code>TaskExecutor</code> will use, simple bean properties have
been exposed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskExecutor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">corePoolSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxPoolSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queueCapacity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskExecutorExample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TaskExecutorExample</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskExecutor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-task-scheduler"><a class="anchor" href="integration.html#scheduling-task-scheduler"></a>7.3. The Spring TaskScheduler abstraction</h3>
<div class="paragraph">
<p>In addition to the <code>TaskExecutor</code> abstraction, Spring 3.0 introduces a <code>TaskScheduler</code>
with a variety of methods for scheduling tasks to run at some point in the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TaskScheduler</span> {

    <span class="predefined-type">ScheduledFuture</span> schedule(<span class="predefined-type">Runnable</span> task, Trigger trigger);

    <span class="predefined-type">ScheduledFuture</span> schedule(<span class="predefined-type">Runnable</span> task, <span class="predefined-type">Date</span> startTime);

    <span class="predefined-type">ScheduledFuture</span> scheduleAtFixedRate(<span class="predefined-type">Runnable</span> task, <span class="predefined-type">Date</span> startTime, <span class="type">long</span> period);

    <span class="predefined-type">ScheduledFuture</span> scheduleAtFixedRate(<span class="predefined-type">Runnable</span> task, <span class="type">long</span> period);

    <span class="predefined-type">ScheduledFuture</span> scheduleWithFixedDelay(<span class="predefined-type">Runnable</span> task, <span class="predefined-type">Date</span> startTime, <span class="type">long</span> delay);

    <span class="predefined-type">ScheduledFuture</span> scheduleWithFixedDelay(<span class="predefined-type">Runnable</span> task, <span class="type">long</span> delay);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest method is the one named 'schedule' that takes a <code>Runnable</code> and <code>Date</code> only.
That will cause the task to run once after the specified time. All of the other methods
are capable of scheduling tasks to run repeatedly. The fixed-rate and fixed-delay
methods are for simple, periodic execution, but the method that accepts a Trigger is
much more flexible.</p>
</div>
<div class="sect3">
<h4 id="scheduling-trigger-interface"><a class="anchor" href="integration.html#scheduling-trigger-interface"></a>7.3.1. Trigger interface</h4>
<div class="paragraph">
<p>The <code>Trigger</code> interface is essentially inspired by JSR-236, which, as of Spring 3.0, has
not yet been officially implemented. The basic idea of the <code>Trigger</code> is that execution
times may be determined based on past execution outcomes or even arbitrary conditions.
If these determinations do take into account the outcome of the preceding execution,
that information is available within a <code>TriggerContext</code>. The <code>Trigger</code> interface itself
is quite simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Trigger</span> {

    <span class="predefined-type">Date</span> nextExecutionTime(TriggerContext triggerContext);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>TriggerContext</code> is the most important part. It encapsulates all of
the relevant data, and is open for extension in the future if necessary. The
<code>TriggerContext</code> is an interface (a <code>SimpleTriggerContext</code> implementation is used by
default). Here you can see what methods are available for <code>Trigger</code> implementations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TriggerContext</span> {

    <span class="predefined-type">Date</span> lastScheduledExecutionTime();

    <span class="predefined-type">Date</span> lastActualExecutionTime();

    <span class="predefined-type">Date</span> lastCompletionTime();

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-trigger-implementations"><a class="anchor" href="integration.html#scheduling-trigger-implementations"></a>7.3.2. Trigger implementations</h4>
<div class="paragraph">
<p>Spring provides two implementations of the <code>Trigger</code> interface. The most interesting one
is the <code>CronTrigger</code>. It enables the scheduling of tasks based on cron expressions. For
example, the following task is being scheduled to run 15 minutes past each hour but only
during the 9-to-5 "business hours" on weekdays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">scheduler.schedule(task, <span class="keyword">new</span> CronTrigger(<span class="string"><span class="delimiter">&quot;</span><span class="content">0 15 9-17 * * MON-FRI</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other out-of-the-box implementation is a <code>PeriodicTrigger</code> that accepts a fixed
period, an optional initial delay value, and a boolean to indicate whether the period
should be interpreted as a fixed-rate or a fixed-delay. Since the <code>TaskScheduler</code>
interface already defines methods for scheduling tasks at a fixed-rate or with a
fixed-delay, those methods should be used directly whenever possible. The value of the
<code>PeriodicTrigger</code> implementation is that it can be used within components that rely on
the <code>Trigger</code> abstraction. For example, it may be convenient to allow periodic triggers,
cron-based triggers, and even custom trigger implementations to be used interchangeably.
Such a component could take advantage of dependency injection so that such <code>Triggers</code>
could be configured externally and therefore easily modified or extended.</p>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-task-scheduler-implementations"><a class="anchor" href="integration.html#scheduling-task-scheduler-implementations"></a>7.3.3. TaskScheduler implementations</h4>
<div class="paragraph">
<p>As with Spring&#8217;s <code>TaskExecutor</code> abstraction, the primary benefit of the <code>TaskScheduler</code>
is that code relying on scheduling behavior need not be coupled to a particular
scheduler implementation. The flexibility this provides is particularly relevant when
running within Application Server environments where threads should not be created
directly by the application itself. For such cases, Spring provides a
<code>TimerManagerTaskScheduler</code> that delegates to a CommonJ TimerManager instance, typically
configured with a JNDI-lookup.</p>
</div>
<div class="paragraph">
<p>A simpler alternative, the <code>ThreadPoolTaskScheduler</code>, can be used whenever external
thread management is not a requirement. Internally, it delegates to a
<code>ScheduledExecutorService</code> instance. <code>ThreadPoolTaskScheduler</code> actually implements
Spring&#8217;s <code>TaskExecutor</code> interface as well, so that a single instance can be used for
asynchronous execution <em>as soon as possible</em> as well as scheduled, and potentially
recurring, executions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-annotation-support"><a class="anchor" href="integration.html#scheduling-annotation-support"></a>7.4. Annotation Support for Scheduling and Asynchronous Execution</h3>
<div class="paragraph">
<p>Spring provides annotation support for both task scheduling and asynchronous method
execution.</p>
</div>
<div class="sect3">
<h4 id="scheduling-enable-annotation-support"><a class="anchor" href="integration.html#scheduling-enable-annotation-support"></a>7.4.1. Enable scheduling annotations</h4>
<div class="paragraph">
<p>To enable support for <code>@Scheduled</code> and <code>@Async</code> annotations add <code>@EnableScheduling</code> and
<code>@EnableAsync</code> to one of your <code>@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAsync</span>
<span class="annotation">@EnableScheduling</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free to pick and choose the relevant annotations for your application. For
example, if you only need support for <code>@Scheduled</code>, simply omit <code>@EnableAsync</code>. For more
fine-grained control you can additionally implement the <code>SchedulingConfigurer</code> and/or
<code>AsyncConfigurer</code> interfaces. See the javadocs for full details.</p>
</div>
<div class="paragraph">
<p>If you prefer XML configuration use the <code>&lt;task:annotation-driven&gt;</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:annotation-driven</span> <span class="attribute-name">executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myExecutor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scheduler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;task:executor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myExecutor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;task:scheduler</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice with the above XML that an executor reference is provided for handling those
tasks that correspond to methods with the <code>@Async</code> annotation, and the scheduler
reference is provided for managing those methods annotated with <code>@Scheduled</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default advice mode for processing <code>@Async</code> annotations is "proxy" which allows
for interception of calls through the proxy only; local calls within the same class
cannot get intercepted that way. For a more advanced mode of interception, consider
switching to "aspectj" mode in combination with compile-time or load-time weaving.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-annotation-support-scheduled"><a class="anchor" href="integration.html#scheduling-annotation-support-scheduled"></a>7.4.2. The @Scheduled annotation</h4>
<div class="paragraph">
<p>The <code>@Scheduled</code> annotation can be added to a method along with trigger metadata. For
example, the following method would be invoked every 5 seconds with a fixed delay,
meaning that the period will be measured from the completion time of each preceding
invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedDelay=<span class="integer">5000</span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="comment">// something that should execute periodically</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a fixed rate execution is desired, simply change the property name specified within
the annotation. The following would be executed every 5 seconds measured between the
successive start times of each invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedRate=<span class="integer">5000</span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="comment">// something that should execute periodically</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For fixed-delay and fixed-rate tasks, an initial delay may be specified indicating the
number of milliseconds to wait before the first execution of the method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(initialDelay=<span class="integer">1000</span>, fixedRate=<span class="integer">5000</span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="comment">// something that should execute periodically</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If simple periodic scheduling is not expressive enough, then a cron expression may be
provided. For example, the following will only execute on weekdays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(cron=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/5 * * * * MON-FRI</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="comment">// something that should execute on weekdays only</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can additionally use the <code>zone</code> attribute to specify the time zone in which the cron
expression will be resolved.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that the methods to be scheduled must have void returns and must not expect any
arguments. If the method needs to interact with other objects from the Application
Context, then those would typically have been provided through dependency injection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Spring Framework 4.3, <code>@Scheduled</code> methods are supported on beans of any scope.</p>
</div>
<div class="paragraph">
<p>Make sure that you are not initializing multiple instances of the same <code>@Scheduled</code>
annotation class at runtime, unless you do want to schedule callbacks to each such
instance. Related to this, make sure that you do not use <code>@Configurable</code> on bean
classes which are annotated with <code>@Scheduled</code> and registered as regular Spring beans
with the container: You would get double initialization otherwise, once through the
container and once through the <code>@Configurable</code> aspect, with the consequence of each
<code>@Scheduled</code> method being invoked twice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-annotation-support-async"><a class="anchor" href="integration.html#scheduling-annotation-support-async"></a>7.4.3. The @Async annotation</h4>
<div class="paragraph">
<p>The <code>@Async</code> annotation can be provided on a method so that invocation of that method
will occur asynchronously. In other words, the caller will return immediately upon
invocation and the actual execution of the method will occur in a task that has been
submitted to a Spring <code>TaskExecutor</code>. In the simplest case, the annotation may be
applied to a <code>void</code>-returning method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Async</span>
<span class="type">void</span> doSomething() {
    <span class="comment">// this will be executed asynchronously</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike the methods annotated with the <code>@Scheduled</code> annotation, these methods can expect
arguments, because they will be invoked in the "normal" way by callers at runtime rather
than from a scheduled task being managed by the container. For example, the following is
a legitimate application of the <code>@Async</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Async</span>
<span class="type">void</span> doSomething(<span class="predefined-type">String</span> s) {
    <span class="comment">// this will be executed asynchronously</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even methods that return a value can be invoked asynchronously. However, such methods
are required to have a <code>Future</code> typed return value. This still provides the benefit of
asynchronous execution so that the caller can perform other tasks prior to calling
<code>get()</code> on that Future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Async</span>
<span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; returnSomething(<span class="type">int</span> i) {
    <span class="comment">// this will be executed asynchronously</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@Async</code> methods may not only declare a regular <code>java.util.concurrent.Future</code> return type
but also Spring&#8217;s <code>org.springframework.util.concurrent.ListenableFuture</code> or, as of Spring
4.2, JDK 8&#8217;s <code>java.util.concurrent.CompletableFuture</code>: for richer interaction with the
asynchronous task and for immediate composition with further processing steps.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@Async</code> can not be used in conjunction with lifecycle callbacks such as
<code>@PostConstruct</code>. To asynchronously initialize Spring beans you currently have to use
a separate initializing Spring bean that invokes the <code>@Async</code> annotated method on the
target then.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleBeanImpl</span> <span class="directive">implements</span> SampleBean {

    <span class="annotation">@Async</span>
    <span class="type">void</span> doSomething() {
        <span class="comment">// ...</span>
    }

}

<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleBeanInitializer</span> {

    <span class="directive">private</span> <span class="directive">final</span> SampleBean bean;

    <span class="directive">public</span> SampleBeanInitializer(SampleBean bean) {
        <span class="local-variable">this</span>.bean = bean;
    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> initialize() {
        bean.doSomething();
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is no direct XML equivalent for <code>@Async</code> since such methods should be designed
for asynchronous execution in the first place, not externally re-declared to be async.
However, you may manually set up Spring&#8217;s <code>AsyncExecutionInterceptor</code> with Spring AOP,
in combination with a custom pointcut.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-annotation-support-qualification"><a class="anchor" href="integration.html#scheduling-annotation-support-qualification"></a>7.4.4. Executor qualification with @Async</h4>
<div class="paragraph">
<p>By default when specifying <code>@Async</code> on a method, the executor that will be used is the
one supplied to the 'annotation-driven' element as described above. However, the <code>value</code>
attribute of the <code>@Async</code> annotation can be used when needing to indicate that an
executor other than the default should be used when executing a given method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Async</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">otherExecutor</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> doSomething(<span class="predefined-type">String</span> s) {
    <span class="comment">// this will be executed asynchronously by &quot;otherExecutor&quot;</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, "otherExecutor" may be the name of any <code>Executor</code> bean in the Spring
container, or may be the name of a <em>qualifier</em> associated with any <code>Executor</code>, e.g. as
specified with the <code>&lt;qualifier&gt;</code> element or Spring&#8217;s <code>@Qualifier</code> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-annotation-support-exception"><a class="anchor" href="integration.html#scheduling-annotation-support-exception"></a>7.4.5. Exception management with @Async</h4>
<div class="paragraph">
<p>When an <code>@Async</code> method has a <code>Future</code> typed return value, it is easy to manage
an exception that was thrown during the method execution as this exception will
be thrown when calling <code>get</code> on the <code>Future</code> result. With a void return type
however, the exception is uncaught and cannot be transmitted. For those cases, an
<code>AsyncUncaughtExceptionHandler</code> can be provided to handle such exceptions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAsyncUncaughtExceptionHandler</span> <span class="directive">implements</span> AsyncUncaughtExceptionHandler {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> handleUncaughtException(<span class="predefined-type">Throwable</span> ex, <span class="predefined-type">Method</span> method, <span class="predefined-type">Object</span>... params) {
        <span class="comment">// handle exception</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the exception is simply logged. A custom <code>AsyncUncaughtExceptionHandler</code> can
be defined <em>via</em> <code>AsyncConfigurer</code> or the <code>task:annotation-driven</code> XML element.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-task-namespace"><a class="anchor" href="integration.html#scheduling-task-namespace"></a>7.5. The task namespace</h3>
<div class="paragraph">
<p>Beginning with Spring 3.0, there is an XML namespace for configuring <code>TaskExecutor</code> and
<code>TaskScheduler</code> instances. It also provides a convenient way to configure tasks to be
scheduled with a trigger.</p>
</div>
<div class="sect3">
<h4 id="scheduling-task-namespace-scheduler"><a class="anchor" href="integration.html#scheduling-task-namespace-scheduler"></a>7.5.1. The 'scheduler' element</h4>
<div class="paragraph">
<p>The following element will create a <code>ThreadPoolTaskScheduler</code> instance with the
specified thread pool size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:scheduler</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scheduler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value provided for the 'id' attribute will be used as the prefix for thread names
within the pool. The 'scheduler' element is relatively straightforward. If you do not
provide a 'pool-size' attribute, the default thread pool will only have a single thread.
There are no other configuration options for the scheduler.</p>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-task-namespace-executor"><a class="anchor" href="integration.html#scheduling-task-namespace-executor"></a>7.5.2. The 'executor' element</h4>
<div class="paragraph">
<p>The following will create a <code>ThreadPoolTaskExecutor</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:executor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">executor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with the scheduler above, the value provided for the 'id' attribute will be used as
the prefix for thread names within the pool. As far as the pool size is concerned, the
'executor' element supports more configuration options than the 'scheduler' element. For
one thing, the thread pool for a <code>ThreadPoolTaskExecutor</code> is itself more configurable.
Rather than just a single size, an executor&#8217;s thread pool may have different values for
the <em>core</em> and the <em>max</em> size. If a single value is provided then the executor will
have a fixed-size thread pool (the core and max sizes are the same). However, the
'executor' element&#8217;s 'pool-size' attribute also accepts a range in the form of "min-max".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:executor</span>
        <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorWithPoolSizeRange</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5-25</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">queue-capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from that configuration, a 'queue-capacity' value has also been provided.
The configuration of the thread pool should also be considered in light of the
executor&#8217;s queue capacity. For the full description of the relationship between pool
size and queue capacity, consult the documentation for
<a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html">ThreadPoolExecutor</a>.
The main idea is that when a task is submitted, the executor will first try to use a
free thread if the number of active threads is currently less than the core size. If the
core size has been reached, then the task will be added to the queue as long as its
capacity has not yet been reached. Only then, if the queue&#8217;s capacity <em>has</em> been
reached, will the executor create a new thread beyond the core size. If the max size has
also been reached, then the executor will reject the task.</p>
</div>
<div class="paragraph">
<p>By default, the queue is <em>unbounded</em>, but this is rarely the desired configuration,
because it can lead to <code>OutOfMemoryErrors</code> if enough tasks are added to that queue while
all pool threads are busy. Furthermore, if the queue is unbounded, then the max size has
no effect at all. Since the executor will always try the queue before creating a new
thread beyond the core size, a queue must have a finite capacity for the thread pool to
grow beyond the core size (this is why a <em>fixed size</em> pool is the only sensible case
when using an unbounded queue).</p>
</div>
<div class="paragraph">
<p>In a moment, we will review the effects of the keep-alive setting which adds yet another
factor to consider when providing a pool size configuration. First, let&#8217;s consider the
case, as mentioned above, when a task is rejected. By default, when a task is rejected,
a thread pool executor will throw a <code>TaskRejectedException</code>. However, the rejection
policy is actually configurable. The exception is thrown when using the default
rejection policy which is the <code>AbortPolicy</code> implementation. For applications where some
tasks can be skipped under heavy load, either the <code>DiscardPolicy</code> or
<code>DiscardOldestPolicy</code> may be configured instead. Another option that works well for
applications that need to throttle the submitted tasks under heavy load is the
<code>CallerRunsPolicy</code>. Instead of throwing an exception or discarding tasks, that policy
will simply force the thread that is calling the submit method to run the task itself.
The idea is that such a caller will be busy while running that task and not able to
submit other tasks immediately. Therefore it provides a simple way to throttle the
incoming load while maintaining the limits of the thread pool and queue. Typically this
allows the executor to "catch up" on the tasks it is handling and thereby frees up some
capacity on the queue, in the pool, or both. Any of these options can be chosen from an
enumeration of values available for the 'rejection-policy' attribute on the 'executor'
element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:executor</span>
        <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorWithCallerRunsPolicy</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5-25</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">queue-capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">rejection-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CALLER_RUNS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>keep-alive</code> setting determines the time limit (in seconds) for which threads
may remain idle before being terminated. If there are more than the core number of threads
currently in the pool, after waiting this amount of time without processing a task, excess
threads will get terminated. A time value of zero will cause excess threads to terminate
immediately after executing a task without remaining follow-up work in the task queue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:executor</span>
        <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorWithKeepAlive</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5-25</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">keep-alive</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">120</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-task-namespace-scheduled-tasks"><a class="anchor" href="integration.html#scheduling-task-namespace-scheduled-tasks"></a>7.5.3. The 'scheduled-tasks' element</h4>
<div class="paragraph">
<p>The most powerful feature of Spring&#8217;s task namespace is the support for configuring
tasks to be scheduled within a Spring Application Context. This follows an approach
similar to other "method-invokers" in Spring, such as that provided by the JMS namespace
for configuring Message-driven POJOs. Basically a "ref" attribute can point to any
Spring-managed object, and the "method" attribute provides the name of a method to be
invoked on that object. Here is a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:scheduled-tasks</span> <span class="attribute-name">scheduler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;task:scheduled</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">methodA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fixed-delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/task:scheduled-tasks&gt;</span>

<span class="tag">&lt;task:scheduler</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the scheduler is referenced by the outer element, and each individual
task includes the configuration of its trigger metadata. In the preceding example, that
metadata defines a periodic trigger with a fixed delay indicating the number of
milliseconds to wait after each task execution has completed. Another option is
'fixed-rate', indicating how often the method should be executed regardless of how long
any previous execution takes. Additionally, for both fixed-delay and fixed-rate tasks an
'initial-delay' parameter may be specified indicating the number of milliseconds to wait
before the first execution of the method. For more control, a "cron" attribute may be
provided instead. Here is an example demonstrating these other options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:scheduled-tasks</span> <span class="attribute-name">scheduler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;task:scheduled</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">methodA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fixed-delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;task:scheduled</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">methodB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fixed-rate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;task:scheduled</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beanC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">methodC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cron</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/5 * * * * MON-FRI</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/task:scheduled-tasks&gt;</span>

<span class="tag">&lt;task:scheduler</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pool-size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-quartz"><a class="anchor" href="integration.html#scheduling-quartz"></a>7.6. Using the Quartz Scheduler</h3>
<div class="paragraph">
<p>Quartz uses <code>Trigger</code>, <code>Job</code> and <code>JobDetail</code> objects to realize scheduling of all kinds
of jobs. For the basic concepts behind Quartz, have a look at
<a href="http://quartz-scheduler.org" class="bare">http://quartz-scheduler.org</a>. For convenience purposes, Spring offers a couple of
classes that simplify the usage of Quartz within Spring-based applications.</p>
</div>
<div class="sect3">
<h4 id="scheduling-quartz-jobdetail"><a class="anchor" href="integration.html#scheduling-quartz-jobdetail"></a>7.6.1. Using the JobDetailFactoryBean</h4>
<div class="paragraph">
<p>Quartz <code>JobDetail</code> objects contain all information needed to run a job. Spring provides a
<code>JobDetailFactoryBean</code> which provides bean-style properties for XML configuration purposes.
Let&#8217;s have a look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.JobDetailFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobClass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.ExampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDataAsMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The job detail configuration has all information it needs to run the job (<code>ExampleJob</code>).
The timeout is specified in the job data map. The job data map is available through the
<code>JobExecutionContext</code> (passed to you at execution time), but the <code>JobDetail</code> also gets
its properties from the job data mapped to properties of the job instance. So in this
case, if the <code>ExampleJob</code> contains a bean property named <code>timeout</code>, the <code>JobDetail</code>
will have it applied automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleJob</span> <span class="directive">extends</span> QuartzJobBean {

    <span class="directive">private</span> <span class="type">int</span> timeout;

    <span class="comment">/**
     * Setter called after the ExampleJob is instantiated
     * with the value from the JobDetailFactoryBean (5)
     */</span>
    <span class="directive">public</span> <span class="type">void</span> setTimeout(<span class="type">int</span> timeout) {
        <span class="local-variable">this</span>.timeout = timeout;
    }

    <span class="directive">protected</span> <span class="type">void</span> executeInternal(JobExecutionContext ctx) <span class="directive">throws</span> JobExecutionException {
        <span class="comment">// do the actual work</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All additional properties from the job data map are of course available to you as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the <code>name</code> and <code>group</code> properties, you can modify the name and the group
of the job, respectively. By default, the name of the job matches the bean name
of the <code>JobDetailFactoryBean</code> (in the example above, this is <code>exampleJob</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-quartz-method-invoking-job"><a class="anchor" href="integration.html#scheduling-quartz-method-invoking-job"></a>7.6.2. Using the MethodInvokingJobDetailFactoryBean</h4>
<div class="paragraph">
<p>Often you just need to invoke a method on a specific object. Using the
<code>MethodInvokingJobDetailFactoryBean</code> you can do exactly this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetail</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBusinessObject</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doIt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will result in the <code>doIt</code> method being called on the
<code>exampleBusinessObject</code> method (see below):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleBusinessObject</span> {

    <span class="comment">// properties and collaborators</span>

    <span class="directive">public</span> <span class="type">void</span> doIt() {
        <span class="comment">// do the actual work</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBusinessObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examples.ExampleBusinessObject</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>MethodInvokingJobDetailFactoryBean</code>, you don&#8217;t need to create one-line jobs
that just invoke a method, and you only need to create the actual business object and
wire up the detail object.</p>
</div>
<div class="paragraph">
<p>By default, Quartz Jobs are stateless, resulting in the possibility of jobs interfering
with each other. If you specify two triggers for the same <code>JobDetail</code>, it might be
possible that before the first job has finished, the second one will start. If
<code>JobDetail</code> classes implement the <code>Stateful</code> interface, this won&#8217;t happen. The second
job will not start before the first one has finished. To make jobs resulting from the
<code>MethodInvokingJobDetailFactoryBean</code> non-concurrent, set the <code>concurrent</code> flag to
<code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetail</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleBusinessObject</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doIt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concurrent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, jobs will run in a concurrent fashion.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-quartz-cron"><a class="anchor" href="integration.html#scheduling-quartz-cron"></a>7.6.3. Wiring up jobs using triggers and the SchedulerFactoryBean</h4>
<div class="paragraph">
<p>We&#8217;ve created job details and jobs. We&#8217;ve also reviewed the convenience bean that allows
you to invoke a method on a specific object. Of course, we still need to schedule the
jobs themselves. This is done using triggers and a <code>SchedulerFactoryBean</code>. Several
triggers are available within Quartz and Spring offers two Quartz <code>FactoryBean</code>
implementations with convenient defaults: <code>CronTriggerFactoryBean</code> and
<code>SimpleTriggerFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>Triggers need to be scheduled. Spring offers a <code>SchedulerFactoryBean</code> that exposes
triggers to be set as properties. <code>SchedulerFactoryBean</code> schedules the actual jobs with
those triggers.</p>
</div>
<div class="paragraph">
<p>Find below a couple of examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleTrigger</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.SimpleTriggerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- see the example of method invoking job above --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetail</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetail</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- 10 seconds --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">startDelay</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- repeat every 50 seconds --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repeatInterval</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cronTrigger</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.CronTriggerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobDetail</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- run every morning at 6 AM --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cronExpression</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0 0 6 * * ?</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;ve set up two triggers, one running every 50 seconds with a starting delay of 10
seconds and one every morning at 6 AM. To finalize everything, we need to set up the
<code>SchedulerFactoryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.scheduling.quartz.SchedulerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">triggers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cronTrigger</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleTrigger</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More properties are available for the <code>SchedulerFactoryBean</code> for you to set, such as the
calendars used by the job details, properties to customize Quartz with, etc. Have a look
at the
<a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/scheduling/quartz/SchedulerFactoryBean.html"><code>SchedulerFactoryBean</code>
javadocs</a> for more information.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cache"><a class="anchor" href="integration.html#cache"></a>8. Cache Abstraction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cache-introduction"><a class="anchor" href="integration.html#cache-introduction"></a>8.1. Introduction</h3>
<div class="paragraph">
<p>Since version 3.1, Spring Framework provides support for transparently adding caching
into an existing Spring application. Similar to the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">transaction</a>
support, the caching abstraction allows consistent use of various caching solutions with minimal
impact on the code.</p>
</div>
<div class="paragraph">
<p>As from Spring 4.1, the cache abstraction has been significantly improved with the
support of <a href="integration.html#cache-jsr-107">JSR-107 annotations</a> and more customization options.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache-strategies"><a class="anchor" href="integration.html#cache-strategies"></a>8.2. Understanding the cache abstraction</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Cache vs Buffer</div>
<div class="paragraph">
<p>The terms "buffer" and "cache" tend to be used interchangeably; note however they
represent different things. A buffer is used traditionally as an intermediate temporary
store for data between a fast and a slow entity. As one party would have to <em>wait</em> for
the other affecting performance, the buffer alleviates this by allowing entire blocks of
data to move at once rather then in small chunks. The data is written and read only once
from the buffer. Furthermore, the buffers are <em>visible</em> to at least one party which is
aware of it.</p>
</div>
<div class="paragraph">
<p>A cache on the other hand by definition is hidden and neither party is aware that
caching occurs.It as well improves performance but does that by allowing the same data
to be read multiple times in a fast fashion.</p>
</div>
<div class="paragraph">
<p>A further explanation of the differences between two can be found
<a href="https://en.wikipedia.org/wiki/Cache_(computing)#The_difference_between_buffer_and_cache">here</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>At its core, the abstraction applies caching to Java methods, reducing thus the number
of executions based on the information available in the cache. That is, each time a
<em>targeted</em> method is invoked, the abstraction will apply a caching behavior checking
whether the method has been already executed for the given arguments. If it has, then
the cached result is returned without having to execute the actual method; if it has
not, then method is executed, the result cached and returned to the user so that, the
next time the method is invoked, the cached result is returned. This way, expensive
methods (whether CPU or IO bound) can be executed only once for a given set of
parameters and the result reused without having to actually execute the method again.
The caching logic is applied transparently without any interference to the invoker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Obviously this approach works only for methods that are guaranteed to return the same
output (result) for a given input (or arguments) no matter how many times it is being
executed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other cache-related operations are provided by the abstraction such as the ability
to update the content of the cache or remove one of all entries. These are useful if
the cache deals with data that can change during the course of the application.</p>
</div>
<div class="paragraph">
<p>Just like other services in the Spring Framework, the caching service is an
abstraction (not a cache implementation) and requires the use of an actual storage to
store the cache data - that is, the abstraction frees the developer from having to write
the caching logic but does not provide the actual stores. This abstraction is
materialized by the <code>org.springframework.cache.Cache</code> and
<code>org.springframework.cache.CacheManager</code> interfaces.</p>
</div>
<div class="paragraph">
<p>There are <a href="integration.html#cache-store-configuration">a few implementations</a> of that abstraction
available out of the box: JDK <code>java.util.concurrent.ConcurrentMap</code> based caches,
<a href="http://ehcache.org/">Ehcache 2.x</a>, Gemfire cache,
<a href="https://github.com/ben-manes/caffeine/wiki">Caffeine</a> and JSR-107 compliant
caches (e.g. Ehcache 3.x). See <a href="integration.html#cache-plug">Plugging-in different back-end caches</a> for more information on plugging in
other cache stores/providers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The caching abstraction has no special handling of multi-threaded and multi-process
environments as such features are handled by the cache implementation. .</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have a multi-process environment (i.e. an application deployed on several nodes),
you will need to configure your cache provider accordingly. Depending on your use cases,
a copy of the same data on several nodes may be enough but if you change the data during
the course of the application, you may need to enable other propagation mechanisms.</p>
</div>
<div class="paragraph">
<p>Caching a particular item is a direct equivalent of the typical get-if-not-found-then-
proceed-and-put-eventually code blocks found with programmatic cache interaction: no locks
are applied and several threads may try to load the same item concurrently. The same applies
to eviction: if several threads are trying to update or evict data concurrently, you may
use stale data. Certain cache providers offer advanced features in that area, refer to
the documentation of the cache provider that you are using for more details.</p>
</div>
<div class="paragraph">
<p>To use the cache abstraction, the developer needs to take care of two aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>caching declaration - identify the methods that need to be cached and their policy</p>
</li>
<li>
<p>cache configuration - the backing cache where the data is stored and read from</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cache-annotations"><a class="anchor" href="integration.html#cache-annotations"></a>8.3. Declarative annotation-based caching</h3>
<div class="paragraph">
<p>For caching declaration, the abstraction provides a set of Java annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Cacheable</code> triggers cache population</p>
</li>
<li>
<p><code>@CacheEvict</code> triggers cache eviction</p>
</li>
<li>
<p><code>@CachePut</code> updates the cache without interfering with the method execution</p>
</li>
<li>
<p><code>@Caching</code> regroups multiple cache operations to be applied on a method</p>
</li>
<li>
<p><code>@CacheConfig</code> shares some common cache-related settings at class-level</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us take a closer look at each annotation:</p>
</div>
<div class="sect3">
<h4 id="cache-annotations-cacheable"><a class="anchor" href="integration.html#cache-annotations-cacheable"></a>8.3.1. @Cacheable annotation</h4>
<div class="paragraph">
<p>As the name implies, <code>@Cacheable</code> is used to demarcate methods that are cacheable - that
is, methods for whom the result is stored into the cache so on subsequent invocations
(with the same arguments), the value in the cache is returned without having to actually
execute the method. In its simplest form, the annotation declaration requires the name
of the cache associated with the annotated method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, the method <code>findBook</code> is associated with the cache named <code>books</code>.
Each time the method is called, the cache is checked to see whether the invocation has
been already executed and does not have to be repeated. While in most cases, only one
cache is declared, the annotation allows multiple names to be specified so that more
than one cache are being used. In this case, each of the caches will be checked before
executing the method - if at least one cache is hit, then the associated value will be
returned:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the other caches that do not contain the value will be updated as well even though
the cached method was not actually executed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">isbns</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-default-key"><a class="anchor" href="integration.html#cache-annotations-cacheable-default-key"></a>Default Key Generation</h5>
<div class="paragraph">
<p>Since caches are essentially key-value stores, each invocation of a cached method needs
to be translated into a suitable key for cache access. Out of the box, the caching
abstraction uses a simple <code>KeyGenerator</code> based on the following algorithm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no params are given, return <code>SimpleKey.EMPTY</code>.</p>
</li>
<li>
<p>If only one param is given, return that instance.</p>
</li>
<li>
<p>If more the one param is given, return a <code>SimpleKey</code> containing all parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach works well for most use-cases; As long as parameters have <em>natural keys</em>
and implement valid <code>hashCode()</code> and <code>equals()</code> methods. If that is not the case then the
strategy needs to be changed.</p>
</div>
<div class="paragraph">
<p>To provide a different <em>default</em> key generator, one needs to implement the
<code>org.springframework.cache.interceptor.KeyGenerator</code> interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default key generation strategy changed with the release of Spring 4.0. Earlier
versions of Spring used a key generation strategy that, for multiple key parameters,
only considered the <code>hashCode()</code> of parameters and not <code>equals()</code>; this could cause
unexpected key collisions (see <a href="https://jira.spring.io/browse/SPR-10237">SPR-10237</a>
for background). The new 'SimpleKeyGenerator' uses a compound key for such scenarios.</p>
</div>
<div class="paragraph">
<p>If you want to keep using the previous key strategy, you can configure the deprecated
<code>org.springframework.cache.interceptor.DefaultKeyGenerator</code> class or create a custom
hash-based 'KeyGenerator' implementation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-key"><a class="anchor" href="integration.html#cache-annotations-cacheable-key"></a>Custom Key Generation Declaration</h5>
<div class="paragraph">
<p>Since caching is generic, it is quite likely the target methods have various signatures
that cannot be simply mapped on top of the cache structure. This tends to become obvious
when the target method has multiple arguments out of which only some are suitable for
caching (while the rest are used only by the method logic). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance, while the two <code>boolean</code> arguments influence the way the book is found,
they are no use for the cache. Further more what if only one of the two is important
while the other is not?</p>
</div>
<div class="paragraph">
<p>For such cases, the <code>@Cacheable</code> annotation allows the user to specify how the key is
generated through its <code>key</code> attribute. The developer can use <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">SpEL</a> to
pick the arguments of interest (or their nested properties), perform operations or even
invoke arbitrary methods without having to write any code or implement any interface.
This is the recommended approach over the
<a href="integration.html#cache-annotations-cacheable-default-key">default generator</a> since methods tend to be
quite different in signatures as the code base grows; while the default strategy might
work for some methods, it rarely does for all methods.</p>
</div>
<div class="paragraph">
<p>Below are some examples of various SpEL declarations - if you are not familiar with it,
do yourself a favor and read <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions">Spring Expression Language</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)

<span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn.rawNumber</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)

<span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>key=<span class="string"><span class="delimiter">&quot;</span><span class="content">T(someType).hash(#isbn)</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippets above show how easy it is to select a certain argument, one of its
properties or even an arbitrary (static) method.</p>
</div>
<div class="paragraph">
<p>If the algorithm responsible to generate the key is too specific or if it needs
to be shared, you may define a custom <code>keyGenerator</code> on the operation. To do
this, specify the name of the <code>KeyGenerator</code> bean implementation to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>keyGenerator=<span class="string"><span class="delimiter">&quot;</span><span class="content">myKeyGenerator</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>key</code> and <code>keyGenerator</code> parameters are mutually exclusive and an operation
specifying both will result in an exception.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-default-cache-resolver"><a class="anchor" href="integration.html#cache-annotations-cacheable-default-cache-resolver"></a>Default Cache Resolution</h5>
<div class="paragraph">
<p>Out of the box, the caching abstraction uses a simple <code>CacheResolver</code> that
retrieves the cache(s) defined at the operation level using the configured
<code>CacheManager</code>.</p>
</div>
<div class="paragraph">
<p>To provide a different <em>default</em> cache resolver, one needs to implement the
<code>org.springframework.cache.interceptor.CacheResolver</code> interface.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-cache-resolver"><a class="anchor" href="integration.html#cache-annotations-cacheable-cache-resolver"></a>Custom cache resolution</h5>
<div class="paragraph">
<p>The default cache resolution fits well for applications working with a
single <code>CacheManager</code> and with no complex cache resolution requirements.</p>
</div>
<div class="paragraph">
<p>For applications working with several cache managers, it is possible
to set the <code>cacheManager</code> to use per operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>cacheManager=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherCacheManager</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to replace the <code>CacheResolver</code> entirely in a similar
fashion as for <a href="integration.html#cache-annotations-cacheable-key">key generation</a>. The
resolution is requested for every cache operation, giving a chance to
the implementation to actually resolve the cache(s) to use based on
runtime arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(<strong>cacheResolver=<span class="string"><span class="delimiter">&quot;</span><span class="content">runtimeCacheResolver</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn) {...}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since Spring 4.1, the <code>value</code> attribute of the cache annotations are no longer
mandatory since this particular information can be provided by the <code>CacheResolver</code>
regardless of the content of the annotation.</p>
</div>
<div class="paragraph">
<p>Similarly to <code>key</code> and <code>keyGenerator</code>, the <code>cacheManager</code> and <code>cacheResolver</code>
parameters are mutually exclusive and an operation specifying both will
result in an exception as a custom <code>CacheManager</code> will be ignored by the
<code>CacheResolver</code> implementation. This is probably not what you expect.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-synchronized"><a class="anchor" href="integration.html#cache-annotations-cacheable-synchronized"></a>Synchronized caching</h5>
<div class="paragraph">
<p>In a multi-threaded environment, certain operations might be concurrently invoked for
the same argument (typically on startup). By default, the cache abstraction does not
lock anything and the same value may be computed several times, defeating the purpose
of caching.</p>
</div>
<div class="paragraph">
<p>For those particular cases, the <code>sync</code> attribute can be used to instruct the underlying
cache provider to <em>lock</em> the cache entry while the value is being computed. As a result,
only one thread will be busy computing the value while the others are blocked until the
entry is updated in the cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">foos</span><span class="delimiter">&quot;</span></span>, <strong>sync=<span class="predefined-constant">true</span></strong>)
<span class="directive">public</span> Foo executeExpensiveOperation(<span class="predefined-type">String</span> id) {...}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an optional feature and your favorite cache library may not support it. All
<code>CacheManager</code> implementations provided by the core framework support it. Check the
documentation of your cache provider for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cache-annotations-cacheable-condition"><a class="anchor" href="integration.html#cache-annotations-cacheable-condition"></a>Conditional caching</h5>
<div class="paragraph">
<p>Sometimes, a method might not be suitable for caching all the time (for example, it
might depend on the given arguments). The cache annotations support such functionality
through the <code>condition</code> parameter which takes a <code>SpEL</code> expression that is evaluated to
either <code>true</code> or <code>false</code>. If <code>true</code>, the method is cached - if not, it behaves as if the
method is not cached, that is executed every time no matter what values are in the cache
or what arguments are used. A quick example - the following method will be cached only
if the argument <code>name</code> has a length shorter than 32:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <strong>condition=<span class="string"><span class="delimiter">&quot;</span><span class="content">#name.length() &lt; 32</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition the <code>condition</code> parameter, the <code>unless</code> parameter can be used to veto the
adding of a value to the cache. Unlike <code>condition</code>, <code>unless</code> expressions are evaluated
<em>after</em> the method has been called. Expanding on the previous example - perhaps we
only want to cache paperback books:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, condition=<span class="string"><span class="delimiter">&quot;</span><span class="content">#name.length() &lt; 32</span><span class="delimiter">&quot;</span></span>, <strong>unless=<span class="string"><span class="delimiter">&quot;</span><span class="content">#result.hardback</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cache abstraction supports <code>java.util.Optional</code>, using its content as cached value
only if it present. <code>#result</code> always refers to the business entity and never on a
supported wrapper so the previous example can be rewritten as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, condition=<span class="string"><span class="delimiter">&quot;</span><span class="content">#name.length() &lt; 32</span><span class="delimiter">&quot;</span></span>, <strong>unless=<span class="string"><span class="delimiter">&quot;</span><span class="content">#result?.hardback</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> Optional&lt;<span class="predefined-type">Book</span>&gt; findBook(<span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>result</code> still refers to <code>Book</code> and not <code>Optional</code>. As it might be <code>null</code>, we
should use the safe navigation operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache-spel-context"><a class="anchor" href="integration.html#cache-spel-context"></a>Available caching SpEL evaluation context</h5>
<div class="paragraph">
<p>Each <code>SpEL</code> expression evaluates again a dedicated
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions-language-ref"><code>context</code></a>. In addition to the build in parameters, the
framework provides dedicated caching related metadata such as the argument names. The
next table lists the items made available to the context so one can use them for key and
conditional computations:</p>
</div>
<table id="cache-spel-context-tbl" class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Cache SpEL available metadata</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">methodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the method being invoked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.methodName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The method being invoked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.method.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target object being invoked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.target</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class of the target being invoked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.targetClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The arguments (as array) used for invoking the target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.args[0]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">caches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of caches against which the current method is executed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#root.caches[0].name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>argument name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluation context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of any of the method arguments. If for some reason the names are not available
(e.g. no debug information), the argument names are also available under the <code>#a&lt;#arg&gt;</code>
where <em>#arg</em> stands for the argument index (starting from 0).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#iban</code> or <code>#a0</code> (one can also use <code>#p0</code> or <code>#p&lt;#arg&gt;</code> notation as an alias).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluation context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The result of the method call (the value to be cached). Only available in <code>unless</code>
expressions, <code>cache put</code> expressions (to compute the <code>key</code>), or <code>cache evict</code>
expressions (when <code>beforeInvocation</code> is <code>false</code>). For supported wrappers such as
<code>Optional</code>, <code>#result</code> refers to the actual object, not the wrapper.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#result</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotations-put"><a class="anchor" href="integration.html#cache-annotations-put"></a>8.3.2. @CachePut annotation</h4>
<div class="paragraph">
<p>For cases where the cache needs to be updated without interfering with the method
execution, one can use the <code>@CachePut</code> annotation. That is, the method will always be
executed and its result placed into the cache (according to the <code>@CachePut</code> options). It
supports the same options as <code>@Cacheable</code> and should be used for cache population rather
than method flow optimization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CachePut</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> updateBook(ISBN isbn, BookDescriptor descriptor)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that using <code>@CachePut</code> and <code>@Cacheable</code> annotations on the same method is generally
strongly discouraged because they have different behaviors. While the latter causes the
method execution to be skipped by using the cache, the former forces the execution in
order to execute a cache update. This leads to unexpected behavior and with the exception of
specific corner-cases (such as annotations having conditions that exclude them from each
other), such declaration should be avoided. Note also that such condition should not rely
on the result object (i.e. the <code>#result</code> variable) as these are validated upfront to confirm
the exclusion.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotations-evict"><a class="anchor" href="integration.html#cache-annotations-evict"></a>8.3.3. @CacheEvict annotation</h4>
<div class="paragraph">
<p>The cache abstraction allows not just population of a cache store but also eviction.
This process is useful for removing stale or unused data from the cache. Opposed to
<code>@Cacheable</code>, annotation <code>@CacheEvict</code> demarcates methods that perform cache
<em>eviction</em>, that is methods that act as triggers for removing data from the cache.
Just like its sibling, <code>@CacheEvict</code> requires specifying one (or multiple) caches
that are affected by the action, allows a custom cache and key resolution or a
condition to be specified but in addition, features an extra parameter
<code>allEntries</code> which indicates whether a cache-wide eviction needs to be performed
rather then just an entry one (based on the key):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CacheEvict</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>allEntries=<span class="predefined-constant">true</span></strong>)
<span class="directive">public</span> <span class="type">void</span> loadBooks(<span class="predefined-type">InputStream</span> batch)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This option comes in handy when an entire cache region needs to be cleared out - rather
then evicting each entry (which would take a long time since it is inefficient), all the
entries are removed in one operation as shown above. Note that the framework will ignore
any key specified in this scenario as it does not apply (the entire cache is evicted not
just one entry).</p>
</div>
<div class="paragraph">
<p>One can also indicate whether the eviction should occur after (the default) or before
the method executes through the <code>beforeInvocation</code> attribute. The former provides the
same semantics as the rest of the annotations - once the method completes successfully,
an action (in this case eviction) on the cache is executed. If the method does not
execute (as it might be cached) or an exception is thrown, the eviction does not occur.
The latter ( <code>beforeInvocation=true</code>) causes the eviction to occur always, before the
method is invoked - this is useful in cases where the eviction does not need to be tied
to the method outcome.</p>
</div>
<div class="paragraph">
<p>It is important to note that void methods can be used with <code>@CacheEvict</code> - as the
methods act as triggers, the return values are ignored (as they don&#8217;t interact with the
cache) - this is not the case with <code>@Cacheable</code> which adds/updates data into the cache
and thus requires a result.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotations-caching"><a class="anchor" href="integration.html#cache-annotations-caching"></a>8.3.4. @Caching annotation</h4>
<div class="paragraph">
<p>There are cases when multiple annotations of the same type, such as <code>@CacheEvict</code> or
<code>@CachePut</code> need to be specified, for example because the condition or the key
expression is different between different caches. <code>@Caching</code> allows multiple nested
<code>@Cacheable</code>, <code>@CachePut</code> and <code>@CacheEvict</code> to be used on the same method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Caching</span>(evict = { <span class="annotation">@CacheEvict</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">primary</span><span class="delimiter">&quot;</span></span>), <span class="annotation">@CacheEvict</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">secondary</span><span class="delimiter">&quot;</span></span>, key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#p0</span><span class="delimiter">&quot;</span></span>) })
<span class="directive">public</span> <span class="predefined-type">Book</span> importBooks(<span class="predefined-type">String</span> deposit, <span class="predefined-type">Date</span> date)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotations-config"><a class="anchor" href="integration.html#cache-annotations-config"></a>8.3.5. @CacheConfig annotation</h4>
<div class="paragraph">
<p>So far we have seen that caching operations offered many customization options and
these can be set on an operation basis. However, some of the customization options
can be tedious to configure if they apply to all operations of the class. For
instance, specifying the name of the cache to use for every cache operation of the
class could be replaced by a single class-level definition. This is where <code>@CacheConfig</code>
comes into play.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><strong><span class="annotation">@CacheConfig</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookRepositoryImpl</span> <span class="directive">implements</span> BookRepository {

    <span class="annotation">@Cacheable</span>
    <span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn) {...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@CacheConfig</code> is a class-level annotation that allows to share the cache names, the custom
<code>KeyGenerator</code>, the custom <code>CacheManager</code> and finally the custom <code>CacheResolver</code>. Placing
this annotation on the class does not turn on any caching operation.</p>
</div>
<div class="paragraph">
<p>An operation-level customization will always override a customization set on <code>@CacheConfig</code>. This
gives therefore three levels of customizations per cache operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Globally configured, available for <code>CacheManager</code>, <code>KeyGenerator</code></p>
</li>
<li>
<p>At class level, using <code>@CacheConfig</code></p>
</li>
<li>
<p>At the operation level</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotation-enable"><a class="anchor" href="integration.html#cache-annotation-enable"></a>8.3.6. Enable caching annotations</h4>
<div class="paragraph">
<p>It is important to note that even though declaring the cache annotations does not
automatically trigger their actions - like many things in Spring, the feature has to be
declaratively enabled (which means if you ever suspect caching is to blame, you can
disable it by removing only one configuration line rather than all the annotations in
your code).</p>
</div>
<div class="paragraph">
<p>To enable caching annotations add the annotation <code>@EnableCaching</code> to one of your
<code>@Configuration</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableCaching</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively for XML configuration use the <code>cache:annotation-driven</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/cache</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;cache:annotation-driven</span> <span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both the <code>cache:annotation-driven</code> element and <code>@EnableCaching</code> annotation allow various
options to be specified that influence the way the caching behavior is added to the
application through AOP. The configuration is intentionally similar with that of
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#tx-annotation-driven-settings"><code>@Transactional</code></a>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default advice mode for processing caching annotations is "proxy" which allows
for interception of calls through the proxy only; local calls within the same class
cannot get intercepted that way. For a more advanced mode of interception, consider
switching to "aspectj" mode in combination with compile-time or load-time weaving.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Advanced customizations using Java config require to implement <code>CachingConfigurer</code>:
Please refer to <a href="https://docs.spring.io/spring-framework/docs/5.0.4.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html">the
javadoc for more details</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="cache-annotation-driven-settings" class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. Cache annotation settings</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XML Attribute</th>
<th class="tableblock halign-left valign-top">Annotation Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache-manager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A (See <code>CachingConfigurer</code> javadocs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cacheManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of cache manager to use. A default <code>CacheResolver</code> will be initialized behind
the scenes with this cache manager (or `cacheManager`if not set). For more
fine-grained management of the cache resolution, consider setting the 'cache-resolver'
attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache-resolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A (See <code>CachingConfigurer</code> javadocs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>SimpleCacheResolver</code> using the configured <code>cacheManager</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bean name of the CacheResolver that is to be used to resolve the backing caches.
This attribute is not required, and only needs to be specified as an alternative to
the 'cache-manager' attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key-generator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A (See <code>CachingConfigurer</code> javadocs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleKeyGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the custom key generator to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error-handler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A (See <code>CachingConfigurer</code> javadocs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleCacheErrorHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the custom cache error handler to use. By default, any exception throw during
a cache related operations are thrown back at the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default mode "proxy" processes annotated beans to be proxied using Spring&#8217;s AOP
framework (following proxy semantics, as discussed above, applying to method calls
coming in through the proxy only). The alternative mode "aspectj" instead weaves the
affected classes with Spring&#8217;s AspectJ caching aspect, modifying the target class byte
code to apply to any kind of method call. AspectJ weaving requires spring-aspects.jar
in the classpath as well as load-time weaving (or compile-time weaving) enabled. (See
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop-aj-ltw-spring">Spring configuration</a> for details on how to set up
load-time weaving.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy-target-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxyTargetClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applies to proxy mode only. Controls what type of caching proxies are created for
classes annotated with the <code>@Cacheable</code> or <code>@CacheEvict</code> annotations. If the
<code>proxy-target-class</code> attribute is set to <code>true</code>, then class-based proxies are created.
If <code>proxy-target-class</code> is <code>false</code> or if the attribute is omitted, then standard JDK
interface-based proxies are created. (See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop-proxying">Proxying mechanisms</a>
for a detailed examination of the different proxy types.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered.LOWEST_PRECEDENCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the order of the cache advice that is applied to beans annotated with
<code>@Cacheable</code> or <code>@CacheEvict</code>. (For more information about the rules related to
ordering of AOP advice, see <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop-ataspectj-advice-ordering">Advice ordering</a>.)
No specified ordering means that the AOP subsystem determines the order of the advice.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>&lt;cache:annotation-driven/&gt;</code> only looks for <code>@Cacheable/@CachePut/@CacheEvict/@Caching</code>
on beans in the same application context it is defined in. This means that, if you put
<code>&lt;cache:annotation-driven/&gt;</code> in a <code>WebApplicationContext</code> for a <code>DispatcherServlet</code>, it
only checks for beans in your controllers, and not your services.
See <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-servlet">the MVC section</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Method visibility and cache annotations</div>
<div class="paragraph">
<p>When using proxies, you should apply the cache annotations only to methods with
<em>public</em> visibility. If you do annotate protected, private or package-visible methods
with these annotations, no error is raised, but the annotated method does not exhibit
the configured caching settings. Consider the use of AspectJ (see below) if you need to
annotate non-public methods as it changes the bytecode itself.</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring recommends that you only annotate concrete classes (and methods of concrete
classes) with the <code>@Cache*</code> annotation, as opposed to annotating interfaces. You
certainly can place the <code>@Cache*</code> annotation on an interface (or an interface method),
but this works only as you would expect it to if you are using interface-based proxies.
The fact that Java annotations are <em>not inherited from interfaces</em> means that if you
are using class-based proxies ( <code>proxy-target-class="true"</code>) or the weaving-based aspect
( <code>mode="aspectj"</code>), then the caching settings are not recognized by the proxying and
weaving infrastructure, and the object will not be wrapped in a caching proxy, which
would be decidedly <em>bad</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In proxy mode (which is the default), only external method calls coming in through the
proxy are intercepted. This means that self-invocation, in effect, a method within the
target object calling another method of the target object, will not lead to an actual
caching at runtime even if the invoked method is marked with <code>@Cacheable</code> - considering
using the aspectj mode in this case. Also, the proxy must be fully initialized to provide
the expected behaviour so you should not rely on this feature in your initialization
code, i.e. <code>@PostConstruct</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cache-annotation-stereotype"><a class="anchor" href="integration.html#cache-annotation-stereotype"></a>8.3.7. Using custom annotations</h4>
<div class="sidebarblock">
<div class="content">
<div class="title">Custom annotation and AspectJ</div>
<div class="paragraph">
<p>This feature only works out-of-the-box with the proxy-based approach but can be enabled
with a bit of extra effort using AspectJ.</p>
</div>
<div class="paragraph">
<p>The <code>spring-aspects</code> module defines an aspect for the standard annotations only. If you
have defined your own annotations, you also need to define an aspect for those. Check
<code>AnnotationCacheAspect</code> for an example.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The caching abstraction allows you to use your own annotations to identify what method
triggers cache population or eviction. This is quite handy as a template mechanism as it
eliminates the need to duplicate cache annotation declarations (especially useful if the
key or condition are specified) or if the foreign imports (<code>org.springframework</code>) are
not allowed in your code base. Similar to the rest of the
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-stereotype-annotations">stereotype</a> annotations, <code>@Cacheable</code>, <code>@CachePut</code>,
<code>@CacheEvict</code> and <code>@CacheConfig</code> can be used as <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-meta-annotations">meta-annotations</a>,
that is annotations that can annotate other annotations. To wit, let us replace a common
<code>@Cacheable</code> declaration with our own, custom annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD})
<span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="annotation">@interface</span> SlowService {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above, we have defined our own <code>SlowService</code> annotation which itself is annotated with
<code>@Cacheable</code> - now we can replace the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SlowService</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though <code>@SlowService</code> is not a Spring annotation, the container automatically picks
up its declaration at runtime and understands its meaning. Note that as mentioned
<a href="integration.html#cache-annotation-enable">above</a>, the annotation-driven behavior needs to be enabled.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache-jsr-107"><a class="anchor" href="integration.html#cache-jsr-107"></a>8.4. JCache (JSR-107) annotations</h3>
<div class="paragraph">
<p>Since the Spring Framework 4.1, the caching abstraction fully supports the JCache
standard annotations: these are <code>@CacheResult</code>, <code>@CachePut</code>, <code>@CacheRemove</code> and
<code>@CacheRemoveAll</code> as well as the <code>@CacheDefaults</code>, <code>@CacheKey</code> and <code>@CacheValue</code>
companions. These annotations can be used right the way without migrating your
cache store to JSR-107: the internal implementation uses Spring&#8217;s caching abstraction
and provides default <code>CacheResolver</code> and <code>KeyGenerator</code> implementations that are
compliant with the specification. In other words, if you are already using Spring&#8217;s
caching abstraction, you can switch to these standard annotations without changing
your cache storage (or configuration, for that matter).</p>
</div>
<div class="sect3">
<h4 id="cache-jsr-107-summary"><a class="anchor" href="integration.html#cache-jsr-107-summary"></a>8.4.1. Feature summary</h4>
<div class="paragraph">
<p>For those who are familiar with Spring&#8217;s caching annotations, the following table
describes the main differences between the Spring annotations and the JSR-107
counterpart:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Spring vs. JSR-107 caching annotations</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spring</th>
<th class="tableblock halign-left valign-top">JSR-107</th>
<th class="tableblock halign-left valign-top">Remark</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Cacheable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fairly similar. <code>@CacheResult</code> can cache specific exceptions and force the
execution of the method regardless of the content of the cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CachePut</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CachePut</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">While Spring updates the cache with the result of the method invocation, JCache
requires to pass it as an argument that is annotated with <code>@CacheValue</code>. Due
to this difference, JCache allows to update the cache before or after the
actual method invocation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheEvict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheRemove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fairly similar. <code>@CacheRemove</code> supports a conditional evict in case the
method invocation results in an exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheEvict(allEntries=true)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheRemoveAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <code>@CacheRemove</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CacheDefaults</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to configure the same concepts, in a similar fashion.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>JCache has the notion of <code>javax.cache.annotation.CacheResolver</code> that is identical
to the Spring&#8217;s <code>CacheResolver</code> interface, except that JCache only supports a single
cache. By default, a simple implementation retrieves the cache to use based on
the name declared on the annotation. It should be noted that if no cache name
is specified on the annotation, a default is automatically generated, check the
javadoc of <code>@CacheResult#cacheName()</code> for more information.</p>
</div>
<div class="paragraph">
<p><code>CacheResolver</code> instances are retrieved by a <code>CacheResolverFactory</code>. It is
possible to customize the factory per cache operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CacheResult</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>cacheResolverFactory=MyCacheResolverFactory.class</strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For all referenced <em>classes</em>, Spring tries to locate a bean with the given type. If
more than one match exists, a new instance is created and can use the regular
bean lifecycle callbacks such as dependency injection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keys are generated by a <code>javax.cache.annotation.CacheKeyGenerator</code> that serves the
same purpose as Spring&#8217;s <code>KeyGenerator</code>. By default, all method arguments are taken
into account unless at least one parameter is annotated with <code>@CacheKey</code>. This is
similar to Spring&#8217;s <a href="integration.html#cache-annotations-cacheable-key">custom key generation
declaration</a>. For instance these are identical operations, one using Spring&#8217;s
abstraction and the other with JCache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(cacheNames=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>key=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span></strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)

<span class="annotation">@CacheResult</span>(cacheName=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<strong><span class="annotation">@CacheKey</span></strong> ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CacheKeyResolver</code> to use can also be specified on the operation, in a similar
fashion as the <code>CacheResolverFactory</code>.</p>
</div>
<div class="paragraph">
<p>JCache can manage exceptions thrown by annotated methods: this can prevent an update of
the cache but it can also cache the exception as an indicator of the failure instead of
calling the method again. Let&#8217;s assume that <code>InvalidIsbnNotFoundException</code> is thrown if
the structure of the ISBN is invalid. This is a permanent failure, no book could ever be
retrieved with such parameter. The following caches the exception so that further calls
with the same, invalid ISBN, throws the cached exception directly instead of invoking
the method again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CacheResult</span>(cacheName=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>, <strong>exceptionCacheName=<span class="string"><span class="delimiter">&quot;</span><span class="content">failures</span><span class="delimiter">&quot;</span></span></strong>
            <strong>cachedExceptions = InvalidIsbnNotFoundException.class</strong>)
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(ISBN isbn)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enabling-jsr-107-support"><a class="anchor" href="integration.html#enabling-jsr-107-support"></a>8.4.2. Enabling JSR-107 support</h4>
<div class="paragraph">
<p>Nothing specific needs to be done to enable the JSR-107 support alongside Spring&#8217;s
declarative annotation support. Both <code>@EnableCaching</code> and the
<code>cache:annotation-driven</code> element will enable automatically the JCache support
if both the JSR-107 API and the <code>spring-context-support</code> module are present in
the classpath.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Depending of your use case, the choice is basically yours. You can even mix
and match services using the JSR-107 API and others using Spring&#8217;s own
annotations. Be aware however that if these services are impacting the same
caches, a consistent and identical key generation implementation should be used.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache-declarative-xml"><a class="anchor" href="integration.html#cache-declarative-xml"></a>8.5. Declarative XML-based caching</h3>
<div class="paragraph">
<p>If annotations are not an option (no access to the sources or no external code), one can
use XML for declarative caching. So instead of annotating the methods for caching, one
specifies the target method and the caching directives externally (similar to the
declarative transaction management <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative-first-example">advice</a>).
The previous example can be translated into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- the service we want to make cacheable --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x.y.service.DefaultBookService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- cache definitions --&gt;</span>
<span class="tag">&lt;cache:advice</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheAdvice</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;cache:caching</span> <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;cache:cacheable</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">findBook</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#isbn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;cache:cache-evict</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadBooks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">all-entries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/cache:caching&gt;</span>
<span class="tag">&lt;/cache:advice&gt;</span>

<span class="comment">&lt;!-- apply the cacheable behavior to all BookService interfaces --&gt;</span>
<span class="tag">&lt;aop:config&gt;</span>
    <span class="tag">&lt;aop:advisor</span> <span class="attribute-name">advice-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheAdvice</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* x.y.BookService.*(..))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span>

<span class="comment">&lt;!-- cache manager definition omitted --&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the configuration above, the <code>bookService</code> is made cacheable. The caching semantics
to apply are encapsulated in the <code>cache:advice</code> definition which instructs method
<code>findBooks</code> to be used for putting data into the cache while method <code>loadBooks</code> for
evicting data. Both definitions are working against the <code>books</code> cache.</p>
</div>
<div class="paragraph">
<p>The <code>aop:config</code> definition applies the cache advice to the appropriate points in the
program by using the AspectJ pointcut expression (more information is available in
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop">Aspect Oriented Programming with Spring</a>).
In the example above, all methods from the <code>BookService</code> are considered and
the cache advice applied to them.</p>
</div>
<div class="paragraph">
<p>The declarative XML caching supports all of the annotation-based model so moving between
the two should be fairly easy - further more both can be used inside the same
application. The XML based approach does not touch the target code however it is
inherently more verbose; when dealing with classes with overloaded methods that are
targeted for caching, identifying the proper methods does take an extra effort since the
<code>method</code> argument is not a good discriminator - in these cases, the AspectJ pointcut can
be used to cherry pick the target methods and apply the appropriate caching
functionality. However through XML, it is easier to apply a package/group/interface-wide
caching (again due to the AspectJ pointcut) and to create template-like definitions (as
we did in the example above by defining the target cache through the <code>cache:definitions</code>
<code>cache</code> attribute).</p>
</div>
</div>
<div class="sect2">
<h3 id="cache-store-configuration"><a class="anchor" href="integration.html#cache-store-configuration"></a>8.6. Configuring the cache storage</h3>
<div class="paragraph">
<p>Out of the box, the cache abstraction provides several storage integration. To use
them, one needs to simply declare an appropriate <code>CacheManager</code> - an entity that
controls and manages <code>Cache</code>s and can be used to retrieve these for storage.</p>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-jdk"><a class="anchor" href="integration.html#cache-store-configuration-jdk"></a>8.6.1. JDK ConcurrentMap-based Cache</h4>
<div class="paragraph">
<p>The JDK-based <code>Cache</code> implementation resides under
<code>org.springframework.cache.concurrent</code> package. It allows one to use <code>ConcurrentHashMap</code>
as a backing <code>Cache</code> store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- simple cache manager --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.support.SimpleCacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">caches</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above uses the <code>SimpleCacheManager</code> to create a <code>CacheManager</code> for the two
nested <code>ConcurrentMapCache</code> instances named <em>default</em> and <em>books</em>. Note that the
names are configured directly for each cache.</p>
</div>
<div class="paragraph">
<p>As the cache is created by the application, it is bound to its lifecycle, making it
suitable for basic use cases, tests or simple applications. The cache scales well and is
very fast but it does not provide any management or persistence capabilities nor
eviction contracts.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-ehcache"><a class="anchor" href="integration.html#cache-store-configuration-ehcache"></a>8.6.2. Ehcache-based Cache</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ehcache 3.x is fully JSR-107 compliant and no dedicated support is required for it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Ehcache 2.x implementation is located under <code>org.springframework.cache.ehcache</code> package.
Again, to use it, one simply needs to declare the appropriate <code>CacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.ehcache.EhCacheCacheManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:cache-manager-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ehcache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- EhCache library setup --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ehcache</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.ehcache.EhCacheManagerFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:config-location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ehcache.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup bootstraps the ehcache library inside Spring IoC (through the <code>ehcache</code> bean) which
is then wired into the dedicated <code>CacheManager</code> implementation. Note the entire
ehcache-specific configuration is read from <code>ehcache.xml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-caffeine"><a class="anchor" href="integration.html#cache-store-configuration-caffeine"></a>8.6.3. Caffeine Cache</h4>
<div class="paragraph">
<p>Caffeine is a Java 8 rewrite of Guava&#8217;s cache and its implementation is located under
<code>org.springframework.cache.caffeine</code> package and provides access to several features
of Caffeine.</p>
</div>
<div class="paragraph">
<p>Configuring a <code>CacheManager</code> that creates the cache on demand is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.caffeine.CaffeineCacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to provide the caches to use explicitly. In that case, only those
will be made available by the manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.caffeine.CaffeineCacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">caches</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;set&gt;</span>
            <span class="tag">&lt;value&gt;</span>default<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>books<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Caffeine <code>CacheManager</code> also supports customs <code>Caffeine</code> and <code>CacheLoader</code>. See
the <a href="https://github.com/ben-manes/caffeine/wiki">Caffeine documentation</a> for more
information about those.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-gemfire"><a class="anchor" href="integration.html#cache-store-configuration-gemfire"></a>8.6.4. GemFire-based Cache</h4>
<div class="paragraph">
<p>GemFire is a memory-oriented/disk-backed, elastically scalable, continuously available,
active (with built-in pattern-based subscription notifications), globally replicated
database and provides fully-featured edge caching. For further information on how to use
GemFire as a CacheManager (and more), please refer to the
<a href="https://docs.spring.io/spring-gemfire/docs/current/reference/html/">Spring Data GemFire reference documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-jsr107"><a class="anchor" href="integration.html#cache-store-configuration-jsr107"></a>8.6.5. JSR-107 Cache</h4>
<div class="paragraph">
<p>JSR-107 compliant caches can also be used by Spring&#8217;s caching abstraction. The JCache
implementation is located under <code>org.springframework.cache.jcache</code> package.</p>
</div>
<div class="paragraph">
<p>Again, to use it, one simply needs to declare the appropriate <code>CacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.jcache.JCacheCacheManager</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">p:cache-manager-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jCacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- JSR-107 cache manager setup  --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jCacheManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cache-store-configuration-noop"><a class="anchor" href="integration.html#cache-store-configuration-noop"></a>8.6.6. Dealing with caches without a backing store</h4>
<div class="paragraph">
<p>Sometimes when switching environments or doing testing, one might have cache
declarations without an actual backing cache configured. As this is an invalid
configuration, at runtime an exception will be thrown since the caching infrastructure
is unable to find a suitable store. In situations like this, rather then removing the
cache declarations (which can prove tedious), one can wire in a simple, dummy cache that
performs no caching - that is, forces the cached methods to be executed every time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.support.CompositeCacheManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManagers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdkCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gemfireCache</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fallbackToNoOpCache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CompositeCacheManager</code> above chains multiple <code>CacheManager</code>s and additionally,
through the <code>fallbackToNoOpCache</code> flag, adds a <em>no op</em> cache that for all the
definitions not handled by the configured cache managers. That is, every cache
definition not found in either <code>jdkCache</code> or <code>gemfireCache</code> (configured above) will be
handled by the no op cache, which will not store any information causing the target
method to be executed every time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cache-plug"><a class="anchor" href="integration.html#cache-plug"></a>8.7. Plugging-in different back-end caches</h3>
<div class="paragraph">
<p>Clearly there are plenty of caching products out there that can be used as a backing
store. To plug them in, one needs to provide a <code>CacheManager</code> and <code>Cache</code> implementation
since unfortunately there is no available standard that we can use instead. This may
sound harder than it is since in practice, the classes tend to be simple
<a href="https://en.wikipedia.org/wiki/Adapter_pattern">adapter</a>s that map the caching abstraction
framework on top of the storage API as the <code>ehcache</code> classes can show. Most
<code>CacheManager</code> classes can use the classes in <code>org.springframework.cache.support</code>
package, such as <code>AbstractCacheManager</code> which takes care of the boiler-plate code
leaving only the actual <em>mapping</em> to be completed. We hope that in time, the libraries
that provide integration with Spring can fill in this small configuration gap.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache-specific-config"><a class="anchor" href="integration.html#cache-specific-config"></a>8.8. How can I set the TTL/TTI/Eviction policy/XXX feature?</h3>
<div class="paragraph">
<p>Directly through your cache provider. The cache abstraction is&#8230;&#8203; well, an abstraction
not a cache implementation. The solution you are using might support various data
policies and different topologies which other solutions do not (take for example the JDK
<code>ConcurrentHashMap</code>) - exposing that in the cache abstraction would be useless simply
because there would no backing support. Such functionality should be controlled directly
through the backing cache, when configuring it or through its native API.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="integration.html#appendix"></a>9. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="xsd-schemas"><a class="anchor" href="integration.html#xsd-schemas"></a>9.1. XML Schemas</h3>
<div class="paragraph">
<p>This part of the appendix lists XML schemas related to integration technologies.</p>
</div>
<div class="sect3">
<h4 id="xsd-schemas-jee"><a class="anchor" href="integration.html#xsd-schemas-jee"></a>9.1.1. The jee schema</h4>
<div class="paragraph">
<p>The <code>jee</code> tags deal with Java EE (Java Enterprise Edition)-related configuration issues,
such as looking up a JNDI object and defining EJB references.</p>
</div>
<div class="paragraph">
<p>To use the tags in the <code>jee</code> schema, you need to have the following preamble at the top
of your Spring XML configuration file; the text in the following snippet references the
correct schema so that the tags in the <code>jee</code> namespace are available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:jee</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jee</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-jndi-lookup"><a class="anchor" href="integration.html#xsd-schemas-jee-jndi-lookup"></a>&lt;jee:jndi-lookup/&gt; (simple)</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>dataSource</strong></span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jndi.JndiObjectFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.JdbcUserDao</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Spring will do the cast automatically (as usual) --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>dataSource</strong></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>dataSource</strong></span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userDao</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.JdbcUserDao</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Spring will do the cast automatically (as usual) --&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content"><strong>dataSource</strong></span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-jndi-lookup-environment-single"><a class="anchor" href="integration.html#xsd-schemas-jee-jndi-lookup-environment-single"></a>&lt;jee:jndi-lookup/&gt; (with single JNDI environment setting)</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jndi.JndiObjectFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiEnvironment</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>bar<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jee:environment&gt;</span>foo=bar<span class="tag">&lt;/jee:environment&gt;</span>
<span class="tag">&lt;/jee:jndi-lookup&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-jndi-lookup-evironment-multiple"><a class="anchor" href="integration.html#xsd-schemas-jee-jndi-lookup-evironment-multiple"></a>&lt;jee:jndi-lookup/&gt; (with multiple JNDI environment settings)</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jndi.JndiObjectFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiEnvironment</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>bar<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>pong<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- newline-separated, key-value pairs for the environment (standard Properties format) --&gt;</span>
    <span class="tag">&lt;jee:environment&gt;</span>
        foo=bar
        ping=pong
    <span class="tag">&lt;/jee:environment&gt;</span>
<span class="tag">&lt;/jee:jndi-lookup&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-jndi-lookup-complex"><a class="anchor" href="integration.html#xsd-schemas-jee-jndi-lookup-complex"></a>&lt;jee:jndi-lookup/&gt; (complex)</h5>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jndi.JndiObjectFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceRef</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lookupOnStartup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">expectedType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.myapp.DefaultFoo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.myapp.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDataSource</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">lookup-on-startup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">expected-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.myapp.DefaultFoo</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">proxy-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.myapp.Foo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-local-slsb"><a class="anchor" href="integration.html#xsd-schemas-jee-local-slsb"></a>&lt;jee:local-slsb/&gt; (simple)</h5>
<div class="paragraph">
<p>The <code>&lt;jee:local-slsb/&gt;</code> tag configures a reference to an EJB Stateless SessionBean.</p>
</div>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/RentalServiceBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:local-slsb</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleSlsb</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/RentalServiceBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">business-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-local-slsb-complex"><a class="anchor" href="integration.html#xsd-schemas-jee-local-slsb-complex"></a>&lt;jee:local-slsb/&gt; (complex)</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">complexLocalEjb</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/RentalServiceBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheHome</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lookupHomeOnStartup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceRef</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:local-slsb</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">complexLocalEjb</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/RentalServiceBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">business-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">cache-home</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">lookup-home-on-startup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="xsd-schemas-jee-remote-slsb"><a class="anchor" href="integration.html#xsd-schemas-jee-remote-slsb"></a>&lt;jee:remote-slsb/&gt;</h5>
<div class="paragraph">
<p>The <code>&lt;jee:remote-slsb/&gt;</code> tag configures a reference to a <code>remote</code> EJB Stateless
SessionBean.</p>
</div>
<div class="paragraph">
<p>Before&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">complexRemoteEjb</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/MyRemoteBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">businessInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheHome</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lookupHomeOnStartup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resourceRef</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">homeInterface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refreshHomeOnConnectFailure</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:remote-slsb</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">complexRemoteEjb</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejb/MyRemoteBean</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">business-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">cache-home</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">lookup-home-on-startup</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">home-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.service.RentalService</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">refresh-home-on-connect-failure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-jms"><a class="anchor" href="integration.html#xsd-schemas-jms"></a>9.1.2. The jms schema</h4>
<div class="paragraph">
<p>The <code>jms</code> tags deal with configuring JMS-related beans such as Spring&#8217;s
<a href="integration.html#jms-mdp">MessageListenerContainers</a>. These tags are detailed in the
section of the <a href="integration.html#jms">JMS chapter</a> entitled <a href="integration.html#jms-namespace">JMS namespace support</a>. Please do consult that chapter for full details on this support
and the <code>jms</code> tags themselves.</p>
</div>
<div class="paragraph">
<p>In the interest of completeness, to use the tags in the <code>jms</code> schema, you need to have
the following preamble at the top of your Spring XML configuration file; the text in the
following snippet references the correct schema so that the tags in the <code>jms</code> namespace
are available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jms</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-context-mbe"><a class="anchor" href="integration.html#xsd-schemas-context-mbe"></a>9.1.3. &lt;context:mbean-export/&gt;</h4>
<div class="paragraph">
<p>This element is detailed in
<a href="integration.html#jmx-context-mbeanexport">Configuring annotation based MBean export</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="xsd-schemas-cache"><a class="anchor" href="integration.html#xsd-schemas-cache"></a>9.1.4. The cache schema</h4>
<div class="paragraph">
<p>The <code>cache</code> tags can be used to enable support for Spring&#8217;s <code>@CacheEvict</code>, <code>@CachePut</code>
and <code>@Caching</code> annotations. It it also supports declarative XML-based caching. See
<a href="integration.html#cache-annotation-enable">Enable caching annotations</a> and
<a href="integration.html#cache-declarative-xml">Declarative XML-based caching</a> for details.</p>
</div>
<div class="paragraph">
<p>To use the tags in the <code>cache</code> schema, you need to have the following preamble at the
top of your Spring XML configuration file; the text in the following snippet references
the correct schema so that the tags in the <code>cache</code> namespace are available to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name"><em>xmlns:cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/cache</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content"><em>http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd</span><span class="delimiter">&quot;</span></span><span class="attribute-name"></em></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 5.0.4.RELEASE<br>
Last updated 2018-02-19 10:39:28 UTC
</div>
</div>
<script data-cfasync="false" src="../../../../cdn-cgi/scripts/d07b1474/cloudflare-static/email-decode.min.js"></script><script src="tocbot-3.0.2/tocbot.js"></script>
<script>var oldtoc=document.getElementById('toctitle').nextElementSibling;var newtoc=document.createElement('div');newtoc.setAttribute('id','tocbot');newtoc.setAttribute('class','js-toc');oldtoc.parentNode.replaceChild(newtoc,oldtoc);tocbot.init({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',smoothScroll:false});var handleTocOnResize=function(){var width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(width<768){tocbot.refresh({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',collapseDepth:6,activeLinkClass:'ignoreactive',throttleTimeout:1000,smoothScroll:false});}else{tocbot.refresh({contentSelector:'#content',headingSelector:'h1, h2, h3, h4, h5',smoothScroll:false});}};window.addEventListener('resize',handleTocOnResize);handleTocOnResize();var link=document.createElement("a");link.setAttribute("href","index.html");link.innerHTML="<i class=\"fa fa-chevron-left\" aria-hidden=\"true\"></i>&nbsp;&nbsp;Back to index";var p=document.createElement("p");p.appendChild(link);var toc=document.getElementById('toc')
var next=document.getElementById('toctitle').nextElementSibling;toc.insertBefore(p,next);</script>
<script>if(window.parent==window){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2728886-23','auto',{'siteSpeedSampleRate':100});ga('send','pageview');}</script></body>
</html>